(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const nR="modulepreload",rR=function(t){return"/Nova-AI-Planer-beta-/"+t},_y={},Ka=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=rR(l),l in _y)return;_y[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":nR,u||(p.as="script"),p.crossOrigin="",p.href=l,a&&p.setAttribute("nonce",a),document.head.appendChild(p),u)return new Promise((g,v)=>{p.addEventListener("load",g),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function iR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var QI={exports:{}},_h={},YI={exports:{}},ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _u=Symbol.for("react.element"),sR=Symbol.for("react.portal"),oR=Symbol.for("react.fragment"),aR=Symbol.for("react.strict_mode"),lR=Symbol.for("react.profiler"),uR=Symbol.for("react.provider"),cR=Symbol.for("react.context"),dR=Symbol.for("react.forward_ref"),hR=Symbol.for("react.suspense"),fR=Symbol.for("react.memo"),pR=Symbol.for("react.lazy"),yy=Symbol.iterator;function mR(t){return t===null||typeof t!="object"?null:(t=yy&&t[yy]||t["@@iterator"],typeof t=="function"?t:null)}var XI={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ZI=Object.assign,ew={};function ma(t,e,n){this.props=t,this.context=e,this.refs=ew,this.updater=n||XI}ma.prototype.isReactComponent={};ma.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ma.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function tw(){}tw.prototype=ma.prototype;function jm(t,e,n){this.props=t,this.context=e,this.refs=ew,this.updater=n||XI}var Jm=jm.prototype=new tw;Jm.constructor=jm;ZI(Jm,ma.prototype);Jm.isPureReactComponent=!0;var vy=Array.isArray,nw=Object.prototype.hasOwnProperty,Qm={current:null},rw={key:!0,ref:!0,__self:!0,__source:!0};function iw(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)nw.call(e,r)&&!rw.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:_u,type:t,key:s,ref:o,props:i,_owner:Qm.current}}function gR(t,e){return{$$typeof:_u,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ym(t){return typeof t=="object"&&t!==null&&t.$$typeof===_u}function _R(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Ty=/\/+/g;function Ef(t,e){return typeof t=="object"&&t!==null&&t.key!=null?_R(""+t.key):e.toString(36)}function qc(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case _u:case sR:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ef(o,0):r,vy(i)?(n="",t!=null&&(n=t.replace(Ty,"$&/")+"/"),qc(i,e,n,"",function(u){return u})):i!=null&&(Ym(i)&&(i=gR(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Ty,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",vy(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+Ef(s,a);o+=qc(s,e,n,l,i)}else if(l=mR(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+Ef(s,a++),o+=qc(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function gc(t,e,n){if(t==null)return t;var r=[],i=0;return qc(t,r,"","",function(s){return e.call(n,s,i++)}),r}function yR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var nn={current:null},Gc={transition:null},vR={ReactCurrentDispatcher:nn,ReactCurrentBatchConfig:Gc,ReactCurrentOwner:Qm};function sw(){throw Error("act(...) is not supported in production builds of React.")}ke.Children={map:gc,forEach:function(t,e,n){gc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return gc(t,function(){e++}),e},toArray:function(t){return gc(t,function(e){return e})||[]},only:function(t){if(!Ym(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ke.Component=ma;ke.Fragment=oR;ke.Profiler=lR;ke.PureComponent=jm;ke.StrictMode=aR;ke.Suspense=hR;ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vR;ke.act=sw;ke.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=ZI({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Qm.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)nw.call(e,l)&&!rw.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:_u,type:t.type,key:i,ref:s,props:r,_owner:o}};ke.createContext=function(t){return t={$$typeof:cR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:uR,_context:t},t.Consumer=t};ke.createElement=iw;ke.createFactory=function(t){var e=iw.bind(null,t);return e.type=t,e};ke.createRef=function(){return{current:null}};ke.forwardRef=function(t){return{$$typeof:dR,render:t}};ke.isValidElement=Ym;ke.lazy=function(t){return{$$typeof:pR,_payload:{_status:-1,_result:t},_init:yR}};ke.memo=function(t,e){return{$$typeof:fR,type:t,compare:e===void 0?null:e}};ke.startTransition=function(t){var e=Gc.transition;Gc.transition={};try{t()}finally{Gc.transition=e}};ke.unstable_act=sw;ke.useCallback=function(t,e){return nn.current.useCallback(t,e)};ke.useContext=function(t){return nn.current.useContext(t)};ke.useDebugValue=function(){};ke.useDeferredValue=function(t){return nn.current.useDeferredValue(t)};ke.useEffect=function(t,e){return nn.current.useEffect(t,e)};ke.useId=function(){return nn.current.useId()};ke.useImperativeHandle=function(t,e,n){return nn.current.useImperativeHandle(t,e,n)};ke.useInsertionEffect=function(t,e){return nn.current.useInsertionEffect(t,e)};ke.useLayoutEffect=function(t,e){return nn.current.useLayoutEffect(t,e)};ke.useMemo=function(t,e){return nn.current.useMemo(t,e)};ke.useReducer=function(t,e,n){return nn.current.useReducer(t,e,n)};ke.useRef=function(t){return nn.current.useRef(t)};ke.useState=function(t){return nn.current.useState(t)};ke.useSyncExternalStore=function(t,e,n){return nn.current.useSyncExternalStore(t,e,n)};ke.useTransition=function(){return nn.current.useTransition()};ke.version="18.3.1";YI.exports=ke;var $=YI.exports;const ow=iR($);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TR=$,ER=Symbol.for("react.element"),IR=Symbol.for("react.fragment"),wR=Object.prototype.hasOwnProperty,SR=TR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CR={key:!0,ref:!0,__self:!0,__source:!0};function aw(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)wR.call(e,r)&&!CR.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ER,type:t,key:s,ref:o,props:i,_owner:SR.current}}_h.Fragment=IR;_h.jsx=aw;_h.jsxs=aw;QI.exports=_h;var m=QI.exports,lp={},lw={exports:{}},Sn={},uw={exports:{}},cw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,le){var pe=J.length;J.push(le);e:for(;0<pe;){var Pe=pe-1>>>1,oe=J[Pe];if(0<i(oe,le))J[Pe]=le,J[pe]=oe,pe=Pe;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var le=J[0],pe=J.pop();if(pe!==le){J[0]=pe;e:for(var Pe=0,oe=J.length,et=oe>>>1;Pe<et;){var Je=2*(Pe+1)-1,jt=J[Je],Et=Je+1,sn=J[Et];if(0>i(jt,pe))Et<oe&&0>i(sn,jt)?(J[Pe]=sn,J[Et]=pe,Pe=Et):(J[Pe]=jt,J[Je]=pe,Pe=Je);else if(Et<oe&&0>i(sn,pe))J[Pe]=sn,J[Et]=pe,Pe=Et;else break e}}return le}function i(J,le){var pe=J.sortIndex-le.sortIndex;return pe!==0?pe:J.id-le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],f=1,p=null,g=3,v=!1,T=!1,x=!1,D=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(J){for(var le=n(u);le!==null;){if(le.callback===null)r(u);else if(le.startTime<=J)r(u),le.sortIndex=le.expirationTime,e(l,le);else break;le=n(u)}}function M(J){if(x=!1,R(J),!T)if(n(l)!==null)T=!0,Me(O);else{var le=n(u);le!==null&&he(M,le.startTime-J)}}function O(J,le){T=!1,x&&(x=!1,S(w),w=-1),v=!0;var pe=g;try{for(R(le),p=n(l);p!==null&&(!(p.expirationTime>le)||J&&!b());){var Pe=p.callback;if(typeof Pe=="function"){p.callback=null,g=p.priorityLevel;var oe=Pe(p.expirationTime<=le);le=t.unstable_now(),typeof oe=="function"?p.callback=oe:p===n(l)&&r(l),R(le)}else r(l);p=n(l)}if(p!==null)var et=!0;else{var Je=n(u);Je!==null&&he(M,Je.startTime-le),et=!1}return et}finally{p=null,g=pe,v=!1}}var F=!1,I=null,w=-1,C=5,N=-1;function b(){return!(t.unstable_now()-N<C)}function V(){if(I!==null){var J=t.unstable_now();N=J;var le=!0;try{le=I(!0,J)}finally{le?k():(F=!1,I=null)}}else F=!1}var k;if(typeof E=="function")k=function(){E(V)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,Fe=xe.port2;xe.port1.onmessage=V,k=function(){Fe.postMessage(null)}}else k=function(){D(V,0)};function Me(J){I=J,F||(F=!0,k())}function he(J,le){w=D(function(){J(t.unstable_now())},le)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){T||v||(T=!0,Me(O))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(J){switch(g){case 1:case 2:case 3:var le=3;break;default:le=g}var pe=g;g=le;try{return J()}finally{g=pe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,le){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var pe=g;g=J;try{return le()}finally{g=pe}},t.unstable_scheduleCallback=function(J,le,pe){var Pe=t.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?Pe+pe:Pe):pe=Pe,J){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=pe+oe,J={id:f++,callback:le,priorityLevel:J,startTime:pe,expirationTime:oe,sortIndex:-1},pe>Pe?(J.sortIndex=pe,e(u,J),n(l)===null&&J===n(u)&&(x?(S(w),w=-1):x=!0,he(M,pe-Pe))):(J.sortIndex=oe,e(l,J),T||v||(T=!0,Me(O))),J},t.unstable_shouldYield=b,t.unstable_wrapCallback=function(J){var le=g;return function(){var pe=g;g=le;try{return J.apply(this,arguments)}finally{g=pe}}}})(cw);uw.exports=cw;var AR=uw.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xR=$,In=AR;function X(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dw=new Set,Bl={};function Ws(t,e){Wo(t,e),Wo(t+"Capture",e)}function Wo(t,e){for(Bl[t]=e,t=0;t<e.length;t++)dw.add(e[t])}var Vr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),up=Object.prototype.hasOwnProperty,RR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ey={},Iy={};function PR(t){return up.call(Iy,t)?!0:up.call(Ey,t)?!1:RR.test(t)?Iy[t]=!0:(Ey[t]=!0,!1)}function kR(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function NR(t,e,n,r){if(e===null||typeof e>"u"||kR(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function rn(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ut={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ut[t]=new rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ut[e]=new rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ut[t]=new rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ut[t]=new rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ut[t]=new rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ut[t]=new rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ut[t]=new rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ut[t]=new rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ut[t]=new rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Xm=/[\-:]([a-z])/g;function Zm(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Xm,Zm);Ut[e]=new rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Xm,Zm);Ut[e]=new rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Xm,Zm);Ut[e]=new rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ut[t]=new rn(t,1,!1,t.toLowerCase(),null,!1,!1)});Ut.xlinkHref=new rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ut[t]=new rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function eg(t,e,n,r){var i=Ut.hasOwnProperty(e)?Ut[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(NR(e,n,i,r)&&(n=null),r||i===null?PR(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var zr=xR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_c=Symbol.for("react.element"),vo=Symbol.for("react.portal"),To=Symbol.for("react.fragment"),tg=Symbol.for("react.strict_mode"),cp=Symbol.for("react.profiler"),hw=Symbol.for("react.provider"),fw=Symbol.for("react.context"),ng=Symbol.for("react.forward_ref"),dp=Symbol.for("react.suspense"),hp=Symbol.for("react.suspense_list"),rg=Symbol.for("react.memo"),ni=Symbol.for("react.lazy"),pw=Symbol.for("react.offscreen"),wy=Symbol.iterator;function ja(t){return t===null||typeof t!="object"?null:(t=wy&&t[wy]||t["@@iterator"],typeof t=="function"?t:null)}var ct=Object.assign,If;function ul(t){if(If===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);If=e&&e[1]||""}return`
`+If+t}var wf=!1;function Sf(t,e){if(!t||wf)return"";wf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{wf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ul(t):""}function DR(t){switch(t.tag){case 5:return ul(t.type);case 16:return ul("Lazy");case 13:return ul("Suspense");case 19:return ul("SuspenseList");case 0:case 2:case 15:return t=Sf(t.type,!1),t;case 11:return t=Sf(t.type.render,!1),t;case 1:return t=Sf(t.type,!0),t;default:return""}}function fp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case To:return"Fragment";case vo:return"Portal";case cp:return"Profiler";case tg:return"StrictMode";case dp:return"Suspense";case hp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case fw:return(t.displayName||"Context")+".Consumer";case hw:return(t._context.displayName||"Context")+".Provider";case ng:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rg:return e=t.displayName||null,e!==null?e:fp(t.type)||"Memo";case ni:e=t._payload,t=t._init;try{return fp(t(e))}catch{}}return null}function bR(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fp(e);case 8:return e===tg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ri(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function mw(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function MR(t){var e=mw(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function yc(t){t._valueTracker||(t._valueTracker=MR(t))}function gw(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=mw(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function yd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function pp(t,e){var n=e.checked;return ct({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Sy(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ri(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _w(t,e){e=e.checked,e!=null&&eg(t,"checked",e,!1)}function mp(t,e){_w(t,e);var n=Ri(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?gp(t,e.type,n):e.hasOwnProperty("defaultValue")&&gp(t,e.type,Ri(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Cy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function gp(t,e,n){(e!=="number"||yd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var cl=Array.isArray;function bo(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ri(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function _p(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return ct({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ay(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(X(92));if(cl(n)){if(1<n.length)throw Error(X(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ri(n)}}function yw(t,e){var n=Ri(e.value),r=Ri(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function xy(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function vw(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?vw(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vc,Tw=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vc=vc||document.createElement("div"),vc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ql(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var yl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},VR=["Webkit","ms","Moz","O"];Object.keys(yl).forEach(function(t){VR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),yl[e]=yl[t]})});function Ew(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||yl.hasOwnProperty(t)&&yl[t]?(""+e).trim():e+"px"}function Iw(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Ew(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var LR=ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vp(t,e){if(e){if(LR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function Tp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ep=null;function ig(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ip=null,Mo=null,Vo=null;function Ry(t){if(t=Tu(t)){if(typeof Ip!="function")throw Error(X(280));var e=t.stateNode;e&&(e=Ih(e),Ip(t.stateNode,t.type,e))}}function ww(t){Mo?Vo?Vo.push(t):Vo=[t]:Mo=t}function Sw(){if(Mo){var t=Mo,e=Vo;if(Vo=Mo=null,Ry(t),e)for(t=0;t<e.length;t++)Ry(e[t])}}function Cw(t,e){return t(e)}function Aw(){}var Cf=!1;function xw(t,e,n){if(Cf)return t(e,n);Cf=!0;try{return Cw(t,e,n)}finally{Cf=!1,(Mo!==null||Vo!==null)&&(Aw(),Sw())}}function Gl(t,e){var n=t.stateNode;if(n===null)return null;var r=Ih(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(X(231,e,typeof n));return n}var wp=!1;if(Vr)try{var Ja={};Object.defineProperty(Ja,"passive",{get:function(){wp=!0}}),window.addEventListener("test",Ja,Ja),window.removeEventListener("test",Ja,Ja)}catch{wp=!1}function FR(t,e,n,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(f){this.onError(f)}}var vl=!1,vd=null,Td=!1,Sp=null,UR={onError:function(t){vl=!0,vd=t}};function OR(t,e,n,r,i,s,o,a,l){vl=!1,vd=null,FR.apply(UR,arguments)}function BR(t,e,n,r,i,s,o,a,l){if(OR.apply(this,arguments),vl){if(vl){var u=vd;vl=!1,vd=null}else throw Error(X(198));Td||(Td=!0,Sp=u)}}function Ks(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Rw(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Py(t){if(Ks(t)!==t)throw Error(X(188))}function qR(t){var e=t.alternate;if(!e){if(e=Ks(t),e===null)throw Error(X(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Py(i),t;if(s===r)return Py(i),e;s=s.sibling}throw Error(X(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(X(189))}}if(n.alternate!==r)throw Error(X(190))}if(n.tag!==3)throw Error(X(188));return n.stateNode.current===n?t:e}function Pw(t){return t=qR(t),t!==null?kw(t):null}function kw(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=kw(t);if(e!==null)return e;t=t.sibling}return null}var Nw=In.unstable_scheduleCallback,ky=In.unstable_cancelCallback,GR=In.unstable_shouldYield,zR=In.unstable_requestPaint,mt=In.unstable_now,$R=In.unstable_getCurrentPriorityLevel,sg=In.unstable_ImmediatePriority,Dw=In.unstable_UserBlockingPriority,Ed=In.unstable_NormalPriority,HR=In.unstable_LowPriority,bw=In.unstable_IdlePriority,yh=null,cr=null;function WR(t){if(cr&&typeof cr.onCommitFiberRoot=="function")try{cr.onCommitFiberRoot(yh,t,void 0,(t.current.flags&128)===128)}catch{}}var Kn=Math.clz32?Math.clz32:JR,KR=Math.log,jR=Math.LN2;function JR(t){return t>>>=0,t===0?32:31-(KR(t)/jR|0)|0}var Tc=64,Ec=4194304;function dl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Id(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=dl(a):(s&=o,s!==0&&(r=dl(s)))}else o=n&~i,o!==0?r=dl(o):s!==0&&(r=dl(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Kn(e),i=1<<n,r|=t[n],e&=~i;return r}function QR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function YR(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Kn(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=QR(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Cp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Mw(){var t=Tc;return Tc<<=1,!(Tc&4194240)&&(Tc=64),t}function Af(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function yu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Kn(e),t[e]=n}function XR(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Kn(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function og(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Kn(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var He=0;function Vw(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Lw,ag,Fw,Uw,Ow,Ap=!1,Ic=[],fi=null,pi=null,mi=null,zl=new Map,$l=new Map,ii=[],ZR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ny(t,e){switch(t){case"focusin":case"focusout":fi=null;break;case"dragenter":case"dragleave":pi=null;break;case"mouseover":case"mouseout":mi=null;break;case"pointerover":case"pointerout":zl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":$l.delete(e.pointerId)}}function Qa(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Tu(e),e!==null&&ag(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function eP(t,e,n,r,i){switch(e){case"focusin":return fi=Qa(fi,t,e,n,r,i),!0;case"dragenter":return pi=Qa(pi,t,e,n,r,i),!0;case"mouseover":return mi=Qa(mi,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return zl.set(s,Qa(zl.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,$l.set(s,Qa($l.get(s)||null,t,e,n,r,i)),!0}return!1}function Bw(t){var e=Es(t.target);if(e!==null){var n=Ks(e);if(n!==null){if(e=n.tag,e===13){if(e=Rw(n),e!==null){t.blockedOn=e,Ow(t.priority,function(){Fw(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function zc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ep=r,n.target.dispatchEvent(r),Ep=null}else return e=Tu(n),e!==null&&ag(e),t.blockedOn=n,!1;e.shift()}return!0}function Dy(t,e,n){zc(t)&&n.delete(e)}function tP(){Ap=!1,fi!==null&&zc(fi)&&(fi=null),pi!==null&&zc(pi)&&(pi=null),mi!==null&&zc(mi)&&(mi=null),zl.forEach(Dy),$l.forEach(Dy)}function Ya(t,e){t.blockedOn===e&&(t.blockedOn=null,Ap||(Ap=!0,In.unstable_scheduleCallback(In.unstable_NormalPriority,tP)))}function Hl(t){function e(i){return Ya(i,t)}if(0<Ic.length){Ya(Ic[0],t);for(var n=1;n<Ic.length;n++){var r=Ic[n];r.blockedOn===t&&(r.blockedOn=null)}}for(fi!==null&&Ya(fi,t),pi!==null&&Ya(pi,t),mi!==null&&Ya(mi,t),zl.forEach(e),$l.forEach(e),n=0;n<ii.length;n++)r=ii[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ii.length&&(n=ii[0],n.blockedOn===null);)Bw(n),n.blockedOn===null&&ii.shift()}var Lo=zr.ReactCurrentBatchConfig,wd=!0;function nP(t,e,n,r){var i=He,s=Lo.transition;Lo.transition=null;try{He=1,lg(t,e,n,r)}finally{He=i,Lo.transition=s}}function rP(t,e,n,r){var i=He,s=Lo.transition;Lo.transition=null;try{He=4,lg(t,e,n,r)}finally{He=i,Lo.transition=s}}function lg(t,e,n,r){if(wd){var i=xp(t,e,n,r);if(i===null)Lf(t,e,r,Sd,n),Ny(t,r);else if(eP(i,t,e,n,r))r.stopPropagation();else if(Ny(t,r),e&4&&-1<ZR.indexOf(t)){for(;i!==null;){var s=Tu(i);if(s!==null&&Lw(s),s=xp(t,e,n,r),s===null&&Lf(t,e,r,Sd,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Lf(t,e,r,null,n)}}var Sd=null;function xp(t,e,n,r){if(Sd=null,t=ig(r),t=Es(t),t!==null)if(e=Ks(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Rw(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Sd=t,null}function qw(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($R()){case sg:return 1;case Dw:return 4;case Ed:case HR:return 16;case bw:return 536870912;default:return 16}default:return 16}}var ci=null,ug=null,$c=null;function Gw(){if($c)return $c;var t,e=ug,n=e.length,r,i="value"in ci?ci.value:ci.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return $c=i.slice(t,1<r?1-r:void 0)}function Hc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function wc(){return!0}function by(){return!1}function Cn(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?wc:by,this.isPropagationStopped=by,this}return ct(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=wc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=wc)},persist:function(){},isPersistent:wc}),e}var ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cg=Cn(ga),vu=ct({},ga,{view:0,detail:0}),iP=Cn(vu),xf,Rf,Xa,vh=ct({},vu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Xa&&(Xa&&t.type==="mousemove"?(xf=t.screenX-Xa.screenX,Rf=t.screenY-Xa.screenY):Rf=xf=0,Xa=t),xf)},movementY:function(t){return"movementY"in t?t.movementY:Rf}}),My=Cn(vh),sP=ct({},vh,{dataTransfer:0}),oP=Cn(sP),aP=ct({},vu,{relatedTarget:0}),Pf=Cn(aP),lP=ct({},ga,{animationName:0,elapsedTime:0,pseudoElement:0}),uP=Cn(lP),cP=ct({},ga,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dP=Cn(cP),hP=ct({},ga,{data:0}),Vy=Cn(hP),fP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mP[t])?!!e[t]:!1}function dg(){return gP}var _P=ct({},vu,{key:function(t){if(t.key){var e=fP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Hc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dg,charCode:function(t){return t.type==="keypress"?Hc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Hc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),yP=Cn(_P),vP=ct({},vh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ly=Cn(vP),TP=ct({},vu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dg}),EP=Cn(TP),IP=ct({},ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),wP=Cn(IP),SP=ct({},vh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CP=Cn(SP),AP=[9,13,27,32],hg=Vr&&"CompositionEvent"in window,Tl=null;Vr&&"documentMode"in document&&(Tl=document.documentMode);var xP=Vr&&"TextEvent"in window&&!Tl,zw=Vr&&(!hg||Tl&&8<Tl&&11>=Tl),Fy=" ",Uy=!1;function $w(t,e){switch(t){case"keyup":return AP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Eo=!1;function RP(t,e){switch(t){case"compositionend":return Hw(e);case"keypress":return e.which!==32?null:(Uy=!0,Fy);case"textInput":return t=e.data,t===Fy&&Uy?null:t;default:return null}}function PP(t,e){if(Eo)return t==="compositionend"||!hg&&$w(t,e)?(t=Gw(),$c=ug=ci=null,Eo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return zw&&e.locale!=="ko"?null:e.data;default:return null}}var kP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Oy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!kP[t.type]:e==="textarea"}function Ww(t,e,n,r){ww(r),e=Cd(e,"onChange"),0<e.length&&(n=new cg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var El=null,Wl=null;function NP(t){rS(t,0)}function Th(t){var e=So(t);if(gw(e))return t}function DP(t,e){if(t==="change")return e}var Kw=!1;if(Vr){var kf;if(Vr){var Nf="oninput"in document;if(!Nf){var By=document.createElement("div");By.setAttribute("oninput","return;"),Nf=typeof By.oninput=="function"}kf=Nf}else kf=!1;Kw=kf&&(!document.documentMode||9<document.documentMode)}function qy(){El&&(El.detachEvent("onpropertychange",jw),Wl=El=null)}function jw(t){if(t.propertyName==="value"&&Th(Wl)){var e=[];Ww(e,Wl,t,ig(t)),xw(NP,e)}}function bP(t,e,n){t==="focusin"?(qy(),El=e,Wl=n,El.attachEvent("onpropertychange",jw)):t==="focusout"&&qy()}function MP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Th(Wl)}function VP(t,e){if(t==="click")return Th(e)}function LP(t,e){if(t==="input"||t==="change")return Th(e)}function FP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Xn=typeof Object.is=="function"?Object.is:FP;function Kl(t,e){if(Xn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!up.call(e,i)||!Xn(t[i],e[i]))return!1}return!0}function Gy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function zy(t,e){var n=Gy(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Gy(n)}}function Jw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Jw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Qw(){for(var t=window,e=yd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=yd(t.document)}return e}function fg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function UP(t){var e=Qw(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Jw(n.ownerDocument.documentElement,n)){if(r!==null&&fg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=zy(n,s);var o=zy(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var OP=Vr&&"documentMode"in document&&11>=document.documentMode,Io=null,Rp=null,Il=null,Pp=!1;function $y(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Pp||Io==null||Io!==yd(r)||(r=Io,"selectionStart"in r&&fg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Il&&Kl(Il,r)||(Il=r,r=Cd(Rp,"onSelect"),0<r.length&&(e=new cg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Io)))}function Sc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wo={animationend:Sc("Animation","AnimationEnd"),animationiteration:Sc("Animation","AnimationIteration"),animationstart:Sc("Animation","AnimationStart"),transitionend:Sc("Transition","TransitionEnd")},Df={},Yw={};Vr&&(Yw=document.createElement("div").style,"AnimationEvent"in window||(delete wo.animationend.animation,delete wo.animationiteration.animation,delete wo.animationstart.animation),"TransitionEvent"in window||delete wo.transitionend.transition);function Eh(t){if(Df[t])return Df[t];if(!wo[t])return t;var e=wo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Yw)return Df[t]=e[n];return t}var Xw=Eh("animationend"),Zw=Eh("animationiteration"),eS=Eh("animationstart"),tS=Eh("transitionend"),nS=new Map,Hy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fi(t,e){nS.set(t,e),Ws(e,[t])}for(var bf=0;bf<Hy.length;bf++){var Mf=Hy[bf],BP=Mf.toLowerCase(),qP=Mf[0].toUpperCase()+Mf.slice(1);Fi(BP,"on"+qP)}Fi(Xw,"onAnimationEnd");Fi(Zw,"onAnimationIteration");Fi(eS,"onAnimationStart");Fi("dblclick","onDoubleClick");Fi("focusin","onFocus");Fi("focusout","onBlur");Fi(tS,"onTransitionEnd");Wo("onMouseEnter",["mouseout","mouseover"]);Wo("onMouseLeave",["mouseout","mouseover"]);Wo("onPointerEnter",["pointerout","pointerover"]);Wo("onPointerLeave",["pointerout","pointerover"]);Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GP=new Set("cancel close invalid load scroll toggle".split(" ").concat(hl));function Wy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,BR(r,e,void 0,t),t.currentTarget=null}function rS(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Wy(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Wy(i,a,u),s=l}}}if(Td)throw t=Sp,Td=!1,Sp=null,t}function Ye(t,e){var n=e[Mp];n===void 0&&(n=e[Mp]=new Set);var r=t+"__bubble";n.has(r)||(iS(e,t,2,!1),n.add(r))}function Vf(t,e,n){var r=0;e&&(r|=4),iS(n,t,r,e)}var Cc="_reactListening"+Math.random().toString(36).slice(2);function jl(t){if(!t[Cc]){t[Cc]=!0,dw.forEach(function(n){n!=="selectionchange"&&(GP.has(n)||Vf(n,!1,t),Vf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Cc]||(e[Cc]=!0,Vf("selectionchange",!1,e))}}function iS(t,e,n,r){switch(qw(e)){case 1:var i=nP;break;case 4:i=rP;break;default:i=lg}n=i.bind(null,e,n,t),i=void 0,!wp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Lf(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Es(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}xw(function(){var u=s,f=ig(n),p=[];e:{var g=nS.get(t);if(g!==void 0){var v=cg,T=t;switch(t){case"keypress":if(Hc(n)===0)break e;case"keydown":case"keyup":v=yP;break;case"focusin":T="focus",v=Pf;break;case"focusout":T="blur",v=Pf;break;case"beforeblur":case"afterblur":v=Pf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=My;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=oP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=EP;break;case Xw:case Zw:case eS:v=uP;break;case tS:v=wP;break;case"scroll":v=iP;break;case"wheel":v=CP;break;case"copy":case"cut":case"paste":v=dP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=Ly}var x=(e&4)!==0,D=!x&&t==="scroll",S=x?g!==null?g+"Capture":null:g;x=[];for(var E=u,R;E!==null;){R=E;var M=R.stateNode;if(R.tag===5&&M!==null&&(R=M,S!==null&&(M=Gl(E,S),M!=null&&x.push(Jl(E,M,R)))),D)break;E=E.return}0<x.length&&(g=new v(g,T,null,n,f),p.push({event:g,listeners:x}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",v=t==="mouseout"||t==="pointerout",g&&n!==Ep&&(T=n.relatedTarget||n.fromElement)&&(Es(T)||T[Lr]))break e;if((v||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,v?(T=n.relatedTarget||n.toElement,v=u,T=T?Es(T):null,T!==null&&(D=Ks(T),T!==D||T.tag!==5&&T.tag!==6)&&(T=null)):(v=null,T=u),v!==T)){if(x=My,M="onMouseLeave",S="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(x=Ly,M="onPointerLeave",S="onPointerEnter",E="pointer"),D=v==null?g:So(v),R=T==null?g:So(T),g=new x(M,E+"leave",v,n,f),g.target=D,g.relatedTarget=R,M=null,Es(f)===u&&(x=new x(S,E+"enter",T,n,f),x.target=R,x.relatedTarget=D,M=x),D=M,v&&T)t:{for(x=v,S=T,E=0,R=x;R;R=io(R))E++;for(R=0,M=S;M;M=io(M))R++;for(;0<E-R;)x=io(x),E--;for(;0<R-E;)S=io(S),R--;for(;E--;){if(x===S||S!==null&&x===S.alternate)break t;x=io(x),S=io(S)}x=null}else x=null;v!==null&&Ky(p,g,v,x,!1),T!==null&&D!==null&&Ky(p,D,T,x,!0)}}e:{if(g=u?So(u):window,v=g.nodeName&&g.nodeName.toLowerCase(),v==="select"||v==="input"&&g.type==="file")var O=DP;else if(Oy(g))if(Kw)O=LP;else{O=MP;var F=bP}else(v=g.nodeName)&&v.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(O=VP);if(O&&(O=O(t,u))){Ww(p,O,n,f);break e}F&&F(t,g,u),t==="focusout"&&(F=g._wrapperState)&&F.controlled&&g.type==="number"&&gp(g,"number",g.value)}switch(F=u?So(u):window,t){case"focusin":(Oy(F)||F.contentEditable==="true")&&(Io=F,Rp=u,Il=null);break;case"focusout":Il=Rp=Io=null;break;case"mousedown":Pp=!0;break;case"contextmenu":case"mouseup":case"dragend":Pp=!1,$y(p,n,f);break;case"selectionchange":if(OP)break;case"keydown":case"keyup":$y(p,n,f)}var I;if(hg)e:{switch(t){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Eo?$w(t,n)&&(w="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(zw&&n.locale!=="ko"&&(Eo||w!=="onCompositionStart"?w==="onCompositionEnd"&&Eo&&(I=Gw()):(ci=f,ug="value"in ci?ci.value:ci.textContent,Eo=!0)),F=Cd(u,w),0<F.length&&(w=new Vy(w,t,null,n,f),p.push({event:w,listeners:F}),I?w.data=I:(I=Hw(n),I!==null&&(w.data=I)))),(I=xP?RP(t,n):PP(t,n))&&(u=Cd(u,"onBeforeInput"),0<u.length&&(f=new Vy("onBeforeInput","beforeinput",null,n,f),p.push({event:f,listeners:u}),f.data=I))}rS(p,e)})}function Jl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Cd(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Gl(t,n),s!=null&&r.unshift(Jl(t,s,i)),s=Gl(t,e),s!=null&&r.push(Jl(t,s,i))),t=t.return}return r}function io(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ky(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=Gl(n,s),l!=null&&o.unshift(Jl(n,l,a))):i||(l=Gl(n,s),l!=null&&o.push(Jl(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var zP=/\r\n?/g,$P=/\u0000|\uFFFD/g;function jy(t){return(typeof t=="string"?t:""+t).replace(zP,`
`).replace($P,"")}function Ac(t,e,n){if(e=jy(e),jy(t)!==e&&n)throw Error(X(425))}function Ad(){}var kp=null,Np=null;function Dp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bp=typeof setTimeout=="function"?setTimeout:void 0,HP=typeof clearTimeout=="function"?clearTimeout:void 0,Jy=typeof Promise=="function"?Promise:void 0,WP=typeof queueMicrotask=="function"?queueMicrotask:typeof Jy<"u"?function(t){return Jy.resolve(null).then(t).catch(KP)}:bp;function KP(t){setTimeout(function(){throw t})}function Ff(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Hl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Hl(e)}function gi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Qy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var _a=Math.random().toString(36).slice(2),ar="__reactFiber$"+_a,Ql="__reactProps$"+_a,Lr="__reactContainer$"+_a,Mp="__reactEvents$"+_a,jP="__reactListeners$"+_a,JP="__reactHandles$"+_a;function Es(t){var e=t[ar];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Lr]||n[ar]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Qy(t);t!==null;){if(n=t[ar])return n;t=Qy(t)}return e}t=n,n=t.parentNode}return null}function Tu(t){return t=t[ar]||t[Lr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function So(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(X(33))}function Ih(t){return t[Ql]||null}var Vp=[],Co=-1;function Ui(t){return{current:t}}function Ze(t){0>Co||(t.current=Vp[Co],Vp[Co]=null,Co--)}function Qe(t,e){Co++,Vp[Co]=t.current,t.current=e}var Pi={},Kt=Ui(Pi),cn=Ui(!1),Ds=Pi;function Ko(t,e){var n=t.type.contextTypes;if(!n)return Pi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function dn(t){return t=t.childContextTypes,t!=null}function xd(){Ze(cn),Ze(Kt)}function Yy(t,e,n){if(Kt.current!==Pi)throw Error(X(168));Qe(Kt,e),Qe(cn,n)}function sS(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(X(108,bR(t)||"Unknown",i));return ct({},n,r)}function Rd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Pi,Ds=Kt.current,Qe(Kt,t),Qe(cn,cn.current),!0}function Xy(t,e,n){var r=t.stateNode;if(!r)throw Error(X(169));n?(t=sS(t,e,Ds),r.__reactInternalMemoizedMergedChildContext=t,Ze(cn),Ze(Kt),Qe(Kt,t)):Ze(cn),Qe(cn,n)}var Ar=null,wh=!1,Uf=!1;function oS(t){Ar===null?Ar=[t]:Ar.push(t)}function QP(t){wh=!0,oS(t)}function Oi(){if(!Uf&&Ar!==null){Uf=!0;var t=0,e=He;try{var n=Ar;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ar=null,wh=!1}catch(i){throw Ar!==null&&(Ar=Ar.slice(t+1)),Nw(sg,Oi),i}finally{He=e,Uf=!1}}return null}var Ao=[],xo=0,Pd=null,kd=0,xn=[],Rn=0,bs=null,Rr=1,Pr="";function ds(t,e){Ao[xo++]=kd,Ao[xo++]=Pd,Pd=t,kd=e}function aS(t,e,n){xn[Rn++]=Rr,xn[Rn++]=Pr,xn[Rn++]=bs,bs=t;var r=Rr;t=Pr;var i=32-Kn(r)-1;r&=~(1<<i),n+=1;var s=32-Kn(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Rr=1<<32-Kn(e)+i|n<<i|r,Pr=s+t}else Rr=1<<s|n<<i|r,Pr=t}function pg(t){t.return!==null&&(ds(t,1),aS(t,1,0))}function mg(t){for(;t===Pd;)Pd=Ao[--xo],Ao[xo]=null,kd=Ao[--xo],Ao[xo]=null;for(;t===bs;)bs=xn[--Rn],xn[Rn]=null,Pr=xn[--Rn],xn[Rn]=null,Rr=xn[--Rn],xn[Rn]=null}var En=null,vn=null,rt=!1,$n=null;function lS(t,e){var n=Pn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Zy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,En=t,vn=gi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,En=t,vn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=bs!==null?{id:Rr,overflow:Pr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Pn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,En=t,vn=null,!0):!1;default:return!1}}function Lp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Fp(t){if(rt){var e=vn;if(e){var n=e;if(!Zy(t,e)){if(Lp(t))throw Error(X(418));e=gi(n.nextSibling);var r=En;e&&Zy(t,e)?lS(r,n):(t.flags=t.flags&-4097|2,rt=!1,En=t)}}else{if(Lp(t))throw Error(X(418));t.flags=t.flags&-4097|2,rt=!1,En=t}}}function ev(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;En=t}function xc(t){if(t!==En)return!1;if(!rt)return ev(t),rt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Dp(t.type,t.memoizedProps)),e&&(e=vn)){if(Lp(t))throw uS(),Error(X(418));for(;e;)lS(t,e),e=gi(e.nextSibling)}if(ev(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){vn=gi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}vn=null}}else vn=En?gi(t.stateNode.nextSibling):null;return!0}function uS(){for(var t=vn;t;)t=gi(t.nextSibling)}function jo(){vn=En=null,rt=!1}function gg(t){$n===null?$n=[t]:$n.push(t)}var YP=zr.ReactCurrentBatchConfig;function Za(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(X(309));var r=n.stateNode}if(!r)throw Error(X(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(X(284));if(!n._owner)throw Error(X(290,t))}return t}function Rc(t,e){throw t=Object.prototype.toString.call(e),Error(X(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function tv(t){var e=t._init;return e(t._payload)}function cS(t){function e(S,E){if(t){var R=S.deletions;R===null?(S.deletions=[E],S.flags|=16):R.push(E)}}function n(S,E){if(!t)return null;for(;E!==null;)e(S,E),E=E.sibling;return null}function r(S,E){for(S=new Map;E!==null;)E.key!==null?S.set(E.key,E):S.set(E.index,E),E=E.sibling;return S}function i(S,E){return S=Ti(S,E),S.index=0,S.sibling=null,S}function s(S,E,R){return S.index=R,t?(R=S.alternate,R!==null?(R=R.index,R<E?(S.flags|=2,E):R):(S.flags|=2,E)):(S.flags|=1048576,E)}function o(S){return t&&S.alternate===null&&(S.flags|=2),S}function a(S,E,R,M){return E===null||E.tag!==6?(E=Hf(R,S.mode,M),E.return=S,E):(E=i(E,R),E.return=S,E)}function l(S,E,R,M){var O=R.type;return O===To?f(S,E,R.props.children,M,R.key):E!==null&&(E.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===ni&&tv(O)===E.type)?(M=i(E,R.props),M.ref=Za(S,E,R),M.return=S,M):(M=Xc(R.type,R.key,R.props,null,S.mode,M),M.ref=Za(S,E,R),M.return=S,M)}function u(S,E,R,M){return E===null||E.tag!==4||E.stateNode.containerInfo!==R.containerInfo||E.stateNode.implementation!==R.implementation?(E=Wf(R,S.mode,M),E.return=S,E):(E=i(E,R.children||[]),E.return=S,E)}function f(S,E,R,M,O){return E===null||E.tag!==7?(E=xs(R,S.mode,M,O),E.return=S,E):(E=i(E,R),E.return=S,E)}function p(S,E,R){if(typeof E=="string"&&E!==""||typeof E=="number")return E=Hf(""+E,S.mode,R),E.return=S,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case _c:return R=Xc(E.type,E.key,E.props,null,S.mode,R),R.ref=Za(S,null,E),R.return=S,R;case vo:return E=Wf(E,S.mode,R),E.return=S,E;case ni:var M=E._init;return p(S,M(E._payload),R)}if(cl(E)||ja(E))return E=xs(E,S.mode,R,null),E.return=S,E;Rc(S,E)}return null}function g(S,E,R,M){var O=E!==null?E.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return O!==null?null:a(S,E,""+R,M);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case _c:return R.key===O?l(S,E,R,M):null;case vo:return R.key===O?u(S,E,R,M):null;case ni:return O=R._init,g(S,E,O(R._payload),M)}if(cl(R)||ja(R))return O!==null?null:f(S,E,R,M,null);Rc(S,R)}return null}function v(S,E,R,M,O){if(typeof M=="string"&&M!==""||typeof M=="number")return S=S.get(R)||null,a(E,S,""+M,O);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case _c:return S=S.get(M.key===null?R:M.key)||null,l(E,S,M,O);case vo:return S=S.get(M.key===null?R:M.key)||null,u(E,S,M,O);case ni:var F=M._init;return v(S,E,R,F(M._payload),O)}if(cl(M)||ja(M))return S=S.get(R)||null,f(E,S,M,O,null);Rc(E,M)}return null}function T(S,E,R,M){for(var O=null,F=null,I=E,w=E=0,C=null;I!==null&&w<R.length;w++){I.index>w?(C=I,I=null):C=I.sibling;var N=g(S,I,R[w],M);if(N===null){I===null&&(I=C);break}t&&I&&N.alternate===null&&e(S,I),E=s(N,E,w),F===null?O=N:F.sibling=N,F=N,I=C}if(w===R.length)return n(S,I),rt&&ds(S,w),O;if(I===null){for(;w<R.length;w++)I=p(S,R[w],M),I!==null&&(E=s(I,E,w),F===null?O=I:F.sibling=I,F=I);return rt&&ds(S,w),O}for(I=r(S,I);w<R.length;w++)C=v(I,S,w,R[w],M),C!==null&&(t&&C.alternate!==null&&I.delete(C.key===null?w:C.key),E=s(C,E,w),F===null?O=C:F.sibling=C,F=C);return t&&I.forEach(function(b){return e(S,b)}),rt&&ds(S,w),O}function x(S,E,R,M){var O=ja(R);if(typeof O!="function")throw Error(X(150));if(R=O.call(R),R==null)throw Error(X(151));for(var F=O=null,I=E,w=E=0,C=null,N=R.next();I!==null&&!N.done;w++,N=R.next()){I.index>w?(C=I,I=null):C=I.sibling;var b=g(S,I,N.value,M);if(b===null){I===null&&(I=C);break}t&&I&&b.alternate===null&&e(S,I),E=s(b,E,w),F===null?O=b:F.sibling=b,F=b,I=C}if(N.done)return n(S,I),rt&&ds(S,w),O;if(I===null){for(;!N.done;w++,N=R.next())N=p(S,N.value,M),N!==null&&(E=s(N,E,w),F===null?O=N:F.sibling=N,F=N);return rt&&ds(S,w),O}for(I=r(S,I);!N.done;w++,N=R.next())N=v(I,S,w,N.value,M),N!==null&&(t&&N.alternate!==null&&I.delete(N.key===null?w:N.key),E=s(N,E,w),F===null?O=N:F.sibling=N,F=N);return t&&I.forEach(function(V){return e(S,V)}),rt&&ds(S,w),O}function D(S,E,R,M){if(typeof R=="object"&&R!==null&&R.type===To&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case _c:e:{for(var O=R.key,F=E;F!==null;){if(F.key===O){if(O=R.type,O===To){if(F.tag===7){n(S,F.sibling),E=i(F,R.props.children),E.return=S,S=E;break e}}else if(F.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===ni&&tv(O)===F.type){n(S,F.sibling),E=i(F,R.props),E.ref=Za(S,F,R),E.return=S,S=E;break e}n(S,F);break}else e(S,F);F=F.sibling}R.type===To?(E=xs(R.props.children,S.mode,M,R.key),E.return=S,S=E):(M=Xc(R.type,R.key,R.props,null,S.mode,M),M.ref=Za(S,E,R),M.return=S,S=M)}return o(S);case vo:e:{for(F=R.key;E!==null;){if(E.key===F)if(E.tag===4&&E.stateNode.containerInfo===R.containerInfo&&E.stateNode.implementation===R.implementation){n(S,E.sibling),E=i(E,R.children||[]),E.return=S,S=E;break e}else{n(S,E);break}else e(S,E);E=E.sibling}E=Wf(R,S.mode,M),E.return=S,S=E}return o(S);case ni:return F=R._init,D(S,E,F(R._payload),M)}if(cl(R))return T(S,E,R,M);if(ja(R))return x(S,E,R,M);Rc(S,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,E!==null&&E.tag===6?(n(S,E.sibling),E=i(E,R),E.return=S,S=E):(n(S,E),E=Hf(R,S.mode,M),E.return=S,S=E),o(S)):n(S,E)}return D}var Jo=cS(!0),dS=cS(!1),Nd=Ui(null),Dd=null,Ro=null,_g=null;function yg(){_g=Ro=Dd=null}function vg(t){var e=Nd.current;Ze(Nd),t._currentValue=e}function Up(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Fo(t,e){Dd=t,_g=Ro=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ln=!0),t.firstContext=null)}function Vn(t){var e=t._currentValue;if(_g!==t)if(t={context:t,memoizedValue:e,next:null},Ro===null){if(Dd===null)throw Error(X(308));Ro=t,Dd.dependencies={lanes:0,firstContext:t}}else Ro=Ro.next=t;return e}var Is=null;function Tg(t){Is===null?Is=[t]:Is.push(t)}function hS(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Tg(e)):(n.next=i.next,i.next=n),e.interleaved=n,Fr(t,r)}function Fr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ri=!1;function Eg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fS(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function br(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function _i(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Oe&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Fr(t,n)}return i=r.interleaved,i===null?(e.next=e,Tg(r)):(e.next=i.next,i.next=e),r.interleaved=e,Fr(t,n)}function Wc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}function nv(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function bd(t,e,n,r){var i=t.updateQueue;ri=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var f=t.alternate;f!==null&&(f=f.updateQueue,a=f.lastBaseUpdate,a!==o&&(a===null?f.firstBaseUpdate=u:a.next=u,f.lastBaseUpdate=l))}if(s!==null){var p=i.baseState;o=0,f=u=l=null,a=s;do{var g=a.lane,v=a.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:v,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var T=t,x=a;switch(g=e,v=n,x.tag){case 1:if(T=x.payload,typeof T=="function"){p=T.call(v,p,g);break e}p=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=x.payload,g=typeof T=="function"?T.call(v,p,g):T,g==null)break e;p=ct({},p,g);break e;case 2:ri=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,g=i.effects,g===null?i.effects=[a]:g.push(a))}else v={eventTime:v,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},f===null?(u=f=v,l=p):f=f.next=v,o|=g;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;g=a,a=g.next,g.next=null,i.lastBaseUpdate=g,i.shared.pending=null}}while(!0);if(f===null&&(l=p),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=f,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Vs|=o,t.lanes=o,t.memoizedState=p}}function rv(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(X(191,i));i.call(r)}}}var Eu={},dr=Ui(Eu),Yl=Ui(Eu),Xl=Ui(Eu);function ws(t){if(t===Eu)throw Error(X(174));return t}function Ig(t,e){switch(Qe(Xl,e),Qe(Yl,t),Qe(dr,Eu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:yp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=yp(e,t)}Ze(dr),Qe(dr,e)}function Qo(){Ze(dr),Ze(Yl),Ze(Xl)}function pS(t){ws(Xl.current);var e=ws(dr.current),n=yp(e,t.type);e!==n&&(Qe(Yl,t),Qe(dr,n))}function wg(t){Yl.current===t&&(Ze(dr),Ze(Yl))}var at=Ui(0);function Md(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Of=[];function Sg(){for(var t=0;t<Of.length;t++)Of[t]._workInProgressVersionPrimary=null;Of.length=0}var Kc=zr.ReactCurrentDispatcher,Bf=zr.ReactCurrentBatchConfig,Ms=0,ut=null,wt=null,Dt=null,Vd=!1,wl=!1,Zl=0,XP=0;function Ot(){throw Error(X(321))}function Cg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Xn(t[n],e[n]))return!1;return!0}function Ag(t,e,n,r,i,s){if(Ms=s,ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Kc.current=t===null||t.memoizedState===null?nk:rk,t=n(r,i),wl){s=0;do{if(wl=!1,Zl=0,25<=s)throw Error(X(301));s+=1,Dt=wt=null,e.updateQueue=null,Kc.current=ik,t=n(r,i)}while(wl)}if(Kc.current=Ld,e=wt!==null&&wt.next!==null,Ms=0,Dt=wt=ut=null,Vd=!1,e)throw Error(X(300));return t}function xg(){var t=Zl!==0;return Zl=0,t}function ir(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?ut.memoizedState=Dt=t:Dt=Dt.next=t,Dt}function Ln(){if(wt===null){var t=ut.alternate;t=t!==null?t.memoizedState:null}else t=wt.next;var e=Dt===null?ut.memoizedState:Dt.next;if(e!==null)Dt=e,wt=t;else{if(t===null)throw Error(X(310));wt=t,t={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Dt===null?ut.memoizedState=Dt=t:Dt=Dt.next=t}return Dt}function eu(t,e){return typeof e=="function"?e(t):e}function qf(t){var e=Ln(),n=e.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=t;var r=wt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var f=u.lane;if((Ms&f)===f)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var p={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=p,o=r):l=l.next=p,ut.lanes|=f,Vs|=f}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,Xn(r,e.memoizedState)||(ln=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ut.lanes|=s,Vs|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Gf(t){var e=Ln(),n=e.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Xn(s,e.memoizedState)||(ln=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function mS(){}function gS(t,e){var n=ut,r=Ln(),i=e(),s=!Xn(r.memoizedState,i);if(s&&(r.memoizedState=i,ln=!0),r=r.queue,Rg(vS.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Dt!==null&&Dt.memoizedState.tag&1){if(n.flags|=2048,tu(9,yS.bind(null,n,r,i,e),void 0,null),bt===null)throw Error(X(349));Ms&30||_S(n,e,i)}return i}function _S(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ut.updateQueue,e===null?(e={lastEffect:null,stores:null},ut.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function yS(t,e,n,r){e.value=n,e.getSnapshot=r,TS(e)&&ES(t)}function vS(t,e,n){return n(function(){TS(e)&&ES(t)})}function TS(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Xn(t,n)}catch{return!0}}function ES(t){var e=Fr(t,1);e!==null&&jn(e,t,1,-1)}function iv(t){var e=ir();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:t},e.queue=t,t=t.dispatch=tk.bind(null,ut,t),[e.memoizedState,t]}function tu(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ut.updateQueue,e===null?(e={lastEffect:null,stores:null},ut.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function IS(){return Ln().memoizedState}function jc(t,e,n,r){var i=ir();ut.flags|=t,i.memoizedState=tu(1|e,n,void 0,r===void 0?null:r)}function Sh(t,e,n,r){var i=Ln();r=r===void 0?null:r;var s=void 0;if(wt!==null){var o=wt.memoizedState;if(s=o.destroy,r!==null&&Cg(r,o.deps)){i.memoizedState=tu(e,n,s,r);return}}ut.flags|=t,i.memoizedState=tu(1|e,n,s,r)}function sv(t,e){return jc(8390656,8,t,e)}function Rg(t,e){return Sh(2048,8,t,e)}function wS(t,e){return Sh(4,2,t,e)}function SS(t,e){return Sh(4,4,t,e)}function CS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function AS(t,e,n){return n=n!=null?n.concat([t]):null,Sh(4,4,CS.bind(null,e,t),n)}function Pg(){}function xS(t,e){var n=Ln();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function RS(t,e){var n=Ln();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function PS(t,e,n){return Ms&21?(Xn(n,e)||(n=Mw(),ut.lanes|=n,Vs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ln=!0),t.memoizedState=n)}function ZP(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=Bf.transition;Bf.transition={};try{t(!1),e()}finally{He=n,Bf.transition=r}}function kS(){return Ln().memoizedState}function ek(t,e,n){var r=vi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},NS(t))DS(e,n);else if(n=hS(t,e,n,r),n!==null){var i=Zt();jn(n,t,r,i),bS(n,e,r)}}function tk(t,e,n){var r=vi(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(NS(t))DS(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Xn(a,o)){var l=e.interleaved;l===null?(i.next=i,Tg(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=hS(t,e,i,r),n!==null&&(i=Zt(),jn(n,t,r,i),bS(n,e,r))}}function NS(t){var e=t.alternate;return t===ut||e!==null&&e===ut}function DS(t,e){wl=Vd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function bS(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}var Ld={readContext:Vn,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useInsertionEffect:Ot,useLayoutEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useMutableSource:Ot,useSyncExternalStore:Ot,useId:Ot,unstable_isNewReconciler:!1},nk={readContext:Vn,useCallback:function(t,e){return ir().memoizedState=[t,e===void 0?null:e],t},useContext:Vn,useEffect:sv,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,jc(4194308,4,CS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return jc(4194308,4,t,e)},useInsertionEffect:function(t,e){return jc(4,2,t,e)},useMemo:function(t,e){var n=ir();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ir();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=ek.bind(null,ut,t),[r.memoizedState,t]},useRef:function(t){var e=ir();return t={current:t},e.memoizedState=t},useState:iv,useDebugValue:Pg,useDeferredValue:function(t){return ir().memoizedState=t},useTransition:function(){var t=iv(!1),e=t[0];return t=ZP.bind(null,t[1]),ir().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ut,i=ir();if(rt){if(n===void 0)throw Error(X(407));n=n()}else{if(n=e(),bt===null)throw Error(X(349));Ms&30||_S(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,sv(vS.bind(null,r,s,t),[t]),r.flags|=2048,tu(9,yS.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=ir(),e=bt.identifierPrefix;if(rt){var n=Pr,r=Rr;n=(r&~(1<<32-Kn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Zl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=XP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},rk={readContext:Vn,useCallback:xS,useContext:Vn,useEffect:Rg,useImperativeHandle:AS,useInsertionEffect:wS,useLayoutEffect:SS,useMemo:RS,useReducer:qf,useRef:IS,useState:function(){return qf(eu)},useDebugValue:Pg,useDeferredValue:function(t){var e=Ln();return PS(e,wt.memoizedState,t)},useTransition:function(){var t=qf(eu)[0],e=Ln().memoizedState;return[t,e]},useMutableSource:mS,useSyncExternalStore:gS,useId:kS,unstable_isNewReconciler:!1},ik={readContext:Vn,useCallback:xS,useContext:Vn,useEffect:Rg,useImperativeHandle:AS,useInsertionEffect:wS,useLayoutEffect:SS,useMemo:RS,useReducer:Gf,useRef:IS,useState:function(){return Gf(eu)},useDebugValue:Pg,useDeferredValue:function(t){var e=Ln();return wt===null?e.memoizedState=t:PS(e,wt.memoizedState,t)},useTransition:function(){var t=Gf(eu)[0],e=Ln().memoizedState;return[t,e]},useMutableSource:mS,useSyncExternalStore:gS,useId:kS,unstable_isNewReconciler:!1};function qn(t,e){if(t&&t.defaultProps){e=ct({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Op(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ct({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ch={isMounted:function(t){return(t=t._reactInternals)?Ks(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zt(),i=vi(t),s=br(r,i);s.payload=e,n!=null&&(s.callback=n),e=_i(t,s,i),e!==null&&(jn(e,t,i,r),Wc(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zt(),i=vi(t),s=br(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=_i(t,s,i),e!==null&&(jn(e,t,i,r),Wc(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zt(),r=vi(t),i=br(n,r);i.tag=2,e!=null&&(i.callback=e),e=_i(t,i,r),e!==null&&(jn(e,t,r,n),Wc(e,t,r))}};function ov(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Kl(n,r)||!Kl(i,s):!0}function MS(t,e,n){var r=!1,i=Pi,s=e.contextType;return typeof s=="object"&&s!==null?s=Vn(s):(i=dn(e)?Ds:Kt.current,r=e.contextTypes,s=(r=r!=null)?Ko(t,i):Pi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ch,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function av(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Ch.enqueueReplaceState(e,e.state,null)}function Bp(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Eg(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Vn(s):(s=dn(e)?Ds:Kt.current,i.context=Ko(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Op(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ch.enqueueReplaceState(i,i.state,null),bd(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Yo(t,e){try{var n="",r=e;do n+=DR(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function zf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function qp(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var sk=typeof WeakMap=="function"?WeakMap:Map;function VS(t,e,n){n=br(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ud||(Ud=!0,Yp=r),qp(t,e)},n}function LS(t,e,n){n=br(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){qp(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){qp(t,e),typeof r!="function"&&(yi===null?yi=new Set([this]):yi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function lv(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new sk;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=vk.bind(null,t,e,n),e.then(t,t))}function uv(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function cv(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=br(-1,1),e.tag=2,_i(n,e,1))),n.lanes|=1),t)}var ok=zr.ReactCurrentOwner,ln=!1;function Qt(t,e,n,r){e.child=t===null?dS(e,null,n,r):Jo(e,t.child,n,r)}function dv(t,e,n,r,i){n=n.render;var s=e.ref;return Fo(e,i),r=Ag(t,e,n,r,s,i),n=xg(),t!==null&&!ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ur(t,e,i)):(rt&&n&&pg(e),e.flags|=1,Qt(t,e,r,i),e.child)}function hv(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Fg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,FS(t,e,s,r,i)):(t=Xc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Kl,n(o,r)&&t.ref===e.ref)return Ur(t,e,i)}return e.flags|=1,t=Ti(s,r),t.ref=e.ref,t.return=e,e.child=t}function FS(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Kl(s,r)&&t.ref===e.ref)if(ln=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(ln=!0);else return e.lanes=t.lanes,Ur(t,e,i)}return Gp(t,e,n,r,i)}function US(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(ko,gn),gn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Qe(ko,gn),gn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Qe(ko,gn),gn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Qe(ko,gn),gn|=r;return Qt(t,e,i,n),e.child}function OS(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Gp(t,e,n,r,i){var s=dn(n)?Ds:Kt.current;return s=Ko(e,s),Fo(e,i),n=Ag(t,e,n,r,s,i),r=xg(),t!==null&&!ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ur(t,e,i)):(rt&&r&&pg(e),e.flags|=1,Qt(t,e,n,i),e.child)}function fv(t,e,n,r,i){if(dn(n)){var s=!0;Rd(e)}else s=!1;if(Fo(e,i),e.stateNode===null)Jc(t,e),MS(e,n,r),Bp(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Vn(u):(u=dn(n)?Ds:Kt.current,u=Ko(e,u));var f=n.getDerivedStateFromProps,p=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&av(e,o,r,u),ri=!1;var g=e.memoizedState;o.state=g,bd(e,r,o,i),l=e.memoizedState,a!==r||g!==l||cn.current||ri?(typeof f=="function"&&(Op(e,n,f,r),l=e.memoizedState),(a=ri||ov(e,n,a,r,g,l,u))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,fS(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:qn(e.type,a),o.props=u,p=e.pendingProps,g=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Vn(l):(l=dn(n)?Ds:Kt.current,l=Ko(e,l));var v=n.getDerivedStateFromProps;(f=typeof v=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||g!==l)&&av(e,o,r,l),ri=!1,g=e.memoizedState,o.state=g,bd(e,r,o,i);var T=e.memoizedState;a!==p||g!==T||cn.current||ri?(typeof v=="function"&&(Op(e,n,v,r),T=e.memoizedState),(u=ri||ov(e,n,u,r,g,T,l)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,T,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,T,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),o.props=r,o.state=T,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return zp(t,e,n,r,s,i)}function zp(t,e,n,r,i,s){OS(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Xy(e,n,!1),Ur(t,e,s);r=e.stateNode,ok.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Jo(e,t.child,null,s),e.child=Jo(e,null,a,s)):Qt(t,e,a,s),e.memoizedState=r.state,i&&Xy(e,n,!0),e.child}function BS(t){var e=t.stateNode;e.pendingContext?Yy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Yy(t,e.context,!1),Ig(t,e.containerInfo)}function pv(t,e,n,r,i){return jo(),gg(i),e.flags|=256,Qt(t,e,n,r),e.child}var $p={dehydrated:null,treeContext:null,retryLane:0};function Hp(t){return{baseLanes:t,cachePool:null,transitions:null}}function qS(t,e,n){var r=e.pendingProps,i=at.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Qe(at,i&1),t===null)return Fp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Rh(o,r,0,null),t=xs(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Hp(n),e.memoizedState=$p,t):kg(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return ak(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Ti(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Ti(a,s):(s=xs(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Hp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=$p,r}return s=t.child,t=s.sibling,r=Ti(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function kg(t,e){return e=Rh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Pc(t,e,n,r){return r!==null&&gg(r),Jo(e,t.child,null,n),t=kg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ak(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=zf(Error(X(422))),Pc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Rh({mode:"visible",children:r.children},i,0,null),s=xs(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Jo(e,t.child,null,o),e.child.memoizedState=Hp(o),e.memoizedState=$p,s);if(!(e.mode&1))return Pc(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(X(419)),r=zf(s,r,void 0),Pc(t,e,o,r)}if(a=(o&t.childLanes)!==0,ln||a){if(r=bt,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Fr(t,i),jn(r,t,i,-1))}return Lg(),r=zf(Error(X(421))),Pc(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Tk.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,vn=gi(i.nextSibling),En=e,rt=!0,$n=null,t!==null&&(xn[Rn++]=Rr,xn[Rn++]=Pr,xn[Rn++]=bs,Rr=t.id,Pr=t.overflow,bs=e),e=kg(e,r.children),e.flags|=4096,e)}function mv(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Up(t.return,e,n)}function $f(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function GS(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Qt(t,e,r.children,n),r=at.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&mv(t,n,e);else if(t.tag===19)mv(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Qe(at,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Md(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),$f(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Md(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}$f(e,!0,n,null,s);break;case"together":$f(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Jc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ur(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Vs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(X(153));if(e.child!==null){for(t=e.child,n=Ti(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ti(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function lk(t,e,n){switch(e.tag){case 3:BS(e),jo();break;case 5:pS(e);break;case 1:dn(e.type)&&Rd(e);break;case 4:Ig(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Qe(Nd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Qe(at,at.current&1),e.flags|=128,null):n&e.child.childLanes?qS(t,e,n):(Qe(at,at.current&1),t=Ur(t,e,n),t!==null?t.sibling:null);Qe(at,at.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return GS(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Qe(at,at.current),r)break;return null;case 22:case 23:return e.lanes=0,US(t,e,n)}return Ur(t,e,n)}var zS,Wp,$S,HS;zS=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wp=function(){};$S=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ws(dr.current);var s=null;switch(n){case"input":i=pp(t,i),r=pp(t,r),s=[];break;case"select":i=ct({},i,{value:void 0}),r=ct({},r,{value:void 0}),s=[];break;case"textarea":i=_p(t,i),r=_p(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ad)}vp(n,r);var o;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Bl.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Bl.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ye("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};HS=function(t,e,n,r){n!==r&&(e.flags|=4)};function el(t,e){if(!rt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Bt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function uk(t,e,n){var r=e.pendingProps;switch(mg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(e),null;case 1:return dn(e.type)&&xd(),Bt(e),null;case 3:return r=e.stateNode,Qo(),Ze(cn),Ze(Kt),Sg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,$n!==null&&(em($n),$n=null))),Wp(t,e),Bt(e),null;case 5:wg(e);var i=ws(Xl.current);if(n=e.type,t!==null&&e.stateNode!=null)$S(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(X(166));return Bt(e),null}if(t=ws(dr.current),xc(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[ar]=e,r[Ql]=s,t=(e.mode&1)!==0,n){case"dialog":Ye("cancel",r),Ye("close",r);break;case"iframe":case"object":case"embed":Ye("load",r);break;case"video":case"audio":for(i=0;i<hl.length;i++)Ye(hl[i],r);break;case"source":Ye("error",r);break;case"img":case"image":case"link":Ye("error",r),Ye("load",r);break;case"details":Ye("toggle",r);break;case"input":Sy(r,s),Ye("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ye("invalid",r);break;case"textarea":Ay(r,s),Ye("invalid",r)}vp(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Ac(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Ac(r.textContent,a,t),i=["children",""+a]):Bl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ye("scroll",r)}switch(n){case"input":yc(r),Cy(r,s,!0);break;case"textarea":yc(r),xy(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Ad)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=vw(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[ar]=e,t[Ql]=r,zS(t,e,!1,!1),e.stateNode=t;e:{switch(o=Tp(n,r),n){case"dialog":Ye("cancel",t),Ye("close",t),i=r;break;case"iframe":case"object":case"embed":Ye("load",t),i=r;break;case"video":case"audio":for(i=0;i<hl.length;i++)Ye(hl[i],t);i=r;break;case"source":Ye("error",t),i=r;break;case"img":case"image":case"link":Ye("error",t),Ye("load",t),i=r;break;case"details":Ye("toggle",t),i=r;break;case"input":Sy(t,r),i=pp(t,r),Ye("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ct({},r,{value:void 0}),Ye("invalid",t);break;case"textarea":Ay(t,r),i=_p(t,r),Ye("invalid",t);break;default:i=r}vp(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Iw(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Tw(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&ql(t,l):typeof l=="number"&&ql(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Bl.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ye("scroll",t):l!=null&&eg(t,s,l,o))}switch(n){case"input":yc(t),Cy(t,r,!1);break;case"textarea":yc(t),xy(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ri(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?bo(t,!!r.multiple,s,!1):r.defaultValue!=null&&bo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ad)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Bt(e),null;case 6:if(t&&e.stateNode!=null)HS(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(X(166));if(n=ws(Xl.current),ws(dr.current),xc(e)){if(r=e.stateNode,n=e.memoizedProps,r[ar]=e,(s=r.nodeValue!==n)&&(t=En,t!==null))switch(t.tag){case 3:Ac(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ac(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ar]=e,e.stateNode=r}return Bt(e),null;case 13:if(Ze(at),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(rt&&vn!==null&&e.mode&1&&!(e.flags&128))uS(),jo(),e.flags|=98560,s=!1;else if(s=xc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(X(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(X(317));s[ar]=e}else jo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Bt(e),s=!1}else $n!==null&&(em($n),$n=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||at.current&1?St===0&&(St=3):Lg())),e.updateQueue!==null&&(e.flags|=4),Bt(e),null);case 4:return Qo(),Wp(t,e),t===null&&jl(e.stateNode.containerInfo),Bt(e),null;case 10:return vg(e.type._context),Bt(e),null;case 17:return dn(e.type)&&xd(),Bt(e),null;case 19:if(Ze(at),s=e.memoizedState,s===null)return Bt(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)el(s,!1);else{if(St!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Md(t),o!==null){for(e.flags|=128,el(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Qe(at,at.current&1|2),e.child}t=t.sibling}s.tail!==null&&mt()>Xo&&(e.flags|=128,r=!0,el(s,!1),e.lanes=4194304)}else{if(!r)if(t=Md(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),el(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!rt)return Bt(e),null}else 2*mt()-s.renderingStartTime>Xo&&n!==1073741824&&(e.flags|=128,r=!0,el(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=mt(),e.sibling=null,n=at.current,Qe(at,r?n&1|2:n&1),e):(Bt(e),null);case 22:case 23:return Vg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?gn&1073741824&&(Bt(e),e.subtreeFlags&6&&(e.flags|=8192)):Bt(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function ck(t,e){switch(mg(e),e.tag){case 1:return dn(e.type)&&xd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Qo(),Ze(cn),Ze(Kt),Sg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return wg(e),null;case 13:if(Ze(at),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(X(340));jo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ze(at),null;case 4:return Qo(),null;case 10:return vg(e.type._context),null;case 22:case 23:return Vg(),null;case 24:return null;default:return null}}var kc=!1,zt=!1,dk=typeof WeakSet=="function"?WeakSet:Set,ae=null;function Po(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){dt(t,e,r)}else n.current=null}function Kp(t,e,n){try{n()}catch(r){dt(t,e,r)}}var gv=!1;function hk(t,e){if(kp=wd,t=Qw(),fg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,f=0,p=t,g=null;t:for(;;){for(var v;p!==n||i!==0&&p.nodeType!==3||(a=o+i),p!==s||r!==0&&p.nodeType!==3||(l=o+r),p.nodeType===3&&(o+=p.nodeValue.length),(v=p.firstChild)!==null;)g=p,p=v;for(;;){if(p===t)break t;if(g===n&&++u===i&&(a=o),g===s&&++f===r&&(l=o),(v=p.nextSibling)!==null)break;p=g,g=p.parentNode}p=v}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Np={focusedElem:t,selectionRange:n},wd=!1,ae=e;ae!==null;)if(e=ae,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ae=t;else for(;ae!==null;){e=ae;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var x=T.memoizedProps,D=T.memoizedState,S=e.stateNode,E=S.getSnapshotBeforeUpdate(e.elementType===e.type?x:qn(e.type,x),D);S.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(M){dt(e,e.return,M)}if(t=e.sibling,t!==null){t.return=e.return,ae=t;break}ae=e.return}return T=gv,gv=!1,T}function Sl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Kp(e,n,s)}i=i.next}while(i!==r)}}function Ah(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function jp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function WS(t){var e=t.alternate;e!==null&&(t.alternate=null,WS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ar],delete e[Ql],delete e[Mp],delete e[jP],delete e[JP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function KS(t){return t.tag===5||t.tag===3||t.tag===4}function _v(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||KS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Jp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ad));else if(r!==4&&(t=t.child,t!==null))for(Jp(t,e,n),t=t.sibling;t!==null;)Jp(t,e,n),t=t.sibling}function Qp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Qp(t,e,n),t=t.sibling;t!==null;)Qp(t,e,n),t=t.sibling}var Mt=null,Gn=!1;function Yr(t,e,n){for(n=n.child;n!==null;)jS(t,e,n),n=n.sibling}function jS(t,e,n){if(cr&&typeof cr.onCommitFiberUnmount=="function")try{cr.onCommitFiberUnmount(yh,n)}catch{}switch(n.tag){case 5:zt||Po(n,e);case 6:var r=Mt,i=Gn;Mt=null,Yr(t,e,n),Mt=r,Gn=i,Mt!==null&&(Gn?(t=Mt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Mt.removeChild(n.stateNode));break;case 18:Mt!==null&&(Gn?(t=Mt,n=n.stateNode,t.nodeType===8?Ff(t.parentNode,n):t.nodeType===1&&Ff(t,n),Hl(t)):Ff(Mt,n.stateNode));break;case 4:r=Mt,i=Gn,Mt=n.stateNode.containerInfo,Gn=!0,Yr(t,e,n),Mt=r,Gn=i;break;case 0:case 11:case 14:case 15:if(!zt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Kp(n,e,o),i=i.next}while(i!==r)}Yr(t,e,n);break;case 1:if(!zt&&(Po(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){dt(n,e,a)}Yr(t,e,n);break;case 21:Yr(t,e,n);break;case 22:n.mode&1?(zt=(r=zt)||n.memoizedState!==null,Yr(t,e,n),zt=r):Yr(t,e,n);break;default:Yr(t,e,n)}}function yv(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new dk),e.forEach(function(r){var i=Ek.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Bn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Mt=a.stateNode,Gn=!1;break e;case 3:Mt=a.stateNode.containerInfo,Gn=!0;break e;case 4:Mt=a.stateNode.containerInfo,Gn=!0;break e}a=a.return}if(Mt===null)throw Error(X(160));jS(s,o,i),Mt=null,Gn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){dt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JS(e,t),e=e.sibling}function JS(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Bn(e,t),rr(t),r&4){try{Sl(3,t,t.return),Ah(3,t)}catch(x){dt(t,t.return,x)}try{Sl(5,t,t.return)}catch(x){dt(t,t.return,x)}}break;case 1:Bn(e,t),rr(t),r&512&&n!==null&&Po(n,n.return);break;case 5:if(Bn(e,t),rr(t),r&512&&n!==null&&Po(n,n.return),t.flags&32){var i=t.stateNode;try{ql(i,"")}catch(x){dt(t,t.return,x)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&_w(i,s),Tp(a,o);var u=Tp(a,s);for(o=0;o<l.length;o+=2){var f=l[o],p=l[o+1];f==="style"?Iw(i,p):f==="dangerouslySetInnerHTML"?Tw(i,p):f==="children"?ql(i,p):eg(i,f,p,u)}switch(a){case"input":mp(i,s);break;case"textarea":yw(i,s);break;case"select":var g=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var v=s.value;v!=null?bo(i,!!s.multiple,v,!1):g!==!!s.multiple&&(s.defaultValue!=null?bo(i,!!s.multiple,s.defaultValue,!0):bo(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ql]=s}catch(x){dt(t,t.return,x)}}break;case 6:if(Bn(e,t),rr(t),r&4){if(t.stateNode===null)throw Error(X(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(x){dt(t,t.return,x)}}break;case 3:if(Bn(e,t),rr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Hl(e.containerInfo)}catch(x){dt(t,t.return,x)}break;case 4:Bn(e,t),rr(t);break;case 13:Bn(e,t),rr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(bg=mt())),r&4&&yv(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(zt=(u=zt)||f,Bn(e,t),zt=u):Bn(e,t),rr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!f&&t.mode&1)for(ae=t,f=t.child;f!==null;){for(p=ae=f;ae!==null;){switch(g=ae,v=g.child,g.tag){case 0:case 11:case 14:case 15:Sl(4,g,g.return);break;case 1:Po(g,g.return);var T=g.stateNode;if(typeof T.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(x){dt(r,n,x)}}break;case 5:Po(g,g.return);break;case 22:if(g.memoizedState!==null){Tv(p);continue}}v!==null?(v.return=g,ae=v):Tv(p)}f=f.sibling}e:for(f=null,p=t;;){if(p.tag===5){if(f===null){f=p;try{i=p.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Ew("display",o))}catch(x){dt(t,t.return,x)}}}else if(p.tag===6){if(f===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(x){dt(t,t.return,x)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;f===p&&(f=null),p=p.return}f===p&&(f=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Bn(e,t),rr(t),r&4&&yv(t);break;case 21:break;default:Bn(e,t),rr(t)}}function rr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(KS(n)){var r=n;break e}n=n.return}throw Error(X(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ql(i,""),r.flags&=-33);var s=_v(t);Qp(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=_v(t);Jp(t,a,o);break;default:throw Error(X(161))}}catch(l){dt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function fk(t,e,n){ae=t,QS(t)}function QS(t,e,n){for(var r=(t.mode&1)!==0;ae!==null;){var i=ae,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||kc;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||zt;a=kc;var u=zt;if(kc=o,(zt=l)&&!u)for(ae=i;ae!==null;)o=ae,l=o.child,o.tag===22&&o.memoizedState!==null?Ev(i):l!==null?(l.return=o,ae=l):Ev(i);for(;s!==null;)ae=s,QS(s),s=s.sibling;ae=i,kc=a,zt=u}vv(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,ae=s):vv(t)}}function vv(t){for(;ae!==null;){var e=ae;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:zt||Ah(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!zt)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:qn(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&rv(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}rv(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var p=f.dehydrated;p!==null&&Hl(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}zt||e.flags&512&&jp(e)}catch(g){dt(e,e.return,g)}}if(e===t){ae=null;break}if(n=e.sibling,n!==null){n.return=e.return,ae=n;break}ae=e.return}}function Tv(t){for(;ae!==null;){var e=ae;if(e===t){ae=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ae=n;break}ae=e.return}}function Ev(t){for(;ae!==null;){var e=ae;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ah(4,e)}catch(l){dt(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){dt(e,i,l)}}var s=e.return;try{jp(e)}catch(l){dt(e,s,l)}break;case 5:var o=e.return;try{jp(e)}catch(l){dt(e,o,l)}}}catch(l){dt(e,e.return,l)}if(e===t){ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ae=a;break}ae=e.return}}var pk=Math.ceil,Fd=zr.ReactCurrentDispatcher,Ng=zr.ReactCurrentOwner,Dn=zr.ReactCurrentBatchConfig,Oe=0,bt=null,vt=null,Ft=0,gn=0,ko=Ui(0),St=0,nu=null,Vs=0,xh=0,Dg=0,Cl=null,an=null,bg=0,Xo=1/0,Cr=null,Ud=!1,Yp=null,yi=null,Nc=!1,di=null,Od=0,Al=0,Xp=null,Qc=-1,Yc=0;function Zt(){return Oe&6?mt():Qc!==-1?Qc:Qc=mt()}function vi(t){return t.mode&1?Oe&2&&Ft!==0?Ft&-Ft:YP.transition!==null?(Yc===0&&(Yc=Mw()),Yc):(t=He,t!==0||(t=window.event,t=t===void 0?16:qw(t.type)),t):1}function jn(t,e,n,r){if(50<Al)throw Al=0,Xp=null,Error(X(185));yu(t,n,r),(!(Oe&2)||t!==bt)&&(t===bt&&(!(Oe&2)&&(xh|=n),St===4&&si(t,Ft)),hn(t,r),n===1&&Oe===0&&!(e.mode&1)&&(Xo=mt()+500,wh&&Oi()))}function hn(t,e){var n=t.callbackNode;YR(t,e);var r=Id(t,t===bt?Ft:0);if(r===0)n!==null&&ky(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&ky(n),e===1)t.tag===0?QP(Iv.bind(null,t)):oS(Iv.bind(null,t)),WP(function(){!(Oe&6)&&Oi()}),n=null;else{switch(Vw(r)){case 1:n=sg;break;case 4:n=Dw;break;case 16:n=Ed;break;case 536870912:n=bw;break;default:n=Ed}n=iC(n,YS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function YS(t,e){if(Qc=-1,Yc=0,Oe&6)throw Error(X(327));var n=t.callbackNode;if(Uo()&&t.callbackNode!==n)return null;var r=Id(t,t===bt?Ft:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Bd(t,r);else{e=r;var i=Oe;Oe|=2;var s=ZS();(bt!==t||Ft!==e)&&(Cr=null,Xo=mt()+500,As(t,e));do try{_k();break}catch(a){XS(t,a)}while(!0);yg(),Fd.current=s,Oe=i,vt!==null?e=0:(bt=null,Ft=0,e=St)}if(e!==0){if(e===2&&(i=Cp(t),i!==0&&(r=i,e=Zp(t,i))),e===1)throw n=nu,As(t,0),si(t,r),hn(t,mt()),n;if(e===6)si(t,r);else{if(i=t.current.alternate,!(r&30)&&!mk(i)&&(e=Bd(t,r),e===2&&(s=Cp(t),s!==0&&(r=s,e=Zp(t,s))),e===1))throw n=nu,As(t,0),si(t,r),hn(t,mt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(X(345));case 2:hs(t,an,Cr);break;case 3:if(si(t,r),(r&130023424)===r&&(e=bg+500-mt(),10<e)){if(Id(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Zt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=bp(hs.bind(null,t,an,Cr),e);break}hs(t,an,Cr);break;case 4:if(si(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Kn(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=mt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*pk(r/1960))-r,10<r){t.timeoutHandle=bp(hs.bind(null,t,an,Cr),r);break}hs(t,an,Cr);break;case 5:hs(t,an,Cr);break;default:throw Error(X(329))}}}return hn(t,mt()),t.callbackNode===n?YS.bind(null,t):null}function Zp(t,e){var n=Cl;return t.current.memoizedState.isDehydrated&&(As(t,e).flags|=256),t=Bd(t,e),t!==2&&(e=an,an=n,e!==null&&em(e)),t}function em(t){an===null?an=t:an.push.apply(an,t)}function mk(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Xn(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function si(t,e){for(e&=~Dg,e&=~xh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Kn(e),r=1<<n;t[n]=-1,e&=~r}}function Iv(t){if(Oe&6)throw Error(X(327));Uo();var e=Id(t,0);if(!(e&1))return hn(t,mt()),null;var n=Bd(t,e);if(t.tag!==0&&n===2){var r=Cp(t);r!==0&&(e=r,n=Zp(t,r))}if(n===1)throw n=nu,As(t,0),si(t,e),hn(t,mt()),n;if(n===6)throw Error(X(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hs(t,an,Cr),hn(t,mt()),null}function Mg(t,e){var n=Oe;Oe|=1;try{return t(e)}finally{Oe=n,Oe===0&&(Xo=mt()+500,wh&&Oi())}}function Ls(t){di!==null&&di.tag===0&&!(Oe&6)&&Uo();var e=Oe;Oe|=1;var n=Dn.transition,r=He;try{if(Dn.transition=null,He=1,t)return t()}finally{He=r,Dn.transition=n,Oe=e,!(Oe&6)&&Oi()}}function Vg(){gn=ko.current,Ze(ko)}function As(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,HP(n)),vt!==null)for(n=vt.return;n!==null;){var r=n;switch(mg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&xd();break;case 3:Qo(),Ze(cn),Ze(Kt),Sg();break;case 5:wg(r);break;case 4:Qo();break;case 13:Ze(at);break;case 19:Ze(at);break;case 10:vg(r.type._context);break;case 22:case 23:Vg()}n=n.return}if(bt=t,vt=t=Ti(t.current,null),Ft=gn=e,St=0,nu=null,Dg=xh=Vs=0,an=Cl=null,Is!==null){for(e=0;e<Is.length;e++)if(n=Is[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}Is=null}return t}function XS(t,e){do{var n=vt;try{if(yg(),Kc.current=Ld,Vd){for(var r=ut.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Vd=!1}if(Ms=0,Dt=wt=ut=null,wl=!1,Zl=0,Ng.current=null,n===null||n.return===null){St=1,nu=e,vt=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ft,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,f=a,p=f.tag;if(!(f.mode&1)&&(p===0||p===11||p===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var v=uv(o);if(v!==null){v.flags&=-257,cv(v,o,a,s,e),v.mode&1&&lv(s,u,e),e=v,l=u;var T=e.updateQueue;if(T===null){var x=new Set;x.add(l),e.updateQueue=x}else T.add(l);break e}else{if(!(e&1)){lv(s,u,e),Lg();break e}l=Error(X(426))}}else if(rt&&a.mode&1){var D=uv(o);if(D!==null){!(D.flags&65536)&&(D.flags|=256),cv(D,o,a,s,e),gg(Yo(l,a));break e}}s=l=Yo(l,a),St!==4&&(St=2),Cl===null?Cl=[s]:Cl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=VS(s,l,e);nv(s,S);break e;case 1:a=l;var E=s.type,R=s.stateNode;if(!(s.flags&128)&&(typeof E.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(yi===null||!yi.has(R)))){s.flags|=65536,e&=-e,s.lanes|=e;var M=LS(s,a,e);nv(s,M);break e}}s=s.return}while(s!==null)}tC(n)}catch(O){e=O,vt===n&&n!==null&&(vt=n=n.return);continue}break}while(!0)}function ZS(){var t=Fd.current;return Fd.current=Ld,t===null?Ld:t}function Lg(){(St===0||St===3||St===2)&&(St=4),bt===null||!(Vs&268435455)&&!(xh&268435455)||si(bt,Ft)}function Bd(t,e){var n=Oe;Oe|=2;var r=ZS();(bt!==t||Ft!==e)&&(Cr=null,As(t,e));do try{gk();break}catch(i){XS(t,i)}while(!0);if(yg(),Oe=n,Fd.current=r,vt!==null)throw Error(X(261));return bt=null,Ft=0,St}function gk(){for(;vt!==null;)eC(vt)}function _k(){for(;vt!==null&&!GR();)eC(vt)}function eC(t){var e=rC(t.alternate,t,gn);t.memoizedProps=t.pendingProps,e===null?tC(t):vt=e,Ng.current=null}function tC(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ck(n,e),n!==null){n.flags&=32767,vt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{St=6,vt=null;return}}else if(n=uk(n,e,gn),n!==null){vt=n;return}if(e=e.sibling,e!==null){vt=e;return}vt=e=t}while(e!==null);St===0&&(St=5)}function hs(t,e,n){var r=He,i=Dn.transition;try{Dn.transition=null,He=1,yk(t,e,n,r)}finally{Dn.transition=i,He=r}return null}function yk(t,e,n,r){do Uo();while(di!==null);if(Oe&6)throw Error(X(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(X(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(XR(t,s),t===bt&&(vt=bt=null,Ft=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Nc||(Nc=!0,iC(Ed,function(){return Uo(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Dn.transition,Dn.transition=null;var o=He;He=1;var a=Oe;Oe|=4,Ng.current=null,hk(t,n),JS(n,t),UP(Np),wd=!!kp,Np=kp=null,t.current=n,fk(n),zR(),Oe=a,He=o,Dn.transition=s}else t.current=n;if(Nc&&(Nc=!1,di=t,Od=i),s=t.pendingLanes,s===0&&(yi=null),WR(n.stateNode),hn(t,mt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ud)throw Ud=!1,t=Yp,Yp=null,t;return Od&1&&t.tag!==0&&Uo(),s=t.pendingLanes,s&1?t===Xp?Al++:(Al=0,Xp=t):Al=0,Oi(),null}function Uo(){if(di!==null){var t=Vw(Od),e=Dn.transition,n=He;try{if(Dn.transition=null,He=16>t?16:t,di===null)var r=!1;else{if(t=di,di=null,Od=0,Oe&6)throw Error(X(331));var i=Oe;for(Oe|=4,ae=t.current;ae!==null;){var s=ae,o=s.child;if(ae.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ae=u;ae!==null;){var f=ae;switch(f.tag){case 0:case 11:case 15:Sl(8,f,s)}var p=f.child;if(p!==null)p.return=f,ae=p;else for(;ae!==null;){f=ae;var g=f.sibling,v=f.return;if(WS(f),f===u){ae=null;break}if(g!==null){g.return=v,ae=g;break}ae=v}}}var T=s.alternate;if(T!==null){var x=T.child;if(x!==null){T.child=null;do{var D=x.sibling;x.sibling=null,x=D}while(x!==null)}}ae=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ae=o;else e:for(;ae!==null;){if(s=ae,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Sl(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,ae=S;break e}ae=s.return}}var E=t.current;for(ae=E;ae!==null;){o=ae;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,ae=R;else e:for(o=E;ae!==null;){if(a=ae,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ah(9,a)}}catch(O){dt(a,a.return,O)}if(a===o){ae=null;break e}var M=a.sibling;if(M!==null){M.return=a.return,ae=M;break e}ae=a.return}}if(Oe=i,Oi(),cr&&typeof cr.onPostCommitFiberRoot=="function")try{cr.onPostCommitFiberRoot(yh,t)}catch{}r=!0}return r}finally{He=n,Dn.transition=e}}return!1}function wv(t,e,n){e=Yo(n,e),e=VS(t,e,1),t=_i(t,e,1),e=Zt(),t!==null&&(yu(t,1,e),hn(t,e))}function dt(t,e,n){if(t.tag===3)wv(t,t,n);else for(;e!==null;){if(e.tag===3){wv(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(yi===null||!yi.has(r))){t=Yo(n,t),t=LS(e,t,1),e=_i(e,t,1),t=Zt(),e!==null&&(yu(e,1,t),hn(e,t));break}}e=e.return}}function vk(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zt(),t.pingedLanes|=t.suspendedLanes&n,bt===t&&(Ft&n)===n&&(St===4||St===3&&(Ft&130023424)===Ft&&500>mt()-bg?As(t,0):Dg|=n),hn(t,e)}function nC(t,e){e===0&&(t.mode&1?(e=Ec,Ec<<=1,!(Ec&130023424)&&(Ec=4194304)):e=1);var n=Zt();t=Fr(t,e),t!==null&&(yu(t,e,n),hn(t,n))}function Tk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),nC(t,n)}function Ek(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(X(314))}r!==null&&r.delete(e),nC(t,n)}var rC;rC=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||cn.current)ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ln=!1,lk(t,e,n);ln=!!(t.flags&131072)}else ln=!1,rt&&e.flags&1048576&&aS(e,kd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Jc(t,e),t=e.pendingProps;var i=Ko(e,Kt.current);Fo(e,n),i=Ag(null,e,r,t,i,n);var s=xg();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,dn(r)?(s=!0,Rd(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Eg(e),i.updater=Ch,e.stateNode=i,i._reactInternals=e,Bp(e,r,t,n),e=zp(null,e,r,!0,s,n)):(e.tag=0,rt&&s&&pg(e),Qt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Jc(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=wk(r),t=qn(r,t),i){case 0:e=Gp(null,e,r,t,n);break e;case 1:e=fv(null,e,r,t,n);break e;case 11:e=dv(null,e,r,t,n);break e;case 14:e=hv(null,e,r,qn(r.type,t),n);break e}throw Error(X(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),Gp(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),fv(t,e,r,i,n);case 3:e:{if(BS(e),t===null)throw Error(X(387));r=e.pendingProps,s=e.memoizedState,i=s.element,fS(t,e),bd(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Yo(Error(X(423)),e),e=pv(t,e,r,n,i);break e}else if(r!==i){i=Yo(Error(X(424)),e),e=pv(t,e,r,n,i);break e}else for(vn=gi(e.stateNode.containerInfo.firstChild),En=e,rt=!0,$n=null,n=dS(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(jo(),r===i){e=Ur(t,e,n);break e}Qt(t,e,r,n)}e=e.child}return e;case 5:return pS(e),t===null&&Fp(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Dp(r,i)?o=null:s!==null&&Dp(r,s)&&(e.flags|=32),OS(t,e),Qt(t,e,o,n),e.child;case 6:return t===null&&Fp(e),null;case 13:return qS(t,e,n);case 4:return Ig(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Jo(e,null,r,n):Qt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),dv(t,e,r,i,n);case 7:return Qt(t,e,e.pendingProps,n),e.child;case 8:return Qt(t,e,e.pendingProps.children,n),e.child;case 12:return Qt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Qe(Nd,r._currentValue),r._currentValue=o,s!==null)if(Xn(s.value,o)){if(s.children===i.children&&!cn.current){e=Ur(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=br(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?l.next=l:(l.next=f.next,f.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Up(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(X(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Up(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Qt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Fo(e,n),i=Vn(i),r=r(i),e.flags|=1,Qt(t,e,r,n),e.child;case 14:return r=e.type,i=qn(r,e.pendingProps),i=qn(r.type,i),hv(t,e,r,i,n);case 15:return FS(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),Jc(t,e),e.tag=1,dn(r)?(t=!0,Rd(e)):t=!1,Fo(e,n),MS(e,r,i),Bp(e,r,i,n),zp(null,e,r,!0,t,n);case 19:return GS(t,e,n);case 22:return US(t,e,n)}throw Error(X(156,e.tag))};function iC(t,e){return Nw(t,e)}function Ik(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pn(t,e,n,r){return new Ik(t,e,n,r)}function Fg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wk(t){if(typeof t=="function")return Fg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ng)return 11;if(t===rg)return 14}return 2}function Ti(t,e){var n=t.alternate;return n===null?(n=Pn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Xc(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Fg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case To:return xs(n.children,i,s,e);case tg:o=8,i|=8;break;case cp:return t=Pn(12,n,e,i|2),t.elementType=cp,t.lanes=s,t;case dp:return t=Pn(13,n,e,i),t.elementType=dp,t.lanes=s,t;case hp:return t=Pn(19,n,e,i),t.elementType=hp,t.lanes=s,t;case pw:return Rh(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case hw:o=10;break e;case fw:o=9;break e;case ng:o=11;break e;case rg:o=14;break e;case ni:o=16,r=null;break e}throw Error(X(130,t==null?t:typeof t,""))}return e=Pn(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function xs(t,e,n,r){return t=Pn(7,t,r,e),t.lanes=n,t}function Rh(t,e,n,r){return t=Pn(22,t,r,e),t.elementType=pw,t.lanes=n,t.stateNode={isHidden:!1},t}function Hf(t,e,n){return t=Pn(6,t,null,e),t.lanes=n,t}function Wf(t,e,n){return e=Pn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Sk(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Af(0),this.expirationTimes=Af(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Af(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Ug(t,e,n,r,i,s,o,a,l){return t=new Sk(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Pn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Eg(s),t}function Ck(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function sC(t){if(!t)return Pi;t=t._reactInternals;e:{if(Ks(t)!==t||t.tag!==1)throw Error(X(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(dn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(t.tag===1){var n=t.type;if(dn(n))return sS(t,n,e)}return e}function oC(t,e,n,r,i,s,o,a,l){return t=Ug(n,r,!0,t,i,s,o,a,l),t.context=sC(null),n=t.current,r=Zt(),i=vi(n),s=br(r,i),s.callback=e??null,_i(n,s,i),t.current.lanes=i,yu(t,i,r),hn(t,r),t}function Ph(t,e,n,r){var i=e.current,s=Zt(),o=vi(i);return n=sC(n),e.context===null?e.context=n:e.pendingContext=n,e=br(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=_i(i,e,o),t!==null&&(jn(t,i,o,s),Wc(t,i,o)),o}function qd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Sv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Og(t,e){Sv(t,e),(t=t.alternate)&&Sv(t,e)}function Ak(){return null}var aC=typeof reportError=="function"?reportError:function(t){console.error(t)};function Bg(t){this._internalRoot=t}kh.prototype.render=Bg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(X(409));Ph(t,e,null,null)};kh.prototype.unmount=Bg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ls(function(){Ph(null,t,null,null)}),e[Lr]=null}};function kh(t){this._internalRoot=t}kh.prototype.unstable_scheduleHydration=function(t){if(t){var e=Uw();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ii.length&&e!==0&&e<ii[n].priority;n++);ii.splice(n,0,t),n===0&&Bw(t)}};function qg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Nh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Cv(){}function xk(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=qd(o);s.call(u)}}var o=oC(e,r,t,0,null,!1,!1,"",Cv);return t._reactRootContainer=o,t[Lr]=o.current,jl(t.nodeType===8?t.parentNode:t),Ls(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=qd(l);a.call(u)}}var l=Ug(t,0,!1,null,null,!1,!1,"",Cv);return t._reactRootContainer=l,t[Lr]=l.current,jl(t.nodeType===8?t.parentNode:t),Ls(function(){Ph(e,l,n,r)}),l}function Dh(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=qd(o);a.call(l)}}Ph(e,o,t,i)}else o=xk(n,e,t,i,r);return qd(o)}Lw=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=dl(e.pendingLanes);n!==0&&(og(e,n|1),hn(e,mt()),!(Oe&6)&&(Xo=mt()+500,Oi()))}break;case 13:Ls(function(){var r=Fr(t,1);if(r!==null){var i=Zt();jn(r,t,1,i)}}),Og(t,1)}};ag=function(t){if(t.tag===13){var e=Fr(t,134217728);if(e!==null){var n=Zt();jn(e,t,134217728,n)}Og(t,134217728)}};Fw=function(t){if(t.tag===13){var e=vi(t),n=Fr(t,e);if(n!==null){var r=Zt();jn(n,t,e,r)}Og(t,e)}};Uw=function(){return He};Ow=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};Ip=function(t,e,n){switch(e){case"input":if(mp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Ih(r);if(!i)throw Error(X(90));gw(r),mp(r,i)}}}break;case"textarea":yw(t,n);break;case"select":e=n.value,e!=null&&bo(t,!!n.multiple,e,!1)}};Cw=Mg;Aw=Ls;var Rk={usingClientEntryPoint:!1,Events:[Tu,So,Ih,ww,Sw,Mg]},tl={findFiberByHostInstance:Es,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Pk={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Pw(t),t===null?null:t.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||Ak,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dc.isDisabled&&Dc.supportsFiber)try{yh=Dc.inject(Pk),cr=Dc}catch{}}Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rk;Sn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qg(e))throw Error(X(200));return Ck(t,e,null,n)};Sn.createRoot=function(t,e){if(!qg(t))throw Error(X(299));var n=!1,r="",i=aC;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Ug(t,1,!1,null,null,n,!1,r,i),t[Lr]=e.current,jl(t.nodeType===8?t.parentNode:t),new Bg(e)};Sn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(X(188)):(t=Object.keys(t).join(","),Error(X(268,t)));return t=Pw(e),t=t===null?null:t.stateNode,t};Sn.flushSync=function(t){return Ls(t)};Sn.hydrate=function(t,e,n){if(!Nh(e))throw Error(X(200));return Dh(null,t,e,!0,n)};Sn.hydrateRoot=function(t,e,n){if(!qg(t))throw Error(X(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=aC;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=oC(e,null,t,1,n??null,i,!1,s,o),t[Lr]=e.current,jl(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new kh(e)};Sn.render=function(t,e,n){if(!Nh(e))throw Error(X(200));return Dh(null,t,e,!1,n)};Sn.unmountComponentAtNode=function(t){if(!Nh(t))throw Error(X(40));return t._reactRootContainer?(Ls(function(){Dh(null,null,t,!1,function(){t._reactRootContainer=null,t[Lr]=null})}),!0):!1};Sn.unstable_batchedUpdates=Mg;Sn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Nh(n))throw Error(X(200));if(t==null||t._reactInternals===void 0)throw Error(X(38));return Dh(t,e,n,!1,r)};Sn.version="18.3.1-next-f1338f8080-20240426";function lC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lC)}catch(t){console.error(t)}}lC(),lw.exports=Sn;var kk=lw.exports,Av=kk;lp.createRoot=Av.createRoot,lp.hydrateRoot=Av.hydrateRoot;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Nk,Dk;function bk(){return{geminiUrl:Nk,vertexUrl:Dk}}function Mk(t,e,n,r){var i,s;if(!(t!=null&&t.baseUrl)){const o=bk();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:n:(s=o.geminiUrl)!==null&&s!==void 0?s:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class js{}function ue(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const s=e[i];return s!=null?String(s):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function h(t,e,n){for(let s=0;s<e.length-1;s++){const o=e[s];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(t[a])){const l=t[a];if(Array.isArray(n))for(let u=0;u<l.length;u++){const f=l[u];h(f,e.slice(s+1),n[u])}else for(const u of l)h(u,e.slice(s+1),n)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in t||(t[a]=[{}]);const l=t[a];h(l[0],e.slice(s+1),n);return}(!t[o]||typeof t[o]!="object")&&(t[o]={}),t=t[o]}const r=e[e.length-1],i=t[r];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function c(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2);if(s in t){const o=t[s];return Array.isArray(o)?o.map(a=>c(a,e.slice(r+1),n)):n}else return n}else t=t[i]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function Vk(t,e){for(const[n,r]of Object.entries(e)){const i=n.split("."),s=r.split("."),o=new Set;let a=-1;for(let l=0;l<i.length;l++)if(i[l]==="*"){a=l;break}if(a!==-1&&s.length>a)for(let l=a;l<s.length;l++){const u=s[l];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&o.add(u)}tm(t,i,s,0,o)}}function tm(t,e,n,r,i){if(r>=e.length||typeof t!="object"||t===null)return;const s=e[r];if(s.endsWith("[]")){const o=s.slice(0,-2),a=t;if(o in a&&Array.isArray(a[o]))for(const l of a[o])tm(l,e,n,r+1,i)}else if(s==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const o=t,a=Object.keys(o).filter(u=>!u.startsWith("_")&&!i.has(u)),l={};for(const u of a)l[u]=o[u];for(const[u,f]of Object.entries(l)){const p=[];for(const g of n.slice(r))g==="*"?p.push(u):p.push(g);h(o,p,f)}for(const u of a)delete o[u]}}else{const o=t;s in o&&tm(o[s],e,n,r+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gg(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Lk(t){const e={},n=c(t,["operationName"]);n!=null&&h(e,["operationName"],n);const r=c(t,["resourceName"]);return r!=null&&h(e,["_url","resourceName"],r),e}function Fk(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["metadata"]);r!=null&&h(e,["metadata"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);s!=null&&h(e,["error"],s);const o=c(t,["response","generateVideoResponse"]);return o!=null&&h(e,["response"],Ok(o)),e}function Uk(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["metadata"]);r!=null&&h(e,["metadata"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);s!=null&&h(e,["error"],s);const o=c(t,["response"]);return o!=null&&h(e,["response"],Bk(o)),e}function Ok(t){const e={},n=c(t,["generatedSamples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>qk(o))),h(e,["generatedVideos"],s)}const r=c(t,["raiMediaFilteredCount"]);r!=null&&h(e,["raiMediaFilteredCount"],r);const i=c(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function Bk(t){const e={},n=c(t,["videos"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Gk(o))),h(e,["generatedVideos"],s)}const r=c(t,["raiMediaFilteredCount"]);r!=null&&h(e,["raiMediaFilteredCount"],r);const i=c(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function qk(t){const e={},n=c(t,["video"]);return n!=null&&h(e,["video"],Hk(n)),e}function Gk(t){const e={},n=c(t,["_self"]);return n!=null&&h(e,["video"],Wk(n)),e}function zk(t){const e={},n=c(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function $k(t){const e={},n=c(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function Hk(t){const e={},n=c(t,["uri"]);n!=null&&h(e,["uri"],n);const r=c(t,["encodedVideo"]);r!=null&&h(e,["videoBytes"],Gg(r));const i=c(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function Wk(t){const e={},n=c(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const r=c(t,["bytesBase64Encoded"]);r!=null&&h(e,["videoBytes"],Gg(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var xv;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(xv||(xv={}));var Rv;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Rv||(Rv={}));var kn;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(kn||(kn={}));var Pv;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Pv||(Pv={}));var kv;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(kv||(kv={}));var Nv;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Nv||(Nv={}));var Dv;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Dv||(Dv={}));var bv;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(bv||(bv={}));var Mv;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Mv||(Mv={}));var Vv;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Vv||(Vv={}));var Lv;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Lv||(Lv={}));var Fv;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Fv||(Fv={}));var Uv;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Uv||(Uv={}));var Ov;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(Ov||(Ov={}));var Bv;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Bv||(Bv={}));var Gd;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Gd||(Gd={}));var qv;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(qv||(qv={}));var nm;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(nm||(nm={}));var Gv;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Gv||(Gv={}));var zv;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(zv||(zv={}));var $v;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V"})($v||($v={}));var Hv;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Hv||(Hv={}));var Wv;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Wv||(Wv={}));var Kv;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Kv||(Kv={}));var jv;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(jv||(jv={}));var Jv;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Jv||(Jv={}));var Qv;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Qv||(Qv={}));var Yv;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Yv||(Yv={}));var Xv;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Xv||(Xv={}));var Zv;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Zv||(Zv={}));var eT;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(eT||(eT={}));var tT;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(tT||(tT={}));var nT;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(nT||(nT={}));var rT;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(rT||(rT={}));var iT;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(iT||(iT={}));var sT;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(sT||(sT={}));var oT;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(oT||(oT={}));var aT;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(aT||(aT={}));var lT;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(lT||(lT={}));var uT;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(uT||(uT={}));var cT;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(cT||(cT={}));var dT;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(dT||(dT={}));var hT;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(hT||(hT={}));var fT;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(fT||(fT={}));var pT;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(pT||(pT={}));var mT;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(mT||(mT={}));var gT;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(gT||(gT={}));var _T;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(_T||(_T={}));var No;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(No||(No={}));class rm{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class nl{get text(){var e,n,r,i,s,o,a,l;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const g of(l=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[v,T]of Object.entries(g))v!=="text"&&v!=="thought"&&(T!==null||T!==void 0)&&p.push(v);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;f=!0,u+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var e,n,r,i,s,o,a,l;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(l=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[g,v]of Object.entries(p))g!=="inlineData"&&(v!==null||v!==void 0)&&f.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,n,r,i,s,o,a,l;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(l=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var e,n,r,i,s,o,a,l,u;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(l=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,n,r,i,s,o,a,l,u;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(l=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class yT{}class vT{}class Kk{}class jk{}class Jk{}class Qk{}class TT{}class ET{}class IT{}class Yk{}class zd{_fromAPIResponse({apiResponse:e,isVertexAI:n}){const r=new zd;let i;const s=e;return n?i=Uk(s):i=Fk(s),Object.assign(r,i),r}}class wT{}class ST{}class CT{}class Xk{}class Zk{}class e1{}class AT{}class t1{get text(){var e,n,r;let i="",s=!1;const o=[];for(const a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[l,u]of Object.entries(a))l!=="text"&&l!=="thought"&&u!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;s=!0,i+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?i:void 0}get data(){var e,n,r;let i="";const s=[];for(const o of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&s.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class n1{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Be(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function uC(t,e){const n=Be(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function cC(t){return Array.isArray(t)?t.map(e=>$d(e)):[$d(t)]}function $d(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function dC(t){const e=$d(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function hC(t){const e=$d(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function xT(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function fC(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>xT(e)):[xT(t)]}function im(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function RT(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function PT(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Ht(t){if(t==null)throw new Error("ContentUnion is required");return im(t)?t:{role:"user",parts:fC(t)}}function zg(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=Ht(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=Ht(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Ht(n)):[Ht(e)]}function bn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(RT(t)||PT(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ht(t)]}const e=[],n=[],r=im(t[0]);for(const i of t){const s=im(i);if(s!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(i);else{if(RT(i)||PT(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:fC(n)}),e}function r1(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(kn).includes(n[0].toUpperCase())?n[0].toUpperCase():kn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(kn).includes(r.toUpperCase())?r.toUpperCase():kn.TYPE_UNSPECIFIED})}}function Oo(t){const e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=t.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,t=s[1]):s[1].type==="null"&&(e.nullable=!0,t=s[0])),t.type instanceof Array&&r1(t.type,e);for(const[o,a]of Object.entries(t))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(kn).includes(a.toUpperCase())?a.toUpperCase():kn.TYPE_UNSPECIFIED}else if(n.includes(o))e[o]=Oo(a);else if(r.includes(o)){const l=[];for(const u of a){if(u.type=="null"){e.nullable=!0;continue}l.push(Oo(u))}e[o]=l}else if(i.includes(o)){const l={};for(const[u,f]of Object.entries(a))l[u]=Oo(f);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function $g(t){return Oo(t)}function Hg(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Wg(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function ya(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Oo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Oo(e.response));return t}function va(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function i1(t,e,n,r=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function $r(t,e){if(typeof e!="string")throw new Error("name must be a string");return i1(t,e,"cachedContents")}function pC(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Bi(t){return Gg(t)}function s1(t){return t!=null&&typeof t=="object"&&"name"in t}function o1(t){return t!=null&&typeof t=="object"&&"video"in t}function a1(t){return t!=null&&typeof t=="object"&&"uri"in t}function mC(t){var e;let n;if(s1(t)&&(n=t.name),!(a1(t)&&(n=t.uri,n===void 0))&&!(o1(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function gC(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function _C(t){for(const e of["models","tunedModels","publisherModels"])if(l1(t,e))return t[e];return[]}function l1(t,e){return t!==null&&typeof t=="object"&&e in t}function u1(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function c1(t,e={}){const n=[],r=new Set;for(const i of t){const s=i.name;if(r.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);r.add(s);const o=u1(i,e);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}function yC(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function d1(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function vC(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let s=!1;for(const o of i){if(typeof o!="object"||o===null)continue;const l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){s=!0;break}}return s&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ta(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function TC(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function h1(t){const e={},n=c(t,["responsesFile"]);n!=null&&h(e,["fileName"],n);const r=c(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>z1(o))),h(e,["inlinedResponses"],s)}const i=c(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),h(e,["inlinedEmbedContentResponses"],s)}return e}function f1(t){const e={},n=c(t,["predictionsFormat"]);n!=null&&h(e,["format"],n);const r=c(t,["gcsDestination","outputUriPrefix"]);r!=null&&h(e,["gcsUri"],r);const i=c(t,["bigqueryDestination","outputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function p1(t){const e={},n=c(t,["format"]);n!=null&&h(e,["predictionsFormat"],n);const r=c(t,["gcsUri"]);r!=null&&h(e,["gcsDestination","outputUriPrefix"],r);const i=c(t,["bigqueryUri"]);if(i!=null&&h(e,["bigqueryDestination","outputUri"],i),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(c(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Zc(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["metadata","displayName"]);r!=null&&h(e,["displayName"],r);const i=c(t,["metadata","state"]);i!=null&&h(e,["state"],TC(i));const s=c(t,["metadata","createTime"]);s!=null&&h(e,["createTime"],s);const o=c(t,["metadata","endTime"]);o!=null&&h(e,["endTime"],o);const a=c(t,["metadata","updateTime"]);a!=null&&h(e,["updateTime"],a);const l=c(t,["metadata","model"]);l!=null&&h(e,["model"],l);const u=c(t,["metadata","output"]);return u!=null&&h(e,["dest"],h1(vC(u))),e}function sm(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["displayName"]);r!=null&&h(e,["displayName"],r);const i=c(t,["state"]);i!=null&&h(e,["state"],TC(i));const s=c(t,["error"]);s!=null&&h(e,["error"],s);const o=c(t,["createTime"]);o!=null&&h(e,["createTime"],o);const a=c(t,["startTime"]);a!=null&&h(e,["startTime"],a);const l=c(t,["endTime"]);l!=null&&h(e,["endTime"],l);const u=c(t,["updateTime"]);u!=null&&h(e,["updateTime"],u);const f=c(t,["model"]);f!=null&&h(e,["model"],f);const p=c(t,["inputConfig"]);p!=null&&h(e,["src"],m1(p));const g=c(t,["outputConfig"]);return g!=null&&h(e,["dest"],f1(vC(g))),e}function m1(t){const e={},n=c(t,["instancesFormat"]);n!=null&&h(e,["format"],n);const r=c(t,["gcsSource","uris"]);r!=null&&h(e,["gcsUri"],r);const i=c(t,["bigquerySource","inputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function g1(t,e){const n={};if(c(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=c(e,["fileName"]);r!=null&&h(n,["fileName"],r);const i=c(e,["inlinedRequests"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>G1(t,o))),h(n,["requests","requests"],s)}return n}function _1(t){const e={},n=c(t,["format"]);n!=null&&h(e,["instancesFormat"],n);const r=c(t,["gcsUri"]);r!=null&&h(e,["gcsSource","uris"],r);const i=c(t,["bigqueryUri"]);if(i!=null&&h(e,["bigquerySource","inputUri"],i),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function y1(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["data"]);n!=null&&h(e,["data"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function v1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function T1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function E1(t){const e={},n=c(t,["content"]);n!=null&&h(e,["content"],n);const r=c(t,["citationMetadata"]);r!=null&&h(e,["citationMetadata"],I1(r));const i=c(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const s=c(t,["finishReason"]);s!=null&&h(e,["finishReason"],s);const o=c(t,["urlContextMetadata"]);o!=null&&h(e,["urlContextMetadata"],o);const a=c(t,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);const l=c(t,["groundingMetadata"]);l!=null&&h(e,["groundingMetadata"],l);const u=c(t,["index"]);u!=null&&h(e,["index"],u);const f=c(t,["logprobsResult"]);f!=null&&h(e,["logprobsResult"],f);const p=c(t,["safetyRatings"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(v=>v)),h(e,["safetyRatings"],g)}return e}function I1(t){const e={},n=c(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),h(e,["citations"],r)}return e}function EC(t){const e={},n=c(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Q1(s))),h(e,["parts"],i)}const r=c(t,["role"]);return r!=null&&h(e,["role"],r),e}function w1(t,e){const n={},r=c(t,["displayName"]);if(e!==void 0&&r!=null&&h(e,["batch","displayName"],r),c(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function S1(t,e){const n={},r=c(t,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const i=c(t,["dest"]);return e!==void 0&&i!=null&&h(e,["outputConfig"],p1(d1(i))),n}function kT(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["src"]);i!=null&&h(n,["batch","inputConfig"],g1(t,yC(t,i)));const s=c(e,["config"]);return s!=null&&w1(s,n),n}function C1(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["model"],Be(t,r));const i=c(e,["src"]);i!=null&&h(n,["inputConfig"],_1(yC(t,i)));const s=c(e,["config"]);return s!=null&&S1(s,n),n}function A1(t,e){const n={},r=c(t,["displayName"]);return e!==void 0&&r!=null&&h(e,["batch","displayName"],r),n}function x1(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["src"]);i!=null&&h(n,["batch","inputConfig"],M1(t,i));const s=c(e,["config"]);return s!=null&&A1(s,n),n}function R1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function P1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function k1(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);return s!=null&&h(e,["error"],s),e}function N1(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);return s!=null&&h(e,["error"],s),e}function D1(t,e){const n={},r=c(e,["contents"]);if(r!=null){let s=zg(t,r);Array.isArray(s)&&(s=s.map(o=>o)),h(n,["requests[]","request","content"],s)}const i=c(e,["config"]);return i!=null&&(h(n,["_self"],b1(i,n)),Vk(n,{"requests[].*":"requests[].request.*"})),n}function b1(t,e){const n={},r=c(t,["taskType"]);e!==void 0&&r!=null&&h(e,["requests[]","taskType"],r);const i=c(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const s=c(t,["outputDimensionality"]);if(e!==void 0&&s!=null&&h(e,["requests[]","outputDimensionality"],s),c(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function M1(t,e){const n={},r=c(e,["fileName"]);r!=null&&h(n,["file_name"],r);const i=c(e,["inlinedRequests"]);return i!=null&&h(n,["requests"],D1(t,i)),n}function V1(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function L1(t,e,n){const r={},i=c(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],EC(Ht(i)));const s=c(e,["temperature"]);s!=null&&h(r,["temperature"],s);const o=c(e,["topP"]);o!=null&&h(r,["topP"],o);const a=c(e,["topK"]);a!=null&&h(r,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(r,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(r,["maxOutputTokens"],u);const f=c(e,["stopSequences"]);f!=null&&h(r,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(r,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(r,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(r,["presencePenalty"],v);const T=c(e,["frequencyPenalty"]);T!=null&&h(r,["frequencyPenalty"],T);const x=c(e,["seed"]);x!=null&&h(r,["seed"],x);const D=c(e,["responseMimeType"]);D!=null&&h(r,["responseMimeType"],D);const S=c(e,["responseSchema"]);S!=null&&h(r,["responseSchema"],$g(S));const E=c(e,["responseJsonSchema"]);if(E!=null&&h(r,["responseJsonSchema"],E),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=c(e,["safetySettings"]);if(n!==void 0&&R!=null){let V=R;Array.isArray(V)&&(V=V.map(k=>Y1(k))),h(n,["safetySettings"],V)}const M=c(e,["tools"]);if(n!==void 0&&M!=null){let V=va(M);Array.isArray(V)&&(V=V.map(k=>X1(ya(k)))),h(n,["tools"],V)}const O=c(e,["toolConfig"]);if(n!==void 0&&O!=null&&h(n,["toolConfig"],O),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const F=c(e,["cachedContent"]);n!==void 0&&F!=null&&h(n,["cachedContent"],$r(t,F));const I=c(e,["responseModalities"]);I!=null&&h(r,["responseModalities"],I);const w=c(e,["mediaResolution"]);w!=null&&h(r,["mediaResolution"],w);const C=c(e,["speechConfig"]);if(C!=null&&h(r,["speechConfig"],Hg(C)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=c(e,["thinkingConfig"]);N!=null&&h(r,["thinkingConfig"],N);const b=c(e,["imageConfig"]);return b!=null&&h(r,["imageConfig"],b),r}function F1(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["candidates"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>E1(u))),h(e,["candidates"],l)}const i=c(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const s=c(t,["promptFeedback"]);s!=null&&h(e,["promptFeedback"],s);const o=c(t,["responseId"]);o!=null&&h(e,["responseId"],o);const a=c(t,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function U1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function O1(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],Ta(t,r)),n}function B1(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=c(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function q1(t){const e={},n=c(t,["timeRangeFilter"]);if(n!=null&&h(e,["timeRangeFilter"],n),c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function G1(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["request","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let a=bn(i);Array.isArray(a)&&(a=a.map(l=>EC(l))),h(n,["request","contents"],a)}const s=c(e,["metadata"]);s!=null&&h(n,["metadata"],s);const o=c(e,["config"]);return o!=null&&h(n,["request","generationConfig"],L1(t,o,c(n,["request"],{}))),n}function z1(t){const e={},n=c(t,["response"]);n!=null&&h(e,["response"],F1(n));const r=c(t,["error"]);return r!=null&&h(e,["error"],r),e}function $1(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);if(e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),c(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function H1(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);e!==void 0&&i!=null&&h(e,["_query","pageToken"],i);const s=c(t,["filter"]);return e!==void 0&&s!=null&&h(e,["_query","filter"],s),n}function W1(t){const e={},n=c(t,["config"]);return n!=null&&$1(n,e),e}function K1(t){const e={},n=c(t,["config"]);return n!=null&&H1(n,e),e}function j1(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["operations"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>Zc(o))),h(e,["batchJobs"],s)}return e}function J1(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["batchPredictionJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>sm(o))),h(e,["batchJobs"],s)}return e}function Q1(t){const e={},n=c(t,["videoMetadata"]);n!=null&&h(e,["videoMetadata"],n);const r=c(t,["thought"]);r!=null&&h(e,["thought"],r);const i=c(t,["inlineData"]);i!=null&&h(e,["inlineData"],y1(i));const s=c(t,["fileData"]);s!=null&&h(e,["fileData"],V1(s));const o=c(t,["thoughtSignature"]);o!=null&&h(e,["thoughtSignature"],o);const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],a);const l=c(t,["codeExecutionResult"]);l!=null&&h(e,["codeExecutionResult"],l);const u=c(t,["executableCode"]);u!=null&&h(e,["executableCode"],u);const f=c(t,["functionResponse"]);f!=null&&h(e,["functionResponse"],f);const p=c(t,["text"]);return p!=null&&h(e,["text"],p),e}function Y1(t){const e={};if(c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=c(t,["category"]);n!=null&&h(e,["category"],n);const r=c(t,["threshold"]);return r!=null&&h(e,["threshold"],r),e}function X1(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=c(t,["googleSearch"]);r!=null&&h(e,["googleSearch"],q1(r));const i=c(t,["googleSearchRetrieval"]);if(i!=null&&h(e,["googleSearchRetrieval"],i),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const s=c(t,["googleMaps"]);s!=null&&h(e,["googleMaps"],B1(s));const o=c(t,["urlContext"]);o!=null&&h(e,["urlContext"],o);const a=c(t,["computerUse"]);a!=null&&h(e,["computerUse"],a);const l=c(t,["codeExecution"]);return l!=null&&h(e,["codeExecution"],l),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Fs;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Fs||(Fs={}));class Iu{constructor(e,n,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,i)}init(e,n,r){var i,s;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!r||Object.keys(r).length===0?o={config:{}}:typeof r=="object"?o=Object.assign({},r):o=r,o.config&&(o.config.pageToken=n.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(s=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Z1 extends js{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new Iu(Fs.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=kT(this.apiClient,e),r=n._url,i=ue("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,l=a.requests,u=[];for(const f of l){const p=Object.assign({},f);if(p.systemInstruction){const g=p.systemInstruction;delete p.systemInstruction;const v=p.request;v.systemInstruction=g,p.request=v}u.push(p)}return a.requests=u,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){const s=this.getGcsUri(e),o=this.getBigqueryUri(e);if(s)s.endsWith(".jsonl")?r.dest=`${s.slice(0,-6)}/dest`:r.dest=`${s}_dest_${i}`;else if(o)r.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=C1(this.apiClient,e);return a=ue("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>sm(f))}else{const u=kT(this.apiClient,e);return a=ue("{model}:batchGenerateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>Zc(f))}}async createEmbeddingsInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=x1(this.apiClient,e);return s=ue("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i.then(l=>Zc(l))}}async get(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=O1(this.apiClient,e);return a=ue("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>sm(f))}else{const u=U1(this.apiClient,e);return a=ue("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>Zc(f))}}async cancel(e){var n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI()){const l=T1(this.apiClient,e);o=ue("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const l=v1(this.apiClient,e);o=ue("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=K1(e);return a=ue("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=J1(f),g=new AT;return Object.assign(g,p),g})}else{const u=W1(e);return a=ue("batches",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=j1(f),g=new AT;return Object.assign(g,p),g})}}async delete(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=P1(this.apiClient,e);return a=ue("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>N1(f))}else{const u=R1(this.apiClient,e);return a=ue("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>k1(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eN(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["data"]);n!=null&&h(e,["data"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function NT(t){const e={},n=c(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>EN(s))),h(e,["parts"],i)}const r=c(t,["role"]);return r!=null&&h(e,["role"],r),e}function tN(t,e){const n={},r=c(t,["ttl"]);e!==void 0&&r!=null&&h(e,["ttl"],r);const i=c(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const s=c(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const o=c(t,["contents"]);if(e!==void 0&&o!=null){let f=bn(o);Array.isArray(f)&&(f=f.map(p=>NT(p))),h(e,["contents"],f)}const a=c(t,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],NT(Ht(a)));const l=c(t,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>IN(p))),h(e,["tools"],f)}const u=c(t,["toolConfig"]);if(e!==void 0&&u!=null&&h(e,["toolConfig"],u),c(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function nN(t,e){const n={},r=c(t,["ttl"]);e!==void 0&&r!=null&&h(e,["ttl"],r);const i=c(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const s=c(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const o=c(t,["contents"]);if(e!==void 0&&o!=null){let p=bn(o);Array.isArray(p)&&(p=p.map(g=>g)),h(e,["contents"],p)}const a=c(t,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],Ht(a));const l=c(t,["tools"]);if(e!==void 0&&l!=null){let p=l;Array.isArray(p)&&(p=p.map(g=>wN(g))),h(e,["tools"],p)}const u=c(t,["toolConfig"]);e!==void 0&&u!=null&&h(e,["toolConfig"],u);const f=c(t,["kmsKeyName"]);return e!==void 0&&f!=null&&h(e,["encryption_spec","kmsKeyName"],f),n}function rN(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["model"],uC(t,r));const i=c(e,["config"]);return i!=null&&tN(i,n),n}function iN(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["model"],uC(t,r));const i=c(e,["config"]);return i!=null&&nN(i,n),n}function sN(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],$r(t,r)),n}function oN(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],$r(t,r)),n}function aN(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function lN(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function uN(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function cN(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=c(t,["description"]);n!=null&&h(e,["description"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["parameters"]);i!=null&&h(e,["parameters"],i);const s=c(t,["parametersJsonSchema"]);s!=null&&h(e,["parametersJsonSchema"],s);const o=c(t,["response"]);o!=null&&h(e,["response"],o);const a=c(t,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function dN(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],$r(t,r)),n}function hN(t,e){const n={},r=c(e,["name"]);return r!=null&&h(n,["_url","name"],$r(t,r)),n}function fN(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=c(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function pN(t){const e={},n=c(t,["timeRangeFilter"]);if(n!=null&&h(e,["timeRangeFilter"],n),c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function mN(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function gN(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function _N(t){const e={},n=c(t,["config"]);return n!=null&&mN(n,e),e}function yN(t){const e={},n=c(t,["config"]);return n!=null&&gN(n,e),e}function vN(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),h(e,["cachedContents"],s)}return e}function TN(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),h(e,["cachedContents"],s)}return e}function EN(t){const e={},n=c(t,["videoMetadata"]);n!=null&&h(e,["videoMetadata"],n);const r=c(t,["thought"]);r!=null&&h(e,["thought"],r);const i=c(t,["inlineData"]);i!=null&&h(e,["inlineData"],eN(i));const s=c(t,["fileData"]);s!=null&&h(e,["fileData"],uN(s));const o=c(t,["thoughtSignature"]);o!=null&&h(e,["thoughtSignature"],o);const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],a);const l=c(t,["codeExecutionResult"]);l!=null&&h(e,["codeExecutionResult"],l);const u=c(t,["executableCode"]);u!=null&&h(e,["executableCode"],u);const f=c(t,["functionResponse"]);f!=null&&h(e,["functionResponse"],f);const p=c(t,["text"]);return p!=null&&h(e,["text"],p),e}function IN(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=c(t,["googleSearch"]);r!=null&&h(e,["googleSearch"],pN(r));const i=c(t,["googleSearchRetrieval"]);if(i!=null&&h(e,["googleSearchRetrieval"],i),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const s=c(t,["googleMaps"]);s!=null&&h(e,["googleMaps"],fN(s));const o=c(t,["urlContext"]);o!=null&&h(e,["urlContext"],o);const a=c(t,["computerUse"]);a!=null&&h(e,["computerUse"],a);const l=c(t,["codeExecution"]);return l!=null&&h(e,["codeExecution"],l),e}function wN(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(g=>cN(g))),h(e,["functionDeclarations"],p)}const r=c(t,["retrieval"]);r!=null&&h(e,["retrieval"],r);const i=c(t,["googleSearch"]);i!=null&&h(e,["googleSearch"],i);const s=c(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const o=c(t,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);const a=c(t,["googleMaps"]);a!=null&&h(e,["googleMaps"],a);const l=c(t,["urlContext"]);l!=null&&h(e,["urlContext"],l);const u=c(t,["computerUse"]);u!=null&&h(e,["computerUse"],u);const f=c(t,["codeExecution"]);return f!=null&&h(e,["codeExecution"],f),e}function SN(t,e){const n={},r=c(t,["ttl"]);e!==void 0&&r!=null&&h(e,["ttl"],r);const i=c(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function CN(t,e){const n={},r=c(t,["ttl"]);e!==void 0&&r!=null&&h(e,["ttl"],r);const i=c(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function AN(t,e){const n={},r=c(e,["name"]);r!=null&&h(n,["_url","name"],$r(t,r));const i=c(e,["config"]);return i!=null&&SN(i,n),n}function xN(t,e){const n={},r=c(e,["name"]);r!=null&&h(n,["_url","name"],$r(t,r));const i=c(e,["config"]);return i!=null&&CN(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class RN extends js{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Iu(Fs.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=iN(this.apiClient,e);return a=ue("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=rN(this.apiClient,e);return a=ue("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async get(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=hN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=dN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=oN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=lN(f),g=new ST;return Object.assign(g,p),g})}else{const u=sN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=aN(f),g=new ST;return Object.assign(g,p),g})}}async update(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=xN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=AN(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async listInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=yN(e);return a=ue("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=TN(f),g=new CT;return Object.assign(g,p),g})}else{const u=_N(e);return a=ue("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=vN(f),g=new CT;return Object.assign(g,p),g})}}}function DT(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xe(t){return this instanceof Xe?(this.v=t,this):new Xe(t)}function Bo(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(v){return function(T){return Promise.resolve(T).then(v,p)}}function a(v,T){r[v]&&(i[v]=function(x){return new Promise(function(D,S){s.push([v,x,D,S])>1||l(v,x)})},T&&(i[v]=T(i[v])))}function l(v,T){try{u(r[v](T))}catch(x){g(s[0][3],x)}}function u(v){v.value instanceof Xe?Promise.resolve(v.value.v).then(f,p):g(s[0][2],v)}function f(v){l("next",v)}function p(v){l("throw",v)}function g(v,T){v(T),s.shift(),s.length&&l(s[0][0],s[0][1])}}function xl(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof DT=="function"?DT(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function PN(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:IC(n)}function IC(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function kN(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function bT(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const i=[];let s=!0;for(;r<n&&t[r].role==="model";)i.push(t[r]),s&&!IC(t[r])&&(s=!1),r++;s?e.push(...i):e.pop()}return e}class NN{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new DN(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class DN{constructor(e,n,r,i={},s=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=i,this.history=s,this.sendPromise=Promise.resolve(),kN(s)}async sendMessage(e){var n;await this.sendPromise;const r=Ht(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var s,o,a;const l=await i,u=(o=(s=l.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content,f=l.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let g=[];f!=null&&(g=(a=f.slice(p))!==null&&a!==void 0?a:[]);const v=u?[u]:[];this.recordHistory(r,v,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const r=Ht(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const s=await i;return this.processStreamResponse(s,r)}getHistory(e=!1){const n=e?bT(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var r,i;return Bo(this,arguments,function*(){var o,a,l,u;const f=[];try{for(var p=!0,g=xl(e),v;v=yield Xe(g.next()),o=v.done,!o;p=!0){u=v.value,p=!1;const T=u;if(PN(T)){const x=(i=(r=T.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content;x!==void 0&&f.push(x)}yield yield Xe(T)}}catch(T){a={error:T}}finally{try{!p&&!o&&(l=g.return)&&(yield Xe(l.call(g)))}finally{if(a)throw a.error}}this.recordHistory(n,f)})}recordHistory(e,n,r){let i=[];n.length>0&&n.every(s=>s.role!==void 0)?i=n:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...bT(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bh extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,bh.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bN(t){const e={},n=c(t,["file"]);return n!=null&&h(e,["file"],n),e}function MN(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function VN(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","file"],mC(n)),e}function LN(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function FN(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","file"],mC(n)),e}function UN(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function ON(t){const e={},n=c(t,["config"]);return n!=null&&UN(n,e),e}function BN(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["files"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),h(e,["files"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qN extends js{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Iu(Fs.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ON(e);return s=ue("files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=BN(l),f=new Xk;return Object.assign(f,u),f})}}async createInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=bN(e);return s=ue("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i.then(l=>{const u=MN(l),f=new Zk;return Object.assign(f,u),f})}}async get(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=FN(e);return s=ue("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=VN(e);return s=ue("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=LN(l),f=new e1;return Object.assign(f,u),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ed(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["data"]);n!=null&&h(e,["data"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function GN(t){const e={},n=c(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>rD(s))),h(e,["parts"],i)}const r=c(t,["role"]);return r!=null&&h(e,["role"],r),e}function zN(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function $N(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=c(t,["description"]);n!=null&&h(e,["description"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["parameters"]);i!=null&&h(e,["parameters"],i);const s=c(t,["parametersJsonSchema"]);s!=null&&h(e,["parametersJsonSchema"],s);const o=c(t,["response"]);o!=null&&h(e,["response"],o);const a=c(t,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function HN(t){const e={},n=c(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const r=c(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const i=c(t,["candidateCount"]);i!=null&&h(e,["candidateCount"],i);const s=c(t,["enableAffectiveDialog"]);s!=null&&h(e,["enableAffectiveDialog"],s);const o=c(t,["frequencyPenalty"]);o!=null&&h(e,["frequencyPenalty"],o);const a=c(t,["logprobs"]);a!=null&&h(e,["logprobs"],a);const l=c(t,["maxOutputTokens"]);l!=null&&h(e,["maxOutputTokens"],l);const u=c(t,["mediaResolution"]);u!=null&&h(e,["mediaResolution"],u);const f=c(t,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);const p=c(t,["responseJsonSchema"]);p!=null&&h(e,["responseJsonSchema"],p);const g=c(t,["responseLogprobs"]);g!=null&&h(e,["responseLogprobs"],g);const v=c(t,["responseMimeType"]);v!=null&&h(e,["responseMimeType"],v);const T=c(t,["responseModalities"]);T!=null&&h(e,["responseModalities"],T);const x=c(t,["responseSchema"]);x!=null&&h(e,["responseSchema"],x);const D=c(t,["routingConfig"]);D!=null&&h(e,["routingConfig"],D);const S=c(t,["seed"]);S!=null&&h(e,["seed"],S);const E=c(t,["speechConfig"]);E!=null&&h(e,["speechConfig"],wC(E));const R=c(t,["stopSequences"]);R!=null&&h(e,["stopSequences"],R);const M=c(t,["temperature"]);M!=null&&h(e,["temperature"],M);const O=c(t,["thinkingConfig"]);O!=null&&h(e,["thinkingConfig"],O);const F=c(t,["topK"]);F!=null&&h(e,["topK"],F);const I=c(t,["topP"]);return I!=null&&h(e,["topP"],I),e}function WN(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=c(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function KN(t){const e={},n=c(t,["timeRangeFilter"]);if(n!=null&&h(e,["timeRangeFilter"],n),c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function jN(t,e){const n={},r=c(t,["generationConfig"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig"],r);const i=c(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const s=c(t,["temperature"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","temperature"],s);const o=c(t,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(t,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(t,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(t,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],Wg(p));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const T=c(t,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],GN(Ht(T)));const x=c(t,["tools"]);if(e!==void 0&&x!=null){let F=va(x);Array.isArray(F)&&(F=F.map(I=>sD(ya(I)))),h(e,["setup","tools"],F)}const D=c(t,["sessionResumption"]);e!==void 0&&D!=null&&h(e,["setup","sessionResumption"],iD(D));const S=c(t,["inputAudioTranscription"]);e!==void 0&&S!=null&&h(e,["setup","inputAudioTranscription"],S);const E=c(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&h(e,["setup","outputAudioTranscription"],E);const R=c(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=c(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const O=c(t,["proactivity"]);return e!==void 0&&O!=null&&h(e,["setup","proactivity"],O),n}function JN(t,e){const n={},r=c(t,["generationConfig"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig"],HN(r));const i=c(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const s=c(t,["temperature"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","temperature"],s);const o=c(t,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(t,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(t,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(t,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],wC(Wg(p)));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const T=c(t,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],Ht(T));const x=c(t,["tools"]);if(e!==void 0&&x!=null){let F=va(x);Array.isArray(F)&&(F=F.map(I=>oD(ya(I)))),h(e,["setup","tools"],F)}const D=c(t,["sessionResumption"]);e!==void 0&&D!=null&&h(e,["setup","sessionResumption"],D);const S=c(t,["inputAudioTranscription"]);e!==void 0&&S!=null&&h(e,["setup","inputAudioTranscription"],S);const E=c(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&h(e,["setup","outputAudioTranscription"],E);const R=c(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=c(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const O=c(t,["proactivity"]);return e!==void 0&&O!=null&&h(e,["setup","proactivity"],O),n}function QN(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["setup","model"],Be(t,r));const i=c(e,["config"]);return i!=null&&h(n,["config"],jN(i,n)),n}function YN(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["setup","model"],Be(t,r));const i=c(e,["config"]);return i!=null&&h(n,["config"],JN(i,n)),n}function XN(t){const e={},n=c(t,["musicGenerationConfig"]);return n!=null&&h(e,["musicGenerationConfig"],n),e}function ZN(t){const e={},n=c(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),h(e,["weightedPrompts"],r)}return e}function eD(t){const e={},n=c(t,["media"]);if(n!=null){let u=cC(n);Array.isArray(u)&&(u=u.map(f=>ed(f))),h(e,["mediaChunks"],u)}const r=c(t,["audio"]);r!=null&&h(e,["audio"],ed(hC(r)));const i=c(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const s=c(t,["video"]);s!=null&&h(e,["video"],ed(dC(s)));const o=c(t,["text"]);o!=null&&h(e,["text"],o);const a=c(t,["activityStart"]);a!=null&&h(e,["activityStart"],a);const l=c(t,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function tD(t){const e={},n=c(t,["media"]);if(n!=null){let u=cC(n);Array.isArray(u)&&(u=u.map(f=>f)),h(e,["mediaChunks"],u)}const r=c(t,["audio"]);r!=null&&h(e,["audio"],hC(r));const i=c(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const s=c(t,["video"]);s!=null&&h(e,["video"],dC(s));const o=c(t,["text"]);o!=null&&h(e,["text"],o);const a=c(t,["activityStart"]);a!=null&&h(e,["activityStart"],a);const l=c(t,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function nD(t){const e={},n=c(t,["setupComplete"]);n!=null&&h(e,["setupComplete"],n);const r=c(t,["serverContent"]);r!=null&&h(e,["serverContent"],r);const i=c(t,["toolCall"]);i!=null&&h(e,["toolCall"],i);const s=c(t,["toolCallCancellation"]);s!=null&&h(e,["toolCallCancellation"],s);const o=c(t,["usageMetadata"]);o!=null&&h(e,["usageMetadata"],aD(o));const a=c(t,["goAway"]);a!=null&&h(e,["goAway"],a);const l=c(t,["sessionResumptionUpdate"]);return l!=null&&h(e,["sessionResumptionUpdate"],l),e}function rD(t){const e={},n=c(t,["videoMetadata"]);n!=null&&h(e,["videoMetadata"],n);const r=c(t,["thought"]);r!=null&&h(e,["thought"],r);const i=c(t,["inlineData"]);i!=null&&h(e,["inlineData"],ed(i));const s=c(t,["fileData"]);s!=null&&h(e,["fileData"],zN(s));const o=c(t,["thoughtSignature"]);o!=null&&h(e,["thoughtSignature"],o);const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],a);const l=c(t,["codeExecutionResult"]);l!=null&&h(e,["codeExecutionResult"],l);const u=c(t,["executableCode"]);u!=null&&h(e,["executableCode"],u);const f=c(t,["functionResponse"]);f!=null&&h(e,["functionResponse"],f);const p=c(t,["text"]);return p!=null&&h(e,["text"],p),e}function iD(t){const e={},n=c(t,["handle"]);if(n!=null&&h(e,["handle"],n),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function wC(t){const e={},n=c(t,["voiceConfig"]);if(n!=null&&h(e,["voiceConfig"],n),c(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=c(t,["languageCode"]);return r!=null&&h(e,["languageCode"],r),e}function sD(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=c(t,["googleSearch"]);r!=null&&h(e,["googleSearch"],KN(r));const i=c(t,["googleSearchRetrieval"]);if(i!=null&&h(e,["googleSearchRetrieval"],i),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const s=c(t,["googleMaps"]);s!=null&&h(e,["googleMaps"],WN(s));const o=c(t,["urlContext"]);o!=null&&h(e,["urlContext"],o);const a=c(t,["computerUse"]);a!=null&&h(e,["computerUse"],a);const l=c(t,["codeExecution"]);return l!=null&&h(e,["codeExecution"],l),e}function oD(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(g=>$N(g))),h(e,["functionDeclarations"],p)}const r=c(t,["retrieval"]);r!=null&&h(e,["retrieval"],r);const i=c(t,["googleSearch"]);i!=null&&h(e,["googleSearch"],i);const s=c(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const o=c(t,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);const a=c(t,["googleMaps"]);a!=null&&h(e,["googleMaps"],a);const l=c(t,["urlContext"]);l!=null&&h(e,["urlContext"],l);const u=c(t,["computerUse"]);u!=null&&h(e,["computerUse"],u);const f=c(t,["codeExecution"]);return f!=null&&h(e,["codeExecution"],f),e}function aD(t){const e={},n=c(t,["promptTokenCount"]);n!=null&&h(e,["promptTokenCount"],n);const r=c(t,["cachedContentTokenCount"]);r!=null&&h(e,["cachedContentTokenCount"],r);const i=c(t,["candidatesTokenCount"]);i!=null&&h(e,["responseTokenCount"],i);const s=c(t,["toolUsePromptTokenCount"]);s!=null&&h(e,["toolUsePromptTokenCount"],s);const o=c(t,["thoughtsTokenCount"]);o!=null&&h(e,["thoughtsTokenCount"],o);const a=c(t,["totalTokenCount"]);a!=null&&h(e,["totalTokenCount"],a);const l=c(t,["promptTokensDetails"]);if(l!=null){let v=l;Array.isArray(v)&&(v=v.map(T=>T)),h(e,["promptTokensDetails"],v)}const u=c(t,["cacheTokensDetails"]);if(u!=null){let v=u;Array.isArray(v)&&(v=v.map(T=>T)),h(e,["cacheTokensDetails"],v)}const f=c(t,["candidatesTokensDetails"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(T=>T)),h(e,["responseTokensDetails"],v)}const p=c(t,["toolUsePromptTokensDetails"]);if(p!=null){let v=p;Array.isArray(v)&&(v=v.map(T=>T)),h(e,["toolUsePromptTokensDetails"],v)}const g=c(t,["trafficType"]);return g!=null&&h(e,["trafficType"],g),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lD(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["data"]);n!=null&&h(e,["data"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function uD(t){const e={},n=c(t,["content"]);n!=null&&h(e,["content"],n);const r=c(t,["citationMetadata"]);r!=null&&h(e,["citationMetadata"],cD(r));const i=c(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const s=c(t,["finishReason"]);s!=null&&h(e,["finishReason"],s);const o=c(t,["urlContextMetadata"]);o!=null&&h(e,["urlContextMetadata"],o);const a=c(t,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);const l=c(t,["groundingMetadata"]);l!=null&&h(e,["groundingMetadata"],l);const u=c(t,["index"]);u!=null&&h(e,["index"],u);const f=c(t,["logprobsResult"]);f!=null&&h(e,["logprobsResult"],f);const p=c(t,["safetyRatings"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(v=>v)),h(e,["safetyRatings"],g)}return e}function cD(t){const e={},n=c(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),h(e,["citations"],r)}return e}function dD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let s=bn(i);Array.isArray(s)&&(s=s.map(o=>o)),h(n,["contents"],s)}return n}function hD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["tokensInfo"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),h(e,["tokensInfo"],i)}return e}function fD(t){const e={},n=c(t,["values"]);n!=null&&h(e,["values"],n);const r=c(t,["statistics"]);return r!=null&&h(e,["statistics"],pD(r)),e}function pD(t){const e={},n=c(t,["truncated"]);n!=null&&h(e,["truncated"],n);const r=c(t,["token_count"]);return r!=null&&h(e,["tokenCount"],r),e}function Mh(t){const e={},n=c(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>vb(s))),h(e,["parts"],i)}const r=c(t,["role"]);return r!=null&&h(e,["role"],r),e}function mD(t){const e={},n=c(t,["controlType"]);n!=null&&h(e,["controlType"],n);const r=c(t,["enableControlImageComputation"]);return r!=null&&h(e,["computeControl"],r),e}function gD(t){const e={};if(c(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(c(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(c(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function _D(t,e){const n={},r=c(t,["systemInstruction"]);e!==void 0&&r!=null&&h(e,["systemInstruction"],Ht(r));const i=c(t,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>RC(a))),h(e,["tools"],o)}const s=c(t,["generationConfig"]);return e!==void 0&&s!=null&&h(e,["generationConfig"],ob(s)),n}function yD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let o=bn(i);Array.isArray(o)&&(o=o.map(a=>Mh(a))),h(n,["contents"],o)}const s=c(e,["config"]);return s!=null&&gD(s),n}function vD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let o=bn(i);Array.isArray(o)&&(o=o.map(a=>a)),h(n,["contents"],o)}const s=c(e,["config"]);return s!=null&&_D(s,n),n}function TD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["totalTokens"]);r!=null&&h(e,["totalTokens"],r);const i=c(t,["cachedContentTokenCount"]);return i!=null&&h(e,["cachedContentTokenCount"],i),e}function ED(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["totalTokens"]);return r!=null&&h(e,["totalTokens"],r),e}function ID(t,e){const n={},r=c(e,["model"]);return r!=null&&h(n,["_url","name"],Be(t,r)),n}function wD(t,e){const n={},r=c(e,["model"]);return r!=null&&h(n,["_url","name"],Be(t,r)),n}function SD(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function CD(t){const e={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function AD(t,e){const n={},r=c(t,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const i=c(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const s=c(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const o=c(t,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const a=c(t,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);const l=c(t,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);const u=c(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&h(e,["parameters","includeSafetyAttributes"],p);const g=c(t,["includeRaiReason"]);e!==void 0&&g!=null&&h(e,["parameters","includeRaiReason"],g);const v=c(t,["language"]);e!==void 0&&v!=null&&h(e,["parameters","language"],v);const T=c(t,["outputMimeType"]);e!==void 0&&T!=null&&h(e,["parameters","outputOptions","mimeType"],T);const x=c(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&h(e,["parameters","outputOptions","compressionQuality"],x);const D=c(t,["addWatermark"]);e!==void 0&&D!=null&&h(e,["parameters","addWatermark"],D);const S=c(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const E=c(t,["editMode"]);e!==void 0&&E!=null&&h(e,["parameters","editMode"],E);const R=c(t,["baseSteps"]);return e!==void 0&&R!=null&&h(e,["parameters","editConfig","baseSteps"],R),n}function xD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const s=c(e,["referenceImages"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(l=>Cb(l))),h(n,["instances[0]","referenceImages"],a)}const o=c(e,["config"]);return o!=null&&AD(o,n),n}function RD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Vh(s))),h(e,["generatedImages"],i)}return e}function PD(t,e){const n={},r=c(t,["taskType"]);e!==void 0&&r!=null&&h(e,["requests[]","taskType"],r);const i=c(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const s=c(t,["outputDimensionality"]);if(e!==void 0&&s!=null&&h(e,["requests[]","outputDimensionality"],s),c(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function kD(t,e){const n={},r=c(t,["taskType"]);e!==void 0&&r!=null&&h(e,["instances[]","task_type"],r);const i=c(t,["title"]);e!==void 0&&i!=null&&h(e,["instances[]","title"],i);const s=c(t,["outputDimensionality"]);e!==void 0&&s!=null&&h(e,["parameters","outputDimensionality"],s);const o=c(t,["mimeType"]);e!==void 0&&o!=null&&h(e,["instances[]","mimeType"],o);const a=c(t,["autoTruncate"]);return e!==void 0&&a!=null&&h(e,["parameters","autoTruncate"],a),n}function ND(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let a=zg(t,i);Array.isArray(a)&&(a=a.map(l=>l)),h(n,["requests[]","content"],a)}const s=c(e,["config"]);s!=null&&PD(s,n);const o=c(e,["model"]);return o!==void 0&&h(n,["requests[]","model"],Be(t,o)),n}function DD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let o=zg(t,i);Array.isArray(o)&&(o=o.map(a=>a)),h(n,["instances[]","content"],o)}const s=c(e,["config"]);return s!=null&&kD(s,n),n}function bD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["embeddings"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>o)),h(e,["embeddings"],s)}const i=c(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function MD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["predictions[]","embeddings"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>fD(o))),h(e,["embeddings"],s)}const i=c(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function VD(t){const e={},n=c(t,["endpoint"]);n!=null&&h(e,["name"],n);const r=c(t,["deployedModelId"]);return r!=null&&h(e,["deployedModelId"],r),e}function LD(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function FD(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=c(t,["description"]);n!=null&&h(e,["description"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["parameters"]);i!=null&&h(e,["parameters"],i);const s=c(t,["parametersJsonSchema"]);s!=null&&h(e,["parametersJsonSchema"],s);const o=c(t,["response"]);o!=null&&h(e,["response"],o);const a=c(t,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function UD(t,e,n){const r={},i=c(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],Mh(Ht(i)));const s=c(e,["temperature"]);s!=null&&h(r,["temperature"],s);const o=c(e,["topP"]);o!=null&&h(r,["topP"],o);const a=c(e,["topK"]);a!=null&&h(r,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(r,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(r,["maxOutputTokens"],u);const f=c(e,["stopSequences"]);f!=null&&h(r,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(r,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(r,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(r,["presencePenalty"],v);const T=c(e,["frequencyPenalty"]);T!=null&&h(r,["frequencyPenalty"],T);const x=c(e,["seed"]);x!=null&&h(r,["seed"],x);const D=c(e,["responseMimeType"]);D!=null&&h(r,["responseMimeType"],D);const S=c(e,["responseSchema"]);S!=null&&h(r,["responseSchema"],$g(S));const E=c(e,["responseJsonSchema"]);if(E!=null&&h(r,["responseJsonSchema"],E),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=c(e,["safetySettings"]);if(n!==void 0&&R!=null){let V=R;Array.isArray(V)&&(V=V.map(k=>Ab(k))),h(n,["safetySettings"],V)}const M=c(e,["tools"]);if(n!==void 0&&M!=null){let V=va(M);Array.isArray(V)&&(V=V.map(k=>Db(ya(k)))),h(n,["tools"],V)}const O=c(e,["toolConfig"]);if(n!==void 0&&O!=null&&h(n,["toolConfig"],O),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const F=c(e,["cachedContent"]);n!==void 0&&F!=null&&h(n,["cachedContent"],$r(t,F));const I=c(e,["responseModalities"]);I!=null&&h(r,["responseModalities"],I);const w=c(e,["mediaResolution"]);w!=null&&h(r,["mediaResolution"],w);const C=c(e,["speechConfig"]);if(C!=null&&h(r,["speechConfig"],Hg(C)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=c(e,["thinkingConfig"]);N!=null&&h(r,["thinkingConfig"],N);const b=c(e,["imageConfig"]);return b!=null&&h(r,["imageConfig"],b),r}function OD(t,e,n){const r={},i=c(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],Ht(i));const s=c(e,["temperature"]);s!=null&&h(r,["temperature"],s);const o=c(e,["topP"]);o!=null&&h(r,["topP"],o);const a=c(e,["topK"]);a!=null&&h(r,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(r,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(r,["maxOutputTokens"],u);const f=c(e,["stopSequences"]);f!=null&&h(r,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(r,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(r,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(r,["presencePenalty"],v);const T=c(e,["frequencyPenalty"]);T!=null&&h(r,["frequencyPenalty"],T);const x=c(e,["seed"]);x!=null&&h(r,["seed"],x);const D=c(e,["responseMimeType"]);D!=null&&h(r,["responseMimeType"],D);const S=c(e,["responseSchema"]);S!=null&&h(r,["responseSchema"],$g(S));const E=c(e,["responseJsonSchema"]);E!=null&&h(r,["responseJsonSchema"],E);const R=c(e,["routingConfig"]);R!=null&&h(r,["routingConfig"],R);const M=c(e,["modelSelectionConfig"]);M!=null&&h(r,["modelConfig"],M);const O=c(e,["safetySettings"]);if(n!==void 0&&O!=null){let Me=O;Array.isArray(Me)&&(Me=Me.map(he=>he)),h(n,["safetySettings"],Me)}const F=c(e,["tools"]);if(n!==void 0&&F!=null){let Me=va(F);Array.isArray(Me)&&(Me=Me.map(he=>RC(ya(he)))),h(n,["tools"],Me)}const I=c(e,["toolConfig"]);n!==void 0&&I!=null&&h(n,["toolConfig"],I);const w=c(e,["labels"]);n!==void 0&&w!=null&&h(n,["labels"],w);const C=c(e,["cachedContent"]);n!==void 0&&C!=null&&h(n,["cachedContent"],$r(t,C));const N=c(e,["responseModalities"]);N!=null&&h(r,["responseModalities"],N);const b=c(e,["mediaResolution"]);b!=null&&h(r,["mediaResolution"],b);const V=c(e,["speechConfig"]);V!=null&&h(r,["speechConfig"],xC(Hg(V)));const k=c(e,["audioTimestamp"]);k!=null&&h(r,["audioTimestamp"],k);const xe=c(e,["thinkingConfig"]);xe!=null&&h(r,["thinkingConfig"],xe);const Fe=c(e,["imageConfig"]);return Fe!=null&&h(r,["imageConfig"],Fe),r}function MT(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let o=bn(i);Array.isArray(o)&&(o=o.map(a=>Mh(a))),h(n,["contents"],o)}const s=c(e,["config"]);return s!=null&&h(n,["generationConfig"],UD(t,s,n)),n}function VT(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["contents"]);if(i!=null){let o=bn(i);Array.isArray(o)&&(o=o.map(a=>a)),h(n,["contents"],o)}const s=c(e,["config"]);return s!=null&&h(n,["generationConfig"],OD(t,s,n)),n}function LT(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["candidates"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>uD(u))),h(e,["candidates"],l)}const i=c(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const s=c(t,["promptFeedback"]);s!=null&&h(e,["promptFeedback"],s);const o=c(t,["responseId"]);o!=null&&h(e,["responseId"],o);const a=c(t,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function FT(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["candidates"],u)}const i=c(t,["createTime"]);i!=null&&h(e,["createTime"],i);const s=c(t,["modelVersion"]);s!=null&&h(e,["modelVersion"],s);const o=c(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const a=c(t,["responseId"]);a!=null&&h(e,["responseId"],a);const l=c(t,["usageMetadata"]);return l!=null&&h(e,["usageMetadata"],l),e}function BD(t,e){const n={};if(c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=c(t,["numberOfImages"]);e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r);const i=c(t,["aspectRatio"]);e!==void 0&&i!=null&&h(e,["parameters","aspectRatio"],i);const s=c(t,["guidanceScale"]);if(e!==void 0&&s!=null&&h(e,["parameters","guidanceScale"],s),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=c(t,["safetyFilterLevel"]);e!==void 0&&o!=null&&h(e,["parameters","safetySetting"],o);const a=c(t,["personGeneration"]);e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a);const l=c(t,["includeSafetyAttributes"]);e!==void 0&&l!=null&&h(e,["parameters","includeSafetyAttributes"],l);const u=c(t,["includeRaiReason"]);e!==void 0&&u!=null&&h(e,["parameters","includeRaiReason"],u);const f=c(t,["language"]);e!==void 0&&f!=null&&h(e,["parameters","language"],f);const p=c(t,["outputMimeType"]);e!==void 0&&p!=null&&h(e,["parameters","outputOptions","mimeType"],p);const g=c(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&h(e,["parameters","outputOptions","compressionQuality"],g),c(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(c(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const v=c(t,["imageSize"]);if(e!==void 0&&v!=null&&h(e,["parameters","sampleImageSize"],v),c(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function qD(t,e){const n={},r=c(t,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const i=c(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const s=c(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const o=c(t,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const a=c(t,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);const l=c(t,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);const u=c(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&h(e,["parameters","includeSafetyAttributes"],p);const g=c(t,["includeRaiReason"]);e!==void 0&&g!=null&&h(e,["parameters","includeRaiReason"],g);const v=c(t,["language"]);e!==void 0&&v!=null&&h(e,["parameters","language"],v);const T=c(t,["outputMimeType"]);e!==void 0&&T!=null&&h(e,["parameters","outputOptions","mimeType"],T);const x=c(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&h(e,["parameters","outputOptions","compressionQuality"],x);const D=c(t,["addWatermark"]);e!==void 0&&D!=null&&h(e,["parameters","addWatermark"],D);const S=c(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const E=c(t,["imageSize"]);e!==void 0&&E!=null&&h(e,["parameters","sampleImageSize"],E);const R=c(t,["enhancePrompt"]);return e!==void 0&&R!=null&&h(e,["parameters","enhancePrompt"],R),n}function GD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const s=c(e,["config"]);return s!=null&&BD(s,n),n}function zD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const s=c(e,["config"]);return s!=null&&qD(s,n),n}function $D(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["predictions"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>nb(o))),h(e,["generatedImages"],s)}const i=c(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],CC(i)),e}function HD(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["predictions"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>Vh(o))),h(e,["generatedImages"],s)}const i=c(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],AC(i)),e}function WD(t,e){const n={},r=c(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r),c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=c(t,["durationSeconds"]);if(e!==void 0&&i!=null&&h(e,["parameters","durationSeconds"],i),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=c(t,["aspectRatio"]);e!==void 0&&s!=null&&h(e,["parameters","aspectRatio"],s);const o=c(t,["resolution"]);e!==void 0&&o!=null&&h(e,["parameters","resolution"],o);const a=c(t,["personGeneration"]);if(e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a),c(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=c(t,["negativePrompt"]);e!==void 0&&l!=null&&h(e,["parameters","negativePrompt"],l);const u=c(t,["enhancePrompt"]);if(e!==void 0&&u!=null&&h(e,["parameters","enhancePrompt"],u),c(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=c(t,["lastFrame"]);e!==void 0&&f!=null&&h(e,["instances[0]","lastFrame"],Lh(f));const p=c(t,["referenceImages"]);if(e!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(v=>Hb(v))),h(e,["instances[0]","referenceImages"],g)}if(c(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(c(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function KD(t,e){const n={},r=c(t,["numberOfVideos"]);e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r);const i=c(t,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const s=c(t,["fps"]);e!==void 0&&s!=null&&h(e,["parameters","fps"],s);const o=c(t,["durationSeconds"]);e!==void 0&&o!=null&&h(e,["parameters","durationSeconds"],o);const a=c(t,["seed"]);e!==void 0&&a!=null&&h(e,["parameters","seed"],a);const l=c(t,["aspectRatio"]);e!==void 0&&l!=null&&h(e,["parameters","aspectRatio"],l);const u=c(t,["resolution"]);e!==void 0&&u!=null&&h(e,["parameters","resolution"],u);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["pubsubTopic"]);e!==void 0&&p!=null&&h(e,["parameters","pubsubTopic"],p);const g=c(t,["negativePrompt"]);e!==void 0&&g!=null&&h(e,["parameters","negativePrompt"],g);const v=c(t,["enhancePrompt"]);e!==void 0&&v!=null&&h(e,["parameters","enhancePrompt"],v);const T=c(t,["generateAudio"]);e!==void 0&&T!=null&&h(e,["parameters","generateAudio"],T);const x=c(t,["lastFrame"]);e!==void 0&&x!=null&&h(e,["instances[0]","lastFrame"],Zn(x));const D=c(t,["referenceImages"]);if(e!==void 0&&D!=null){let R=D;Array.isArray(R)&&(R=R.map(M=>Wb(M))),h(e,["instances[0]","referenceImages"],R)}const S=c(t,["mask"]);e!==void 0&&S!=null&&h(e,["instances[0]","mask"],$b(S));const E=c(t,["compressionQuality"]);return e!==void 0&&E!=null&&h(e,["parameters","compressionQuality"],E),n}function jD(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["metadata"]);r!=null&&h(e,["metadata"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);s!=null&&h(e,["error"],s);const o=c(t,["response","generateVideoResponse"]);return o!=null&&h(e,["response"],XD(o)),e}function JD(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["metadata"]);r!=null&&h(e,["metadata"],r);const i=c(t,["done"]);i!=null&&h(e,["done"],i);const s=c(t,["error"]);s!=null&&h(e,["error"],s);const o=c(t,["response"]);return o!=null&&h(e,["response"],ZD(o)),e}function QD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const s=c(e,["image"]);s!=null&&h(n,["instances[0]","image"],Lh(s));const o=c(e,["video"]);o!=null&&h(n,["instances[0]","video"],PC(o));const a=c(e,["source"]);a!=null&&eb(a,n);const l=c(e,["config"]);return l!=null&&WD(l,n),n}function YD(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const s=c(e,["image"]);s!=null&&h(n,["instances[0]","image"],Zn(s));const o=c(e,["video"]);o!=null&&h(n,["instances[0]","video"],kC(o));const a=c(e,["source"]);a!=null&&tb(a,n);const l=c(e,["config"]);return l!=null&&KD(l,n),n}function XD(t){const e={},n=c(t,["generatedSamples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>ib(o))),h(e,["generatedVideos"],s)}const r=c(t,["raiMediaFilteredCount"]);r!=null&&h(e,["raiMediaFilteredCount"],r);const i=c(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function ZD(t){const e={},n=c(t,["videos"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>sb(o))),h(e,["generatedVideos"],s)}const r=c(t,["raiMediaFilteredCount"]);r!=null&&h(e,["raiMediaFilteredCount"],r);const i=c(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function eb(t,e){const n={},r=c(t,["prompt"]);e!==void 0&&r!=null&&h(e,["instances[0]","prompt"],r);const i=c(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Lh(i));const s=c(t,["video"]);return e!==void 0&&s!=null&&h(e,["instances[0]","video"],PC(s)),n}function tb(t,e){const n={},r=c(t,["prompt"]);e!==void 0&&r!=null&&h(e,["instances[0]","prompt"],r);const i=c(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Zn(i));const s=c(t,["video"]);return e!==void 0&&s!=null&&h(e,["instances[0]","video"],kC(s)),n}function nb(t){const e={},n=c(t,["_self"]);n!=null&&h(e,["image"],db(n));const r=c(t,["raiFilteredReason"]);r!=null&&h(e,["raiFilteredReason"],r);const i=c(t,["_self"]);return i!=null&&h(e,["safetyAttributes"],CC(i)),e}function Vh(t){const e={},n=c(t,["_self"]);n!=null&&h(e,["image"],SC(n));const r=c(t,["raiFilteredReason"]);r!=null&&h(e,["raiFilteredReason"],r);const i=c(t,["_self"]);i!=null&&h(e,["safetyAttributes"],AC(i));const s=c(t,["prompt"]);return s!=null&&h(e,["enhancedPrompt"],s),e}function rb(t){const e={},n=c(t,["_self"]);n!=null&&h(e,["mask"],SC(n));const r=c(t,["labels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),h(e,["labels"],i)}return e}function ib(t){const e={},n=c(t,["video"]);return n!=null&&h(e,["video"],Gb(n)),e}function sb(t){const e={},n=c(t,["_self"]);return n!=null&&h(e,["video"],zb(n)),e}function ob(t){const e={},n=c(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const r=c(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const i=c(t,["candidateCount"]);i!=null&&h(e,["candidateCount"],i);const s=c(t,["enableAffectiveDialog"]);s!=null&&h(e,["enableAffectiveDialog"],s);const o=c(t,["frequencyPenalty"]);o!=null&&h(e,["frequencyPenalty"],o);const a=c(t,["logprobs"]);a!=null&&h(e,["logprobs"],a);const l=c(t,["maxOutputTokens"]);l!=null&&h(e,["maxOutputTokens"],l);const u=c(t,["mediaResolution"]);u!=null&&h(e,["mediaResolution"],u);const f=c(t,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);const p=c(t,["responseJsonSchema"]);p!=null&&h(e,["responseJsonSchema"],p);const g=c(t,["responseLogprobs"]);g!=null&&h(e,["responseLogprobs"],g);const v=c(t,["responseMimeType"]);v!=null&&h(e,["responseMimeType"],v);const T=c(t,["responseModalities"]);T!=null&&h(e,["responseModalities"],T);const x=c(t,["responseSchema"]);x!=null&&h(e,["responseSchema"],x);const D=c(t,["routingConfig"]);D!=null&&h(e,["routingConfig"],D);const S=c(t,["seed"]);S!=null&&h(e,["seed"],S);const E=c(t,["speechConfig"]);E!=null&&h(e,["speechConfig"],xC(E));const R=c(t,["stopSequences"]);R!=null&&h(e,["stopSequences"],R);const M=c(t,["temperature"]);M!=null&&h(e,["temperature"],M);const O=c(t,["thinkingConfig"]);O!=null&&h(e,["thinkingConfig"],O);const F=c(t,["topK"]);F!=null&&h(e,["topK"],F);const I=c(t,["topP"]);return I!=null&&h(e,["topP"],I),e}function ab(t,e){const n={},r=c(e,["model"]);return r!=null&&h(n,["_url","name"],Be(t,r)),n}function lb(t,e){const n={},r=c(e,["model"]);return r!=null&&h(n,["_url","name"],Be(t,r)),n}function ub(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=c(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function cb(t){const e={},n=c(t,["timeRangeFilter"]);if(n!=null&&h(e,["timeRangeFilter"],n),c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function db(t){const e={},n=c(t,["bytesBase64Encoded"]);n!=null&&h(e,["imageBytes"],Bi(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function SC(t){const e={},n=c(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const r=c(t,["bytesBase64Encoded"]);r!=null&&h(e,["imageBytes"],Bi(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Lh(t){const e={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=c(t,["imageBytes"]);n!=null&&h(e,["bytesBase64Encoded"],Bi(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function Zn(t){const e={},n=c(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const r=c(t,["imageBytes"]);r!=null&&h(e,["bytesBase64Encoded"],Bi(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function hb(t,e,n){const r={},i=c(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const s=c(e,["pageToken"]);n!==void 0&&s!=null&&h(n,["_query","pageToken"],s);const o=c(e,["filter"]);n!==void 0&&o!=null&&h(n,["_query","filter"],o);const a=c(e,["queryBase"]);return n!==void 0&&a!=null&&h(n,["_url","models_url"],gC(t,a)),r}function fb(t,e,n){const r={},i=c(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const s=c(e,["pageToken"]);n!==void 0&&s!=null&&h(n,["_query","pageToken"],s);const o=c(e,["filter"]);n!==void 0&&o!=null&&h(n,["_query","filter"],o);const a=c(e,["queryBase"]);return n!==void 0&&a!=null&&h(n,["_url","models_url"],gC(t,a)),r}function pb(t,e){const n={},r=c(e,["config"]);return r!=null&&hb(t,r,n),n}function mb(t,e){const n={},r=c(e,["config"]);return r!=null&&fb(t,r,n),n}function gb(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["_self"]);if(i!=null){let s=_C(i);Array.isArray(s)&&(s=s.map(o=>om(o))),h(e,["models"],s)}return e}function _b(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["_self"]);if(i!=null){let s=_C(i);Array.isArray(s)&&(s=s.map(o=>am(o))),h(e,["models"],s)}return e}function yb(t){const e={},n=c(t,["maskMode"]);n!=null&&h(e,["maskMode"],n);const r=c(t,["segmentationClasses"]);r!=null&&h(e,["maskClasses"],r);const i=c(t,["maskDilation"]);return i!=null&&h(e,["dilation"],i),e}function om(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["displayName"]);r!=null&&h(e,["displayName"],r);const i=c(t,["description"]);i!=null&&h(e,["description"],i);const s=c(t,["version"]);s!=null&&h(e,["version"],s);const o=c(t,["_self"]);o!=null&&h(e,["tunedModelInfo"],bb(o));const a=c(t,["inputTokenLimit"]);a!=null&&h(e,["inputTokenLimit"],a);const l=c(t,["outputTokenLimit"]);l!=null&&h(e,["outputTokenLimit"],l);const u=c(t,["supportedGenerationMethods"]);return u!=null&&h(e,["supportedActions"],u),e}function am(t){const e={},n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["displayName"]);r!=null&&h(e,["displayName"],r);const i=c(t,["description"]);i!=null&&h(e,["description"],i);const s=c(t,["versionId"]);s!=null&&h(e,["version"],s);const o=c(t,["deployedModels"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(g=>VD(g))),h(e,["endpoints"],p)}const a=c(t,["labels"]);a!=null&&h(e,["labels"],a);const l=c(t,["_self"]);l!=null&&h(e,["tunedModelInfo"],Mb(l));const u=c(t,["defaultCheckpointId"]);u!=null&&h(e,["defaultCheckpointId"],u);const f=c(t,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>g)),h(e,["checkpoints"],p)}return e}function vb(t){const e={},n=c(t,["videoMetadata"]);n!=null&&h(e,["videoMetadata"],n);const r=c(t,["thought"]);r!=null&&h(e,["thought"],r);const i=c(t,["inlineData"]);i!=null&&h(e,["inlineData"],lD(i));const s=c(t,["fileData"]);s!=null&&h(e,["fileData"],LD(s));const o=c(t,["thoughtSignature"]);o!=null&&h(e,["thoughtSignature"],o);const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],a);const l=c(t,["codeExecutionResult"]);l!=null&&h(e,["codeExecutionResult"],l);const u=c(t,["executableCode"]);u!=null&&h(e,["executableCode"],u);const f=c(t,["functionResponse"]);f!=null&&h(e,["functionResponse"],f);const p=c(t,["text"]);return p!=null&&h(e,["text"],p),e}function Tb(t){const e={},n=c(t,["productImage"]);return n!=null&&h(e,["image"],Zn(n)),e}function Eb(t,e){const n={},r=c(t,["numberOfImages"]);e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r);const i=c(t,["baseSteps"]);e!==void 0&&i!=null&&h(e,["parameters","editConfig","baseSteps"],i);const s=c(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const o=c(t,["seed"]);e!==void 0&&o!=null&&h(e,["parameters","seed"],o);const a=c(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&h(e,["parameters","safetySetting"],a);const l=c(t,["personGeneration"]);e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l);const u=c(t,["addWatermark"]);e!==void 0&&u!=null&&h(e,["parameters","addWatermark"],u);const f=c(t,["outputMimeType"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","mimeType"],f);const p=c(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&h(e,["parameters","outputOptions","compressionQuality"],p);const g=c(t,["enhancePrompt"]);e!==void 0&&g!=null&&h(e,["parameters","enhancePrompt"],g);const v=c(t,["labels"]);return e!==void 0&&v!=null&&h(e,["labels"],v),n}function Ib(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["source"]);i!=null&&Sb(i,n);const s=c(e,["config"]);return s!=null&&Eb(s,n),n}function wb(t){const e={},n=c(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Vh(i))),h(e,["generatedImages"],r)}return e}function Sb(t,e){const n={},r=c(t,["prompt"]);e!==void 0&&r!=null&&h(e,["instances[0]","prompt"],r);const i=c(t,["personImage"]);e!==void 0&&i!=null&&h(e,["instances[0]","personImage","image"],Zn(i));const s=c(t,["productImages"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>Tb(a))),h(e,["instances[0]","productImages"],o)}return n}function Cb(t){const e={},n=c(t,["referenceImage"]);n!=null&&h(e,["referenceImage"],Zn(n));const r=c(t,["referenceId"]);r!=null&&h(e,["referenceId"],r);const i=c(t,["referenceType"]);i!=null&&h(e,["referenceType"],i);const s=c(t,["maskImageConfig"]);s!=null&&h(e,["maskImageConfig"],yb(s));const o=c(t,["controlImageConfig"]);o!=null&&h(e,["controlImageConfig"],mD(o));const a=c(t,["styleImageConfig"]);a!=null&&h(e,["styleImageConfig"],a);const l=c(t,["subjectImageConfig"]);return l!=null&&h(e,["subjectImageConfig"],l),e}function CC(t){const e={},n=c(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const r=c(t,["safetyAttributes","scores"]);r!=null&&h(e,["scores"],r);const i=c(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function AC(t){const e={},n=c(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const r=c(t,["safetyAttributes","scores"]);r!=null&&h(e,["scores"],r);const i=c(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function Ab(t){const e={};if(c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=c(t,["category"]);n!=null&&h(e,["category"],n);const r=c(t,["threshold"]);return r!=null&&h(e,["threshold"],r),e}function xb(t){const e={},n=c(t,["image"]);return n!=null&&h(e,["image"],Zn(n)),e}function Rb(t,e){const n={},r=c(t,["mode"]);e!==void 0&&r!=null&&h(e,["parameters","mode"],r);const i=c(t,["maxPredictions"]);e!==void 0&&i!=null&&h(e,["parameters","maxPredictions"],i);const s=c(t,["confidenceThreshold"]);e!==void 0&&s!=null&&h(e,["parameters","confidenceThreshold"],s);const o=c(t,["maskDilation"]);e!==void 0&&o!=null&&h(e,["parameters","maskDilation"],o);const a=c(t,["binaryColorThreshold"]);e!==void 0&&a!=null&&h(e,["parameters","binaryColorThreshold"],a);const l=c(t,["labels"]);return e!==void 0&&l!=null&&h(e,["labels"],l),n}function Pb(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["source"]);i!=null&&Nb(i,n);const s=c(e,["config"]);return s!=null&&Rb(s,n),n}function kb(t){const e={},n=c(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>rb(i))),h(e,["generatedMasks"],r)}return e}function Nb(t,e){const n={},r=c(t,["prompt"]);e!==void 0&&r!=null&&h(e,["instances[0]","prompt"],r);const i=c(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Zn(i));const s=c(t,["scribbleImage"]);return e!==void 0&&s!=null&&h(e,["instances[0]","scribble"],xb(s)),n}function xC(t){const e={},n=c(t,["voiceConfig"]);if(n!=null&&h(e,["voiceConfig"],n),c(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=c(t,["languageCode"]);return r!=null&&h(e,["languageCode"],r),e}function Db(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=c(t,["googleSearch"]);r!=null&&h(e,["googleSearch"],cb(r));const i=c(t,["googleSearchRetrieval"]);if(i!=null&&h(e,["googleSearchRetrieval"],i),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const s=c(t,["googleMaps"]);s!=null&&h(e,["googleMaps"],ub(s));const o=c(t,["urlContext"]);o!=null&&h(e,["urlContext"],o);const a=c(t,["computerUse"]);a!=null&&h(e,["computerUse"],a);const l=c(t,["codeExecution"]);return l!=null&&h(e,["codeExecution"],l),e}function RC(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(g=>FD(g))),h(e,["functionDeclarations"],p)}const r=c(t,["retrieval"]);r!=null&&h(e,["retrieval"],r);const i=c(t,["googleSearch"]);i!=null&&h(e,["googleSearch"],i);const s=c(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const o=c(t,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);const a=c(t,["googleMaps"]);a!=null&&h(e,["googleMaps"],a);const l=c(t,["urlContext"]);l!=null&&h(e,["urlContext"],l);const u=c(t,["computerUse"]);u!=null&&h(e,["computerUse"],u);const f=c(t,["codeExecution"]);return f!=null&&h(e,["codeExecution"],f),e}function bb(t){const e={},n=c(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const r=c(t,["createTime"]);r!=null&&h(e,["createTime"],r);const i=c(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function Mb(t){const e={},n=c(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&h(e,["baseModel"],n);const r=c(t,["createTime"]);r!=null&&h(e,["createTime"],r);const i=c(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function Vb(t,e){const n={},r=c(t,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const i=c(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const s=c(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&h(e,["defaultCheckpointId"],s),n}function Lb(t,e){const n={},r=c(t,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const i=c(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const s=c(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&h(e,["defaultCheckpointId"],s),n}function Fb(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","name"],Be(t,r));const i=c(e,["config"]);return i!=null&&Vb(i,n),n}function Ub(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["config"]);return i!=null&&Lb(i,n),n}function Ob(t,e){const n={},r=c(t,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const i=c(t,["includeRaiReason"]);e!==void 0&&i!=null&&h(e,["parameters","includeRaiReason"],i);const s=c(t,["outputMimeType"]);e!==void 0&&s!=null&&h(e,["parameters","outputOptions","mimeType"],s);const o=c(t,["outputCompressionQuality"]);e!==void 0&&o!=null&&h(e,["parameters","outputOptions","compressionQuality"],o);const a=c(t,["enhanceInputImage"]);e!==void 0&&a!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],a);const l=c(t,["imagePreservationFactor"]);e!==void 0&&l!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],l);const u=c(t,["labels"]);e!==void 0&&u!=null&&h(e,["labels"],u);const f=c(t,["numberOfImages"]);e!==void 0&&f!=null&&h(e,["parameters","sampleCount"],f);const p=c(t,["mode"]);return e!==void 0&&p!=null&&h(e,["parameters","mode"],p),n}function Bb(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["_url","model"],Be(t,r));const i=c(e,["image"]);i!=null&&h(n,["instances[0]","image"],Zn(i));const s=c(e,["upscaleFactor"]);s!=null&&h(n,["parameters","upscaleConfig","upscaleFactor"],s);const o=c(e,["config"]);return o!=null&&Ob(o,n),n}function qb(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Vh(s))),h(e,["generatedImages"],i)}return e}function Gb(t){const e={},n=c(t,["uri"]);n!=null&&h(e,["uri"],n);const r=c(t,["encodedVideo"]);r!=null&&h(e,["videoBytes"],Bi(r));const i=c(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function zb(t){const e={},n=c(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const r=c(t,["bytesBase64Encoded"]);r!=null&&h(e,["videoBytes"],Bi(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function $b(t){const e={},n=c(t,["image"]);n!=null&&h(e,["_self"],Zn(n));const r=c(t,["maskMode"]);return r!=null&&h(e,["maskMode"],r),e}function Hb(t){const e={},n=c(t,["image"]);n!=null&&h(e,["image"],Lh(n));const r=c(t,["referenceType"]);return r!=null&&h(e,["referenceType"],r),e}function Wb(t){const e={},n=c(t,["image"]);n!=null&&h(e,["image"],Zn(n));const r=c(t,["referenceType"]);return r!=null&&h(e,["referenceType"],r),e}function PC(t){const e={},n=c(t,["uri"]);n!=null&&h(e,["uri"],n);const r=c(t,["videoBytes"]);r!=null&&h(e,["encodedVideo"],Bi(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["encoding"],i),e}function kC(t){const e={},n=c(t,["uri"]);n!=null&&h(e,["gcsUri"],n);const r=c(t,["videoBytes"]);r!=null&&h(e,["bytesBase64Encoded"],Bi(r));const i=c(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kb="Content-Type",jb="X-Server-Timeout",Jb="User-Agent",lm="x-goog-api-client",Qb="1.25.0",Yb=`google-genai-sdk/${Qb}`,Xb="v1beta1",Zb="v1beta",UT=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class eM{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Xb,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:Zb,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const i=[this.getRequestUrlInternal(n)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))i.searchParams.append(o,String(a));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,n,e.abortSignal),this.unaryApiCall(i,s,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[i,s]of Object.entries(n))typeof s=="object"?r[i]=Object.assign(Object.assign({},r[i]),s):s!==void 0&&(r[i]=s);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,n,e.abortSignal),this.streamApiCall(i,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r){if(n&&n.timeout||r){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const o=setTimeout(()=>i.abort(),n.timeout);o&&typeof o.unref=="function"&&o.unref()}r&&r.addEventListener("abort",()=>{i.abort()}),e.signal=s}return n&&n.extraBody!==null&&tM(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await OT(i),new rm(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await OT(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return Bo(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),s=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="";for(;;){const{done:a,value:l}=yield Xe(i.read());if(a){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=s.decode(l,{stream:!0});try{const p=JSON.parse(u);if("error"in p){const g=JSON.parse(JSON.stringify(p.error)),v=g.status,T=g.code,x=`got status: ${v}. ${JSON.stringify(p)}`;if(T>=400&&T<600)throw new bh({message:x,status:T})}}catch(p){if(p.name==="ApiError")throw p}o+=u;let f=o.match(UT);for(;f;){const p=f[1];try{const g=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Xe(new rm(g)),o=o.slice(f[0].length),f=o.match(UT)}catch(g){throw new Error(`exception parsing stream chunk ${p}. ${g}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=Yb+" "+this.clientOptions.userAgentExtra;return e[Jb]=n,e[lm]=n,e[Kb]="application/json",e}async getHeadersInternal(e){const n=new Headers;if(e&&e.headers){for(const[r,i]of Object.entries(e.headers))n.append(r,i);e.timeout&&e.timeout>0&&n.append(jb,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var r;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const s=this.clientOptions.uploader,o=await s.stat(e);i.sizeBytes=String(o.size);const a=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;const l=await this.fetchUploadUrl(i,n);return s.upload(e,l,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var r;let i={};n!=null&&n.httpOptions?i=n.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const s={file:e},o=await this.request({path:ue("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:i});if(!o||!(o!=null&&o.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=(r=o==null?void 0:o.headers)===null||r===void 0?void 0:r["x-goog-upload-url"];if(a===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function OT(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(r);throw n>=400&&n<600?new bh({message:i,status:n}):new Error(i)}}function tM(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const s=JSON.parse(t.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))n=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(s,o){const a=Object.assign({},s);for(const l in o)if(Object.prototype.hasOwnProperty.call(o,l)){const u=o[l],f=a[l];u&&typeof u=="object"&&!Array.isArray(u)&&f&&typeof f=="object"&&!Array.isArray(f)?a[l]=r(f,u):(f&&u&&typeof f!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof f}, New type: ${typeof u}. Overwriting.`),a[l]=u)}return a}const i=r(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nM="mcp_used/unknown";let rM=!1;function NC(t){for(const e of t)if(iM(e)||typeof e=="object"&&"inputSchema"in e)return!0;return rM}function DC(t){var e;const n=(e=t[lm])!==null&&e!==void 0?e:"";t[lm]=(n+` ${nM}`).trimStart()}function iM(t){return t!==null&&typeof t=="object"&&t instanceof Kg}function sM(t,e=100){return Bo(this,arguments,function*(){let r,i=0;for(;i<e;){const s=yield Xe(t.listTools({cursor:r}));for(const o of s.tools)yield yield Xe(o),i++;if(!s.nextCursor)break;r=s.nextCursor}})}class Kg{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Kg(e,n)}async initialize(){var e,n,r,i;if(this.mcpTools.length>0)return;const s={},o=[];for(const f of this.mcpClients)try{for(var a=!0,l=(n=void 0,xl(sM(f))),u;u=await l.next(),e=u.done,!e;a=!0){i=u.value,a=!1;const p=i;o.push(p);const g=p.name;if(s[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);s[g]=f}}catch(p){n={error:p}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(n)throw n.error}}this.mcpTools=o,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),c1(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let s;this.config.timeout&&(s={timeout:this.config.timeout});const o=await i.callTool({name:r.name,arguments:r.args},void 0,s);n.push({functionResponse:{name:r.name,response:o.isError?{error:o}:o}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function oM(t,e,n){const r=new n1;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(r,i),e(r)}class aM{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),o=cM(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${a}`;let u=()=>{};const f=new Promise(R=>{u=R}),p=e.callbacks,g=function(){u({})},v=this.apiClient,T={onopen:g,onmessage:R=>{oM(v,p.onmessage,R)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(R){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(R){}},x=this.webSocketFactory.create(l,uM(o),T);x.connect(),await f;const E={setup:{model:Be(this.apiClient,e.model)}};return x.send(JSON.stringify(E)),new lM(x,this.apiClient)}}class lM{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=ZN(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=XN(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(No.PLAY)}pause(){this.sendPlaybackControl(No.PAUSE)}stop(){this.sendPlaybackControl(No.STOP)}resetContext(){this.sendPlaybackControl(No.RESET_CONTEXT)}close(){this.conn.close()}}function uM(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function cM(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dM="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function hM(t,e,n){const r=new t1;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const s=JSON.parse(i);if(t.isVertexAI()){const o=nD(s);Object.assign(r,o)}else Object.assign(r,s);e(r)}class fM{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new aM(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,i,s,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&NC(e.config.tools)&&DC(p);const g=_M(p);if(this.apiClient.isVertexAI())f=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g);else{const C=this.apiClient.getApiKey();let N="BidiGenerateContent",b="key";C!=null&&C.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),N="BidiGenerateContentConstrained",b="access_token"),f=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${N}?${b}=${C}`}let v=()=>{};const T=new Promise(C=>{v=C}),x=e.callbacks,D=function(){var C;(C=x==null?void 0:x.onopen)===null||C===void 0||C.call(x),v({})},S=this.apiClient,E={onopen:D,onmessage:C=>{hM(S,x.onmessage,C)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(C){},onclose:(r=x==null?void 0:x.onclose)!==null&&r!==void 0?r:function(C){}},R=this.webSocketFactory.create(f,gM(g),E);R.connect(),await T;let M=Be(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&M.startsWith("publishers/")){const C=this.apiClient.getProject(),N=this.apiClient.getLocation();M=`projects/${C}/locations/${N}/`+M}let O={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Gd.AUDIO]}:e.config.responseModalities=[Gd.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const F=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],I=[];for(const C of F)if(this.isCallableTool(C)){const N=C;I.push(await N.tool())}else I.push(C);I.length>0&&(e.config.tools=I);const w={model:M,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?O=YN(this.apiClient,w):O=QN(this.apiClient,w),delete O.config,R.send(JSON.stringify(O)),new mM(R,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const pM={turnComplete:!0};class mM{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=bn(n.turns),e.isVertexAI()||(r=r.map(i=>Mh(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const s of r){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(dM)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},pM),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:tD(e)}:n={realtimeInput:eD(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function gM(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function _M(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const BT=10;function qT(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const o of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(qo(o)){i=!0;break}if(!i)return!0;const s=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function qo(t){return"callTool"in t&&typeof t.callTool=="function"}function yM(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>qo(i)))!==null&&r!==void 0?r:!1}function vM(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>!qo(i)))!==null&&r!==void 0?r:!1}function GT(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class TM extends js{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,i,s,o,a;const l=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!yM(n)||qT(n.config))return await this.generateContentInternal(l);if(vM(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let u,f;const p=bn(l.contents),g=(s=(i=(r=l.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:BT;let v=0;for(;v<g&&(u=await this.generateContentInternal(l),!(!u.functionCalls||u.functionCalls.length===0));){const T=u.candidates[0].content,x=[];for(const D of(a=(o=n.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(qo(D)){const E=await D.callTool(u.functionCalls);x.push(...E)}v++,f={role:"user",parts:x},l.contents=bn(l.contents),l.contents.push(T),l.contents.push(f),GT(l.config)&&(p.push(T),p.push(f))}return GT(l.config)&&(u.automaticFunctionCallingHistory=p),u},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),qT(n.config)){const r=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(r)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var i;let s;const o=[];if(r!=null&&r.generatedImages)for(const l of r.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((i=l==null?void 0:l.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?s=l==null?void 0:l.safetyAttributes:o.push(l);let a;return s?a={generatedImages:o,positivePromptSafetyAttributes:s,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;const o={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((r=o.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Iu(Fs.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var r,i,s,o,a,l;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((o=(s=n.source)===null||s===void 0?void 0:s.video)===null||o===void 0)&&o.uri&&(!((l=(a=n.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,i;const s=(n=e.config)===null||n===void 0?void 0:n.tools;if(!s)return e;const o=await Promise.all(s.map(async l=>qo(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&NC(e.config.tools)){const l=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let u=Object.assign({},l);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),DC(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var n,r,i;const s=new Map;for(const o of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(qo(o)){const a=o,l=await a.tool();for(const u of(i=l.functionDeclarations)!==null&&i!==void 0?i:[]){if(!u.name)throw new Error("Function declaration name is required.");if(s.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);s.set(u.name,a)}}return s}async processAfcStream(e){var n,r,i;const s=(i=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:BT;let o=!1,a=0;const l=await this.initAfcToolsMap(e);return function(u,f,p){var g,v;return Bo(this,arguments,function*(){for(var T,x,D,S;a<s;){o&&(a++,o=!1);const O=yield Xe(u.processParamsMaybeAddMcpUsage(p)),F=yield Xe(u.generateContentStreamInternal(O)),I=[],w=[];try{for(var E=!0,R=(x=void 0,xl(F)),M;M=yield Xe(R.next()),T=M.done,!T;E=!0){S=M.value,E=!1;const C=S;if(yield yield Xe(C),C.candidates&&(!((g=C.candidates[0])===null||g===void 0)&&g.content)){w.push(C.candidates[0].content);for(const N of(v=C.candidates[0].content.parts)!==null&&v!==void 0?v:[])if(a<s&&N.functionCall){if(!N.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(N.functionCall.name)){const b=yield Xe(f.get(N.functionCall.name).callTool([N.functionCall]));I.push(...b)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${N.functionCall.name}`)}}}}catch(C){x={error:C}}finally{try{!E&&!T&&(D=R.return)&&(yield Xe(D.call(R)))}finally{if(x)throw x.error}}if(I.length>0){o=!0;const C=new nl;C.candidates=[{content:{role:"user",parts:I}}],yield yield Xe(C);const N=[];N.push(...w),N.push({role:"user",parts:I});const b=bn(p.contents).concat(N);p.contents=b}else break}})}(this,l,e)}async generateContentInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=VT(this.apiClient,e);return a=ue("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=FT(f),g=new nl;return Object.assign(g,p),g})}else{const u=MT(this.apiClient,e);return a=ue("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=LT(f),g=new nl;return Object.assign(g,p),g})}}async generateContentStreamInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=VT(this.apiClient,e);return a=ue("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(p){return Bo(this,arguments,function*(){var g,v,T,x;try{for(var D=!0,S=xl(p),E;E=yield Xe(S.next()),g=E.done,!g;D=!0){x=E.value,D=!1;const R=x,M=FT(yield Xe(R.json()));M.sdkHttpResponse={headers:R.headers};const O=new nl;Object.assign(O,M),yield yield Xe(O)}}catch(R){v={error:R}}finally{try{!D&&!g&&(T=S.return)&&(yield Xe(T.call(S)))}finally{if(v)throw v.error}}})})}else{const u=MT(this.apiClient,e);return a=ue("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(p){return Bo(this,arguments,function*(){var g,v,T,x;try{for(var D=!0,S=xl(p),E;E=yield Xe(S.next()),g=E.done,!g;D=!0){x=E.value,D=!1;const R=x,M=LT(yield Xe(R.json()));M.sdkHttpResponse={headers:R.headers};const O=new nl;Object.assign(O,M),yield yield Xe(O)}}catch(R){v={error:R}}finally{try{!D&&!g&&(T=S.return)&&(yield Xe(T.call(S)))}finally{if(v)throw v.error}}})})}}async embedContent(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=DD(this.apiClient,e);return a=ue("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=MD(f),g=new yT;return Object.assign(g,p),g})}else{const u=ND(this.apiClient,e);return a=ue("{model}:batchEmbedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=bD(f),g=new yT;return Object.assign(g,p),g})}}async generateImagesInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=zD(this.apiClient,e);return a=ue("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=HD(f),g=new vT;return Object.assign(g,p),g})}else{const u=GD(this.apiClient,e);return a=ue("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=$D(f),g=new vT;return Object.assign(g,p),g})}}async editImageInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=xD(this.apiClient,e);return s=ue("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=RD(l),f=new Kk;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=Bb(this.apiClient,e);return s=ue("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=qb(l),f=new jk;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=Ib(this.apiClient,e);return s=ue("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i.then(l=>{const u=wb(l),f=new Jk;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=Pb(this.apiClient,e);return s=ue("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i.then(l=>{const u=kb(l),f=new Qk;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=lb(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>am(f))}else{const u=ab(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>om(f))}}async listInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=mb(this.apiClient,e);return a=ue("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=_b(f),g=new TT;return Object.assign(g,p),g})}else{const u=pb(this.apiClient,e);return a=ue("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=gb(f),g=new TT;return Object.assign(g,p),g})}}async update(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Ub(this.apiClient,e);return a=ue("{model}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>am(f))}else{const u=Fb(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>om(f))}}async delete(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=wD(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=CD(f),g=new ET;return Object.assign(g,p),g})}else{const u=ID(this.apiClient,e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=SD(f),g=new ET;return Object.assign(g,p),g})}}async countTokens(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=vD(this.apiClient,e);return a=ue("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=ED(f),g=new IT;return Object.assign(g,p),g})}else{const u=yD(this.apiClient,e);return a=ue("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=TD(f),g=new IT;return Object.assign(g,p),g})}}async computeTokens(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=dD(this.apiClient,e);return s=ue("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=hD(l),f=new Yk;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=YD(this.apiClient,e);return a=ue("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>{const p=JD(f),g=new zd;return Object.assign(g,p),g})}else{const u=QD(this.apiClient,e);return a=ue("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>{const p=jD(f),g=new zd;return Object.assign(g,p),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class EM extends js{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let s;r&&"httpOptions"in r&&(s=r.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:s}});return n._fromAPIResponse({apiResponse:o,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let s;r&&"httpOptions"in r&&(s=r.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:s}});return n._fromAPIResponse({apiResponse:o,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=$k(e);return a=ue("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o}else{const u=zk(e);return a=ue("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o}}async fetchPredictVideosOperationInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=Lk(e);return s=ue("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IM(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["data"]);n!=null&&h(e,["data"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function wM(t){const e={},n=c(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>NM(s))),h(e,["parts"],i)}const r=c(t,["role"]);return r!=null&&h(e,["role"],r),e}function SM(t,e,n){const r={},i=c(e,["expireTime"]);n!==void 0&&i!=null&&h(n,["expireTime"],i);const s=c(e,["newSessionExpireTime"]);n!==void 0&&s!=null&&h(n,["newSessionExpireTime"],s);const o=c(e,["uses"]);n!==void 0&&o!=null&&h(n,["uses"],o);const a=c(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&h(n,["bidiGenerateContentSetup"],kM(t,a));const l=c(e,["lockAdditionalFields"]);return n!==void 0&&l!=null&&h(n,["fieldMask"],l),r}function CM(t,e){const n={},r=c(e,["config"]);return r!=null&&h(n,["config"],SM(t,r,n)),n}function AM(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function xM(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=c(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function RM(t){const e={},n=c(t,["timeRangeFilter"]);if(n!=null&&h(e,["timeRangeFilter"],n),c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function PM(t,e){const n={},r=c(t,["generationConfig"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig"],r);const i=c(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const s=c(t,["temperature"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","temperature"],s);const o=c(t,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(t,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(t,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(t,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],Wg(p));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const T=c(t,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],wM(Ht(T)));const x=c(t,["tools"]);if(e!==void 0&&x!=null){let F=va(x);Array.isArray(F)&&(F=F.map(I=>bM(ya(I)))),h(e,["setup","tools"],F)}const D=c(t,["sessionResumption"]);e!==void 0&&D!=null&&h(e,["setup","sessionResumption"],DM(D));const S=c(t,["inputAudioTranscription"]);e!==void 0&&S!=null&&h(e,["setup","inputAudioTranscription"],S);const E=c(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&h(e,["setup","outputAudioTranscription"],E);const R=c(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=c(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const O=c(t,["proactivity"]);return e!==void 0&&O!=null&&h(e,["setup","proactivity"],O),n}function kM(t,e){const n={},r=c(e,["model"]);r!=null&&h(n,["setup","model"],Be(t,r));const i=c(e,["config"]);return i!=null&&h(n,["config"],PM(i,n)),n}function NM(t){const e={},n=c(t,["videoMetadata"]);n!=null&&h(e,["videoMetadata"],n);const r=c(t,["thought"]);r!=null&&h(e,["thought"],r);const i=c(t,["inlineData"]);i!=null&&h(e,["inlineData"],IM(i));const s=c(t,["fileData"]);s!=null&&h(e,["fileData"],AM(s));const o=c(t,["thoughtSignature"]);o!=null&&h(e,["thoughtSignature"],o);const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],a);const l=c(t,["codeExecutionResult"]);l!=null&&h(e,["codeExecutionResult"],l);const u=c(t,["executableCode"]);u!=null&&h(e,["executableCode"],u);const f=c(t,["functionResponse"]);f!=null&&h(e,["functionResponse"],f);const p=c(t,["text"]);return p!=null&&h(e,["text"],p),e}function DM(t){const e={},n=c(t,["handle"]);if(n!=null&&h(e,["handle"],n),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function bM(t){const e={},n=c(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=c(t,["googleSearch"]);r!=null&&h(e,["googleSearch"],RM(r));const i=c(t,["googleSearchRetrieval"]);if(i!=null&&h(e,["googleSearchRetrieval"],i),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const s=c(t,["googleMaps"]);s!=null&&h(e,["googleMaps"],xM(s));const o=c(t,["urlContext"]);o!=null&&h(e,["urlContext"],o);const a=c(t,["computerUse"]);a!=null&&h(e,["computerUse"],a);const l=c(t,["codeExecution"]);return l!=null&&h(e,["codeExecution"],l),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function MM(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(s=>`${n}.${s}`);e.push(...i)}else e.push(n)}return e.join(",")}function VM(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const s=r.setup;typeof s=="object"&&s!==null?(t.bidiGenerateContentSetup=s,n=s):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const s=MM(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)s?t.fieldMask=s:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];i.length>0&&(a=i.map(u=>o.includes(u)?`generationConfig.${u}`:u));const l=[];s&&l.push(s),a.length>0&&l.push(...a),l.length>0?t.fieldMask=l.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class LM extends js{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=CM(this.apiClient,e);s=ue("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const l=VM(a,e.config);return i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>u)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function FM(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function UM(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function OM(t,e){const n={};if(c(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=c(t,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&h(e,["displayName"],r),c(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=c(t,["epochCount"]);e!==void 0&&i!=null&&h(e,["tuningTask","hyperparameters","epochCount"],i);const s=c(t,["learningRateMultiplier"]);if(s!=null&&h(n,["tuningTask","hyperparameters","learningRateMultiplier"],s),c(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(c(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(c(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const o=c(t,["batchSize"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","batchSize"],o);const a=c(t,["learningRate"]);if(e!==void 0&&a!=null&&h(e,["tuningTask","hyperparameters","learningRate"],a),c(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return n}function BM(t,e){const n={},r=c(t,["validationDataset"]);e!==void 0&&r!=null&&h(e,["supervisedTuningSpec"],t2(r,n));const i=c(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&h(e,["tunedModelDisplayName"],i);const s=c(t,["description"]);e!==void 0&&s!=null&&h(e,["description"],s);const o=c(t,["epochCount"]);e!==void 0&&o!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],o);const a=c(t,["learningRateMultiplier"]);e!==void 0&&a!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],a);const l=c(t,["exportLastCheckpointOnly"]);e!==void 0&&l!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],l);const u=c(t,["adapterSize"]);if(e!==void 0&&u!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],u),c(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(c(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const f=c(t,["labels"]);return e!==void 0&&f!=null&&h(e,["labels"],f),n}function qM(t){const e={},n=c(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const r=c(t,["preTunedModel"]);r!=null&&h(e,["preTunedModel"],r);const i=c(t,["trainingDataset"]);i!=null&&h(e,["tuningTask","trainingData"],XM(i));const s=c(t,["config"]);return s!=null&&OM(s,e),e}function GM(t){const e={},n=c(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const r=c(t,["preTunedModel"]);r!=null&&h(e,["preTunedModel"],r);const i=c(t,["trainingDataset"]);i!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],ZM(i,e));const s=c(t,["config"]);return s!=null&&BM(s,e),e}function zM(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function $M(t){const e={},n=c(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function HM(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);e!==void 0&&i!=null&&h(e,["_query","pageToken"],i);const s=c(t,["filter"]);return e!==void 0&&s!=null&&h(e,["_query","filter"],s),n}function WM(t,e){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const i=c(t,["pageToken"]);e!==void 0&&i!=null&&h(e,["_query","pageToken"],i);const s=c(t,["filter"]);return e!==void 0&&s!=null&&h(e,["_query","filter"],s),n}function KM(t){const e={},n=c(t,["config"]);return n!=null&&HM(n,e),e}function jM(t){const e={},n=c(t,["config"]);return n!=null&&WM(n,e),e}function JM(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>bC(o))),h(e,["tuningJobs"],s)}return e}function QM(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(e,["nextPageToken"],r);const i=c(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>um(o))),h(e,["tuningJobs"],s)}return e}function YM(t){const e={},n=c(t,["name"]);n!=null&&h(e,["model"],n);const r=c(t,["name"]);return r!=null&&h(e,["endpoint"],r),e}function XM(t){const e={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=c(t,["examples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),h(e,["examples","examples"],r)}return e}function ZM(t,e){const n={},r=c(t,["gcsUri"]);e!==void 0&&r!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],r);const i=c(t,["vertexDatasetResource"]);if(e!==void 0&&i!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],i),c(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function bC(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["state"]);i!=null&&h(e,["state"],pC(i));const s=c(t,["createTime"]);s!=null&&h(e,["createTime"],s);const o=c(t,["tuningTask","startTime"]);o!=null&&h(e,["startTime"],o);const a=c(t,["tuningTask","completeTime"]);a!=null&&h(e,["endTime"],a);const l=c(t,["updateTime"]);l!=null&&h(e,["updateTime"],l);const u=c(t,["description"]);u!=null&&h(e,["description"],u);const f=c(t,["baseModel"]);f!=null&&h(e,["baseModel"],f);const p=c(t,["_self"]);p!=null&&h(e,["tunedModel"],YM(p));const g=c(t,["customBaseModel"]);g!=null&&h(e,["customBaseModel"],g);const v=c(t,["experiment"]);v!=null&&h(e,["experiment"],v);const T=c(t,["labels"]);T!=null&&h(e,["labels"],T);const x=c(t,["outputUri"]);x!=null&&h(e,["outputUri"],x);const D=c(t,["pipelineJob"]);D!=null&&h(e,["pipelineJob"],D);const S=c(t,["serviceAccount"]);S!=null&&h(e,["serviceAccount"],S);const E=c(t,["tunedModelDisplayName"]);E!=null&&h(e,["tunedModelDisplayName"],E);const R=c(t,["veoTuningSpec"]);return R!=null&&h(e,["veoTuningSpec"],R),e}function um(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["state"]);i!=null&&h(e,["state"],pC(i));const s=c(t,["createTime"]);s!=null&&h(e,["createTime"],s);const o=c(t,["startTime"]);o!=null&&h(e,["startTime"],o);const a=c(t,["endTime"]);a!=null&&h(e,["endTime"],a);const l=c(t,["updateTime"]);l!=null&&h(e,["updateTime"],l);const u=c(t,["error"]);u!=null&&h(e,["error"],u);const f=c(t,["description"]);f!=null&&h(e,["description"],f);const p=c(t,["baseModel"]);p!=null&&h(e,["baseModel"],p);const g=c(t,["tunedModel"]);g!=null&&h(e,["tunedModel"],g);const v=c(t,["preTunedModel"]);v!=null&&h(e,["preTunedModel"],v);const T=c(t,["supervisedTuningSpec"]);T!=null&&h(e,["supervisedTuningSpec"],T);const x=c(t,["tuningDataStats"]);x!=null&&h(e,["tuningDataStats"],x);const D=c(t,["encryptionSpec"]);D!=null&&h(e,["encryptionSpec"],D);const S=c(t,["partnerModelTuningSpec"]);S!=null&&h(e,["partnerModelTuningSpec"],S);const E=c(t,["customBaseModel"]);E!=null&&h(e,["customBaseModel"],E);const R=c(t,["experiment"]);R!=null&&h(e,["experiment"],R);const M=c(t,["labels"]);M!=null&&h(e,["labels"],M);const O=c(t,["outputUri"]);O!=null&&h(e,["outputUri"],O);const F=c(t,["pipelineJob"]);F!=null&&h(e,["pipelineJob"],F);const I=c(t,["serviceAccount"]);I!=null&&h(e,["serviceAccount"],I);const w=c(t,["tunedModelDisplayName"]);w!=null&&h(e,["tunedModelDisplayName"],w);const C=c(t,["veoTuningSpec"]);return C!=null&&h(e,["veoTuningSpec"],C),e}function e2(t){const e={},n=c(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(e,["name"],r);const i=c(t,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(t,["done"]);s!=null&&h(e,["done"],s);const o=c(t,["error"]);return o!=null&&h(e,["error"],o),e}function t2(t,e){const n={},r=c(t,["gcsUri"]);r!=null&&h(n,["validationDatasetUri"],r);const i=c(t,["vertexDatasetResource"]);return e!==void 0&&i!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class n2 extends js{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Iu(Fs.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const s=Object.assign(Object.assign({},n),{preTunedModel:i});return s.baseModel=void 0,await this.tuneInternal(s)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),s=await this.tuneMldevInternal(i);let o="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?o=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(o=s.name.split("/operations/")[0]),{name:o,state:nm.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=$M(e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>um(f))}else{const u=zM(e);return a=ue("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>bC(f))}}async listInternal(e){var n,r,i,s;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=jM(e);return a=ue("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=QM(f),g=new wT;return Object.assign(g,p),g})}else{const u=KM(e);return a=ue("tunedModels",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=JM(f),g=new wT;return Object.assign(g,p),g})}}async cancel(e){var n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI()){const l=UM(e);o=ue("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const l=FM(e);o=ue("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async tuneInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){const a=GM(e);return s=ue("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>um(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=qM(e);return s=ue("tunedModels",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>e2(l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r2{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const i2=1024*1024*8,s2=3,o2=1e3,a2=2,Kf="x-goog-upload-status";async function l2(t,e,n){var r,i,s;let o=0,a=0,l=new rm(new Response),u="upload";for(o=t.size;a<o;){const p=Math.min(i2,o-a),g=t.slice(a,a+p);a+p>=o&&(u+=", finalize");let v=0,T=o2;for(;v<s2&&(l=await n.request({path:"",body:g,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[Kf]));)v++,await c2(T),T=T*a2;if(a+=p,((i=l==null?void 0:l.headers)===null||i===void 0?void 0:i[Kf])!=="active")break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(l==null?void 0:l.json());if(((s=l==null?void 0:l.headers)===null||s===void 0?void 0:s[Kf])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function u2(t){return{size:t.size,type:t.type}}function c2(t){return new Promise(e=>setTimeout(e,t))}class d2{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await l2(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await u2(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class h2{create(e,n,r){return new f2(e,n,r)}}class f2{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const zT="x-goog-api-key";class p2{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(zT)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(zT,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const m2="gl-node/";class g2{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=Mk(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const i=new p2(this.apiKey);this.apiClient=new eM({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:m2+"web",uploader:new d2,downloader:new r2}),this.models=new TM(this.apiClient),this.live=new fM(this.apiClient,i,new h2),this.batches=new Z1(this.apiClient),this.chats=new NN(this.models,this.apiClient),this.caches=new RN(this.apiClient),this.files=new qN(this.apiClient),this.operations=new EM(this.apiClient),this.authTokens=new LM(this.apiClient),this.tunings=new n2(this.apiClient)}}const _2=()=>{};var $T={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},y2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},VC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,u=l?t[i+2]:0,f=s>>2,p=(s&3)<<4|a>>4;let g=(a&15)<<2|u>>6,v=u&63;l||(v=64,o||(g=64)),r.push(n[f],n[p],n[g],n[v])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(MC(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):y2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const u=i<t.length?n[t.charAt(i)]:64;++i;const p=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||p==null)throw new v2;const g=s<<2|a>>4;if(r.push(g),u!==64){const v=a<<4&240|u>>2;if(r.push(v),p!==64){const T=u<<6&192|p;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class v2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const T2=function(t){const e=MC(t);return VC.encodeByteArray(e,!0)},Hd=function(t){return T2(t).replace(/\./g,"")},LC=function(t){try{return VC.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2=()=>FC().__FIREBASE_DEFAULTS__,I2=()=>{if(typeof process>"u"||typeof $T>"u")return;const t=$T.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},w2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&LC(t[1]);return e&&JSON.parse(e)},Fh=()=>{try{return _2()||E2()||I2()||w2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},UC=t=>{var e,n;return(n=(e=Fh())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},S2=t=>{const e=UC(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},OC=()=>{var t;return(t=Fh())==null?void 0:t.config},BC=t=>{var e;return(e=Fh())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ea(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function qC(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Hd(JSON.stringify(n)),Hd(JSON.stringify(o)),""].join(".")}const Rl={};function x2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Rl))Rl[e]?t.emulator.push(e):t.prod.push(e);return t}function R2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let HT=!1;function GC(t,e){if(typeof window>"u"||typeof document>"u"||!Ea(window.location.host)||Rl[t]===e||Rl[t]||HT)return;Rl[t]=e;function n(g){return`__firebase__banner__${g}`}const r="__firebase__banner",s=x2().prod.length>0;function o(){const g=document.getElementById(r);g&&g.remove()}function a(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function l(g,v){g.setAttribute("width","24"),g.setAttribute("id",v),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function u(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{HT=!0,o()},g}function f(g,v){g.setAttribute("id",v),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=R2(r),v=n("text"),T=document.getElementById(v)||document.createElement("span"),x=n("learnmore"),D=document.getElementById(x)||document.createElement("a"),S=n("preprendIcon"),E=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const R=g.element;a(R),f(D,x);const M=u();l(E,S),R.append(E,T,D,M),document.body.appendChild(R)}s?(T.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function P2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ct())}function zC(){var e;const t=(e=Fh())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function k2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function N2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function D2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function b2(){const t=Ct();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function $C(){return!zC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function HC(){return!zC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function WC(){try{return typeof indexedDB=="object"}catch{return!1}}function M2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)==null?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2="FirebaseError";class Hr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=V2,Object.setPrototypeOf(this,Hr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wu.prototype.create)}}class wu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?L2(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Hr(i,a,r)}}function L2(t,e){return t.replace(F2,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const F2=/\{\$([^}]+)}/g;function U2(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Us(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(WT(s)&&WT(o)){if(!Us(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function WT(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function O2(t,e){const n=new B2(t,e);return n.subscribe.bind(n)}class B2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");q2(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=jf),i.error===void 0&&(i.error=jf),i.complete===void 0&&(i.complete=jf);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function q2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function jf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(t){return t&&t._delegate?t._delegate:t}class Os{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new C2;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($2(e))try{this.getOrInitializeService({instanceIdentifier:fs})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=fs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=fs){return this.instances.has(e)}getOptions(e=fs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:z2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=fs){return this.component?this.component.multipleInstances?e:fs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function z2(t){return t===fs?void 0:t}function $2(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new G2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var De;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(De||(De={}));const W2={debug:De.DEBUG,verbose:De.VERBOSE,info:De.INFO,warn:De.WARN,error:De.ERROR,silent:De.SILENT},K2=De.INFO,j2={[De.DEBUG]:"log",[De.VERBOSE]:"log",[De.INFO]:"info",[De.WARN]:"warn",[De.ERROR]:"error"},J2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=j2[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class jg{constructor(e){this.name=e,this._logLevel=K2,this._logHandler=J2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in De))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?W2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,De.DEBUG,...e),this._logHandler(this,De.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,De.VERBOSE,...e),this._logHandler(this,De.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,De.INFO,...e),this._logHandler(this,De.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,De.WARN,...e),this._logHandler(this,De.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,De.ERROR,...e),this._logHandler(this,De.ERROR,...e)}}const Q2=(t,e)=>e.some(n=>t instanceof n);let KT,jT;function Y2(){return KT||(KT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function X2(){return jT||(jT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const KC=new WeakMap,cm=new WeakMap,jC=new WeakMap,Jf=new WeakMap,Jg=new WeakMap;function Z2(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Ei(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&KC.set(n,t)}).catch(()=>{}),Jg.set(e,t),e}function eV(t){if(cm.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});cm.set(t,e)}let dm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return cm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||jC.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ei(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function tV(t){dm=t(dm)}function nV(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Qf(this),e,...n);return jC.set(r,e.sort?e.sort():[e]),Ei(r)}:X2().includes(t)?function(...e){return t.apply(Qf(this),e),Ei(KC.get(this))}:function(...e){return Ei(t.apply(Qf(this),e))}}function rV(t){return typeof t=="function"?nV(t):(t instanceof IDBTransaction&&eV(t),Q2(t,Y2())?new Proxy(t,dm):t)}function Ei(t){if(t instanceof IDBRequest)return Z2(t);if(Jf.has(t))return Jf.get(t);const e=rV(t);return e!==t&&(Jf.set(t,e),Jg.set(e,t)),e}const Qf=t=>Jg.get(t);function iV(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Ei(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ei(o.result),l.oldVersion,l.newVersion,Ei(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const sV=["get","getKey","getAll","getAllKeys","count"],oV=["put","add","delete","clear"],Yf=new Map;function JT(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Yf.get(e))return Yf.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=oV.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||sV.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),i&&l.done]))[0]};return Yf.set(e,s),s}tV(t=>({...t,get:(e,n,r)=>JT(e,n)||t.get(e,n,r),has:(e,n)=>!!JT(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(lV(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function lV(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const hm="@firebase/app",QT="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Or=new jg("@firebase/app"),uV="@firebase/app-compat",cV="@firebase/analytics-compat",dV="@firebase/analytics",hV="@firebase/app-check-compat",fV="@firebase/app-check",pV="@firebase/auth",mV="@firebase/auth-compat",gV="@firebase/database",_V="@firebase/data-connect",yV="@firebase/database-compat",vV="@firebase/functions",TV="@firebase/functions-compat",EV="@firebase/installations",IV="@firebase/installations-compat",wV="@firebase/messaging",SV="@firebase/messaging-compat",CV="@firebase/performance",AV="@firebase/performance-compat",xV="@firebase/remote-config",RV="@firebase/remote-config-compat",PV="@firebase/storage",kV="@firebase/storage-compat",NV="@firebase/firestore",DV="@firebase/ai",bV="@firebase/firestore-compat",MV="firebase",VV="12.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fm="[DEFAULT]",LV={[hm]:"fire-core",[uV]:"fire-core-compat",[dV]:"fire-analytics",[cV]:"fire-analytics-compat",[fV]:"fire-app-check",[hV]:"fire-app-check-compat",[pV]:"fire-auth",[mV]:"fire-auth-compat",[gV]:"fire-rtdb",[_V]:"fire-data-connect",[yV]:"fire-rtdb-compat",[vV]:"fire-fn",[TV]:"fire-fn-compat",[EV]:"fire-iid",[IV]:"fire-iid-compat",[wV]:"fire-fcm",[SV]:"fire-fcm-compat",[CV]:"fire-perf",[AV]:"fire-perf-compat",[xV]:"fire-rc",[RV]:"fire-rc-compat",[PV]:"fire-gcs",[kV]:"fire-gcs-compat",[NV]:"fire-fst",[bV]:"fire-fst-compat",[DV]:"fire-vertex","fire-js":"fire-js",[MV]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wd=new Map,FV=new Map,pm=new Map;function YT(t,e){try{t.container.addComponent(e)}catch(n){Or.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Zo(t){const e=t.name;if(pm.has(e))return Or.debug(`There were multiple attempts to register component ${e}.`),!1;pm.set(e,t);for(const n of Wd.values())YT(n,t);for(const n of FV.values())YT(n,t);return!0}function Qg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Hn(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ii=new wu("app","Firebase",UV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Os("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ii.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia=VV;function JC(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:fm,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Ii.create("bad-app-name",{appName:String(i)});if(n||(n=OC()),!n)throw Ii.create("no-options");const s=Wd.get(i);if(s){if(Us(n,s.options)&&Us(r,s.config))return s;throw Ii.create("duplicate-app",{appName:i})}const o=new H2(i);for(const l of pm.values())o.addComponent(l);const a=new OV(n,r,o);return Wd.set(i,a),a}function QC(t=fm){const e=Wd.get(t);if(!e&&t===fm&&OC())return JC();if(!e)throw Ii.create("no-app",{appName:t});return e}function wi(t,e,n){let r=LV[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Or.warn(o.join(" "));return}Zo(new Os(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV="firebase-heartbeat-database",qV=1,ru="firebase-heartbeat-store";let Xf=null;function YC(){return Xf||(Xf=iV(BV,qV,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ru)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ii.create("idb-open",{originalErrorMessage:t.message})})),Xf}async function GV(t){try{const n=(await YC()).transaction(ru),r=await n.objectStore(ru).get(XC(t));return await n.done,r}catch(e){if(e instanceof Hr)Or.warn(e.message);else{const n=Ii.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Or.warn(n.message)}}}async function XT(t,e){try{const r=(await YC()).transaction(ru,"readwrite");await r.objectStore(ru).put(e,XC(t)),await r.done}catch(n){if(n instanceof Hr)Or.warn(n.message);else{const r=Ii.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Or.warn(r.message)}}}function XC(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zV=1024,$V=30;class HV{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new KV(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=ZT();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>$V){const o=jV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Or.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=ZT(),{heartbeatsToSend:r,unsentEntries:i}=WV(this._heartbeatsCache.heartbeats),s=Hd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return Or.warn(n),""}}}function ZT(){return new Date().toISOString().substring(0,10)}function WV(t,e=zV){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),eE(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eE(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class KV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return WC()?M2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await GV(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return XT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return XT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function eE(t){return Hd(JSON.stringify({version:2,heartbeats:t})).length}function jV(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JV(t){Zo(new Os("platform-logger",e=>new aV(e),"PRIVATE")),Zo(new Os("heartbeat",e=>new HV(e),"PRIVATE")),wi(hm,QT,t),wi(hm,QT,"esm2020"),wi("fire-js","")}JV("");var QV="firebase",YV="12.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wi(QV,YV,"app");function ZC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const XV=ZC,e0=new wu("auth","Firebase",ZC());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kd=new jg("@firebase/auth");function ZV(t,...e){Kd.logLevel<=De.WARN&&Kd.warn(`Auth (${Ia}): ${t}`,...e)}function td(t,...e){Kd.logLevel<=De.ERROR&&Kd.error(`Auth (${Ia}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pr(t,...e){throw Xg(t,...e)}function Jn(t,...e){return Xg(t,...e)}function Yg(t,e,n){const r={...XV(),[e]:n};return new wu("auth","Firebase",r).create(e,{appName:t.name})}function Rs(t){return Yg(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eL(t,e,n){const r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&pr(t,"argument-error"),Yg(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Xg(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return e0.create(t,...e)}function ve(t,e,...n){if(!t)throw Xg(e,...n)}function kr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw td(e),new Error(e)}function Br(t,e){t||kr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function tL(){return tE()==="http:"||tE()==="https:"}function tE(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tL()||N2()||"connection"in navigator)?navigator.onLine:!0}function rL(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e,n){this.shortDelay=e,this.longDelay=n,Br(n>e,"Short delay should be less than long delay!"),this.isMobile=P2()||D2()}get(){return nL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zg(t,e){Br(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;kr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;kr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;kr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],oL=new Cu(3e4,6e4);function e_(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function wa(t,e,n,r,i={}){return n0(t,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=Su({key:t.config.apiKey,...o}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:l,...s};return k2()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Ea(t.emulatorConfig.host)&&(u.credentials="include"),t0.fetch()(await r0(t,t.config.apiHost,n,a),u)})}async function n0(t,e,n){t._canInitEmulator=!1;const r={...iL,...e};try{const i=new lL(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw bc(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw bc(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw bc(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw bc(t,"user-disabled",o);const f=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Yg(t,f,u);pr(t,f)}}catch(i){if(i instanceof Hr)throw i;pr(t,"network-request-failed",{message:String(i)})}}async function aL(t,e,n,r,i={}){const s=await wa(t,e,n,r,i);return"mfaPendingCredential"in s&&pr(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function r0(t,e,n,r){const i=`${e}${n}?${r}`,s=t,o=s.config.emulator?Zg(t.config,i):`${t.config.apiScheme}://${i}`;return sL.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}class lL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Jn(this.auth,"network-request-failed")),oL.get())})}}function bc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Jn(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uL(t,e){return wa(t,"POST","/v1/accounts:delete",e)}async function jd(t,e){return wa(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cL(t,e=!1){const n=At(t),r=await n.getIdToken(e),i=t_(r);ve(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Pl(Zf(i.auth_time)),issuedAtTime:Pl(Zf(i.iat)),expirationTime:Pl(Zf(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Zf(t){return Number(t)*1e3}function t_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return td("JWT malformed, contained fewer than 3 sections"),null;try{const i=LC(n);return i?JSON.parse(i):(td("Failed to decode base64 JWT payload"),null)}catch(i){return td("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function nE(t){const e=t_(t);return ve(e,"internal-error"),ve(typeof e.exp<"u","internal-error"),ve(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Hr&&dL(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function dL({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pl(this.lastLoginAt),this.creationTime=Pl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jd(t){var p;const e=t.auth,n=await t.getIdToken(),r=await iu(t,jd(e,{idToken:n}));ve(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const s=(p=i.providerUserInfo)!=null&&p.length?i0(i.providerUserInfo):[],o=pL(t.providerData,s),a=t.isAnonymous,l=!(t.email&&i.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new gm(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(t,f)}async function fL(t){const e=At(t);await Jd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function pL(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function i0(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mL(t,e){const n=await n0(t,{},async()=>{const r=Su({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=await r0(t,i,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return t.emulatorConfig&&Ea(t.emulatorConfig.host)&&(l.credentials="include"),t0.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function gL(t,e){return wa(t,"POST","/v2/accounts:revokeToken",e_(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ve(e.idToken,"internal-error"),ve(typeof e.idToken<"u","internal-error"),ve(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):nE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ve(e.length!==0,"internal-error");const n=nE(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ve(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await mL(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new Go;return r&&(ve(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ve(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ve(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Go,this.toJSON())}_performRefresh(){return kr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xr(t,e){ve(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Wn{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new hL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new gm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await iu(this,this.stsTokenManager.getToken(this.auth,e));return ve(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return cL(this,e)}reload(){return fL(this)}_assign(e){this!==e&&(ve(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Wn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ve(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Jd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Hn(this.auth.app))return Promise.reject(Rs(this.auth));const e=await this.getIdToken();return await iu(this,uL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,s=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,l=n._redirectEventId??void 0,u=n.createdAt??void 0,f=n.lastLoginAt??void 0,{uid:p,emailVerified:g,isAnonymous:v,providerData:T,stsTokenManager:x}=n;ve(p&&x,e,"internal-error");const D=Go.fromJSON(this.name,x);ve(typeof p=="string",e,"internal-error"),Xr(r,e.name),Xr(i,e.name),ve(typeof g=="boolean",e,"internal-error"),ve(typeof v=="boolean",e,"internal-error"),Xr(s,e.name),Xr(o,e.name),Xr(a,e.name),Xr(l,e.name),Xr(u,e.name),Xr(f,e.name);const S=new Wn({uid:p,auth:e,email:i,emailVerified:g,displayName:r,isAnonymous:v,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:D,createdAt:u,lastLoginAt:f});return T&&Array.isArray(T)&&(S.providerData=T.map(E=>({...E}))),l&&(S._redirectEventId=l),S}static async _fromIdTokenResponse(e,n,r=!1){const i=new Go;i.updateFromServerResponse(n);const s=new Wn({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Jd(s),s}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];ve(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?i0(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new Go;a.updateFromIdToken(r);const l=new Wn({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new gm(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rE=new Map;function Nr(t){Br(t instanceof Function,"Expected a class definition");let e=rE.get(t);return e?(Br(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,rE.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}s0.type="NONE";const iE=s0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nd(t,e,n){return`firebase:${t}:${e}:${n}`}class zo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=nd(this.userKey,i.apiKey,s),this.fullPersistenceKey=nd("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await jd(this.auth,{idToken:e}).catch(()=>{});return n?Wn._fromGetAccountInfoResponse(this.auth,n,e):null}return Wn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new zo(Nr(iE),e,r);const i=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||Nr(iE);const o=nd(r,e.config.apiKey,e.name);let a=null;for(const u of n)try{const f=await u._get(o);if(f){let p;if(typeof f=="string"){const g=await jd(e,{idToken:f}).catch(()=>{});if(!g)break;p=await Wn._fromGetAccountInfoResponse(e,g,f)}else p=Wn._fromJSON(e,f);u!==s&&(a=p),s=u;break}}catch{}const l=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new zo(s,e,r):(s=l[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==s)try{await u._remove(o)}catch{}})),new zo(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(u0(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(o0(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(d0(e))return"Blackberry";if(h0(e))return"Webos";if(a0(e))return"Safari";if((e.includes("chrome/")||l0(e))&&!e.includes("edge/"))return"Chrome";if(c0(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function o0(t=Ct()){return/firefox\//i.test(t)}function a0(t=Ct()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function l0(t=Ct()){return/crios\//i.test(t)}function u0(t=Ct()){return/iemobile/i.test(t)}function c0(t=Ct()){return/android/i.test(t)}function d0(t=Ct()){return/blackberry/i.test(t)}function h0(t=Ct()){return/webos/i.test(t)}function n_(t=Ct()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function _L(t=Ct()){var e;return n_(t)&&!!((e=window.navigator)!=null&&e.standalone)}function yL(){return b2()&&document.documentMode===10}function f0(t=Ct()){return n_(t)||c0(t)||h0(t)||d0(t)||/windows phone/i.test(t)||u0(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p0(t,e=[]){let n;switch(t){case"Browser":n=sE(Ct());break;case"Worker":n=`${sE(Ct())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ia}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((o,a)=>{try{const l=e(s);o(l)}catch(l){a(l)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TL(t,e={}){return wa(t,"GET","/v2/passwordPolicy",e_(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EL=6;class IL{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??EL,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wL{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new oE(this),this.idTokenSubscription=new oE(this),this.beforeStateQueue=new vL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=e0,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Nr(n)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await zo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await jd(this,{idToken:e}),r=await Wn._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Hn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(s=this.redirectUser)==null?void 0:s._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ve(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Jd(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=rL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Hn(this.app))return Promise.reject(Rs(this));const n=e?At(e):null;return n&&ve(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ve(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Hn(this.app)?Promise.reject(Rs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Hn(this.app)?Promise.reject(Rs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Nr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TL(this),n=new IL(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new wu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await gL(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Nr(e)||this._popupRedirectResolver;ve(n,this,"argument-error"),this.redirectPersistenceManager=await zo.create(this,[Nr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ve(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,i);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ve(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=p0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(Hn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&ZV(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Uh(t){return At(t)}class oE{constructor(e){this.auth=e,this.observer=null,this.addObserver=O2(n=>this.observer=n)}get next(){return ve(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function SL(t){r_=t}function CL(t){return r_.loadJS(t)}function AL(){return r_.gapiScript}function xL(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RL(t,e){const n=Qg(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(Us(s,e??{}))return i;pr(i,"already-initialized")}return n.initialize({options:e})}function PL(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Nr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function kL(t,e,n){const r=Uh(t);ve(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=m0(e),{host:o,port:a}=NL(e),l=a===null?"":`:${a}`,u={url:`${s}//${o}${l}/`},f=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ve(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ve(Us(u,r.config.emulator)&&Us(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Ea(o)?(qC(`${s}//${o}${l}`),GC("Auth",!0)):DL()}function m0(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function NL(t){const e=m0(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:aE(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:aE(o)}}}function aE(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function DL(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return kr("not implemented")}_getIdTokenResponse(e){return kr("not implemented")}_linkToIdToken(e,n){return kr("not implemented")}_getReauthenticationResolver(e){return kr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $o(t,e){return aL(t,"POST","/v1/accounts:signInWithIdp",e_(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bL="http://localhost";class Bs extends g0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Bs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):pr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=n;if(!r||!i)return null;const o=new Bs(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return $o(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,$o(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,$o(e,n)}buildRequest(){const e={requestUri:bL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Su(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au extends i_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi extends Au{constructor(){super("facebook.com")}static credential(e){return Bs._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oi.credential(e.oauthAccessToken)}catch{return null}}}oi.FACEBOOK_SIGN_IN_METHOD="facebook.com";oi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr extends Au{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Bs._fromParams({providerId:xr.PROVIDER_ID,signInMethod:xr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return xr.credentialFromTaggedObject(e)}static credentialFromError(e){return xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return xr.credential(n,r)}catch{return null}}}xr.GOOGLE_SIGN_IN_METHOD="google.com";xr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends Au{constructor(){super("github.com")}static credential(e){return Bs._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ai.credential(e.oauthAccessToken)}catch{return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com";ai.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li extends Au{constructor(){super("twitter.com")}static credential(e,n){return Bs._fromParams({providerId:li.PROVIDER_ID,signInMethod:li.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return li.credentialFromTaggedObject(e)}static credentialFromError(e){return li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return li.credential(n,r)}catch{return null}}}li.TWITTER_SIGN_IN_METHOD="twitter.com";li.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await Wn._fromIdTokenResponse(e,r,i),o=lE(r);return new ea({user:s,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=lE(r);return new ea({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function lE(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd extends Hr{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Qd.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new Qd(e,n,r,i)}}function _0(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Qd._fromErrorAndOperation(t,s,e,r):s})}async function ML(t,e,n=!1){const r=await iu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ea._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VL(t,e,n=!1){const{auth:r}=t;if(Hn(r.app))return Promise.reject(Rs(r));const i="reauthenticate";try{const s=await iu(t,_0(r,i,e,t),n);ve(s.idToken,r,"internal-error");const o=t_(s.idToken);ve(o,r,"internal-error");const{sub:a}=o;return ve(t.uid===a,r,"user-mismatch"),ea._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&pr(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LL(t,e,n=!1){if(Hn(t.app))return Promise.reject(Rs(t));const r="signIn",i=await _0(t,r,e),s=await ea._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FL(t,e){return At(t).setPersistence(e)}function UL(t,e,n,r){return At(t).onIdTokenChanged(e,n,r)}function OL(t,e,n){return At(t).beforeAuthStateChanged(e,n)}function BL(t,e,n,r){return At(t).onAuthStateChanged(e,n,r)}function uE(t){return At(t).signOut()}const Yd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Yd,"1"),this.storage.removeItem(Yd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL=1e3,GL=10;class v0 extends y0{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=f0(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);yL()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,GL):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},qL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}v0.type="LOCAL";const T0=v0;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0 extends y0{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}E0.type="SESSION";const I0=E0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zL(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Oh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async u=>u(n.origin,s)),l=await zL(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Oh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const u=s_("",20);i.port1.start();const f=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(p){const g=p;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(g.data.response);break;default:clearTimeout(f),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(){return window}function HL(t){hr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w0(){return typeof hr().WorkerGlobalScope<"u"&&typeof hr().importScripts=="function"}async function WL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function KL(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function jL(){return w0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0="firebaseLocalStorageDb",JL=1,Xd="firebaseLocalStorage",C0="fbase_key";class xu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Bh(t,e){return t.transaction([Xd],e?"readwrite":"readonly").objectStore(Xd)}function QL(){const t=indexedDB.deleteDatabase(S0);return new xu(t).toPromise()}function _m(){const t=indexedDB.open(S0,JL);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Xd,{keyPath:C0})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Xd)?e(r):(r.close(),await QL(),e(await _m()))})})}async function cE(t,e,n){const r=Bh(t,!0).put({[C0]:e,value:n});return new xu(r).toPromise()}async function YL(t,e){const n=Bh(t,!1).get(e),r=await new xu(n).toPromise();return r===void 0?null:r.value}function dE(t,e){const n=Bh(t,!0).delete(e);return new xu(n).toPromise()}const XL=800,ZL=3;class A0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _m(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>ZL)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return w0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Oh._getInstance(jL()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await WL(),!this.activeServiceWorker)return;this.sender=new $L(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||KL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _m();return await cE(e,Yd,"1"),await dE(e,Yd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>cE(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>YL(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>dE(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Bh(i,!1).getAll();return new xu(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),XL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}A0.type="LOCAL";const eF=A0;new Cu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x0(t,e){return e?Nr(e):(ve(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_ extends g0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $o(e,this._buildIdpRequest())}_linkToIdToken(e,n){return $o(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return $o(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function tF(t){return LL(t.auth,new o_(t),t.bypassAuthState)}function nF(t){const{auth:e,user:n}=t;return ve(n,e,"internal-error"),VL(n,new o_(t),t.bypassAuthState)}async function rF(t){const{auth:e,user:n}=t;return ve(n,e,"internal-error"),ML(n,new o_(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tF;case"linkViaPopup":case"linkViaRedirect":return rF;case"reauthViaPopup":case"reauthViaRedirect":return nF;default:pr(this.auth,"internal-error")}}resolve(e){Br(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Br(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iF=new Cu(2e3,1e4);async function sF(t,e,n){if(Hn(t.app))return Promise.reject(Jn(t,"operation-not-supported-in-this-environment"));const r=Uh(t);eL(t,e,i_);const i=x0(r,n);return new Ss(r,"signInViaPopup",e,i).executeNotNull()}class Ss extends R0{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Ss.currentPopupAction&&Ss.currentPopupAction.cancel(),Ss.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ve(e,this.auth,"internal-error"),e}async onExecution(){Br(this.filter.length===1,"Popup operations only handle one event");const e=s_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Jn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Jn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ss.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Jn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,iF.get())};e()}}Ss.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oF="pendingRedirect",rd=new Map;class aF extends R0{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=rd.get(this.auth._key());if(!e){try{const r=await lF(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}rd.set(this.auth._key(),e)}return this.bypassAuthState||rd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lF(t,e){const n=dF(e),r=cF(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function uF(t,e){rd.set(t._key(),e)}function cF(t){return Nr(t._redirectPersistence)}function dF(t){return nd(oF,t.config.apiKey,t.name)}async function hF(t,e,n=!1){if(Hn(t.app))return Promise.reject(Rs(t));const r=Uh(t),i=x0(r,e),o=await new aF(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF=10*60*1e3;class pF{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mF(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!P0(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Jn(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=fF&&this.cachedEventUids.clear(),this.cachedEventUids.has(hE(e))}saveEventToCache(e){this.cachedEventUids.add(hE(e)),this.lastProcessedEventTime=Date.now()}}function hE(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function P0({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function mF(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return P0(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gF(t,e={}){return wa(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _F=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yF=/^https?/;async function vF(t){if(t.config.emulator)return;const{authorizedDomains:e}=await gF(t);for(const n of e)try{if(TF(n))return}catch{}pr(t,"unauthorized-domain")}function TF(t){const e=mm(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!yF.test(n))return!1;if(_F.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EF=new Cu(3e4,6e4);function fE(){const t=hr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function IF(t){return new Promise((e,n)=>{var i,s,o;function r(){fE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fE(),n(Jn(t,"network-request-failed"))},timeout:EF.get()})}if((s=(i=hr().gapi)==null?void 0:i.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((o=hr().gapi)!=null&&o.load)r();else{const a=xL("iframefcb");return hr()[a]=()=>{gapi.load?r():n(Jn(t,"network-request-failed"))},CL(`${AL()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw id=null,e})}let id=null;function wF(t){return id=id||IF(t),id}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SF=new Cu(5e3,15e3),CF="__/auth/iframe",AF="emulator/auth/iframe",xF={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},RF=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function PF(t){const e=t.config;ve(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Zg(e,AF):`https://${t.config.authDomain}/${CF}`,r={apiKey:e.apiKey,appName:t.name,v:Ia},i=RF.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Su(r).slice(1)}`}async function kF(t){const e=await wF(t),n=hr().gapi;return ve(n,t,"internal-error"),e.open({where:document.body,url:PF(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xF,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=Jn(t,"network-request-failed"),a=hr().setTimeout(()=>{s(o)},SF.get());function l(){hr().clearTimeout(a),i(r)}r.ping(l).then(l,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DF=500,bF=600,MF="_blank",VF="http://localhost";class pE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function LF(t,e,n,r=DF,i=bF){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...NF,width:r.toString(),height:i.toString(),top:s,left:o},u=Ct().toLowerCase();n&&(a=l0(u)?MF:n),o0(u)&&(e=e||VF,l.scrollbars="yes");const f=Object.entries(l).reduce((g,[v,T])=>`${g}${v}=${T},`,"");if(_L(u)&&a!=="_self")return FF(e||"",a),new pE(null);const p=window.open(e||"",a,f);ve(p,t,"popup-blocked");try{p.focus()}catch{}return new pE(p)}function FF(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF="__/auth/handler",OF="emulator/auth/handler",BF=encodeURIComponent("fac");async function mE(t,e,n,r,i,s){ve(t.config.authDomain,t,"auth-domain-config-required"),ve(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ia,eventId:i};if(e instanceof i_){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",U2(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))o[f]=p}if(e instanceof Au){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const f of Object.keys(a))a[f]===void 0&&delete a[f];const l=await t._getAppCheckToken(),u=l?`#${BF}=${encodeURIComponent(l)}`:"";return`${qF(t)}?${Su(a).slice(1)}${u}`}function qF({config:t}){return t.emulator?Zg(t,OF):`https://${t.authDomain}/${UF}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ep="webStorageSupport";class GF{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=I0,this._completeRedirectFn=hF,this._overrideRedirectResult=uF}async _openPopup(e,n,r,i){var o;Br((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const s=await mE(e,n,r,mm(),i);return LF(e,s,s_())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await mE(e,n,r,mm(),i);return HL(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(Br(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await kF(e),r=new pF(e);return n.register("authEvent",i=>(ve(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(ep,{type:ep},i=>{var o;const s=(o=i==null?void 0:i[0])==null?void 0:o[ep];s!==void 0&&n(!!s),pr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=vF(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return f0()||a0()||n_()}}const zF=GF;var gE="@firebase/auth",_E="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ve(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function WF(t){Zo(new Os("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ve(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:p0(t)},u=new wL(r,i,s,l);return PL(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Zo(new Os("auth-internal",e=>{const n=Uh(e.getProvider("auth").getImmediate());return(r=>new $F(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),wi(gE,_E,HF(t)),wi(gE,_E,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KF=5*60,jF=BC("authIdTokenMaxAge")||KF;let yE=null;const JF=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>jF)return;const i=n==null?void 0:n.token;yE!==i&&(yE=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function QF(t=QC()){const e=Qg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=RL(t,{popupRedirectResolver:zF,persistence:[eF,T0,I0]}),r=BC("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=JF(s.toString());OL(n,o,()=>o(n.currentUser)),UL(n,a=>o(a))}}const i=UC("auth");return i&&kL(n,`http://${i}`),n}function YF(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}SL({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=Jn("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",YF().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});WF("Browser");var vE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Si,k0;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,w){function C(){}C.prototype=w.prototype,I.F=w.prototype,I.prototype=new C,I.prototype.constructor=I,I.D=function(N,b,V){for(var k=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)k[xe-2]=arguments[xe];return w.prototype[b].apply(N,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,w,C){C||(C=0);const N=Array(16);if(typeof w=="string")for(var b=0;b<16;++b)N[b]=w.charCodeAt(C++)|w.charCodeAt(C++)<<8|w.charCodeAt(C++)<<16|w.charCodeAt(C++)<<24;else for(b=0;b<16;++b)N[b]=w[C++]|w[C++]<<8|w[C++]<<16|w[C++]<<24;w=I.g[0],C=I.g[1],b=I.g[2];let V=I.g[3],k;k=w+(V^C&(b^V))+N[0]+3614090360&4294967295,w=C+(k<<7&4294967295|k>>>25),k=V+(b^w&(C^b))+N[1]+3905402710&4294967295,V=w+(k<<12&4294967295|k>>>20),k=b+(C^V&(w^C))+N[2]+606105819&4294967295,b=V+(k<<17&4294967295|k>>>15),k=C+(w^b&(V^w))+N[3]+3250441966&4294967295,C=b+(k<<22&4294967295|k>>>10),k=w+(V^C&(b^V))+N[4]+4118548399&4294967295,w=C+(k<<7&4294967295|k>>>25),k=V+(b^w&(C^b))+N[5]+1200080426&4294967295,V=w+(k<<12&4294967295|k>>>20),k=b+(C^V&(w^C))+N[6]+2821735955&4294967295,b=V+(k<<17&4294967295|k>>>15),k=C+(w^b&(V^w))+N[7]+4249261313&4294967295,C=b+(k<<22&4294967295|k>>>10),k=w+(V^C&(b^V))+N[8]+1770035416&4294967295,w=C+(k<<7&4294967295|k>>>25),k=V+(b^w&(C^b))+N[9]+2336552879&4294967295,V=w+(k<<12&4294967295|k>>>20),k=b+(C^V&(w^C))+N[10]+4294925233&4294967295,b=V+(k<<17&4294967295|k>>>15),k=C+(w^b&(V^w))+N[11]+2304563134&4294967295,C=b+(k<<22&4294967295|k>>>10),k=w+(V^C&(b^V))+N[12]+1804603682&4294967295,w=C+(k<<7&4294967295|k>>>25),k=V+(b^w&(C^b))+N[13]+4254626195&4294967295,V=w+(k<<12&4294967295|k>>>20),k=b+(C^V&(w^C))+N[14]+2792965006&4294967295,b=V+(k<<17&4294967295|k>>>15),k=C+(w^b&(V^w))+N[15]+1236535329&4294967295,C=b+(k<<22&4294967295|k>>>10),k=w+(b^V&(C^b))+N[1]+4129170786&4294967295,w=C+(k<<5&4294967295|k>>>27),k=V+(C^b&(w^C))+N[6]+3225465664&4294967295,V=w+(k<<9&4294967295|k>>>23),k=b+(w^C&(V^w))+N[11]+643717713&4294967295,b=V+(k<<14&4294967295|k>>>18),k=C+(V^w&(b^V))+N[0]+3921069994&4294967295,C=b+(k<<20&4294967295|k>>>12),k=w+(b^V&(C^b))+N[5]+3593408605&4294967295,w=C+(k<<5&4294967295|k>>>27),k=V+(C^b&(w^C))+N[10]+38016083&4294967295,V=w+(k<<9&4294967295|k>>>23),k=b+(w^C&(V^w))+N[15]+3634488961&4294967295,b=V+(k<<14&4294967295|k>>>18),k=C+(V^w&(b^V))+N[4]+3889429448&4294967295,C=b+(k<<20&4294967295|k>>>12),k=w+(b^V&(C^b))+N[9]+568446438&4294967295,w=C+(k<<5&4294967295|k>>>27),k=V+(C^b&(w^C))+N[14]+3275163606&4294967295,V=w+(k<<9&4294967295|k>>>23),k=b+(w^C&(V^w))+N[3]+4107603335&4294967295,b=V+(k<<14&4294967295|k>>>18),k=C+(V^w&(b^V))+N[8]+1163531501&4294967295,C=b+(k<<20&4294967295|k>>>12),k=w+(b^V&(C^b))+N[13]+2850285829&4294967295,w=C+(k<<5&4294967295|k>>>27),k=V+(C^b&(w^C))+N[2]+4243563512&4294967295,V=w+(k<<9&4294967295|k>>>23),k=b+(w^C&(V^w))+N[7]+1735328473&4294967295,b=V+(k<<14&4294967295|k>>>18),k=C+(V^w&(b^V))+N[12]+2368359562&4294967295,C=b+(k<<20&4294967295|k>>>12),k=w+(C^b^V)+N[5]+4294588738&4294967295,w=C+(k<<4&4294967295|k>>>28),k=V+(w^C^b)+N[8]+2272392833&4294967295,V=w+(k<<11&4294967295|k>>>21),k=b+(V^w^C)+N[11]+1839030562&4294967295,b=V+(k<<16&4294967295|k>>>16),k=C+(b^V^w)+N[14]+4259657740&4294967295,C=b+(k<<23&4294967295|k>>>9),k=w+(C^b^V)+N[1]+2763975236&4294967295,w=C+(k<<4&4294967295|k>>>28),k=V+(w^C^b)+N[4]+1272893353&4294967295,V=w+(k<<11&4294967295|k>>>21),k=b+(V^w^C)+N[7]+4139469664&4294967295,b=V+(k<<16&4294967295|k>>>16),k=C+(b^V^w)+N[10]+3200236656&4294967295,C=b+(k<<23&4294967295|k>>>9),k=w+(C^b^V)+N[13]+681279174&4294967295,w=C+(k<<4&4294967295|k>>>28),k=V+(w^C^b)+N[0]+3936430074&4294967295,V=w+(k<<11&4294967295|k>>>21),k=b+(V^w^C)+N[3]+3572445317&4294967295,b=V+(k<<16&4294967295|k>>>16),k=C+(b^V^w)+N[6]+76029189&4294967295,C=b+(k<<23&4294967295|k>>>9),k=w+(C^b^V)+N[9]+3654602809&4294967295,w=C+(k<<4&4294967295|k>>>28),k=V+(w^C^b)+N[12]+3873151461&4294967295,V=w+(k<<11&4294967295|k>>>21),k=b+(V^w^C)+N[15]+530742520&4294967295,b=V+(k<<16&4294967295|k>>>16),k=C+(b^V^w)+N[2]+3299628645&4294967295,C=b+(k<<23&4294967295|k>>>9),k=w+(b^(C|~V))+N[0]+4096336452&4294967295,w=C+(k<<6&4294967295|k>>>26),k=V+(C^(w|~b))+N[7]+1126891415&4294967295,V=w+(k<<10&4294967295|k>>>22),k=b+(w^(V|~C))+N[14]+2878612391&4294967295,b=V+(k<<15&4294967295|k>>>17),k=C+(V^(b|~w))+N[5]+4237533241&4294967295,C=b+(k<<21&4294967295|k>>>11),k=w+(b^(C|~V))+N[12]+1700485571&4294967295,w=C+(k<<6&4294967295|k>>>26),k=V+(C^(w|~b))+N[3]+2399980690&4294967295,V=w+(k<<10&4294967295|k>>>22),k=b+(w^(V|~C))+N[10]+4293915773&4294967295,b=V+(k<<15&4294967295|k>>>17),k=C+(V^(b|~w))+N[1]+2240044497&4294967295,C=b+(k<<21&4294967295|k>>>11),k=w+(b^(C|~V))+N[8]+1873313359&4294967295,w=C+(k<<6&4294967295|k>>>26),k=V+(C^(w|~b))+N[15]+4264355552&4294967295,V=w+(k<<10&4294967295|k>>>22),k=b+(w^(V|~C))+N[6]+2734768916&4294967295,b=V+(k<<15&4294967295|k>>>17),k=C+(V^(b|~w))+N[13]+1309151649&4294967295,C=b+(k<<21&4294967295|k>>>11),k=w+(b^(C|~V))+N[4]+4149444226&4294967295,w=C+(k<<6&4294967295|k>>>26),k=V+(C^(w|~b))+N[11]+3174756917&4294967295,V=w+(k<<10&4294967295|k>>>22),k=b+(w^(V|~C))+N[2]+718787259&4294967295,b=V+(k<<15&4294967295|k>>>17),k=C+(V^(b|~w))+N[9]+3951481745&4294967295,I.g[0]=I.g[0]+w&4294967295,I.g[1]=I.g[1]+(b+(k<<21&4294967295|k>>>11))&4294967295,I.g[2]=I.g[2]+b&4294967295,I.g[3]=I.g[3]+V&4294967295}r.prototype.v=function(I,w){w===void 0&&(w=I.length);const C=w-this.blockSize,N=this.C;let b=this.h,V=0;for(;V<w;){if(b==0)for(;V<=C;)i(this,I,V),V+=this.blockSize;if(typeof I=="string"){for(;V<w;)if(N[b++]=I.charCodeAt(V++),b==this.blockSize){i(this,N),b=0;break}}else for(;V<w;)if(N[b++]=I[V++],b==this.blockSize){i(this,N),b=0;break}}this.h=b,this.o+=w},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var w=1;w<I.length-8;++w)I[w]=0;w=this.o*8;for(var C=I.length-8;C<I.length;++C)I[C]=w&255,w/=256;for(this.v(I),I=Array(16),w=0,C=0;C<4;++C)for(let N=0;N<32;N+=8)I[w++]=this.g[C]>>>N&255;return I};function s(I,w){var C=a;return Object.prototype.hasOwnProperty.call(C,I)?C[I]:C[I]=w(I)}function o(I,w){this.h=w;const C=[];let N=!0;for(let b=I.length-1;b>=0;b--){const V=I[b]|0;N&&V==w||(C[b]=V,N=!1)}this.g=C}var a={};function l(I){return-128<=I&&I<128?s(I,function(w){return new o([w|0],w<0?-1:0)}):new o([I|0],I<0?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return p;if(I<0)return D(u(-I));const w=[];let C=1;for(let N=0;I>=C;N++)w[N]=I/C|0,C*=4294967296;return new o(w,0)}function f(I,w){if(I.length==0)throw Error("number format error: empty string");if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(I.charAt(0)=="-")return D(f(I.substring(1),w));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const C=u(Math.pow(w,8));let N=p;for(let V=0;V<I.length;V+=8){var b=Math.min(8,I.length-V);const k=parseInt(I.substring(V,V+b),w);b<8?(b=u(Math.pow(w,b)),N=N.j(b).add(u(k))):(N=N.j(C),N=N.add(u(k)))}return N}var p=l(0),g=l(1),v=l(16777216);t=o.prototype,t.m=function(){if(x(this))return-D(this).m();let I=0,w=1;for(let C=0;C<this.g.length;C++){const N=this.i(C);I+=(N>=0?N:4294967296+N)*w,w*=4294967296}return I},t.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(T(this))return"0";if(x(this))return"-"+D(this).toString(I);const w=u(Math.pow(I,6));var C=this;let N="";for(;;){const b=M(C,w).g;C=S(C,b.j(w));let V=((C.g.length>0?C.g[0]:C.h)>>>0).toString(I);if(C=b,T(C))return V+N;for(;V.length<6;)V="0"+V;N=V+N}},t.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function T(I){if(I.h!=0)return!1;for(let w=0;w<I.g.length;w++)if(I.g[w]!=0)return!1;return!0}function x(I){return I.h==-1}t.l=function(I){return I=S(this,I),x(I)?-1:T(I)?0:1};function D(I){const w=I.g.length,C=[];for(let N=0;N<w;N++)C[N]=~I.g[N];return new o(C,~I.h).add(g)}t.abs=function(){return x(this)?D(this):this},t.add=function(I){const w=Math.max(this.g.length,I.g.length),C=[];let N=0;for(let b=0;b<=w;b++){let V=N+(this.i(b)&65535)+(I.i(b)&65535),k=(V>>>16)+(this.i(b)>>>16)+(I.i(b)>>>16);N=k>>>16,V&=65535,k&=65535,C[b]=k<<16|V}return new o(C,C[C.length-1]&-2147483648?-1:0)};function S(I,w){return I.add(D(w))}t.j=function(I){if(T(this)||T(I))return p;if(x(this))return x(I)?D(this).j(D(I)):D(D(this).j(I));if(x(I))return D(this.j(D(I)));if(this.l(v)<0&&I.l(v)<0)return u(this.m()*I.m());const w=this.g.length+I.g.length,C=[];for(var N=0;N<2*w;N++)C[N]=0;for(N=0;N<this.g.length;N++)for(let b=0;b<I.g.length;b++){const V=this.i(N)>>>16,k=this.i(N)&65535,xe=I.i(b)>>>16,Fe=I.i(b)&65535;C[2*N+2*b]+=k*Fe,E(C,2*N+2*b),C[2*N+2*b+1]+=V*Fe,E(C,2*N+2*b+1),C[2*N+2*b+1]+=k*xe,E(C,2*N+2*b+1),C[2*N+2*b+2]+=V*xe,E(C,2*N+2*b+2)}for(I=0;I<w;I++)C[I]=C[2*I+1]<<16|C[2*I];for(I=w;I<2*w;I++)C[I]=0;return new o(C,0)};function E(I,w){for(;(I[w]&65535)!=I[w];)I[w+1]+=I[w]>>>16,I[w]&=65535,w++}function R(I,w){this.g=I,this.h=w}function M(I,w){if(T(w))throw Error("division by zero");if(T(I))return new R(p,p);if(x(I))return w=M(D(I),w),new R(D(w.g),D(w.h));if(x(w))return w=M(I,D(w)),new R(D(w.g),w.h);if(I.g.length>30){if(x(I)||x(w))throw Error("slowDivide_ only works with positive integers.");for(var C=g,N=w;N.l(I)<=0;)C=O(C),N=O(N);var b=F(C,1),V=F(N,1);for(N=F(N,2),C=F(C,2);!T(N);){var k=V.add(N);k.l(I)<=0&&(b=b.add(C),V=k),N=F(N,1),C=F(C,1)}return w=S(I,b.j(w)),new R(b,w)}for(b=p;I.l(w)>=0;){for(C=Math.max(1,Math.floor(I.m()/w.m())),N=Math.ceil(Math.log(C)/Math.LN2),N=N<=48?1:Math.pow(2,N-48),V=u(C),k=V.j(w);x(k)||k.l(I)>0;)C-=N,V=u(C),k=V.j(w);T(V)&&(V=g),b=b.add(V),I=S(I,k)}return new R(b,I)}t.B=function(I){return M(this,I).h},t.and=function(I){const w=Math.max(this.g.length,I.g.length),C=[];for(let N=0;N<w;N++)C[N]=this.i(N)&I.i(N);return new o(C,this.h&I.h)},t.or=function(I){const w=Math.max(this.g.length,I.g.length),C=[];for(let N=0;N<w;N++)C[N]=this.i(N)|I.i(N);return new o(C,this.h|I.h)},t.xor=function(I){const w=Math.max(this.g.length,I.g.length),C=[];for(let N=0;N<w;N++)C[N]=this.i(N)^I.i(N);return new o(C,this.h^I.h)};function O(I){const w=I.g.length+1,C=[];for(let N=0;N<w;N++)C[N]=I.i(N)<<1|I.i(N-1)>>>31;return new o(C,I.h)}function F(I,w){const C=w>>5;w%=32;const N=I.g.length-C,b=[];for(let V=0;V<N;V++)b[V]=w>0?I.i(V+C)>>>w|I.i(V+C+1)<<32-w:I.i(V+C);return new o(b,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,k0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=f,Si=o}).apply(typeof vE<"u"?vE:typeof self<"u"?self:typeof window<"u"?window:{});var Mc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var N0,fl,D0,sd,ym,b0,M0,V0;(function(){var t,e=Object.defineProperty;function n(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof Mc=="object"&&Mc];for(var _=0;_<d.length;++_){var y=d[_];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=n(this);function i(d,_){if(_)e:{var y=r;d=d.split(".");for(var A=0;A<d.length-1;A++){var q=d[A];if(!(q in y))break e;y=y[q]}d=d[d.length-1],A=y[d],_=_(A),_!=A&&_!=null&&e(y,d,{configurable:!0,writable:!0,value:_})}}i("Symbol.dispose",function(d){return d||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(d){return d||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(d){return d||function(_){var y=[],A;for(A in _)Object.prototype.hasOwnProperty.call(_,A)&&y.push([A,_[A]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},o=this||self;function a(d){var _=typeof d;return _=="object"&&d!=null||_=="function"}function l(d,_,y){return d.call.apply(d.bind,arguments)}function u(d,_,y){return u=l,u.apply(null,arguments)}function f(d,_){var y=Array.prototype.slice.call(arguments,1);return function(){var A=y.slice();return A.push.apply(A,arguments),d.apply(this,A)}}function p(d,_){function y(){}y.prototype=_.prototype,d.Z=_.prototype,d.prototype=new y,d.prototype.constructor=d,d.Ob=function(A,q,z){for(var re=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)re[Ae-2]=arguments[Ae];return _.prototype[q].apply(A,re)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?d=>d&&AsyncContext.Snapshot.wrap(d):d=>d;function v(d){const _=d.length;if(_>0){const y=Array(_);for(let A=0;A<_;A++)y[A]=d[A];return y}return[]}function T(d,_){for(let A=1;A<arguments.length;A++){const q=arguments[A];var y=typeof q;if(y=y!="object"?y:q?Array.isArray(q)?"array":y:"null",y=="array"||y=="object"&&typeof q.length=="number"){y=d.length||0;const z=q.length||0;d.length=y+z;for(let re=0;re<z;re++)d[y+re]=q[re]}else d.push(q)}}class x{constructor(_,y){this.i=_,this.j=y,this.h=0,this.g=null}get(){let _;return this.h>0?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}function D(d){o.setTimeout(()=>{throw d},0)}function S(){var d=I;let _=null;return d.g&&(_=d.g,d.g=d.g.next,d.g||(d.h=null),_.next=null),_}class E{constructor(){this.h=this.g=null}add(_,y){const A=R.get();A.set(_,y),this.h?this.h.next=A:this.g=A,this.h=A}}var R=new x(()=>new M,d=>d.reset());class M{constructor(){this.next=this.g=this.h=null}set(_,y){this.h=_,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let O,F=!1,I=new E,w=()=>{const d=Promise.resolve(void 0);O=()=>{d.then(C)}};function C(){for(var d;d=S();){try{d.h.call(d.g)}catch(y){D(y)}var _=R;_.j(d),_.h<100&&(_.h++,d.next=_.g,_.g=d)}F=!1}function N(){this.u=this.u,this.C=this.C}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function b(d,_){this.type=d,this.g=this.target=_,this.defaultPrevented=!1}b.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var d=!1,_=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const y=()=>{};o.addEventListener("test",y,_),o.removeEventListener("test",y,_)}catch{}return d}();function k(d){return/^[\s\xa0]*$/.test(d)}function xe(d,_){b.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d&&this.init(d,_)}p(xe,b),xe.prototype.init=function(d,_){const y=this.type=d.type,A=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;this.target=d.target||d.srcElement,this.g=_,_=d.relatedTarget,_||(y=="mouseover"?_=d.fromElement:y=="mouseout"&&(_=d.toElement)),this.relatedTarget=_,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=d.pointerType,this.state=d.state,this.i=d,d.defaultPrevented&&xe.Z.h.call(this)},xe.prototype.h=function(){xe.Z.h.call(this);const d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Fe="closure_listenable_"+(Math.random()*1e6|0),Me=0;function he(d,_,y,A,q){this.listener=d,this.proxy=null,this.src=_,this.type=y,this.capture=!!A,this.ha=q,this.key=++Me,this.da=this.fa=!1}function J(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function le(d,_,y){for(const A in d)_.call(y,d[A],A,d)}function pe(d,_){for(const y in d)_.call(void 0,d[y],y,d)}function Pe(d){const _={};for(const y in d)_[y]=d[y];return _}const oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(d,_){let y,A;for(let q=1;q<arguments.length;q++){A=arguments[q];for(y in A)d[y]=A[y];for(let z=0;z<oe.length;z++)y=oe[z],Object.prototype.hasOwnProperty.call(A,y)&&(d[y]=A[y])}}function Je(d){this.src=d,this.g={},this.h=0}Je.prototype.add=function(d,_,y,A,q){const z=d.toString();d=this.g[z],d||(d=this.g[z]=[],this.h++);const re=Et(d,_,A,q);return re>-1?(_=d[re],y||(_.fa=!1)):(_=new he(_,this.src,z,!!A,q),_.fa=y,d.push(_)),_};function jt(d,_){const y=_.type;if(y in d.g){var A=d.g[y],q=Array.prototype.indexOf.call(A,_,void 0),z;(z=q>=0)&&Array.prototype.splice.call(A,q,1),z&&(J(_),d.g[y].length==0&&(delete d.g[y],d.h--))}}function Et(d,_,y,A){for(let q=0;q<d.length;++q){const z=d[q];if(!z.da&&z.listener==_&&z.capture==!!y&&z.ha==A)return q}return-1}var sn="closure_lm_"+(Math.random()*1e6|0),fn={};function Jt(d,_,y,A,q){if(Array.isArray(_)){for(let z=0;z<_.length;z++)Jt(d,_[z],y,A,q);return null}return y=ot(y),d&&d[Fe]?d.J(_,y,a(A)?!!A.capture:!1,q):Fn(d,_,y,!1,A,q)}function Fn(d,_,y,A,q,z){if(!_)throw Error("Invalid event type");const re=a(q)?!!q.capture:!!q;let Ae=Ie(d);if(Ae||(d[sn]=Ae=new Je(d)),y=Ae.add(_,y,A,re,z),y.proxy)return y;if(A=_r(),y.proxy=A,A.src=d,A.listener=y,d.addEventListener)V||(q=re),q===void 0&&(q=!1),d.addEventListener(_.toString(),A,q);else if(d.attachEvent)d.attachEvent(yr(_.toString()),A);else if(d.addListener&&d.removeListener)d.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return y}function _r(){function d(y){return _.call(d.src,d.listener,y)}const _=Ne;return d}function er(d,_,y,A,q){if(Array.isArray(_))for(var z=0;z<_.length;z++)er(d,_[z],y,A,q);else A=a(A)?!!A.capture:!!A,y=ot(y),d&&d[Fe]?(d=d.i,z=String(_).toString(),z in d.g&&(_=d.g[z],y=Et(_,y,A,q),y>-1&&(J(_[y]),Array.prototype.splice.call(_,y,1),_.length==0&&(delete d.g[z],d.h--)))):d&&(d=Ie(d))&&(_=d.g[_.toString()],d=-1,_&&(d=Et(_,y,A,q)),(y=d>-1?_[d]:null)&&on(y))}function on(d){if(typeof d!="number"&&d&&!d.da){var _=d.src;if(_&&_[Fe])jt(_.i,d);else{var y=d.type,A=d.proxy;_.removeEventListener?_.removeEventListener(y,A,d.capture):_.detachEvent?_.detachEvent(yr(y),A):_.addListener&&_.removeListener&&_.removeListener(A),(y=Ie(_))?(jt(y,d),y.h==0&&(y.src=null,_[sn]=null)):J(d)}}}function yr(d){return d in fn?fn[d]:fn[d]="on"+d}function Ne(d,_){if(d.da)d=!0;else{_=new xe(_,this);const y=d.listener,A=d.ha||d.src;d.fa&&on(d),d=y.call(A,_)}return d}function Ie(d){return d=d[sn],d instanceof Je?d:null}var Un="__closure_events_fn_"+(Math.random()*1e9>>>0);function ot(d){return typeof d=="function"?d:(d[Un]||(d[Un]=function(_){return d.handleEvent(_)}),d[Un])}function de(){N.call(this),this.i=new Je(this),this.M=this,this.G=null}p(de,N),de.prototype[Fe]=!0,de.prototype.removeEventListener=function(d,_,y,A){er(this,d,_,y,A)};function Rt(d,_){var y,A=d.G;if(A)for(y=[];A;A=A.G)y.push(A);if(d=d.M,A=_.type||_,typeof _=="string")_=new b(_,d);else if(_ instanceof b)_.target=_.target||d;else{var q=_;_=new b(A,d),et(_,q)}q=!0;let z,re;if(y)for(re=y.length-1;re>=0;re--)z=_.g=y[re],q=$i(z,A,!0,_)&&q;if(z=_.g=d,q=$i(z,A,!0,_)&&q,q=$i(z,A,!1,_)&&q,y)for(re=0;re<y.length;re++)z=_.g=y[re],q=$i(z,A,!1,_)&&q}de.prototype.N=function(){if(de.Z.N.call(this),this.i){var d=this.i;for(const _ in d.g){const y=d.g[_];for(let A=0;A<y.length;A++)J(y[A]);delete d.g[_],d.h--}}this.G=null},de.prototype.J=function(d,_,y,A){return this.i.add(String(d),_,!1,y,A)},de.prototype.K=function(d,_,y,A){return this.i.add(String(d),_,!0,y,A)};function $i(d,_,y,A){if(_=d.i.g[String(_)],!_)return!0;_=_.concat();let q=!0;for(let z=0;z<_.length;++z){const re=_[z];if(re&&!re.da&&re.capture==y){const Ae=re.listener,It=re.ha||re.src;re.fa&&jt(d.i,re),q=Ae.call(It,A)!==!1&&q}}return q&&!A.defaultPrevented}function Hi(d,_){if(typeof d!="function")if(d&&typeof d.handleEvent=="function")d=u(d.handleEvent,d);else throw Error("Invalid listener argument");return Number(_)>2147483647?-1:o.setTimeout(d,_||0)}function Ra(d){d.g=Hi(()=>{d.g=null,d.i&&(d.i=!1,Ra(d))},d.l);const _=d.h;d.h=null,d.m.apply(null,_)}class Xs extends N{constructor(_,y){super(),this.m=_,this.l=y,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:Ra(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ce(d){N.call(this),this.h=d,this.g={}}p(Ce,N);var zu=[];function vr(d){le(d.g,function(_,y){this.g.hasOwnProperty(y)&&on(_)},d),d.g={}}Ce.prototype.N=function(){Ce.Z.N.call(this),vr(this)},Ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wi=o.JSON.stringify,Pa=o.JSON.parse,$u=class{stringify(d){return o.JSON.stringify(d,void 0)}parse(d){return o.JSON.parse(d,void 0)}};function ka(){}function Hu(){}var Ki={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Na(){b.call(this,"d")}p(Na,b);function ji(){b.call(this,"c")}p(ji,b);var pn={},Ji=null;function Zs(){return Ji=Ji||new de}pn.Ia="serverreachability";function Da(d){b.call(this,pn.Ia,d)}p(Da,b);function On(d){const _=Zs();Rt(_,new Da(_))}pn.STAT_EVENT="statevent";function Qi(d,_){b.call(this,pn.STAT_EVENT,d),this.stat=_}p(Qi,b);function ft(d){const _=Zs();Rt(_,new Qi(_,d))}pn.Ja="timingevent";function Wu(d,_){b.call(this,pn.Ja,d),this.size=_}p(Wu,b);function Tr(d,_){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){d()},_)}function Yi(){this.g=!0}Yi.prototype.ua=function(){this.g=!1};function Q(d,_,y,A,q,z){d.info(function(){if(d.g)if(z){var re="",Ae=z.split("&");for(let je=0;je<Ae.length;je++){var It=Ae[je].split("=");if(It.length>1){const kt=It[0];It=It[1];const nr=kt.split("_");re=nr.length>=2&&nr[1]=="type"?re+(kt+"="+It+"&"):re+(kt+"=redacted&")}}}else re=null;else re=z;return"XMLHTTP REQ ("+A+") [attempt "+q+"]: "+_+`
`+y+`
`+re})}function ba(d,_,y,A,q,z,re){d.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+q+"]: "+_+`
`+y+`
`+z+" "+re})}function Xi(d,_,y,A){d.info(function(){return"XMLHTTP TEXT ("+_+"): "+ey(d,y)+(A?" "+A:"")})}function Z_(d,_){d.info(function(){return"TIMEOUT: "+_})}Yi.prototype.info=function(){};function ey(d,_){if(!d.g)return _;if(!_)return null;try{const z=JSON.parse(_);if(z){for(d=0;d<z.length;d++)if(Array.isArray(z[d])){var y=z[d];if(!(y.length<2)){var A=y[1];if(Array.isArray(A)&&!(A.length<1)){var q=A[0];if(q!="noop"&&q!="stop"&&q!="close")for(let re=1;re<A.length;re++)A[re]=""}}}}return Wi(z)}catch{return _}}var Ma={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ku={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},eo;function Va(){}p(Va,ka),Va.prototype.g=function(){return new XMLHttpRequest},eo=new Va;function Er(d){return encodeURIComponent(String(d))}function ju(d){var _=1;d=d.split(":");const y=[];for(;_>0&&d.length;)y.push(d.shift()),_--;return d.length&&y.push(d.join(":")),y}function Pt(d,_,y,A){this.j=d,this.i=_,this.l=y,this.S=A||1,this.V=new Ce(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ju}function Ju(){this.i=null,this.g="",this.h=!1}var La={},Zi={};function Fa(d,_,y){d.M=1,d.A=no(An(_)),d.u=y,d.R=!0,Qu(d,null)}function Qu(d,_){d.F=Date.now(),ie(d),d.B=An(d.A);var y=d.B,A=d.S;Array.isArray(A)||(A=[String(A)]),P(y.i,"t",A),d.C=0,y=d.j.L,d.h=new Ju,d.g=fy(d.j,y?_:null,!d.u),d.P>0&&(d.O=new Xs(u(d.Y,d,d.g),d.P)),_=d.V,y=d.g,A=d.ba;var q="readystatechange";Array.isArray(q)||(q&&(zu[0]=q.toString()),q=zu);for(let z=0;z<q.length;z++){const re=Jt(y,q[z],A||_.handleEvent,!1,_.h||_);if(!re)break;_.g[re.key]=re}_=d.J?Pe(d.J):{},d.u?(d.v||(d.v="POST"),_["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.B,d.v,d.u,_)):(d.v="GET",d.g.ea(d.B,d.v,null,_)),On(),Q(d.i,d.v,d.B,d.l,d.S,d.u)}Pt.prototype.ba=function(d){d=d.target;const _=this.O;_&&jr(d)==3?_.j():this.Y(d)},Pt.prototype.Y=function(d){try{if(d==this.g)e:{const Ae=jr(this.g),It=this.g.ya(),je=this.g.ca();if(!(Ae<3)&&(Ae!=3||this.g&&(this.h.h||this.g.la()||ny(this.g)))){this.K||Ae!=4||It==7||(It==8||je<=0?On(3):On(2)),Ua(this);var _=this.g.ca();this.X=_;var y=Yu(this);if(this.o=_==200,ba(this.i,this.v,this.B,this.l,this.S,Ae,_),this.o){if(this.U&&!this.L){t:{if(this.g){var A,q=this.g;if((A=q.g?q.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(A)){var z=A;break t}}z=null}if(d=z)Xi(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Oa(this,d);else{this.o=!1,this.m=3,ft(12),wr(this),Ir(this);break e}}if(this.R){d=!0;let kt;for(;!this.K&&this.C<y.length;)if(kt=df(this,y),kt==Zi){Ae==4&&(this.m=4,ft(14),d=!1),Xi(this.i,this.l,null,"[Incomplete Response]");break}else if(kt==La){this.m=4,ft(15),Xi(this.i,this.l,y,"[Invalid Chunk]"),d=!1;break}else Xi(this.i,this.l,kt,null),Oa(this,kt);if(to(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ae!=4||y.length!=0||this.h.h||(this.m=1,ft(16),d=!1),this.o=this.o&&d,!d)Xi(this.i,this.l,y,"[Invalid Chunked Response]"),wr(this),Ir(this);else if(y.length>0&&!this.W){this.W=!0;var re=this.j;re.g==this&&re.aa&&!re.P&&(re.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),vf(re),re.P=!0,ft(11))}}else Xi(this.i,this.l,y,null),Oa(this,y);Ae==4&&wr(this),this.o&&!this.K&&(Ae==4?uy(this.j,this):(this.o=!1,ie(this)))}else eR(this.g),_==400&&y.indexOf("Unknown SID")>0?(this.m=3,ft(12)):(this.m=0,ft(13)),wr(this),Ir(this)}}}catch{}finally{}};function Yu(d){if(!to(d))return d.g.la();const _=ny(d.g);if(_==="")return"";let y="";const A=_.length,q=jr(d.g)==4;if(!d.h.i){if(typeof TextDecoder>"u")return wr(d),Ir(d),"";d.h.i=new o.TextDecoder}for(let z=0;z<A;z++)d.h.h=!0,y+=d.h.i.decode(_[z],{stream:!(q&&z==A-1)});return _.length=0,d.h.g+=y,d.C=0,d.h.g}function to(d){return d.g?d.v=="GET"&&d.M!=2&&d.j.Aa:!1}function df(d,_){var y=d.C,A=_.indexOf(`
`,y);return A==-1?Zi:(y=Number(_.substring(y,A)),isNaN(y)?La:(A+=1,A+y>_.length?Zi:(_=_.slice(A,A+y),d.C=A+y,_)))}Pt.prototype.cancel=function(){this.K=!0,wr(this)};function ie(d){d.T=Date.now()+d.H,es(d,d.H)}function es(d,_){if(d.D!=null)throw Error("WatchDog timer not null");d.D=Tr(u(d.aa,d),_)}function Ua(d){d.D&&(o.clearTimeout(d.D),d.D=null)}Pt.prototype.aa=function(){this.D=null;const d=Date.now();d-this.T>=0?(Z_(this.i,this.B),this.M!=2&&(On(),ft(17)),wr(this),this.m=2,Ir(this)):es(this,this.T-d)};function Ir(d){d.j.I==0||d.K||uy(d.j,d)}function wr(d){Ua(d);var _=d.O;_&&typeof _.dispose=="function"&&_.dispose(),d.O=null,vr(d.V),d.g&&(_=d.g,d.g=null,_.abort(),_.dispose())}function Oa(d,_){try{var y=d.j;if(y.I!=0&&(y.g==d||qa(y.h,d))){if(!d.L&&qa(y.h,d)&&y.I==3){try{var A=y.Ba.g.parse(_)}catch{A=null}if(Array.isArray(A)&&A.length==3){var q=A;if(q[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<d.F)fc(y),dc(y);else break e;yf(y),ft(18)}}else y.xa=q[1],0<y.xa-y.K&&q[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=Tr(u(y.Va,y),6e3));Zu(y.h)<=1&&y.ta&&(y.ta=void 0)}else ls(y,11)}else if((d.L||y.g==d)&&fc(y),!k(_))for(q=y.Ba.g.parse(_),_=0;_<q.length;_++){let je=q[_];const kt=je[0];if(!(kt<=y.K))if(y.K=kt,je=je[1],y.I==2)if(je[0]=="c"){y.M=je[1],y.ba=je[2];const nr=je[3];nr!=null&&(y.ka=nr,y.j.info("VER="+y.ka));const us=je[4];us!=null&&(y.za=us,y.j.info("SVER="+y.za));const Jr=je[5];Jr!=null&&typeof Jr=="number"&&Jr>0&&(A=1.5*Jr,y.O=A,y.j.info("backChannelRequestTimeoutMs_="+A)),A=y;const Qr=d.g;if(Qr){const mc=Qr.g?Qr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(mc){var z=A.h;z.g||mc.indexOf("spdy")==-1&&mc.indexOf("quic")==-1&&mc.indexOf("h2")==-1||(z.j=z.l,z.g=new Set,z.h&&(ts(z,z.h),z.h=null))}if(A.G){const Tf=Qr.g?Qr.g.getResponseHeader("X-HTTP-Session-Id"):null;Tf&&(A.wa=Tf,Ke(A.J,A.G,Tf))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-d.F,y.j.info("Handshake RTT: "+y.T+"ms")),A=y;var re=d;if(A.na=hy(A,A.L?A.ba:null,A.W),re.L){ec(A.h,re);var Ae=re,It=A.O;It&&(Ae.H=It),Ae.D&&(Ua(Ae),ie(Ae)),A.g=re}else ay(A);y.i.length>0&&hc(y)}else je[0]!="stop"&&je[0]!="close"||ls(y,7);else y.I==3&&(je[0]=="stop"||je[0]=="close"?je[0]=="stop"?ls(y,7):_f(y):je[0]!="noop"&&y.l&&y.l.qa(je),y.A=0)}}On(4)}catch{}}var hf=class{constructor(d,_){this.g=d,this.map=_}};function Xu(d){this.l=d||10,o.PerformanceNavigationTiming?(d=o.performance.getEntriesByType("navigation"),d=d.length>0&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ba(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Zu(d){return d.h?1:d.g?d.g.size:0}function qa(d,_){return d.h?d.h==_:d.g?d.g.has(_):!1}function ts(d,_){d.g?d.g.add(_):d.h=_}function ec(d,_){d.h&&d.h==_?d.h=null:d.g&&d.g.has(_)&&d.g.delete(_)}Xu.prototype.cancel=function(){if(this.i=tc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function tc(d){if(d.h!=null)return d.i.concat(d.h.G);if(d.g!=null&&d.g.size!==0){let _=d.i;for(const y of d.g.values())_=_.concat(y.G);return _}return v(d.i)}var Ga=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nc(d,_){if(d){d=d.split("&");for(let y=0;y<d.length;y++){const A=d[y].indexOf("=");let q,z=null;A>=0?(q=d[y].substring(0,A),z=d[y].substring(A+1)):q=d[y],_(q,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function tr(d){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let _;d instanceof tr?(this.l=d.l,ns(this,d.j),this.o=d.o,this.g=d.g,rs(this,d.u),this.h=d.h,za(this,L(d.i)),this.m=d.m):d&&(_=String(d).match(Ga))?(this.l=!1,ns(this,_[1]||"",!0),this.o=is(_[2]||""),this.g=is(_[3]||"",!0),rs(this,_[4]),this.h=is(_[5]||"",!0),za(this,_[6]||"",!0),this.m=is(_[7]||"")):(this.l=!1,this.i=new os(null,this.l))}tr.prototype.toString=function(){const d=[];var _=this.j;_&&d.push(ss(_,rc,!0),":");var y=this.g;return(y||_=="file")&&(d.push("//"),(_=this.o)&&d.push(ss(_,rc,!0),"@"),d.push(Er(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&d.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&d.push("/"),d.push(ss(y,y.charAt(0)=="/"?mf:pf,!0))),(y=this.i.toString())&&d.push("?",y),(y=this.m)&&d.push("#",ss(y,gf)),d.join("")},tr.prototype.resolve=function(d){const _=An(this);let y=!!d.j;y?ns(_,d.j):y=!!d.o,y?_.o=d.o:y=!!d.g,y?_.g=d.g:y=d.u!=null;var A=d.h;if(y)rs(_,d.u);else if(y=!!d.h){if(A.charAt(0)!="/")if(this.g&&!this.h)A="/"+A;else{var q=_.h.lastIndexOf("/");q!=-1&&(A=_.h.slice(0,q+1)+A)}if(q=A,q==".."||q==".")A="";else if(q.indexOf("./")!=-1||q.indexOf("/.")!=-1){A=q.lastIndexOf("/",0)==0,q=q.split("/");const z=[];for(let re=0;re<q.length;){const Ae=q[re++];Ae=="."?A&&re==q.length&&z.push(""):Ae==".."?((z.length>1||z.length==1&&z[0]!="")&&z.pop(),A&&re==q.length&&z.push("")):(z.push(Ae),A=!0)}A=z.join("/")}else A=q}return y?_.h=A:y=d.i.toString()!=="",y?za(_,L(d.i)):y=!!d.m,y&&(_.m=d.m),_};function An(d){return new tr(d)}function ns(d,_,y){d.j=y?is(_,!0):_,d.j&&(d.j=d.j.replace(/:$/,""))}function rs(d,_){if(_){if(_=Number(_),isNaN(_)||_<0)throw Error("Bad port number "+_);d.u=_}else d.u=null}function za(d,_,y){_ instanceof os?(d.i=_,G(d.i,d.l)):(y||(_=ss(_,ic)),d.i=new os(_,d.l))}function Ke(d,_,y){d.i.set(_,y)}function no(d){return Ke(d,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),d}function is(d,_){return d?_?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function ss(d,_,y){return typeof d=="string"?(d=encodeURI(d).replace(_,ff),y&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function ff(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var rc=/[#\/\?@]/g,pf=/[#\?:]/g,mf=/[#\?]/g,ic=/[#\?@]/g,gf=/#/g;function os(d,_){this.h=this.g=null,this.i=d||null,this.j=!!_}function Sr(d){d.g||(d.g=new Map,d.h=0,d.i&&nc(d.i,function(_,y){d.add(decodeURIComponent(_.replace(/\+/g," ")),y)}))}t=os.prototype,t.add=function(d,_){Sr(this),this.i=null,d=U(this,d);let y=this.g.get(d);return y||this.g.set(d,y=[]),y.push(_),this.h+=1,this};function sc(d,_){Sr(d),_=U(d,_),d.g.has(_)&&(d.i=null,d.h-=d.g.get(_).length,d.g.delete(_))}function oc(d,_){return Sr(d),_=U(d,_),d.g.has(_)}t.forEach=function(d,_){Sr(this),this.g.forEach(function(y,A){y.forEach(function(q){d.call(_,q,A,this)},this)},this)};function ac(d,_){Sr(d);let y=[];if(typeof _=="string")oc(d,_)&&(y=y.concat(d.g.get(U(d,_))));else for(d=Array.from(d.g.values()),_=0;_<d.length;_++)y=y.concat(d[_]);return y}t.set=function(d,_){return Sr(this),this.i=null,d=U(this,d),oc(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[_]),this.h+=1,this},t.get=function(d,_){return d?(d=ac(this,d),d.length>0?String(d[0]):_):_};function P(d,_,y){sc(d,_),y.length>0&&(d.i=null,d.g.set(U(d,_),v(y)),d.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],_=Array.from(this.g.keys());for(let A=0;A<_.length;A++){var y=_[A];const q=Er(y);y=ac(this,y);for(let z=0;z<y.length;z++){let re=q;y[z]!==""&&(re+="="+Er(y[z])),d.push(re)}}return this.i=d.join("&")};function L(d){const _=new os;return _.i=d.i,d.g&&(_.g=new Map(d.g),_.h=d.h),_}function U(d,_){return _=String(_),d.j&&(_=_.toLowerCase()),_}function G(d,_){_&&!d.j&&(Sr(d),d.i=null,d.g.forEach(function(y,A){const q=A.toLowerCase();A!=q&&(sc(this,A),P(this,q,y))},d)),d.j=_}function W(d,_){const y=new Yi;if(o.Image){const A=new Image;A.onload=f(K,y,"TestLoadImage: loaded",!0,_,A),A.onerror=f(K,y,"TestLoadImage: error",!1,_,A),A.onabort=f(K,y,"TestLoadImage: abort",!1,_,A),A.ontimeout=f(K,y,"TestLoadImage: timeout",!1,_,A),o.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=d}else _(!1)}function j(d,_){const y=new Yi,A=new AbortController,q=setTimeout(()=>{A.abort(),K(y,"TestPingServer: timeout",!1,_)},1e4);fetch(d,{signal:A.signal}).then(z=>{clearTimeout(q),z.ok?K(y,"TestPingServer: ok",!0,_):K(y,"TestPingServer: server error",!1,_)}).catch(()=>{clearTimeout(q),K(y,"TestPingServer: error",!1,_)})}function K(d,_,y,A,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),A(y)}catch{}}function Z(){this.g=new $u}function ee(d){this.i=d.Sb||null,this.h=d.ab||!1}p(ee,ka),ee.prototype.g=function(){return new ge(this.i,this.h)};function ge(d,_){de.call(this),this.H=d,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(ge,de),t=ge.prototype,t.open=function(d,_){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=d,this.D=_,this.readyState=1,Ve(this)},t.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const _={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};d&&(_.body=d),(this.H||o).fetch(new Request(this.D,_)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ue(this)),this.readyState=0},t.Pa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,Ve(this)),this.g&&(this.readyState=3,Ve(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;te(this)}else d.text().then(this.Oa.bind(this),this.ga.bind(this))};function te(d){d.j.read().then(d.Ma.bind(d)).catch(d.ga.bind(d))}t.Ma=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var _=d.value?d.value:new Uint8Array(0);(_=this.B.decode(_,{stream:!d.done}))&&(this.response=this.responseText+=_)}d.done?Ue(this):Ve(this),this.readyState==3&&te(this)}},t.Oa=function(d){this.g&&(this.response=this.responseText=d,Ue(this))},t.Na=function(d){this.g&&(this.response=d,Ue(this))},t.ga=function(){this.g&&Ue(this)};function Ue(d){d.readyState=4,d.l=null,d.j=null,d.B=null,Ve(d)}t.setRequestHeader=function(d,_){this.A.append(d,_)},t.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],_=this.h.entries();for(var y=_.next();!y.done;)y=y.value,d.push(y[0]+": "+y[1]),y=_.next();return d.join(`\r
`)};function Ve(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(ge.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function qe(d){let _="";return le(d,function(y,A){_+=A,_+=":",_+=y,_+=`\r
`}),_}function Se(d,_,y){e:{for(A in y){var A=!1;break e}A=!0}A||(y=qe(y),typeof d=="string"?y!=null&&Er(y):Ke(d,_,y))}function ye(d){de.call(this),this.headers=new Map,this.L=d||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(ye,de);var as=/^https?$/i,$a=["POST","PUT"];t=ye.prototype,t.Fa=function(d){this.H=d},t.ea=function(d,_,y,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);_=_?_.toUpperCase():"GET",this.D=d,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():eo.g(),this.g.onreadystatechange=g(u(this.Ca,this));try{this.B=!0,this.g.open(_,String(d),!0),this.B=!1}catch(z){lc(this,z);return}if(d=y||"",y=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var q in A)y.set(q,A[q]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const z of A.keys())y.set(z,A.get(z));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(y.keys()).find(z=>z.toLowerCase()=="content-type"),q=o.FormData&&d instanceof o.FormData,!(Array.prototype.indexOf.call($a,_,void 0)>=0)||A||q||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[z,re]of y)this.g.setRequestHeader(z,re);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(d),this.v=!1}catch(z){lc(this,z)}};function lc(d,_){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=_,d.o=5,uc(d),cc(d)}function uc(d){d.A||(d.A=!0,Rt(d,"complete"),Rt(d,"error"))}t.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=d||7,Rt(this,"complete"),Rt(this,"abort"),cc(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cc(this,!0)),ye.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?ty(this):this.Xa())},t.Xa=function(){ty(this)};function ty(d){if(d.h&&typeof s<"u"){if(d.v&&jr(d)==4)setTimeout(d.Ca.bind(d),0);else if(Rt(d,"readystatechange"),jr(d)==4){d.h=!1;try{const z=d.ca();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var y;if(!(y=_)){var A;if(A=z===0){let re=String(d.D).match(Ga)[1]||null;!re&&o.self&&o.self.location&&(re=o.self.location.protocol.slice(0,-1)),A=!as.test(re?re.toLowerCase():"")}y=A}if(y)Rt(d,"complete"),Rt(d,"success");else{d.o=6;try{var q=jr(d)>2?d.g.statusText:""}catch{q=""}d.l=q+" ["+d.ca()+"]",uc(d)}}finally{cc(d)}}}}function cc(d,_){if(d.g){d.m&&(clearTimeout(d.m),d.m=null);const y=d.g;d.g=null,_||Rt(d,"ready");try{y.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function jr(d){return d.g?d.g.readyState:0}t.ca=function(){try{return jr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(d){if(this.g){var _=this.g.responseText;return d&&_.indexOf(d)==0&&(_=_.substring(d.length)),Pa(_)}};function ny(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.F){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function eR(d){const _={};d=(d.g&&jr(d)>=2&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<d.length;A++){if(k(d[A]))continue;var y=ju(d[A]);const q=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const z=_[q]||[];_[q]=z,z.push(y)}pe(_,function(A){return A.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ha(d,_,y){return y&&y.internalChannelParams&&y.internalChannelParams[d]||_}function ry(d){this.za=0,this.i=[],this.j=new Yi,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ha("failFast",!1,d),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ha("baseRetryDelayMs",5e3,d),this.Za=Ha("retryDelaySeedMs",1e4,d),this.Ta=Ha("forwardChannelMaxRetries",2,d),this.va=Ha("forwardChannelRequestTimeoutMs",2e4,d),this.ma=d&&d.xmlHttpFactory||void 0,this.Ua=d&&d.Rb||void 0,this.Aa=d&&d.useFetchStreams||!1,this.O=void 0,this.L=d&&d.supportsCrossDomainXhr||!1,this.M="",this.h=new Xu(d&&d.concurrentRequestLimit),this.Ba=new Z,this.S=d&&d.fastHandshake||!1,this.R=d&&d.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=d&&d.Pb||!1,d&&d.ua&&this.j.ua(),d&&d.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&d&&d.detectBufferingProxy||!1,this.ia=void 0,d&&d.longPollingTimeout&&d.longPollingTimeout>0&&(this.ia=d.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=ry.prototype,t.ka=8,t.I=1,t.connect=function(d,_,y,A){ft(0),this.W=d,this.H=_||{},y&&A!==void 0&&(this.H.OSID=y,this.H.OAID=A),this.F=this.X,this.J=hy(this,null,this.W),hc(this)};function _f(d){if(iy(d),d.I==3){var _=d.V++,y=An(d.J);if(Ke(y,"SID",d.M),Ke(y,"RID",_),Ke(y,"TYPE","terminate"),Wa(d,y),_=new Pt(d,d.j,_),_.M=2,_.A=no(An(y)),y=!1,o.navigator&&o.navigator.sendBeacon)try{y=o.navigator.sendBeacon(_.A.toString(),"")}catch{}!y&&o.Image&&(new Image().src=_.A,y=!0),y||(_.g=fy(_.j,null),_.g.ea(_.A)),_.F=Date.now(),ie(_)}dy(d)}function dc(d){d.g&&(vf(d),d.g.cancel(),d.g=null)}function iy(d){dc(d),d.v&&(o.clearTimeout(d.v),d.v=null),fc(d),d.h.cancel(),d.m&&(typeof d.m=="number"&&o.clearTimeout(d.m),d.m=null)}function hc(d){if(!Ba(d.h)&&!d.m){d.m=!0;var _=d.Ea;O||w(),F||(O(),F=!0),I.add(_,d),d.D=0}}function tR(d,_){return Zu(d.h)>=d.h.j-(d.m?1:0)?!1:d.m?(d.i=_.G.concat(d.i),!0):d.I==1||d.I==2||d.D>=(d.Sa?0:d.Ta)?!1:(d.m=Tr(u(d.Ea,d,_),cy(d,d.D)),d.D++,!0)}t.Ea=function(d){if(this.m)if(this.m=null,this.I==1){if(!d){this.V=Math.floor(Math.random()*1e5),d=this.V++;const q=new Pt(this,this.j,d);let z=this.o;if(this.U&&(z?(z=Pe(z),et(z,this.U)):z=this.U),this.u!==null||this.R||(q.J=z,z=null),this.S)e:{for(var _=0,y=0;y<this.i.length;y++){t:{var A=this.i[y];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(_+=A,_>4096){_=y;break e}if(_===4096||y===this.i.length-1){_=y+1;break e}}_=1e3}else _=1e3;_=oy(this,q,_),y=An(this.J),Ke(y,"RID",d),Ke(y,"CVER",22),this.G&&Ke(y,"X-HTTP-Session-Id",this.G),Wa(this,y),z&&(this.R?_="headers="+Er(qe(z))+"&"+_:this.u&&Se(y,this.u,z)),ts(this.h,q),this.Ra&&Ke(y,"TYPE","init"),this.S?(Ke(y,"$req",_),Ke(y,"SID","null"),q.U=!0,Fa(q,y,null)):Fa(q,y,_),this.I=2}}else this.I==3&&(d?sy(this,d):this.i.length==0||Ba(this.h)||sy(this))};function sy(d,_){var y;_?y=_.l:y=d.V++;const A=An(d.J);Ke(A,"SID",d.M),Ke(A,"RID",y),Ke(A,"AID",d.K),Wa(d,A),d.u&&d.o&&Se(A,d.u,d.o),y=new Pt(d,d.j,y,d.D+1),d.u===null&&(y.J=d.o),_&&(d.i=_.G.concat(d.i)),_=oy(d,y,1e3),y.H=Math.round(d.va*.5)+Math.round(d.va*.5*Math.random()),ts(d.h,y),Fa(y,A,_)}function Wa(d,_){d.H&&le(d.H,function(y,A){Ke(_,A,y)}),d.l&&le({},function(y,A){Ke(_,A,y)})}function oy(d,_,y){y=Math.min(d.i.length,y);const A=d.l?u(d.l.Ka,d.l,d):null;e:{var q=d.i;let Ae=-1;for(;;){const It=["count="+y];Ae==-1?y>0?(Ae=q[0].g,It.push("ofs="+Ae)):Ae=0:It.push("ofs="+Ae);let je=!0;for(let kt=0;kt<y;kt++){var z=q[kt].g;const nr=q[kt].map;if(z-=Ae,z<0)Ae=Math.max(0,q[kt].g-100),je=!1;else try{z="req"+z+"_"||"";try{var re=nr instanceof Map?nr:Object.entries(nr);for(const[us,Jr]of re){let Qr=Jr;a(Jr)&&(Qr=Wi(Jr)),It.push(z+us+"="+encodeURIComponent(Qr))}}catch(us){throw It.push(z+"type="+encodeURIComponent("_badmap")),us}}catch{A&&A(nr)}}if(je){re=It.join("&");break e}}re=void 0}return d=d.i.splice(0,y),_.G=d,re}function ay(d){if(!d.g&&!d.v){d.Y=1;var _=d.Da;O||w(),F||(O(),F=!0),I.add(_,d),d.A=0}}function yf(d){return d.g||d.v||d.A>=3?!1:(d.Y++,d.v=Tr(u(d.Da,d),cy(d,d.A)),d.A++,!0)}t.Da=function(){if(this.v=null,ly(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var d=4*this.T;this.j.info("BP detection timer enabled: "+d),this.B=Tr(u(this.Wa,this),d)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ft(10),dc(this),ly(this))};function vf(d){d.B!=null&&(o.clearTimeout(d.B),d.B=null)}function ly(d){d.g=new Pt(d,d.j,"rpc",d.Y),d.u===null&&(d.g.J=d.o),d.g.P=0;var _=An(d.na);Ke(_,"RID","rpc"),Ke(_,"SID",d.M),Ke(_,"AID",d.K),Ke(_,"CI",d.F?"0":"1"),!d.F&&d.ia&&Ke(_,"TO",d.ia),Ke(_,"TYPE","xmlhttp"),Wa(d,_),d.u&&d.o&&Se(_,d.u,d.o),d.O&&(d.g.H=d.O);var y=d.g;d=d.ba,y.M=1,y.A=no(An(_)),y.u=null,y.R=!0,Qu(y,d)}t.Va=function(){this.C!=null&&(this.C=null,dc(this),yf(this),ft(19))};function fc(d){d.C!=null&&(o.clearTimeout(d.C),d.C=null)}function uy(d,_){var y=null;if(d.g==_){fc(d),vf(d),d.g=null;var A=2}else if(qa(d.h,_))y=_.G,ec(d.h,_),A=1;else return;if(d.I!=0){if(_.o)if(A==1){y=_.u?_.u.length:0,_=Date.now()-_.F;var q=d.D;A=Zs(),Rt(A,new Wu(A,y)),hc(d)}else ay(d);else if(q=_.m,q==3||q==0&&_.X>0||!(A==1&&tR(d,_)||A==2&&yf(d)))switch(y&&y.length>0&&(_=d.h,_.i=_.i.concat(y)),q){case 1:ls(d,5);break;case 4:ls(d,10);break;case 3:ls(d,6);break;default:ls(d,2)}}}function cy(d,_){let y=d.Qa+Math.floor(Math.random()*d.Za);return d.isActive()||(y*=2),y*_}function ls(d,_){if(d.j.info("Error code "+_),_==2){var y=u(d.bb,d),A=d.Ua;const q=!A;A=new tr(A||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ns(A,"https"),no(A),q?W(A.toString(),y):j(A.toString(),y)}else ft(2);d.I=0,d.l&&d.l.pa(_),dy(d),iy(d)}t.bb=function(d){d?(this.j.info("Successfully pinged google.com"),ft(2)):(this.j.info("Failed to ping google.com"),ft(1))};function dy(d){if(d.I=0,d.ja=[],d.l){const _=tc(d.h);(_.length!=0||d.i.length!=0)&&(T(d.ja,_),T(d.ja,d.i),d.h.i.length=0,v(d.i),d.i.length=0),d.l.oa()}}function hy(d,_,y){var A=y instanceof tr?An(y):new tr(y);if(A.g!="")_&&(A.g=_+"."+A.g),rs(A,A.u);else{var q=o.location;A=q.protocol,_=_?_+"."+q.hostname:q.hostname,q=+q.port;const z=new tr(null);A&&ns(z,A),_&&(z.g=_),q&&rs(z,q),y&&(z.h=y),A=z}return y=d.G,_=d.wa,y&&_&&Ke(A,y,_),Ke(A,"VER",d.ka),Wa(d,A),A}function fy(d,_,y){if(_&&!d.L)throw Error("Can't create secondary domain capable XhrIo object.");return _=d.Aa&&!d.ma?new ye(new ee({ab:y})):new ye(d.ma),_.Fa(d.L),_}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function py(){}t=py.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function pc(){}pc.prototype.g=function(d,_){return new mn(d,_)};function mn(d,_){de.call(this),this.g=new ry(_),this.l=d,this.h=_&&_.messageUrlParams||null,d=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(d?d["X-WebChannel-Content-Type"]=_.messageContentType:d={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.sa&&(d?d["X-WebChannel-Client-Profile"]=_.sa:d={"X-WebChannel-Client-Profile":_.sa}),this.g.U=d,(d=_&&_.Qb)&&!k(d)&&(this.g.u=d),this.A=_&&_.supportsCrossDomainXhr||!1,this.v=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!k(_)&&(this.g.G=_,d=this.h,d!==null&&_ in d&&(d=this.h,_ in d&&delete d[_])),this.j=new ro(this)}p(mn,de),mn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){_f(this.g)},mn.prototype.o=function(d){var _=this.g;if(typeof d=="string"){var y={};y.__data__=d,d=y}else this.v&&(y={},y.__data__=Wi(d),d=y);_.i.push(new hf(_.Ya++,d)),_.I==3&&hc(_)},mn.prototype.N=function(){this.g.l=null,delete this.j,_f(this.g),delete this.g,mn.Z.N.call(this)};function my(d){Na.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var _=d.__sm__;if(_){e:{for(const y in _){d=y;break e}d=void 0}(this.i=d)&&(d=this.i,_=_!==null&&d in _?_[d]:void 0),this.data=_}else this.data=d}p(my,Na);function gy(){ji.call(this),this.status=1}p(gy,ji);function ro(d){this.g=d}p(ro,py),ro.prototype.ra=function(){Rt(this.g,"a")},ro.prototype.qa=function(d){Rt(this.g,new my(d))},ro.prototype.pa=function(d){Rt(this.g,new gy)},ro.prototype.oa=function(){Rt(this.g,"b")},pc.prototype.createWebChannel=pc.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,V0=function(){return new pc},M0=function(){return Zs()},b0=pn,ym={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ma.NO_ERROR=0,Ma.TIMEOUT=8,Ma.HTTP_ERROR=6,sd=Ma,Ku.COMPLETE="complete",D0=Ku,Hu.EventType=Ki,Ki.OPEN="a",Ki.CLOSE="b",Ki.ERROR="c",Ki.MESSAGE="d",de.prototype.listen=de.prototype.J,fl=Hu,ye.prototype.listenOnce=ye.prototype.K,ye.prototype.getLastError=ye.prototype.Ha,ye.prototype.getLastErrorCode=ye.prototype.ya,ye.prototype.getStatus=ye.prototype.ca,ye.prototype.getResponseJson=ye.prototype.La,ye.prototype.getResponseText=ye.prototype.la,ye.prototype.send=ye.prototype.ea,ye.prototype.setWithCredentials=ye.prototype.Fa,N0=ye}).apply(typeof Mc<"u"?Mc:typeof self<"u"?self:typeof window<"u"?window:{});const TE="@firebase/firestore",EE="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Vt.UNAUTHENTICATED=new Vt(null),Vt.GOOGLE_CREDENTIALS=new Vt("google-credentials-uid"),Vt.FIRST_PARTY=new Vt("first-party-uid"),Vt.MOCK_USER=new Vt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sa="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki=new jg("@firebase/firestore");function ho(){return ki.logLevel}function L0(t){ki.setLogLevel(t)}function Y(t,...e){if(ki.logLevel<=De.DEBUG){const n=e.map(a_);ki.debug(`Firestore (${Sa}): ${t}`,...n)}}function Yt(t,...e){if(ki.logLevel<=De.ERROR){const n=e.map(a_);ki.error(`Firestore (${Sa}): ${t}`,...n)}}function Ni(t,...e){if(ki.logLevel<=De.WARN){const n=e.map(a_);ki.warn(`Firestore (${Sa}): ${t}`,...n)}}function a_(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,F0(t,r,n)}function F0(t,e,n){let r=`FIRESTORE (${Sa}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Yt(r),new Error(r)}function fe(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||F0(e,i,r)}function Ee(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ne extends Hr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class O0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Vt.UNAUTHENTICATED))}shutdown(){}}class XF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class ZF{constructor(e){this.t=e,this.currentUser=Vt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){fe(this.o===void 0,42304);let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new fr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new fr,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{Y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Y("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new fr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(Y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(fe(typeof r.accessToken=="string",31837,{l:r}),new U0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return fe(e===null||typeof e=="string",2055,{h:e}),new Vt(e)}}class eU{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Vt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tU{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new eU(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(Vt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class IE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nU{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Hn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){fe(this.o===void 0,3512);const r=s=>{s.error!=null&&Y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,Y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{Y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):Y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new IE(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(fe(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new IE(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rU(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=rU(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%62))}return r}}function Te(t,e){return t<e?-1:t>e?1:0}function vm(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),s=e.charAt(r);if(i!==s)return tp(i)===tp(s)?Te(i,s):tp(i)?1:-1}return Te(t.length,e.length)}const iU=55296,sU=57343;function tp(t){const e=t.charCodeAt(0);return e>=iU&&e<=sU}function ta(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function B0(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE="__name__";class or{constructor(e,n,r){n===void 0?n=0:n>e.length&&ce(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&ce(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return or.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof or?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=or.compareSegments(e.get(i),n.get(i));if(s!==0)return s}return Te(e.length,n.length)}static compareSegments(e,n){const r=or.isNumericId(e),i=or.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?or.extractNumericId(e).compare(or.extractNumericId(n)):vm(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Si.fromString(e.substring(4,e.length-2))}}class Ge extends or{construct(e,n,r){return new Ge(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ne(H.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Ge(n)}static emptyPath(){return new Ge([])}}const oU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class it extends or{construct(e,n,r){return new it(e,n,r)}static isValidIdentifier(e){return oU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),it.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wE}static keyField(){return new it([wE])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new ne(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new ne(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ne(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new ne(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new it(n)}static emptyPath(){return new it([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(Ge.fromString(e))}static fromName(e){return new se(Ge.fromString(e).popFirst(5))}static empty(){return new se(Ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ge.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new Ge(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q0(t,e,n){if(!n)throw new ne(H.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function G0(t,e,n,r){if(e===!0&&r===!0)throw new ne(H.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function SE(t){if(!se.isDocumentKey(t))throw new ne(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function CE(t){if(se.isDocumentKey(t))throw new ne(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function z0(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Gh(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ce(12329,{type:typeof t})}function en(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ne(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Gh(t);throw new ne(H.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(t,e){const n={typeString:t};return e&&(n.value=e),n}function Ru(t,e){if(!z0(t))throw new ne(H.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new ne(H.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE=-62135596800,xE=1e6;class ze{static now(){return ze.fromMillis(Date.now())}static fromDate(e){return ze.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*xE);return new ze(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ne(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ne(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<AE)throw new ne(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ne(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xE}_compareTo(e){return this.seconds===e.seconds?Te(this.nanoseconds,e.nanoseconds):Te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ze._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ru(e,ze._jsonSchema))return new ze(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-AE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ze._jsonSchemaVersion="firestore/timestamp/1.0",ze._jsonSchema={type:Tt("string",ze._jsonSchemaVersion),seconds:Tt("number"),nanoseconds:Tt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{static fromTimestamp(e){return new me(e)}static min(){return new me(new ze(0,0))}static max(){return new me(new ze(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=-1;class Zd{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}}function Tm(t){return t.fields.find(e=>e.kind===2)}function ps(t){return t.fields.filter(e=>e.kind!==2)}Zd.UNKNOWN_ID=-1;class od{constructor(e,n){this.fieldPath=e,this.kind=n}}class ou{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new ou(0,wn.min())}}function aU(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=me.fromTimestamp(r===1e9?new ze(n+1,0):new ze(n,r));return new wn(i,se.empty(),e)}function $0(t){return new wn(t.readTime,t.key,su)}class wn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wn(me.min(),se.empty(),su)}static max(){return new wn(me.max(),se.empty(),su)}}function l_(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=se.comparator(t.documentKey,e.documentKey),n!==0?n:Te(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class W0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Js(t){if(t.code!==H.FAILED_PRECONDITION||t.message!==H0)throw t;Y("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ce(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new B((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof B?n:B.resolve(n)}catch(n){return B.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):B.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):B.reject(n)}static resolve(e){return new B((n,r)=>{n(e)})}static reject(e){return new B((n,r)=>{r(e)})}static waitFor(e){return new B((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},l=>r(l))}),o=!0,s===i&&n()})}static or(e){let n=B.resolve(!1);for(const r of e)n=n.next(i=>i?B.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new B((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const u=l;n(e[u]).next(f=>{o[u]=f,++a,a===s&&r(o)},f=>i(f))}})}static doWhile(e,n){return new B((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n="SimpleDb";class zh{static open(e,n,r,i){try{return new zh(n,e.transaction(i,r))}catch(s){throw new kl(n,s)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new fr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new kl(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const i=u_(r.target.error);this.S.reject(new kl(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Y(_n,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new uU(n)}}class Ci{static delete(e){return Y(_n,"Removing database:",e),_s(FC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!WC())return!1;if(Ci.F())return!0;const e=Ct(),n=Ci.M(e),r=0<n&&n<10,i=K0(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,Ci.M(Ct())===12.2&&Yt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Y(_n,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const o=s.target.result;n(o)},i.onblocked=()=>{r(new kl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const o=s.target.error;o.name==="VersionError"?r(new ne(H.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ne(H.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new kl(e,o))},i.onupgradeneeded=s=>{Y(_n,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.N.k(o,i.transaction,s.oldVersion,this.version).next(()=>{Y(_n,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,i){const s=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=zh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),B.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(Y(_n,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function K0(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class lU{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return _s(this.U.delete())}}class kl extends ne{constructor(e,n){super(H.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function qi(t){return t.name==="IndexedDbTransactionError"}class uU{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(Y(_n,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(Y(_n,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),_s(r)}add(e){return Y(_n,"ADD",this.store.name,e,e),_s(this.store.add(e))}get(e){return _s(this.store.get(e)).next(n=>(n===void 0&&(n=null),Y(_n,"GET",this.store.name,e,n),n))}delete(e){return Y(_n,"DELETE",this.store.name,e),_s(this.store.delete(e))}count(){return Y(_n,"COUNT",this.store.name),_s(this.store.count())}J(e,n){const r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const s=i.getAll(r.range);return new B((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}{const s=this.cursor(r),o=[];return this.H(s,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new B((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Z(e,n){Y(_n,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const i=this.cursor(r);return this.H(i,(s,o,a)=>a.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const i=this.cursor(r);return this.H(i,n)}te(e){const n=this.cursor({});return new B((r,i)=>{n.onerror=s=>{const o=u_(s.target.error);i(o)},n.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new B((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const l=new lU(a),u=n(a.primaryKey,a.value,l);if(u instanceof B){const f=u.catch(p=>(l.done(),B.reject(p)));r.push(f)}l.isDone?i():l.G===null?a.continue():a.continue(l.G)}}).next(()=>B.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function _s(t){return new B((e,n)=>{t.onsuccess=r=>{const i=r.target.result;e(i)},t.onerror=r=>{const i=u_(r.target.error);n(i)}})}let RE=!1;function u_(t){const e=Ci.M(Ct());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ne("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return RE||(RE=!0,setTimeout(()=>{throw r},0)),r}}return t}const Nl="IndexBackfiller";class cU{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Y(Nl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();Y(Nl,`Documents written: ${n}`)}catch(n){qi(n)?Y(Nl,"Ignoring IndexedDB error during index backfill: ",n):await Js(n)}await this.re(6e4)})}}class dU{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let i=n,s=!0;return B.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Y(Nl,`Processing collection: ${o}`),this.oe(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>n-i)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(i,s)).next(a=>(Y(Nl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((i,s)=>{const o=$0(s);l_(o,r)>0&&(r=o)}),new wn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Nn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps=-1;function $h(t){return t==null}function au(t){return t===0&&1/t==-1/0}function hU(t){return typeof t=="number"&&Number.isInteger(t)&&!au(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh="";function Wt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=PE(e)),e=fU(t.get(n),e);return PE(e)}function fU(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case eh:n+="";break;default:n+=s}}return n}function PE(t){return t+eh+""}function lr(t){const e=t.length;if(fe(e>=2,64408,{path:t}),e===2)return fe(t.charAt(0)===eh&&t.charAt(1)==="",56145,{path:t}),Ge.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const o=t.indexOf(eh,s);switch((o<0||o>n)&&ce(50515,{path:t}),t.charAt(o+1)){case"":const a=t.substring(s,o);let l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=t.substring(s,o),i+="\0";break;case"":i+=t.substring(s,o+1);break;default:ce(61167,{path:t})}s=o+2}return new Ge(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms="remoteDocuments",Pu="owner",so="owner",lu="mutationQueues",pU="userId",zn="mutations",kE="batchId",Cs="userMutationsIndex",NE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(t,e){return[t,Wt(e)]}function j0(t,e,n){return[t,Wt(e),n]}const mU={},na="documentMutations",th="remoteDocumentsV14",gU=["prefixPath","collectionGroup","readTime","documentId"],ld="documentKeyIndex",_U=["prefixPath","collectionGroup","documentId"],J0="collectionGroupIndex",yU=["collectionGroup","readTime","prefixPath","documentId"],uu="remoteDocumentGlobal",Em="remoteDocumentGlobalKey",ra="targets",Q0="queryTargetsIndex",vU=["canonicalId","targetId"],ia="targetDocuments",TU=["targetId","path"],c_="documentTargetsIndex",EU=["path","targetId"],nh="targetGlobalKey",ks="targetGlobal",cu="collectionParents",IU=["collectionId","parent"],sa="clientMetadata",wU="clientId",Hh="bundles",SU="bundleId",Wh="namedQueries",CU="name",d_="indexConfiguration",AU="indexId",Im="collectionGroupIndex",xU="collectionGroup",Dl="indexState",RU=["indexId","uid"],Y0="sequenceNumberIndex",PU=["uid","sequenceNumber"],bl="indexEntries",kU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],X0="documentKeyIndex",NU=["indexId","uid","orderedDocumentKey"],Kh="documentOverlays",DU=["userId","collectionPath","documentId"],wm="collectionPathOverlayIndex",bU=["userId","collectionPath","largestBatchId"],Z0="collectionGroupOverlayIndex",MU=["userId","collectionGroup","largestBatchId"],h_="globals",VU="name",eA=[lu,zn,na,ms,ra,Pu,ks,ia,sa,uu,cu,Hh,Wh],LU=[...eA,Kh],tA=[lu,zn,na,th,ra,Pu,ks,ia,sa,uu,cu,Hh,Wh,Kh],nA=tA,f_=[...nA,d_,Dl,bl],FU=f_,rA=[...f_,h_],UU=rA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm extends W0{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function xt(t,e){const n=Ee(t);return Ci.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DE(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function iA(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e,n){this.comparator=e,this.root=n||Lt.EMPTY}insert(e,n){return new st(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Lt.BLACK,null,null))}remove(e){return new st(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Lt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vc(this.root,e,this.comparator,!0)}}class Vc{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Lt{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Lt.RED,this.left=i??Lt.EMPTY,this.right=s??Lt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new Lt(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Lt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Lt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Lt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Lt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ce(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ce(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ce(27949);return e+(this.isRed()?0:1)}}Lt.EMPTY=null,Lt.RED=!0,Lt.BLACK=!1;Lt.EMPTY=new class{constructor(){this.size=0}get key(){throw ce(57766)}get value(){throw ce(16141)}get color(){throw ce(16727)}get left(){throw ce(29726)}get right(){throw ce(36894)}copy(e,n,r,i,s){return this}insert(e,n,r){return new Lt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e){this.comparator=e,this.data=new st(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new bE(this.data.getIterator())}getIteratorFrom(e){return new bE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof We)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new We(this.comparator);return n.data=e,n}}class bE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function oo(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.fields=e,e.sort(it.comparator)}static empty(){return new un([])}unionWith(e){let n=new We(it.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new un(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ta(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new sA("Invalid base64 string: "+s):s}}(e);return new gt(n)}static fromUint8Array(e){const n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new gt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const OU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qr(t){if(fe(!!t,39018),typeof t=="string"){let e=0;const n=OU.exec(t);if(fe(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:nt(t.seconds),nanos:nt(t.nanos)}}function nt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Gr(t){return typeof t=="string"?gt.fromBase64String(t):gt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oA="server_timestamp",aA="__type__",lA="__previous_value__",uA="__local_write_time__";function p_(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[aA])==null?void 0:r.stringValue)===oA}function jh(t){const e=t.mapValue.fields[lA];return p_(e)?jh(e):e}function du(t){const e=qr(t.mapValue.fields[uA].timestampValue);return new ze(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{constructor(e,n,r,i,s,o,a,l,u,f){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=f}}const rh="(default)";class Di{constructor(e,n){this.projectId=e,this.database=n||rh}static empty(){return new Di("","")}get isDefaultDatabase(){return this.database===rh}isEqual(e){return e instanceof Di&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_="__type__",cA="__max__",hi={mapValue:{fields:{__type__:{stringValue:cA}}}},g_="__vector__",oa="value",ud={nullValue:"NULL_VALUE"};function bi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?p_(t)?4:dA(t)?9007199254740991:Jh(t)?10:11:ce(28295,{value:t})}function mr(t,e){if(t===e)return!0;const n=bi(t);if(n!==bi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return du(t).isEqual(du(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=qr(i.timestampValue),a=qr(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return Gr(i.bytesValue).isEqual(Gr(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return nt(i.geoPointValue.latitude)===nt(s.geoPointValue.latitude)&&nt(i.geoPointValue.longitude)===nt(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return nt(i.integerValue)===nt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=nt(i.doubleValue),a=nt(s.doubleValue);return o===a?au(o)===au(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return ta(t.arrayValue.values||[],e.arrayValue.values||[],mr);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(DE(o)!==DE(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!mr(o[l],a[l])))return!1;return!0}(t,e);default:return ce(52216,{left:t})}}function hu(t,e){return(t.values||[]).find(n=>mr(n,e))!==void 0}function Mi(t,e){if(t===e)return 0;const n=bi(t),r=bi(e);if(n!==r)return Te(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Te(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=nt(s.integerValue||s.doubleValue),l=nt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return ME(t.timestampValue,e.timestampValue);case 4:return ME(du(t),du(e));case 5:return vm(t.stringValue,e.stringValue);case 6:return function(s,o){const a=Gr(s),l=Gr(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const f=Te(a[u],l[u]);if(f!==0)return f}return Te(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=Te(nt(s.latitude),nt(o.latitude));return a!==0?a:Te(nt(s.longitude),nt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return VE(t.arrayValue,e.arrayValue);case 10:return function(s,o){var g,v,T,x;const a=s.fields||{},l=o.fields||{},u=(g=a[oa])==null?void 0:g.arrayValue,f=(v=l[oa])==null?void 0:v.arrayValue,p=Te(((T=u==null?void 0:u.values)==null?void 0:T.length)||0,((x=f==null?void 0:f.values)==null?void 0:x.length)||0);return p!==0?p:VE(u,f)}(t.mapValue,e.mapValue);case 11:return function(s,o){if(s===hi.mapValue&&o===hi.mapValue)return 0;if(s===hi.mapValue)return 1;if(o===hi.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),u=o.fields||{},f=Object.keys(u);l.sort(),f.sort();for(let p=0;p<l.length&&p<f.length;++p){const g=vm(l[p],f[p]);if(g!==0)return g;const v=Mi(a[l[p]],u[f[p]]);if(v!==0)return v}return Te(l.length,f.length)}(t.mapValue,e.mapValue);default:throw ce(23264,{he:n})}}function ME(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Te(t,e);const n=qr(t),r=qr(e),i=Te(n.seconds,r.seconds);return i!==0?i:Te(n.nanos,r.nanos)}function VE(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=Mi(n[i],r[i]);if(s)return s}return Te(n.length,r.length)}function aa(t){return Cm(t)}function Cm(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=qr(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Gr(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return se.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=Cm(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Cm(n.fields[o])}`;return i+"}"}(t.mapValue):ce(61005,{value:t})}function cd(t){switch(bi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=jh(t);return e?16+cd(e):16;case 5:return 2*t.stringValue.length;case 6:return Gr(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+cd(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Gi(r.fields,(s,o)=>{i+=s.length+cd(o)}),i}(t.mapValue);default:throw ce(13486,{value:t})}}function fu(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Am(t){return!!t&&"integerValue"in t}function pu(t){return!!t&&"arrayValue"in t}function LE(t){return!!t&&"nullValue"in t}function FE(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function dd(t){return!!t&&"mapValue"in t}function Jh(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[m_])==null?void 0:r.stringValue)===g_}function Ml(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Gi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ml(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ml(t.arrayValue.values[n]);return e}return{...t}}function dA(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===cA}const hA={mapValue:{fields:{[m_]:{stringValue:g_},[oa]:{arrayValue:{}}}}};function qU(t){return"nullValue"in t?ud:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?fu(Di.empty(),se.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?Jh(t)?hA:{mapValue:{}}:ce(35942,{value:t})}function GU(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?fu(Di.empty(),se.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?hA:"mapValue"in t?Jh(t)?{mapValue:{}}:hi:ce(61959,{value:t})}function UE(t,e){const n=Mi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function OE(t,e){const n=Mi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.value=e}static empty(){return new $t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!dd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ml(n)}setAll(e){let n=it.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Ml(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());dd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return mr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];dd(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Gi(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new $t(Ml(this.value))}}function fA(t){const e=[];return Gi(t.fields,(n,r)=>{const i=new it([n]);if(dd(r)){const s=fA(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new un(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ht(e,0,me.min(),me.min(),me.min(),$t.empty(),0)}static newFoundDocument(e,n,r,i){return new ht(e,1,n,me.min(),r,i,0)}static newNoDocument(e,n){return new ht(e,2,n,me.min(),me.min(),$t.empty(),0)}static newUnknownDocument(e,n){return new ht(e,3,n,me.min(),me.min(),$t.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ht&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ht(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,n){this.position=e,this.inclusive=n}}function BE(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),n.key):r=Mi(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function qE(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!mr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,n="asc"){this.field=e,this.dir=n}}function zU(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{}class be extends pA{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new $U(e,n,r):n==="array-contains"?new KU(e,r):n==="in"?new TA(e,r):n==="not-in"?new jU(e,r):n==="array-contains-any"?new JU(e,r):new be(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new HU(e,r):new WU(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Mi(n,this.value)):n!==null&&bi(this.value)===bi(n)&&this.matchesComparison(Mi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ce(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $e extends pA{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new $e(e,n)}matches(e){return ua(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ua(t){return t.op==="and"}function xm(t){return t.op==="or"}function __(t){return mA(t)&&ua(t)}function mA(t){for(const e of t.filters)if(e instanceof $e)return!1;return!0}function Rm(t){if(t instanceof be)return t.field.canonicalString()+t.op.toString()+aa(t.value);if(__(t))return t.filters.map(e=>Rm(e)).join(",");{const e=t.filters.map(n=>Rm(n)).join(",");return`${t.op}(${e})`}}function gA(t,e){return t instanceof be?function(r,i){return i instanceof be&&r.op===i.op&&r.field.isEqual(i.field)&&mr(r.value,i.value)}(t,e):t instanceof $e?function(r,i){return i instanceof $e&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&gA(o,i.filters[a]),!0):!1}(t,e):void ce(19439)}function _A(t,e){const n=t.filters.concat(e);return $e.create(n,t.op)}function yA(t){return t instanceof be?function(n){return`${n.field.canonicalString()} ${n.op} ${aa(n.value)}`}(t):t instanceof $e?function(n){return n.op.toString()+" {"+n.getFilters().map(yA).join(" ,")+"}"}(t):"Filter"}class $U extends be{constructor(e,n,r){super(e,n,r),this.key=se.fromName(r.referenceValue)}matches(e){const n=se.comparator(e.key,this.key);return this.matchesComparison(n)}}class HU extends be{constructor(e,n){super(e,"in",n),this.keys=vA("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class WU extends be{constructor(e,n){super(e,"not-in",n),this.keys=vA("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function vA(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>se.fromName(r.referenceValue))}class KU extends be{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return pu(n)&&hu(n.arrayValue,this.value)}}class TA extends be{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&hu(this.value.arrayValue,n)}}class jU extends be{constructor(e,n){super(e,"not-in",n)}matches(e){if(hu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!hu(this.value.arrayValue,n)}}class JU extends be{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!pu(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>hu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Te=null}}function Pm(t,e=null,n=[],r=[],i=null,s=null,o=null){return new QU(t,e,n,r,i,s,o)}function qs(t){const e=Ee(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Rm(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),$h(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>aa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>aa(r)).join(",")),e.Te=n}return e.Te}function ku(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!zU(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!gA(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!qE(t.startAt,e.startAt)&&qE(t.endAt,e.endAt)}function sh(t){return se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function oh(t,e){return t.filters.filter(n=>n instanceof be&&n.field.isEqual(e))}function GE(t,e,n){let r=ud,i=!0;for(const s of oh(t,e)){let o=ud,a=!0;switch(s.op){case"<":case"<=":o=qU(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=ud}UE({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];UE({value:r,inclusive:i},{value:o,inclusive:n.inclusive})<0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}function zE(t,e,n){let r=hi,i=!0;for(const s of oh(t,e)){let o=hi,a=!0;switch(s.op){case">=":case">":o=GU(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=hi}OE({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];OE({value:r,inclusive:i},{value:o,inclusive:n.inclusive})>0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function YU(t,e,n,r,i,s,o,a){return new Nu(t,e,n,r,i,s,o,a)}function Du(t){return new Nu(t)}function $E(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function EA(t){return t.collectionGroup!==null}function Vl(t){const e=Ee(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new We(it.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new ih(s,r))}),n.has(it.keyField().canonicalString())||e.Ie.push(new ih(it.keyField(),r))}return e.Ie}function Mn(t){const e=Ee(t);return e.Ee||(e.Ee=XU(e,Vl(t))),e.Ee}function XU(t,e){if(t.limitType==="F")return Pm(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new ih(i.field,s)});const n=t.endAt?new la(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new la(t.startAt.position,t.startAt.inclusive):null;return Pm(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function km(t,e){const n=t.filters.concat([e]);return new Nu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Nm(t,e,n){return new Nu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Qh(t,e){return ku(Mn(t),Mn(e))&&t.limitType===e.limitType}function IA(t){return`${qs(Mn(t))}|lt:${t.limitType}`}function fo(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>yA(i)).join(", ")}]`),$h(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>aa(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>aa(i)).join(",")),`Target(${r})`}(Mn(t))}; limitType=${t.limitType})`}function bu(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):se.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of Vl(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,l){const u=BE(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Vl(r),i)||r.endAt&&!function(o,a,l){const u=BE(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Vl(r),i))}(t,e)}function ZU(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function wA(t){return(e,n)=>{let r=!1;for(const i of Vl(t)){const s=e4(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function e4(t,e,n){const r=t.field.isKeyField()?se.comparator(e.key,n.key):function(s,o,a){const l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?Mi(l,u):ce(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ce(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Gi(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return iA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4=new st(se.comparator);function Tn(){return t4}const SA=new st(se.comparator);function pl(...t){let e=SA;for(const n of t)e=e.insert(n.key,n);return e}function CA(t){let e=SA;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ur(){return Ll()}function AA(){return Ll()}function Ll(){return new Wr(t=>t.toString(),(t,e)=>t.isEqual(e))}const n4=new st(se.comparator),r4=new We(se.comparator);function Re(...t){let e=r4;for(const n of t)e=e.add(n);return e}const i4=new We(Te);function s4(){return i4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:au(e)?"-0":e}}function xA(t){return{integerValue:""+t}}function o4(t,e){return hU(e)?xA(e):y_(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(){this._=void 0}}function a4(t,e,n){return t instanceof ca?function(i,s){const o={fields:{[aA]:{stringValue:oA},[uA]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&p_(s)&&(s=jh(s)),s&&(o.fields[lA]=s),{mapValue:o}}(n,e):t instanceof da?PA(t,e):t instanceof ha?kA(t,e):function(i,s){const o=RA(i,s),a=HE(o)+HE(i.Ae);return Am(o)&&Am(i.Ae)?xA(a):y_(i.serializer,a)}(t,e)}function l4(t,e,n){return t instanceof da?PA(t,e):t instanceof ha?kA(t,e):n}function RA(t,e){return t instanceof mu?function(r){return Am(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class ca extends Yh{}class da extends Yh{constructor(e){super(),this.elements=e}}function PA(t,e){const n=NA(e);for(const r of t.elements)n.some(i=>mr(i,r))||n.push(r);return{arrayValue:{values:n}}}class ha extends Yh{constructor(e){super(),this.elements=e}}function kA(t,e){let n=NA(e);for(const r of t.elements)n=n.filter(i=>!mr(i,r));return{arrayValue:{values:n}}}class mu extends Yh{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function HE(t){return nt(t.integerValue||t.doubleValue)}function NA(t){return pu(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(e,n){this.field=e,this.transform=n}}function u4(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof da&&i instanceof da||r instanceof ha&&i instanceof ha?ta(r.elements,i.elements,mr):r instanceof mu&&i instanceof mu?mr(r.Ae,i.Ae):r instanceof ca&&i instanceof ca}(t.transform,e.transform)}class c4{constructor(e,n){this.version=e,this.transformResults=n}}class Xt{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Xt}static exists(e){return new Xt(void 0,e)}static updateTime(e){return new Xt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Xh{}function bA(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Zh(t.key,Xt.none()):new Ca(t.key,t.data,Xt.none());{const n=t.data,r=$t.empty();let i=new We(it.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Kr(t.key,r,new un(i.toArray()),Xt.none())}}function d4(t,e,n){t instanceof Ca?function(i,s,o){const a=i.value.clone(),l=KE(i.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Kr?function(i,s,o){if(!hd(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=KE(i.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(MA(i)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Fl(t,e,n,r){return t instanceof Ca?function(s,o,a,l){if(!hd(s.precondition,o))return a;const u=s.value.clone(),f=jE(s.fieldTransforms,l,o);return u.setAll(f),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Kr?function(s,o,a,l){if(!hd(s.precondition,o))return a;const u=jE(s.fieldTransforms,l,o),f=o.data;return f.setAll(MA(s)),f.setAll(u),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(t,e,n,r):function(s,o,a){return hd(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function h4(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=RA(r.transform,i||null);s!=null&&(n===null&&(n=$t.empty()),n.set(r.field,s))}return n||null}function WE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ta(r,i,(s,o)=>u4(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ca extends Xh{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Kr extends Xh{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function MA(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function KE(t,e,n){const r=new Map;fe(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,l4(o,a,n[i]))}return r}function jE(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,a4(s,o,e))}return r}class Zh extends Xh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class VA extends Xh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&d4(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Fl(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Fl(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=AA();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const l=bA(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(me.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Re())}isEqual(e){return this.batchId===e.batchId&&ta(this.mutations,e.mutations,(n,r)=>WE(n,r))&&ta(this.baseMutations,e.baseMutations,(n,r)=>WE(n,r))}}class T_{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){fe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return n4}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new T_(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t,Le;function p4(t){switch(t){case H.OK:return ce(64938);case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0;default:return ce(15467,{code:t})}}function LA(t){if(t===void 0)return Yt("GRPC error has no .code"),H.UNKNOWN;switch(t){case _t.OK:return H.OK;case _t.CANCELLED:return H.CANCELLED;case _t.UNKNOWN:return H.UNKNOWN;case _t.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case _t.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case _t.INTERNAL:return H.INTERNAL;case _t.UNAVAILABLE:return H.UNAVAILABLE;case _t.UNAUTHENTICATED:return H.UNAUTHENTICATED;case _t.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case _t.NOT_FOUND:return H.NOT_FOUND;case _t.ALREADY_EXISTS:return H.ALREADY_EXISTS;case _t.PERMISSION_DENIED:return H.PERMISSION_DENIED;case _t.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case _t.ABORTED:return H.ABORTED;case _t.OUT_OF_RANGE:return H.OUT_OF_RANGE;case _t.UNIMPLEMENTED:return H.UNIMPLEMENTED;case _t.DATA_LOSS:return H.DATA_LOSS;default:return ce(39323,{code:t})}}(Le=_t||(_t={}))[Le.OK=0]="OK",Le[Le.CANCELLED=1]="CANCELLED",Le[Le.UNKNOWN=2]="UNKNOWN",Le[Le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Le[Le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Le[Le.NOT_FOUND=5]="NOT_FOUND",Le[Le.ALREADY_EXISTS=6]="ALREADY_EXISTS",Le[Le.PERMISSION_DENIED=7]="PERMISSION_DENIED",Le[Le.UNAUTHENTICATED=16]="UNAUTHENTICATED",Le[Le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Le[Le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Le[Le.ABORTED=10]="ABORTED",Le[Le.OUT_OF_RANGE=11]="OUT_OF_RANGE",Le[Le.UNIMPLEMENTED=12]="UNIMPLEMENTED",Le[Le.INTERNAL=13]="INTERNAL",Le[Le.UNAVAILABLE=14]="UNAVAILABLE",Le[Le.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=new Si([4294967295,4294967295],0);function JE(t){const e=m4().encode(t),n=new k0;return n.update(e),new Uint8Array(n.digest())}function QE(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Si([n,r],0),new Si([i,s],0)]}class I_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ml(`Invalid padding: ${n}`);if(r<0)throw new ml(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ml(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ml(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Si.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(Si.fromNumber(r)));return i.compare(g4)===1&&(i=new Si([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=JE(e),[r,i]=QE(n);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);if(!this.we(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new I_(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const n=JE(e),[r,i]=QE(n);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class ml extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Mu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new ef(me.min(),i,new st(Te),Tn(),Re())}}class Mu{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Mu(r,n,Re(),Re(),Re())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class FA{constructor(e,n){this.targetId=e,this.Ce=n}}class UA{constructor(e,n,r=gt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class YE{constructor(){this.ve=0,this.Fe=XE(),this.Me=gt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Re(),n=Re(),r=Re();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:ce(38017,{changeType:s})}}),new Mu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=XE()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,fe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class _4{constructor(e){this.Ge=e,this.ze=new Map,this.je=Tn(),this.Je=Lc(),this.He=Lc(),this.Ye=new st(Te)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:ce(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,i)=>{this.rt(i)&&n(i)})}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const s=i.target;if(sh(s))if(r===0){const o=new se(s.path);this.et(n,o,ht.newNoDocument(o,me.min()))}else fe(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,u)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let o,a;try{o=Gr(r).toUint8Array()}catch(l){if(l instanceof sA)return Ni("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new I_(o,i,s)}catch(l){return Ni(l instanceof ml?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.et(n,s,null),i++)}),i}Tt(e){const n=new Map;this.ze.forEach((s,o)=>{const a=this.ot(o);if(a){if(s.current&&sh(a.target)){const l=new se(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,ht.newNoDocument(l,e))}s.Be&&(n.set(o,s.ke()),s.qe())}});let r=Re();this.He.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.je.forEach((s,o)=>o.setReadTime(e));const i=new ef(e,n,this.Ye,this.je,r);return this.je=Tn(),this.Je=Lc(),this.He=Lc(),this.Ye=new st(Te),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new YE,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new We(Te),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new We(Te),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Y("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new YE),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Lc(){return new st(se.comparator)}function XE(){return new st(se.comparator)}const y4={asc:"ASCENDING",desc:"DESCENDING"},v4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},T4={and:"AND",or:"OR"};class E4{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Dm(t,e){return t.useProto3Json||$h(e)?e:{value:e}}function fa(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function OA(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function I4(t,e){return fa(t,e.toTimestamp())}function tn(t){return fe(!!t,49232),me.fromTimestamp(function(n){const r=qr(n);return new ze(r.seconds,r.nanos)}(t))}function w_(t,e){return bm(t,e).canonicalString()}function bm(t,e){const n=function(i){return new Ge(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function BA(t){const e=Ge.fromString(t);return fe(JA(e),10190,{key:e.toString()}),e}function ah(t,e){return w_(t.databaseId,e.path)}function Ns(t,e){const n=BA(e);if(n.get(1)!==t.databaseId.projectId)throw new ne(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ne(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new se(zA(n))}function qA(t,e){return w_(t.databaseId,e)}function GA(t){const e=BA(t);return e.length===4?Ge.emptyPath():zA(e)}function Mm(t){return new Ge(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function zA(t){return fe(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function ZE(t,e,n){return{name:ah(t,e),fields:n.value.mapValue.fields}}function w4(t,e,n){const r=Ns(t,e.name),i=tn(e.updateTime),s=e.createTime?tn(e.createTime):me.min(),o=new $t({mapValue:{fields:e.fields}}),a=ht.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function S4(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ce(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,f){return u.useProto3Json?(fe(f===void 0||typeof f=="string",58123),gt.fromBase64String(f||"")):(fe(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),gt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const f=u.code===void 0?H.UNKNOWN:LA(u.code);return new ne(f,u.message||"")}(o);n=new UA(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ns(t,r.document.name),s=tn(r.document.updateTime),o=r.document.createTime?tn(r.document.createTime):me.min(),a=new $t({mapValue:{fields:r.document.fields}}),l=ht.newFoundDocument(i,s,o,a),u=r.targetIds||[],f=r.removedTargetIds||[];n=new fd(u,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Ns(t,r.document),s=r.readTime?tn(r.readTime):me.min(),o=ht.newNoDocument(i,s),a=r.removedTargetIds||[];n=new fd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Ns(t,r.document),s=r.removedTargetIds||[];n=new fd([],s,i,null)}else{if(!("filter"in e))return ce(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new f4(i,s),a=r.targetId;n=new FA(a,o)}}return n}function lh(t,e){let n;if(e instanceof Ca)n={update:ZE(t,e.key,e.value)};else if(e instanceof Zh)n={delete:ah(t,e.key)};else if(e instanceof Kr)n={update:ZE(t,e.key,e.data),updateMask:k4(e.fieldMask)};else{if(!(e instanceof VA))return ce(16599,{Vt:e.type});n={verify:ah(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof ca)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof da)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ha)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof mu)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ce(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:I4(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:ce(27497)}(t,e.precondition)),n}function Vm(t,e){const n=e.currentDocument?function(s){return s.updateTime!==void 0?Xt.updateTime(tn(s.updateTime)):s.exists!==void 0?Xt.exists(s.exists):Xt.none()}(e.currentDocument):Xt.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let l=null;if("setToServerValue"in a)fe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new ca;else if("appendMissingElements"in a){const f=a.appendMissingElements.values||[];l=new da(f)}else if("removeAllFromArray"in a){const f=a.removeAllFromArray.values||[];l=new ha(f)}else"increment"in a?l=new mu(o,a.increment):ce(16584,{proto:a});const u=it.fromServerFormat(a.fieldPath);return new DA(u,l)}(t,i)):[];if(e.update){e.update.name;const i=Ns(t,e.update.name),s=new $t({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new un(u.map(f=>it.fromServerFormat(f)))}(e.updateMask);return new Kr(i,s,o,n,r)}return new Ca(i,s,n,r)}if(e.delete){const i=Ns(t,e.delete);return new Zh(i,n)}if(e.verify){const i=Ns(t,e.verify);return new VA(i,n)}return ce(1463,{proto:e})}function C4(t,e){return t&&t.length>0?(fe(e!==void 0,14353),t.map(n=>function(i,s){let o=i.updateTime?tn(i.updateTime):tn(s);return o.isEqual(me.min())&&(o=tn(s)),new c4(o,i.transformResults||[])}(n,e))):[]}function $A(t,e){return{documents:[qA(t,e.path)]}}function HA(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=qA(t,i);const s=function(u){if(u.length!==0)return jA($e.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(u){if(u.length!==0)return u.map(f=>function(g){return{field:po(g.field),direction:x4(g.dir)}}(f))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Dm(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:n,parent:i}}function WA(t){let e=GA(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){fe(r===1,65062);const f=n.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];n.where&&(s=function(p){const g=KA(p);return g instanceof $e&&__(g)?g.getFilters():[g]}(n.where));let o=[];n.orderBy&&(o=function(p){return p.map(g=>function(T){return new ih(mo(T.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(g))}(n.orderBy));let a=null;n.limit&&(a=function(p){let g;return g=typeof p=="object"?p.value:p,$h(g)?null:g}(n.limit));let l=null;n.startAt&&(l=function(p){const g=!!p.before,v=p.values||[];return new la(v,g)}(n.startAt));let u=null;return n.endAt&&(u=function(p){const g=!p.before,v=p.values||[];return new la(v,g)}(n.endAt)),YU(e,i,o,s,a,"F",l,u)}function A4(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function KA(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=mo(n.unaryFilter.field);return be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=mo(n.unaryFilter.field);return be.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=mo(n.unaryFilter.field);return be.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=mo(n.unaryFilter.field);return be.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ce(61313);default:return ce(60726)}}(t):t.fieldFilter!==void 0?function(n){return be.create(mo(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ce(58110);default:return ce(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return $e.create(n.compositeFilter.filters.map(r=>KA(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ce(1026)}}(n.compositeFilter.op))}(t):ce(30097,{filter:t})}function x4(t){return y4[t]}function R4(t){return v4[t]}function P4(t){return T4[t]}function po(t){return{fieldPath:t.canonicalString()}}function mo(t){return it.fromServerFormat(t.fieldPath)}function jA(t){return t instanceof be?function(n){if(n.op==="=="){if(FE(n.value))return{unaryFilter:{field:po(n.field),op:"IS_NAN"}};if(LE(n.value))return{unaryFilter:{field:po(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(FE(n.value))return{unaryFilter:{field:po(n.field),op:"IS_NOT_NAN"}};if(LE(n.value))return{unaryFilter:{field:po(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:po(n.field),op:R4(n.op),value:n.value}}}(t):t instanceof $e?function(n){const r=n.getFilters().map(i=>jA(i));return r.length===1?r[0]:{compositeFilter:{op:P4(n.op),filters:r}}}(t):ce(54877,{filter:t})}function k4(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function JA(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e,n,r,i,s=me.min(),o=me.min(),a=gt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Dr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(e){this.yt=e}}function N4(t,e){let n;if(e.document)n=w4(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),i=zs(e.noDocument.readTime);n=ht.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ce(56709);{const r=se.fromSegments(e.unknownDocument.path),i=zs(e.unknownDocument.version);n=ht.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(i){const s=new ze(i[0],i[1]);return me.fromTimestamp(s)}(e.readTime)),n}function eI(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:uh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:ah(s,o.key),fields:o.data.value.mapValue.fields,updateTime:fa(s,o.version.toTimestamp()),createTime:fa(s,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Gs(e.version)};else{if(!e.isUnknownDocument())return ce(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:Gs(e.version)}}return r}function uh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Gs(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zs(t){const e=new ze(t.seconds,t.nanoseconds);return me.fromTimestamp(e)}function ys(t,e){const n=(e.baseMutations||[]).map(s=>Vm(t.yt,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>Vm(t.yt,s)),i=ze.fromMillis(e.localWriteTimeMs);return new v_(e.batchId,i,n,r)}function gl(t){const e=zs(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?zs(t.lastLimboFreeSnapshotVersion):me.min();let r;return r=function(s){return s.documents!==void 0}(t.query)?function(s){const o=s.documents.length;return fe(o===1,1966,{count:o}),Mn(Du(GA(s.documents[0])))}(t.query):function(s){return Mn(WA(s))}(t.query),new Dr(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,gt.fromBase64String(t.resumeToken))}function YA(t,e){const n=Gs(e.snapshotVersion),r=Gs(e.lastLimboFreeSnapshotVersion);let i;i=sh(e.target)?$A(t.yt,e.target):HA(t.yt,e.target).ft;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qs(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function XA(t){const e=WA({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Nm(e,e.limit,"L"):e}function np(t,e){return new E_(e.largestBatchId,Vm(t.yt,e.overlayMutation))}function tI(t,e){const n=e.path.lastSegment();return[t,Wt(e.path.popLast()),n]}function nI(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Gs(r.readTime),documentKey:Wt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{getBundleMetadata(e,n){return rI(e).get(n).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:zs(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,n){return rI(e).put(function(i){return{bundleId:i.id,createTime:Gs(tn(i.createTime)),version:i.version}}(n))}getNamedQuery(e,n){return iI(e).get(n).next(r=>{if(r)return function(s){return{name:s.name,query:XA(s.bundledQuery),readTime:zs(s.readTime)}}(r)})}saveNamedQuery(e,n){return iI(e).put(function(i){return{name:i.name,readTime:Gs(tn(i.readTime)),bundledQuery:i.bundledQuery}}(n))}}function rI(t){return xt(t,Hh)}function iI(t){return xt(t,Wh)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new tf(e,r)}getOverlay(e,n){return rl(e).get(tI(this.userId,n)).next(r=>r?np(this.serializer,r):null)}getOverlays(e,n){const r=ur();return B.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){const i=[];return r.forEach((s,o)=>{const a=new E_(n,o);i.push(this.St(e,a))}),B.waitFor(i)}removeOverlaysForBatchId(e,n,r){const i=new Set;n.forEach(o=>i.add(Wt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(rl(e).Z(wm,a))}),B.waitFor(s)}getOverlaysForCollection(e,n,r){const i=ur(),s=Wt(n),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return rl(e).J(wm,o).next(a=>{for(const l of a){const u=np(this.serializer,l);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,n,r,i){const s=ur();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return rl(e).ee({index:Z0,range:a},(l,u,f)=>{const p=np(this.serializer,u);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}St(e,n){return rl(e).put(function(i,s,o){const[a,l,u]=tI(s,o.mutation.key);return{userId:s,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:lh(i.yt,o.mutation)}}(this.serializer,this.userId,n))}}function rl(t){return xt(t,Kh)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4{bt(e){return xt(e,h_)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?gt.fromUint8Array(r):gt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(nt(e.integerValue));else if("doubleValue"in e){const r=nt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),au(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=qr(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(Gr(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?dA(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):Jh(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):ce(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const i of Object.keys(r))this.Ot(i,n),this.Ct(r[i],n)}kt(e,n){var o,a;const r=e.fields||{};this.Ft(n,53);const i=oa,s=((a=(o=r[i].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(n,15),n.Mt(nt(s)),this.Ot(i,n),this.Ct(r[i],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const i of r)this.Ct(i,n)}Lt(e,n){this.Ft(n,37),se.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}vs.Kt=new vs;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao=255;function M4(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function sI(t){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=M4(255&r[s]);if(i+=o,o!==8)break}return i}(t);return Math.ceil(e/8)}class V4{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const i=n.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const i=n.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){const n=this.en(e),r=sI(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}nn(e){const n=this.en(e),r=sI(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}rn(){this.sn(ao),this.sn(255)}_n(){this.an(ao),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===ao?(this.sn(ao),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===ao?(this.an(ao),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class L4{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class F4{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class il{constructor(){this.cn=new V4,this.ln=new L4(this.cn),this.hn=new F4(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e,n,r,i){this.Tn=e,this.In=n,this.En=r,this.dn=i}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new Ts(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:pd(this.En),directionalValue:pd(this.dn),orderedDocumentKey:pd(n),documentKey:r.path.toArray()}}Vn(e,n,r){const i=this.Rn(e,n,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function Zr(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=oI(t.En,e.En),n!==0?n:(n=oI(t.dn,e.dn),n!==0?n:se.comparator(t.In,e.In)))}function oI(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function pd(t){return HC()?function(n){let r="";for(let i=0;i<n.length;i++)r+=String.fromCharCode(n[i]);return r}(t):t}function aI(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(t)}class lI{constructor(e){this.mn=new We((n,r)=>it.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(fe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=Tm(e);if(n!==void 0&&!this.wn(n))return!1;const r=ps(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.wn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!i.has(a.field.canonicalString())){const l=r[s];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++s}for(;s<r.length;++s){const a=r[s];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new We(it.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new od(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new od(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new od(r.field,r.dir==="asc"?0:1)));return new Zd(Zd.UNKNOWN_ID,this.collectionId,n,ou.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZA(t){var n,r;if(fe(t instanceof be||t instanceof $e,20012),t instanceof be){if(t instanceof TA){const i=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(s=>be.create(t.field,"==",s)))||[];return $e.create(i,"or")}return t}const e=t.filters.map(i=>ZA(i));return $e.create(e,t.op)}function U4(t){if(t.getFilters().length===0)return[];const e=Um(ZA(t));return fe(ex(e),7391),Lm(e)||Fm(e)?[e]:e.getFilters()}function Lm(t){return t instanceof be}function Fm(t){return t instanceof $e&&__(t)}function ex(t){return Lm(t)||Fm(t)||function(n){if(n instanceof $e&&xm(n)){for(const r of n.getFilters())if(!Lm(r)&&!Fm(r))return!1;return!0}return!1}(t)}function Um(t){if(fe(t instanceof be||t instanceof $e,34018),t instanceof be)return t;if(t.filters.length===1)return Um(t.filters[0]);const e=t.filters.map(r=>Um(r));let n=$e.create(e,t.op);return n=ch(n),ex(n)?n:(fe(n instanceof $e,64498),fe(ua(n),40251),fe(n.filters.length>1,57927),n.filters.reduce((r,i)=>S_(r,i)))}function S_(t,e){let n;return fe(t instanceof be||t instanceof $e,38388),fe(e instanceof be||e instanceof $e,25473),n=t instanceof be?e instanceof be?function(i,s){return $e.create([i,s],"and")}(t,e):uI(t,e):e instanceof be?uI(e,t):function(i,s){if(fe(i.filters.length>0&&s.filters.length>0,48005),ua(i)&&ua(s))return _A(i,s.getFilters());const o=xm(i)?i:s,a=xm(i)?s:i,l=o.filters.map(u=>S_(u,a));return $e.create(l,"or")}(t,e),ch(n)}function uI(t,e){if(ua(e))return _A(e,t.getFilters());{const n=e.filters.map(r=>S_(t,r));return $e.create(n,"or")}}function ch(t){if(fe(t instanceof be||t instanceof $e,11850),t instanceof be)return t;const e=t.getFilters();if(e.length===1)return ch(e[0]);if(mA(t))return t;const n=e.map(i=>ch(i)),r=[];return n.forEach(i=>{i instanceof be?r.push(i):i instanceof $e&&(i.op===t.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:$e.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{constructor(){this.Cn=new C_}addToCollectionParentIndex(e,n){return this.Cn.add(n),B.resolve()}getCollectionParents(e,n){return B.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return B.resolve()}deleteFieldIndex(e,n){return B.resolve()}deleteAllFieldIndexes(e){return B.resolve()}createTargetIndexes(e,n){return B.resolve()}getDocumentsMatchingTarget(e,n){return B.resolve(null)}getIndexType(e,n){return B.resolve(0)}getFieldIndexes(e,n){return B.resolve([])}getNextCollectionGroupToUpdate(e){return B.resolve(null)}getMinOffset(e,n){return B.resolve(wn.min())}getMinOffsetFromCollectionGroup(e,n){return B.resolve(wn.min())}updateCollectionGroup(e,n,r){return B.resolve()}updateIndexEntries(e,n){return B.resolve()}}class C_{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new We(Ge.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new We(Ge.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cI="IndexedDbIndexManager",Fc=new Uint8Array(0);class B4{constructor(e,n){this.databaseId=n,this.vn=new C_,this.Fn=new Wr(r=>qs(r),(r,i)=>ku(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const s={collectionId:r,parent:Wt(i)};return dI(e).put(s)}return B.resolve()}getCollectionParents(e,n){const r=[],i=IDBKeyRange.bound([n,""],[B0(n),""],!1,!0);return dI(e).J(i).next(s=>{for(const o of s){if(o.collectionId!==n)break;r.push(lr(o.parent))}return r})}addFieldIndex(e,n){const r=sl(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(n);delete i.indexId;const s=r.add(i);if(n.indexState){const o=uo(e);return s.next(a=>{o.put(nI(a,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return s.next()}deleteFieldIndex(e,n){const r=sl(e),i=uo(e),s=lo(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=sl(e),r=lo(e),i=uo(e);return n.Z().next(()=>r.Z()).next(()=>i.Z())}createTargetIndexes(e,n){return B.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new lI(r).Dn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,n){const r=lo(e);let i=!0;const s=new Map;return B.forEach(this.Mn(n),o=>this.xn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Re();const a=[];return B.forEach(s,(l,u)=>{Y(cI,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`}(l)} to execute ${qs(n)}`);const f=function(R,M){const O=Tm(M);if(O===void 0)return null;for(const F of oh(R,O.fieldPath))switch(F.op){case"array-contains-any":return F.value.arrayValue.values||[];case"array-contains":return[F.value]}return null}(u,l),p=function(R,M){const O=new Map;for(const F of ps(M))for(const I of oh(R,F.fieldPath))switch(I.op){case"==":case"in":O.set(F.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return O.set(F.fieldPath.canonicalString(),I.value),Array.from(O.values())}return null}(u,l),g=function(R,M){const O=[];let F=!0;for(const I of ps(M)){const w=I.kind===0?GE(R,I.fieldPath,R.startAt):zE(R,I.fieldPath,R.startAt);O.push(w.value),F&&(F=w.inclusive)}return new la(O,F)}(u,l),v=function(R,M){const O=[];let F=!0;for(const I of ps(M)){const w=I.kind===0?zE(R,I.fieldPath,R.endAt):GE(R,I.fieldPath,R.endAt);O.push(w.value),F&&(F=w.inclusive)}return new la(O,F)}(u,l),T=this.On(l,u,g),x=this.On(l,u,v),D=this.Nn(l,u,p),S=this.Bn(l.indexId,f,T,g.inclusive,x,v.inclusive,D);return B.forEach(S,E=>r.Y(E,n.limit).next(R=>{R.forEach(M=>{const O=se.fromSegments(M.documentKey);o.has(O)||(o=o.add(O),a.push(O))})}))}).next(()=>a)}return B.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=U4($e.create(e.filters,"and")).map(r=>Pm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,i,s,o,a){const l=(n!=null?n.length:1)*Math.max(r.length,s.length),u=l/(n!=null?n.length:1),f=[];for(let p=0;p<l;++p){const g=n?this.Ln(n[p/u]):Fc,v=this.kn(e,g,r[p%u],i),T=this.qn(e,g,s[p%u],o),x=a.map(D=>this.kn(e,g,D,!0));f.push(...this.createRange(v,T,x))}return f}kn(e,n,r,i){const s=new Ts(e,se.empty(),n,r);return i?s:s.An()}qn(e,n,r,i){const s=new Ts(e,se.empty(),n,r);return i?s.An():s}xn(e,n){const r=new lI(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;const i=this.Mn(n);return B.forEach(i,s=>this.xn(e,s).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new We(it.comparator),f=!1;for(const p of l.filters)for(const g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?f=!0:u=u.add(g.field));for(const p of l.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&i.length>1&&r===2?1:r)}Qn(e,n){const r=new il;for(const i of ps(e)){const s=n.data.field(i.fieldPath);if(s==null)return null;const o=r.Pn(i.kind);vs.Kt.Dt(s,o)}return r.un()}Ln(e){const n=new il;return vs.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new il;return vs.Kt.Dt(fu(this.databaseId,n),r.Pn(function(s){const o=ps(s);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let i=[];i.push(new il);let s=0;for(const o of ps(e)){const a=r[s++];for(const l of i)if(this.Un(n,o.fieldPath)&&pu(a))i=this.Kn(i,o,a);else{const u=l.Pn(o.kind);vs.Kt.Dt(a,u)}}return this.Wn(i)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const l=new il;l.seed(a.un()),vs.Kt.Dt(o,l.Pn(n.kind)),s.push(l)}return s}Un(e,n){return!!e.filters.find(r=>r instanceof be&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=sl(e),i=uo(e);return(n?r.J(Im,IDBKeyRange.bound(n,n)):r.J()).next(s=>{const o=[];return B.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(function(f,p){const g=p?new ou(p.sequenceNumber,new wn(zs(p.readTime),new se(lr(p.documentKey)),p.largestBatchId)):ou.empty(),v=f.fields.map(([T,x])=>new od(it.fromServerFormat(T),x));return new Zd(f.indexId,f.collectionGroup,v,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Te(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=sl(e),s=uo(e);return this.Gn(e).next(o=>i.J(Im,IDBKeyRange.bound(n,n)).next(a=>B.forEach(a,l=>s.put(nI(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return B.forEach(n,(i,s)=>{const o=r.get(i.collectionGroup);return(o?B.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),B.forEach(a,l=>this.zn(e,i,l).next(u=>{const f=this.jn(s,l);return u.isEqual(f)?B.resolve():this.Jn(e,s,l,u,f)}))))})}Hn(e,n,r,i){return lo(e).put(i.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,i){return lo(e).delete(i.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const i=lo(e);let s=new We(Zr);return i.ee({index:X0,range:IDBKeyRange.only([r.indexId,this.uid,pd(this.$n(r,n))])},(o,a)=>{s=s.add(new Ts(r.indexId,n,aI(a.arrayValue),aI(a.directionalValue)))}).next(()=>s)}jn(e,n){let r=new We(Zr);const i=this.Qn(n,e);if(i==null)return r;const s=Tm(n);if(s!=null){const o=e.data.field(s.fieldPath);if(pu(o))for(const a of o.arrayValue.values||[])r=r.add(new Ts(n.indexId,e.key,this.Ln(a),i))}else r=r.add(new Ts(n.indexId,e.key,Fc,i));return r}Jn(e,n,r,i,s){Y(cI,"Updating index entries for document '%s'",n.key);const o=[];return function(l,u,f,p,g){const v=l.getIterator(),T=u.getIterator();let x=oo(v),D=oo(T);for(;x||D;){let S=!1,E=!1;if(x&&D){const R=f(x,D);R<0?E=!0:R>0&&(S=!0)}else x!=null?E=!0:S=!0;S?(p(D),D=oo(T)):E?(g(x),x=oo(v)):(x=oo(v),D=oo(T))}}(i,s,Zr,a=>{o.push(this.Hn(e,n,r,a))},a=>{o.push(this.Yn(e,n,r,a))}),B.waitFor(o)}Gn(e){let n=1;return uo(e).ee({index:Y0,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>Zr(o,a)).filter((o,a,l)=>!a||Zr(o,l[a-1])!==0);const i=[];i.push(e);for(const o of r){const a=Zr(o,e),l=Zr(o,n);if(a===0)i[0]=e.An();else if(a>0&&l<0)i.push(o),i.push(o.An());else if(l>0)break}i.push(n);const s=[];for(let o=0;o<i.length;o+=2){if(this.Zn(i[o],i[o+1]))return[];const a=i[o].Vn(this.uid,Fc,se.empty()),l=i[o+1].Vn(this.uid,Fc,se.empty());s.push(IDBKeyRange.bound(a,l))}return s}Zn(e,n){return Zr(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(hI)}getMinOffset(e,n){return B.mapArray(this.Mn(n),r=>this.xn(e,r).next(i=>i||ce(44426))).next(hI)}}function dI(t){return xt(t,cu)}function lo(t){return xt(t,bl)}function sl(t){return xt(t,d_)}function uo(t){return xt(t,Dl)}function hI(t){fe(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;l_(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new wn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},tx=41943040;class Gt{static withCacheSize(e){return new Gt(e,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nx(t,e,n){const r=t.store(zn),i=t.store(na),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=r.ee({range:o},(f,p,g)=>(a++,g.delete()));s.push(l.next(()=>{fe(a===1,47070,{batchId:n.batchId})}));const u=[];for(const f of n.mutations){const p=j0(e,f.key.path,n.batchId);s.push(i.delete(p)),u.push(f.key)}return B.waitFor(s).next(()=>u)}function dh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ce(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gt.DEFAULT_COLLECTION_PERCENTILE=10,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gt.DEFAULT=new Gt(tx,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gt.DISABLED=new Gt(-1,0,0);class nf{constructor(e,n,r,i){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Xn={}}static wt(e,n,r,i){fe(e.uid!=="",64387);const s=e.isAuthenticated()?e.uid:"";return new nf(s,n,r,i)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ei(e).ee({index:Cs,range:r},(i,s,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,i){const s=go(e),o=ei(e);return o.add({}).next(a=>{fe(typeof a=="number",49019);const l=new v_(a,n,r,i),u=function(v,T,x){const D=x.baseMutations.map(E=>lh(v.yt,E)),S=x.mutations.map(E=>lh(v.yt,E));return{userId:T,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:D,mutations:S}}(this.serializer,this.userId,l),f=[];let p=new We((g,v)=>Te(g.canonicalString(),v.canonicalString()));for(const g of i){const v=j0(this.userId,g.key.path,a);p=p.add(g.key.path.popLast()),f.push(o.put(u)),f.push(s.put(v,mU))}return p.forEach(g=>{f.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),B.waitFor(f).next(()=>l)})}lookupMutationBatch(e,n){return ei(e).get(n).next(r=>r?(fe(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),ys(this.serializer,r)):null)}er(e,n){return this.Xn[n]?B.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const i=r.keys();return this.Xn[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return ei(e).ee({index:Cs,range:i},(o,a,l)=>{a.userId===this.userId&&(fe(a.batchId>=r,47524,{tr:r}),s=ys(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Ps;return ei(e).ee({index:Cs,range:n,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,Ps],[this.userId,Number.POSITIVE_INFINITY]);return ei(e).J(Cs,n).next(r=>r.map(i=>ys(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=ad(this.userId,n.path),i=IDBKeyRange.lowerBound(r),s=[];return go(e).ee({range:i},(o,a,l)=>{const[u,f,p]=o,g=lr(f);if(u===this.userId&&n.path.isEqual(g))return ei(e).get(p).next(v=>{if(!v)throw ce(61480,{nr:o,batchId:p});fe(v.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:v.userId,batchId:p}),s.push(ys(this.serializer,v))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new We(Te);const i=[];return n.forEach(s=>{const o=ad(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=go(e).ee({range:a},(u,f,p)=>{const[g,v,T]=u,x=lr(v);g===this.userId&&s.path.isEqual(x)?r=r.add(T):p.done()});i.push(l)}),B.waitFor(i).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1,s=ad(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new We(Te);return go(e).ee({range:o},(l,u,f)=>{const[p,g,v]=l,T=lr(g);p===this.userId&&r.isPrefixOf(T)?T.length===i&&(a=a.add(v)):f.done()}).next(()=>this.rr(e,a))}rr(e,n){const r=[],i=[];return n.forEach(s=>{i.push(ei(e).get(s).next(o=>{if(o===null)throw ce(35274,{batchId:s});fe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(ys(this.serializer,o))}))}),B.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return nx(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),B.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return B.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return go(e).ee({range:r},(s,o,a)=>{if(s[0]===this.userId){const l=lr(s[1]);i.push(l)}else a.done()}).next(()=>{fe(i.length===0,56720,{sr:i.map(s=>s.canonicalString())})})})}containsKey(e,n){return rx(e,this.userId,n)}_r(e){return ix(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:Ps,lastStreamToken:""})}}function rx(t,e,n){const r=ad(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return go(t).ee({range:s,X:!0},(a,l,u)=>{const[f,p,g]=a;f===e&&p===i&&(o=!0),u.done()}).next(()=>o)}function ei(t){return xt(t,zn)}function go(t){return xt(t,na)}function ix(t){return xt(t,lu)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new $s(0)}static cr(){return new $s(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new $s(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>me.fromTimestamp(new ze(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.hr(e,i)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>co(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(fe(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let i=0;const s=[];return co(e).ee((o,a)=>{const l=gl(a);l.sequenceNumber<=n&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>B.waitFor(s)).next(()=>i)}forEachTarget(e,n){return co(e).ee((r,i)=>{const s=gl(i);n(s)})}lr(e){return pI(e).get(nh).next(n=>(fe(n!==null,2888),n))}hr(e,n){return pI(e).put(nh,n)}Pr(e,n){return co(e).put(YA(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=qs(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return co(e).ee({range:i,index:Q0},(o,a,l)=>{const u=gl(a);ku(n,u.target)&&(s=u,l.done())}).next(()=>s)}addMatchingKeys(e,n,r){const i=[],s=ui(e);return n.forEach(o=>{const a=Wt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),B.waitFor(i)}removeMatchingKeys(e,n,r){const i=ui(e);return B.forEach(n,s=>{const o=Wt(s.path);return B.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,n){const r=ui(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),i=ui(e);let s=Re();return i.ee({range:r,X:!0},(o,a,l)=>{const u=lr(o[1]),f=new se(u);s=s.add(f)}).next(()=>s)}containsKey(e,n){const r=Wt(n.path),i=IDBKeyRange.bound([r],[B0(r)],!1,!0);let s=0;return ui(e).ee({index:c_,X:!0,range:i},([o,a],l,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}At(e,n){return co(e).get(n).next(r=>r?gl(r):null)}}function co(t){return xt(t,ra)}function pI(t){return xt(t,ks)}function ui(t){return xt(t,ia)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI="LruGarbageCollector",G4=1048576;function gI([t,e],[n,r]){const i=Te(t,n);return i===0?Te(e,r):i}class z4{constructor(e){this.Ir=e,this.buffer=new We(gI),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();gI(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class sx{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Y(mI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){qi(n)?Y(mI,"Ignoring IndexedDB error during garbage collection: ",n):await Js(n)}await this.Vr(3e5)})}}class $4{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return B.resolve(Nn.ce);const r=new z4(n);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Y("LruGarbageCollector","Garbage collection skipped; disabled"),B.resolve(fI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fI):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,s,o,a,l,u;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(Y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,a=Date.now(),this.removeTargets(e,r,n))).next(p=>(s=p,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(u=Date.now(),ho()<=De.DEBUG&&Y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${p} documents in `+(u-l)+`ms
Total Duration: ${u-f}ms`),B.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}}function ox(t,e){return new $4(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e,n){this.db=e,this.garbageCollector=ox(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,i)=>n(i))}addReference(e,n,r){return Uc(e,r)}removeReference(e,n,r){return Uc(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Uc(e,n)}br(e,n){return function(i,s){let o=!1;return ix(i).te(a=>rx(i,a,s).next(l=>(l&&(o=!0),B.resolve(!l)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Sr(e,(o,a)=>{if(a<=n){const l=this.br(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,me.min()),ui(e).delete(function(p){return[0,Wt(p.path)]}(o))))});i.push(l)}}).next(()=>B.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Uc(e,n)}Sr(e,n){const r=ui(e);let i,s=Nn.ce;return r.ee({index:c_},([o,a],{path:l,sequenceNumber:u})=>{o===0?(s!==Nn.ce&&n(new se(lr(i)),s),s=u,i=l):s=Nn.ce}).next(()=>{s!==Nn.ce&&n(new se(lr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Uc(t,e){return ui(t).put(function(r,i){return{targetId:0,path:Wt(r.path),sequenceNumber:i}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(){this.changes=new Wr(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,ht.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?B.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return cs(e).put(r)}removeEntry(e,n,r){return cs(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],uh(o),a[a.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=ht.newInvalidDocument(n);return cs(e).ee({index:ld,range:IDBKeyRange.only(ol(n))},(i,s)=>{r=this.Cr(n,s)}).next(()=>r)}vr(e,n){let r={size:0,document:ht.newInvalidDocument(n)};return cs(e).ee({index:ld,range:IDBKeyRange.only(ol(n))},(i,s)=>{r={document:this.Cr(n,s),size:dh(s)}}).next(()=>r)}getEntries(e,n){let r=Tn();return this.Fr(e,n,(i,s)=>{const o=this.Cr(i,s);r=r.insert(i,o)}).next(()=>r)}Mr(e,n){let r=Tn(),i=new st(se.comparator);return this.Fr(e,n,(s,o)=>{const a=this.Cr(s,o);r=r.insert(s,a),i=i.insert(s,dh(o))}).next(()=>({documents:r,Or:i}))}Fr(e,n,r){if(n.isEmpty())return B.resolve();let i=new We(vI);n.forEach(l=>i=i.add(l));const s=IDBKeyRange.bound(ol(i.first()),ol(i.last())),o=i.getIterator();let a=o.getNext();return cs(e).ee({index:ld,range:s},(l,u,f)=>{const p=se.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&vI(a,p)<0;)r(a,null),a=o.getNext();a&&a.isEqual(p)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?f.j(ol(a)):f.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,i,s){const o=n.path,a=[o.popLast().toArray(),o.lastSegment(),uh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return cs(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{s==null||s.incrementDocumentReadCount(u.length);let f=Tn();for(const p of u){const g=this.Cr(se.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(bu(n,g)||i.has(g.key))&&(f=f.insert(g.key,g))}return f})}getAllFromCollectionGroup(e,n,r,i){let s=Tn();const o=yI(n,r),a=yI(n,wn.max());return cs(e).ee({index:J0,range:IDBKeyRange.bound(o,a,!0)},(l,u,f)=>{const p=this.Cr(se.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new K4(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return _I(e).get(Em).next(n=>(fe(!!n,20021),n))}Dr(e,n){return _I(e).put(Em,n)}Cr(e,n){if(n){const r=N4(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(me.min())))return r}return ht.newInvalidDocument(e)}}function lx(t){return new W4(t)}class K4 extends ax{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Wr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const n=[];let r=0,i=new We((s,o)=>Te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Br.get(s);if(n.push(this.Nr.removeEntry(e,s,a.readTime)),o.isValidDocument()){const l=eI(this.Nr.serializer,o);i=i.add(s.path.popLast());const u=dh(l);r+=u-a.size,n.push(this.Nr.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){const l=eI(this.Nr.serializer,o.convertToNoDocument(me.min()));n.push(this.Nr.addEntry(e,s,l))}}),i.forEach(s=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,s))}),n.push(this.Nr.updateMetadata(e,r)),B.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:i})=>(i.forEach((s,o)=>{this.Br.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function _I(t){return xt(t,uu)}function cs(t){return xt(t,th)}function ol(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yI(t,e){const n=e.documentKey.path.toArray();return[t,uh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function vI(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Te(n[s],r[s]),i)return i;return i=Te(n.length,r.length),i||(i=Te(n[n.length-2],r[r.length-2]),i||Te(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Fl(r.mutation,i,un.empty(),ze.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Re()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Re()){const i=ur();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=pl();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=ur();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Re()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Tn();const o=Ll(),a=function(){return Ll()}();return n.forEach((l,u)=>{const f=r.get(u.key);i.has(u.key)&&(f===void 0||f.mutation instanceof Kr)?s=s.insert(u.key,u):f!==void 0?(o.set(u.key,f.mutation.getFieldMask()),Fl(f.mutation,u,f.mutation.getFieldMask(),ze.now())):o.set(u.key,un.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,f)=>o.set(u,f)),n.forEach((u,f)=>a.set(u,new j4(f,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,n){const r=Ll();let i=new st((o,a)=>o-a),s=Re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let f=r.get(l)||un.empty();f=a.applyToLocalView(u,f),r.set(l,f);const p=(i.get(a.batchId)||Re()).add(l);i=i.insert(a.batchId,p)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,f=l.value,p=AA();f.forEach(g=>{if(!s.has(g)){const v=bA(n.get(g),r.get(g));v!==null&&p.set(g,v),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return B.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):EA(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):B.resolve(ur());let a=su,l=s;return o.next(u=>B.forEach(u,(f,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(f)?B.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{l=l.insert(f,g)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,Re())).next(f=>({batchId:a,changes:CA(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new se(n)).next(r=>{let i=pl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let o=pl();return this.indexManager.getCollectionParents(e,s).next(a=>B.forEach(a,l=>{const u=function(p,g){return new Nu(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(f=>{f.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((l,u)=>{const f=u.getKey();o.get(f)===null&&(o=o.insert(f,ht.newInvalidDocument(f)))});let a=pl();return o.forEach((l,u)=>{const f=s.get(l);f!==void 0&&Fl(f.mutation,u,un.empty(),ze.now()),bu(n,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return B.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:tn(i.createTime)}}(n)),B.resolve()}getNamedQuery(e,n){return B.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(i){return{name:i.name,query:XA(i.bundledQuery),readTime:tn(i.readTime)}}(n)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(){this.overlays=new st(se.comparator),this.qr=new Map}getOverlay(e,n){return B.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ur();return B.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.St(e,n,s)}),B.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(r)),B.resolve()}getOverlaysForCollection(e,n,r){const i=ur(),s=n.length+1,o=new se(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return B.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new st((u,f)=>u-f);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=ur(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}const a=ur(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,f)=>a.set(u,f)),!(a.size()>=i)););return B.resolve(a)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new E_(n,r));let s=this.qr.get(n);s===void 0&&(s=Re(),this.qr.set(n,s)),this.qr.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(e){return B.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(){this.Qr=new We(Nt.$r),this.Ur=new We(Nt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Nt(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new Nt(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new se(new Ge([])),r=new Nt(n,e),i=new Nt(n,e+1),s=[];return this.Ur.forEachInRange([r,i],o=>{this.Gr(o),s.push(o.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new se(new Ge([])),r=new Nt(n,e),i=new Nt(n,e+1);let s=Re();return this.Ur.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new Nt(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Nt{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return se.comparator(e.key,n.key)||Te(e.Yr,n.Yr)}static Kr(e,n){return Te(e.Yr,n.Yr)||se.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new We(Nt.$r)}checkEmpty(e){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new v_(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.Zr=this.Zr.add(new Nt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return B.resolve(o)}lookupMutationBatch(e,n){return B.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),s=i<0?0:i;return B.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?Ps:this.tr-1)}getAllMutationBatches(e){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Nt(n,0),i=new Nt(n,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],o=>{const a=this.Xr(o.Yr);s.push(a)}),B.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new We(Te);return n.forEach(i=>{const s=new Nt(i,0),o=new Nt(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],a=>{r=r.add(a.Yr)})}),B.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;se.isDocumentKey(s)||(s=s.child(""));const o=new Nt(new se(s),0);let a=new We(Te);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(l.Yr)),!0)},o),B.resolve(this.ti(a))}ti(e){const n=[];return e.forEach(r=>{const i=this.Xr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){fe(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return B.forEach(n.mutations,i=>{const s=new Nt(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new Nt(n,0),i=this.Zr.firstAfterOrEqual(r);return B.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,B.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(e){this.ri=e,this.docs=function(){return new st(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return B.resolve(r?r.document.mutableCopy():ht.newInvalidDocument(n))}getEntries(e,n){let r=Tn();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ht.newInvalidDocument(i))}),B.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Tn();const o=n.path,a=new se(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:f}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||l_($0(f),r)<=0||(i.has(f.key)||bu(n,f))&&(s=s.insert(f.key,f.mutableCopy()))}return B.resolve(s)}getAllFromCollectionGroup(e,n,r,i){ce(9500)}ii(e,n){return B.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new eO(this)}getSize(e){return B.resolve(this.size)}}class eO extends ax{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),B.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e){this.persistence=e,this.si=new Wr(n=>qs(n),ku),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.oi=0,this._i=new A_,this.targetCount=0,this.ai=$s.ur()}forEachTarget(e,n){return this.si.forEach((r,i)=>n(i)),B.resolve()}getLastRemoteSnapshotVersion(e){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return B.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),B.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new $s(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,B.resolve()}updateTargetData(e,n){return this.Pr(n),B.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,B.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),B.waitFor(s).next(()=>i)}getTargetCount(e){return B.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return B.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),B.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),B.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),B.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return B.resolve(r)}containsKey(e,n){return B.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,n){this.ui={},this.overlays={},this.ci=new Nn(0),this.li=!1,this.li=!0,this.hi=new Y4,this.referenceDelegate=e(this),this.Pi=new tO(this),this.indexManager=new O4,this.remoteDocumentCache=function(i){return new Z4(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new QA(n),this.Ii=new J4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Q4,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new X4(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Y("MemoryPersistence","Starting transaction:",e);const i=new nO(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ai(e,n){return B.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class nO extends W0{constructor(e){super(),this.currentSequenceNumber=e}}class rf{constructor(e){this.persistence=e,this.Ri=new A_,this.Vi=null}static mi(e){return new rf(e)}get fi(){if(this.Vi)return this.Vi;throw ce(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),B.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),B.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),B.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(i=>this.fi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.fi.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.fi,r=>{const i=se.fromPath(r);return this.gi(e,i).next(s=>{s||n.removeEntry(i,me.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return B.or([()=>B.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class hh{constructor(e,n){this.persistence=e,this.pi=new Wr(r=>Wt(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=ox(this,n)}static mi(e,n){return new hh(e,n)}Ei(){}di(e){return B.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return B.forEach(this.pi,(r,i)=>this.br(e,r,i).next(s=>s?B.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,n).next(a=>{a||(r++,s.removeEntry(o,me.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),B.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),B.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),B.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),B.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=cd(e.data.value)),n}br(e,n,r){return B.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return B.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(e){this.serializer=e}k(e,n,r,i){const s=new zh("createOrUpgrade",n);r<1&&i>=1&&(function(l){l.createObjectStore(Pu)}(e),function(l){l.createObjectStore(lu,{keyPath:pU}),l.createObjectStore(zn,{keyPath:kE,autoIncrement:!0}).createIndex(Cs,NE,{unique:!0}),l.createObjectStore(na)}(e),TI(e),function(l){l.createObjectStore(ms)}(e));let o=B.resolve();return r<3&&i>=3&&(r!==0&&(function(l){l.deleteObjectStore(ia),l.deleteObjectStore(ra),l.deleteObjectStore(ks)}(e),TI(e)),o=o.next(()=>function(l){const u=l.store(ks),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0};return u.put(nh,f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(zn).J().next(p=>{l.deleteObjectStore(zn),l.createObjectStore(zn,{keyPath:kE,autoIncrement:!0}).createIndex(Cs,NE,{unique:!0});const g=u.store(zn),v=p.map(T=>g.put(T));return B.waitFor(v)})}(e,s))),o=o.next(()=>{(function(l){l.createObjectStore(sa,{keyPath:wU})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.yi(s))),r<6&&i>=6&&(o=o.next(()=>(function(l){l.createObjectStore(uu)}(e),this.wi(s)))),r<7&&i>=7&&(o=o.next(()=>this.Si(s))),r<8&&i>=8&&(o=o.next(()=>this.bi(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.Di(s))),r<11&&i>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(Hh,{keyPath:SU})})(e),function(l){l.createObjectStore(Wh,{keyPath:CU})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(Kh,{keyPath:DU});u.createIndex(wm,bU,{unique:!1}),u.createIndex(Z0,MU,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(th,{keyPath:gU});u.createIndex(ld,_U),u.createIndex(J0,yU)}(e)).next(()=>this.Ci(e,s)).next(()=>e.deleteObjectStore(ms))),r<14&&i>=14&&(o=o.next(()=>this.Fi(e,s))),r<15&&i>=15&&(o=o.next(()=>function(l){l.createObjectStore(d_,{keyPath:AU,autoIncrement:!0}).createIndex(Im,xU,{unique:!1}),l.createObjectStore(Dl,{keyPath:RU}).createIndex(Y0,PU,{unique:!1}),l.createObjectStore(bl,{keyPath:kU}).createIndex(X0,NU,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{n.objectStore(Dl).clear()}).next(()=>{n.objectStore(bl).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(h_,{keyPath:VU})})(e)})),r<18&&i>=18&&HC()&&(o=o.next(()=>{n.objectStore(Dl).clear()}).next(()=>{n.objectStore(bl).clear()})),o}wi(e){let n=0;return e.store(ms).ee((r,i)=>{n+=dh(i)}).next(()=>{const r={byteSize:n};return e.store(uu).put(Em,r)})}yi(e){const n=e.store(lu),r=e.store(zn);return n.J().next(i=>B.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,Ps],[s.userId,s.lastAcknowledgedBatchId]);return r.J(Cs,o).next(a=>B.forEach(a,l=>{fe(l.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=ys(this.serializer,l);return nx(e,s.userId,u).next(()=>{})}))}))}Si(e){const n=e.store(ia),r=e.store(ms);return e.store(ks).get(nh).next(i=>{const s=[];return r.ee((o,a)=>{const l=new Ge(o),u=function(p){return[0,Wt(p)]}(l);s.push(n.get(u).next(f=>f?B.resolve():(p=>n.put({targetId:0,path:Wt(p),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>B.waitFor(s))})}bi(e,n){e.createObjectStore(cu,{keyPath:IU});const r=n.store(cu),i=new C_,s=o=>{if(i.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Wt(l)})}};return n.store(ms).ee({X:!0},(o,a)=>{const l=new Ge(o);return s(l.popLast())}).next(()=>n.store(na).ee({X:!0},([o,a,l],u)=>{const f=lr(a);return s(f.popLast())}))}Di(e){const n=e.store(ra);return n.ee((r,i)=>{const s=gl(i),o=YA(this.serializer,s);return n.put(o)})}Ci(e,n){const r=n.store(ms),i=[];return r.ee((s,o)=>{const a=n.store(th),l=function(p){return p.document?new se(Ge.fromString(p.document.name).popFirst(5)):p.noDocument?se.fromSegments(p.noDocument.path):p.unknownDocument?se.fromSegments(p.unknownDocument.path):ce(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>B.waitFor(i))}Fi(e,n){const r=n.store(zn),i=lx(this.serializer),s=new x_(rf.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??Re();ys(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),B.forEach(a,(l,u)=>{const f=new Vt(u),p=tf.wt(this.serializer,f),g=s.getIndexManager(f),v=nf.wt(f,this.serializer,g,s.referenceDelegate);return new ux(i,v,p,g).recalculateAndSaveOverlaysForDocumentKeys(new Sm(n,Nn.ce),l).next()})})}}function TI(t){t.createObjectStore(ia,{keyPath:TU}).createIndex(c_,EU,{unique:!0}),t.createObjectStore(ra,{keyPath:"targetId"}).createIndex(Q0,vU,{unique:!0}),t.createObjectStore(ks)}const ti="IndexedDbPersistence",rp=18e5,ip=5e3,sp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",iO="main";class R_{constructor(e,n,r,i,s,o,a,l,u,f,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=s,this.window=o,this.document=a,this.xi=u,this.Oi=f,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=g=>Promise.resolve(),!R_.v())throw new ne(H.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new H4(this,i),this.$i=n+iO,this.serializer=new QA(l),this.Ui=new Ci(this.$i,this.Ni,new rO(this.serializer)),this.hi=new b4,this.Pi=new q4(this.referenceDelegate,this.serializer),this.remoteDocumentCache=lx(this.serializer),this.Ii=new D4,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Yt(ti,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ne(H.FAILED_PRECONDITION,sp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Nn(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Oc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(qi(e))return Y(ti,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Y(ti,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return al(e).get(so).next(n=>B.resolve(this.es(n)))}ts(e){return Oc(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,rp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=xt(n,sa);return r.J().next(i=>{const s=this.ss(i,rp),o=i.filter(a=>s.indexOf(a)===-1);return B.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?B.resolve(!0):al(e).get(so).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,ip)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new ne(H.FAILED_PRECONDITION,sp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Oc(e).J().next(r=>this.ss(r,ip).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&Y(ti,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Pu,sa],e=>{const n=new Sm(e,Nn.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Oc(e).J().next(n=>this.ss(n,rp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return nf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new B4(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return tf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){Y(ti,"Starting transaction:",e);const i=n==="readonly"?"readonly":"readwrite",s=function(l){return l===18?UU:l===17?rA:l===16?FU:l===15?f_:l===14?nA:l===13?tA:l===12?LU:l===11?eA:void ce(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,i,s,a=>(o=new Sm(a,this.ci?this.ci.next():Nn.ce),n==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Yt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new ne(H.FAILED_PRECONDITION,H0);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return al(e).get(so).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,ip)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ne(H.FAILED_PRECONDITION,sp)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return al(e).put(so,n)}static v(){return Ci.v()}Zi(e){const n=al(e);return n.get(so).next(r=>this.es(r)?(Y(ti,"Releasing primary lease."),n.delete(so)):B.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Yt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;$C()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return Y(ti,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Yt(ti,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Yt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function al(t){return xt(t,Pu)}function Oc(t){return xt(t,sa)}function sO(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=Re(),i=Re();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new P_(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return $C()?8:K0(Ct())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.ys(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ws(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new oO;return this.Ss(e,n,o).next(a=>{if(s.result=a,this.Vs)return this.bs(e,n,o,a.size)})}).next(()=>s.result)}bs(e,n,r,i){return r.documentReadCount<this.fs?(ho()<=De.DEBUG&&Y("QueryEngine","SDK will not create cache indexes for query:",fo(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),B.resolve()):(ho()<=De.DEBUG&&Y("QueryEngine","Query:",fo(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(ho()<=De.DEBUG&&Y("QueryEngine","The SDK decides to create cache indexes for query:",fo(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mn(n))):B.resolve())}ys(e,n){if($E(n))return B.resolve(null);let r=Mn(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=Nm(n,null,"F"),r=Mn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Re(...s);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(n,a);return this.Cs(n,u,o,l.readTime)?this.ys(e,Nm(n,null,"F")):this.vs(e,u,n,l)}))})))}ws(e,n,r,i){return $E(n)||i.isEqual(me.min())?B.resolve(null):this.ps.getDocuments(e,r).next(s=>{const o=this.Ds(n,s);return this.Cs(n,o,r,i)?B.resolve(null):(ho()<=De.DEBUG&&Y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),fo(n)),this.vs(e,o,n,aU(i,su)).next(a=>a))})}Ds(e,n){let r=new We(wA(e));return n.forEach((i,s)=>{bu(e,s)&&(r=r.add(s))}),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,n,r){return ho()<=De.DEBUG&&Y("QueryEngine","Using full collection scan to execute query:",fo(n)),this.ps.getDocumentsMatchingQuery(e,n,wn.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k_="LocalStore",aO=3e8;class lO{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new st(Te),this.xs=new Wr(s=>qs(s),ku),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ux(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function dx(t,e,n,r){return new lO(t,e,n,r)}async function hx(t,e){const n=Ee(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=Re();for(const u of i){o.push(u.batchId);for(const f of u.mutations)l=l.add(f.key)}for(const u of s){a.push(u.batchId);for(const f of u.mutations)l=l.add(f.key)}return n.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function uO(t,e){const n=Ee(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,f){const p=u.batch,g=p.keys();let v=B.resolve();return g.forEach(T=>{v=v.next(()=>f.getEntry(l,T)).next(x=>{const D=u.docVersions.get(T);fe(D!==null,48541),x.version.compareTo(D)<0&&(p.applyToRemoteDocument(x,u),x.isValidDocument()&&(x.setReadTime(u.commitVersion),f.addEntry(x)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,p))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Re();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function fx(t){const e=Ee(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function cO(t,e){const n=Ee(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const a=[];e.targetChanges.forEach((f,p)=>{const g=i.get(p);if(!g)return;a.push(n.Pi.removeMatchingKeys(s,f.removedDocuments,p).next(()=>n.Pi.addMatchingKeys(s,f.addedDocuments,p)));let v=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(gt.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,r)),i=i.insert(p,v),function(x,D,S){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=aO?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(g,v,f)&&a.push(n.Pi.updateTargetData(s,v))});let l=Tn(),u=Re();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,f))}),a.push(dO(s,o,e.documentUpdates).next(f=>{l=f.ks,u=f.qs})),!r.isEqual(me.min())){const f=n.Pi.getLastRemoteSnapshotVersion(s).next(p=>n.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(f)}return B.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(n.Ms=i,s))}function dO(t,e,n){let r=Re(),i=Re();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Tn();return n.forEach((a,l)=>{const u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Y(k_,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:i}})}function hO(t,e){const n=Ee(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ps),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fO(t,e){const n=Ee(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Pi.getTargetData(r,e).next(s=>s?(i=s,B.resolve(i)):n.Pi.allocateTargetId(r).next(o=>(i=new Dr(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function Om(t,e,n){const r=Ee(t),i=r.Ms.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!qi(o))throw o;Y(k_,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function EI(t,e,n){const r=Ee(t);let i=me.min(),s=Re();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,f){const p=Ee(l),g=p.xs.get(f);return g!==void 0?B.resolve(p.Ms.get(g)):p.Pi.getTargetData(u,f)}(r,o,Mn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?i:me.min(),n?s:Re())).next(a=>(pO(r,ZU(e),a),{documents:a,Qs:s})))}function pO(t,e,n){let r=t.Os.get(e)||me.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Os.set(e,r)}class II{constructor(){this.activeTargetIds=s4()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class px{constructor(){this.Mo=new II,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new II,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI="ConnectivityMonitor";class SI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Y(wI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Y(wI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bc=null;function Bm(){return Bc===null?Bc=function(){return 268435456+Math.round(2147483648*Math.random())}():Bc++,"0x"+Bc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const op="RestConnection",gO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _O{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===rh?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,s){const o=Bm(),a=this.zo(e,n.toUriEncodedString());Y(op,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,i,s);const{host:u}=new URL(a),f=Ea(u);return this.Jo(e,a,l,r,f).then(p=>(Y(op,`Received RPC '${e}' ${o}: `,p),p),p=>{throw Ni(op,`RPC '${e}' ${o} failed with error: `,p,"url: ",a,"request:",r),p})}Ho(e,n,r,i,s,o){return this.Go(e,n,r,i,s)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Sa}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}zo(e,n){const r=gO[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qt="WebChannelConnection";class vO extends _O{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,s){const o=Bm();return new Promise((a,l)=>{const u=new N0;u.setWithCredentials(!0),u.listenOnce(D0.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case sd.NO_ERROR:const p=u.getResponseJson();Y(qt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case sd.TIMEOUT:Y(qt,`RPC '${e}' ${o} timed out`),l(new ne(H.DEADLINE_EXCEEDED,"Request time out"));break;case sd.HTTP_ERROR:const g=u.getStatus();if(Y(qt,`RPC '${e}' ${o} failed with status:`,g,"response text:",u.getResponseText()),g>0){let v=u.getResponseJson();Array.isArray(v)&&(v=v[0]);const T=v==null?void 0:v.error;if(T&&T.status&&T.message){const x=function(S){const E=S.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(E)>=0?E:H.UNKNOWN}(T.status);l(new ne(x,T.message))}else l(new ne(H.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new ne(H.UNAVAILABLE,"Connection failed."));break;default:ce(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Y(qt,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(i);Y(qt,`RPC '${e}' ${o} sending request:`,i),u.send(n,"POST",f,r,15)})}T_(e,n,r){const i=Bm(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=V0(),a=M0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const f=s.join("");Y(qt,`Creating RPC '${e}' stream ${i}: ${f}`,l);const p=o.createWebChannel(f,l);this.I_(p);let g=!1,v=!1;const T=new yO({Yo:D=>{v?Y(qt,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(g||(Y(qt,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),Y(qt,`RPC '${e}' stream ${i} sending:`,D),p.send(D))},Zo:()=>p.close()}),x=(D,S,E)=>{D.listen(S,R=>{try{E(R)}catch(M){setTimeout(()=>{throw M},0)}})};return x(p,fl.EventType.OPEN,()=>{v||(Y(qt,`RPC '${e}' stream ${i} transport opened.`),T.o_())}),x(p,fl.EventType.CLOSE,()=>{v||(v=!0,Y(qt,`RPC '${e}' stream ${i} transport closed`),T.a_(),this.E_(p))}),x(p,fl.EventType.ERROR,D=>{v||(v=!0,Ni(qt,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),T.a_(new ne(H.UNAVAILABLE,"The operation could not be completed")))}),x(p,fl.EventType.MESSAGE,D=>{var S;if(!v){const E=D.data[0];fe(!!E,16349);const R=E,M=(R==null?void 0:R.error)||((S=R[0])==null?void 0:S.error);if(M){Y(qt,`RPC '${e}' stream ${i} received error:`,M);const O=M.status;let F=function(C){const N=_t[C];if(N!==void 0)return LA(N)}(O),I=M.message;F===void 0&&(F=H.INTERNAL,I="Unknown error status: "+O+" with message "+M.message),v=!0,T.a_(new ne(F,I)),p.close()}else Y(qt,`RPC '${e}' stream ${i} received:`,E),T.u_(E)}}),x(a,b0.STAT_EVENT,D=>{D.stat===ym.PROXY?Y(qt,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===ym.NOPROXY&&Y(qt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{T.__()},0),T}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TO(){return typeof window<"u"?window:null}function md(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(t){return new E4(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CI="PersistentStream";class gx{constructor(e,n,r,i,s,o,a,l){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new mx(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===H.RESOURCE_EXHAUSTED?(Yt(n.toString()),Yt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===H.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===n&&this.G_(r,i)},r=>{e(()=>{const i=new ne(H.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Y(CI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(Y(CI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class EO extends gx{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=S4(this.serializer,e),r=function(s){if(!("targetChange"in s))return me.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?me.min():o.readTime?tn(o.readTime):me.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Mm(this.serializer),n.addTarget=function(s,o){let a;const l=o.target;if(a=sh(l)?{documents:$A(s,l)}:{query:HA(s,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=OA(s,o.resumeToken);const u=Dm(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(me.min())>0){a.readTime=fa(s,o.snapshotVersion.toTimestamp());const u=Dm(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=A4(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Mm(this.serializer),n.removeTarget=e,this.q_(n)}}class IO extends gx{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return fe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,fe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){fe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=C4(e.writeResults,e.commitTime),r=tn(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Mm(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>lh(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{}class SO extends wO{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new ne(H.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Go(e,bm(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ne(H.UNKNOWN,s.toString())})}Ho(e,n,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,bm(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ne(H.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class CO{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Yt(n),this.aa=!1):Y("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs="RemoteStore";class AO{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Qs(this)&&(Y(Hs,"Restarting streams for network reachability change."),await async function(l){const u=Ee(l);u.Ea.add(4),await Vu(u),u.Ra.set("Unknown"),u.Ea.delete(4),await of(u)}(this))})}),this.Ra=new CO(r,i)}}async function of(t){if(Qs(t))for(const e of t.da)await e(!0)}async function Vu(t){for(const e of t.da)await e(!1)}function _x(t,e){const n=Ee(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),M_(n)?b_(n):Aa(n).O_()&&D_(n,e))}function N_(t,e){const n=Ee(t),r=Aa(n);n.Ia.delete(e),r.O_()&&yx(n,e),n.Ia.size===0&&(r.O_()?r.L_():Qs(n)&&n.Ra.set("Unknown"))}function D_(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Aa(t).Y_(e)}function yx(t,e){t.Va.Ue(e),Aa(t).Z_(e)}function b_(t){t.Va=new _4({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Aa(t).start(),t.Ra.ua()}function M_(t){return Qs(t)&&!Aa(t).x_()&&t.Ia.size>0}function Qs(t){return Ee(t).Ea.size===0}function vx(t){t.Va=void 0}async function xO(t){t.Ra.set("Online")}async function RO(t){t.Ia.forEach((e,n)=>{D_(t,e)})}async function PO(t,e){vx(t),M_(t)?(t.Ra.ha(e),b_(t)):t.Ra.set("Unknown")}async function kO(t,e,n){if(t.Ra.set("Online"),e instanceof UA&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.Ia.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ia.delete(a),i.Va.removeTarget(a))}(t,e)}catch(r){Y(Hs,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await fh(t,r)}else if(e instanceof fd?t.Va.Ze(e):e instanceof FA?t.Va.st(e):t.Va.tt(e),!n.isEqual(me.min()))try{const r=await fx(t.localStore);n.compareTo(r)>=0&&await function(s,o){const a=s.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const f=s.Ia.get(u);f&&s.Ia.set(u,f.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const f=s.Ia.get(l);if(!f)return;s.Ia.set(l,f.withResumeToken(gt.EMPTY_BYTE_STRING,f.snapshotVersion)),yx(s,l);const p=new Dr(f.target,l,u,f.sequenceNumber);D_(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){Y(Hs,"Failed to raise snapshot:",r),await fh(t,r)}}async function fh(t,e,n){if(!qi(e))throw e;t.Ea.add(1),await Vu(t),t.Ra.set("Offline"),n||(n=()=>fx(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Y(Hs,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await of(t)})}function Tx(t,e){return e().catch(n=>fh(t,n,e))}async function Lu(t){const e=Ee(t),n=Vi(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ps;for(;NO(e);)try{const i=await hO(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,DO(e,i)}catch(i){await fh(e,i)}Ex(e)&&Ix(e)}function NO(t){return Qs(t)&&t.Ta.length<10}function DO(t,e){t.Ta.push(e);const n=Vi(t);n.O_()&&n.X_&&n.ea(e.mutations)}function Ex(t){return Qs(t)&&!Vi(t).x_()&&t.Ta.length>0}function Ix(t){Vi(t).start()}async function bO(t){Vi(t).ra()}async function MO(t){const e=Vi(t);for(const n of t.Ta)e.ea(n.mutations)}async function VO(t,e,n){const r=t.Ta.shift(),i=T_.from(r,e,n);await Tx(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Lu(t)}async function LO(t,e){e&&Vi(t).X_&&await async function(r,i){if(function(o){return p4(o)&&o!==H.ABORTED}(i.code)){const s=r.Ta.shift();Vi(r).B_(),await Tx(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Lu(r)}}(t,e),Ex(t)&&Ix(t)}async function AI(t,e){const n=Ee(t);n.asyncQueue.verifyOperationInProgress(),Y(Hs,"RemoteStore received new credentials");const r=Qs(n);n.Ea.add(3),await Vu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await of(n)}async function FO(t,e){const n=Ee(t);e?(n.Ea.delete(2),await of(n)):e||(n.Ea.add(2),await Vu(n),n.Ra.set("Unknown"))}function Aa(t){return t.ma||(t.ma=function(n,r,i){const s=Ee(n);return s.sa(),new EO(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Xo:xO.bind(null,t),t_:RO.bind(null,t),r_:PO.bind(null,t),H_:kO.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),M_(t)?b_(t):t.Ra.set("Unknown")):(await t.ma.stop(),vx(t))})),t.ma}function Vi(t){return t.fa||(t.fa=function(n,r,i){const s=Ee(n);return s.sa(),new IO(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:bO.bind(null,t),r_:LO.bind(null,t),ta:MO.bind(null,t),na:VO.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await Lu(t)):(await t.fa.stop(),t.Ta.length>0&&(Y(Hs,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new fr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new V_(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ne(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function L_(t,e){if(Yt("AsyncQueue",`${e}: ${t}`),qi(t))return new ne(H.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{static emptySet(e){return new Ho(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||se.comparator(n.key,r.key):(n,r)=>se.comparator(n.key,r.key),this.keyedMap=pl(),this.sortedSet=new st(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ho)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ho;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(){this.ga=new st(se.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):ce(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class pa{constructor(e,n,r,i,s,o,a,l,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new pa(e,n,Ho.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UO{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class OO{constructor(){this.queries=RI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=Ee(n),s=i.queries;i.queries=RI(),s.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new ne(H.ABORTED,"Firestore shutting down"))}}function RI(){return new Wr(t=>IA(t),Qh)}async function F_(t,e){const n=Ee(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new UO,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=L_(o,`Initialization of query '${fo(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.Sa.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&O_(n)}async function U_(t,e){const n=Ee(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function BO(t,e){const n=Ee(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.Sa)a.Fa(i)&&(r=!0);o.wa=i}}r&&O_(n)}function qO(t,e,n){const r=Ee(t),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(e)}function O_(t){t.Ca.forEach(e=>{e.next()})}var qm,PI;(PI=qm||(qm={})).Ma="default",PI.Cache="cache";class B_{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new pa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=pa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==qm.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{constructor(e){this.key=e}}class Sx{constructor(e){this.key=e}}class GO{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Re(),this.mutatedKeys=Re(),this.eu=wA(e),this.tu=new Ho(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new xI,i=n?n.tu:this.tu;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{const g=i.get(f),v=bu(this.query,p)?p:null,T=!!g&&this.mutatedKeys.has(g.key),x=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let D=!1;g&&v?g.data.isEqual(v.data)?T!==x&&(r.track({type:3,doc:v}),D=!0):this.su(g,v)||(r.track({type:2,doc:v}),D=!0,(l&&this.eu(v,l)>0||u&&this.eu(v,u)<0)&&(a=!0)):!g&&v?(r.track({type:0,doc:v}),D=!0):g&&!v&&(r.track({type:1,doc:g}),D=!0,(l||u)&&(a=!0)),D&&(v?(o=o.add(v),s=x?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{tu:o,iu:r,Cs:a,mutatedKeys:s}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((f,p)=>function(v,T){const x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce(20277,{Rt:D})}};return x(v)-x(T)}(f.type,p.type)||this.eu(f.doc,p.doc)),this.ou(r),i=i??!1;const a=n&&!i?this._u():[],l=this.Xa.size===0&&this.current&&!i?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new pa(this.query,e.tu,s,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new xI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Re(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new Sx(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new wx(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Re();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return pa.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const q_="SyncEngine";class zO{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class $O{constructor(e){this.key=e,this.hu=!1}}class HO{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Wr(a=>IA(a),Qh),this.Iu=new Map,this.Eu=new Set,this.du=new st(se.comparator),this.Au=new Map,this.Ru=new A_,this.Vu={},this.mu=new Map,this.fu=$s.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function WO(t,e,n=!0){const r=kx(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await Cx(r,e,n,!0),i}async function KO(t,e){const n=kx(t);await Cx(n,e,!0,!1)}async function Cx(t,e,n,r){const i=await fO(t.localStore,Mn(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await jO(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&_x(t.remoteStore,i),a}async function jO(t,e,n,r,i){t.pu=(p,g,v)=>async function(x,D,S,E){let R=D.view.ru(S);R.Cs&&(R=await EI(x.localStore,D.query,!1).then(({documents:I})=>D.view.ru(I,R)));const M=E&&E.targetChanges.get(D.targetId),O=E&&E.targetMismatches.get(D.targetId)!=null,F=D.view.applyChanges(R,x.isPrimaryClient,M,O);return NI(x,D.targetId,F.au),F.snapshot}(t,p,g,v);const s=await EI(t.localStore,e,!0),o=new GO(e,s.Qs),a=o.ru(s.documents),l=Mu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,l);NI(t,n,u.au);const f=new zO(e,n,o);return t.Tu.set(e,f),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}async function JO(t,e,n){const r=Ee(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(o=>!Qh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Om(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&N_(r.remoteStore,i.targetId),Gm(r,i.targetId)}).catch(Js)):(Gm(r,i.targetId),await Om(r.localStore,i.targetId,!0))}async function QO(t,e){const n=Ee(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),N_(n.remoteStore,r.targetId))}async function YO(t,e,n){const r=Nx(t);try{const i=await function(o,a){const l=Ee(o),u=ze.now(),f=a.reduce((v,T)=>v.add(T.key),Re());let p,g;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let T=Tn(),x=Re();return l.Ns.getEntries(v,f).next(D=>{T=D,T.forEach((S,E)=>{E.isValidDocument()||(x=x.add(S))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,T)).next(D=>{p=D;const S=[];for(const E of a){const R=h4(E,p.get(E.key).overlayedDocument);R!=null&&S.push(new Kr(E.key,R,fA(R.value.mapValue),Xt.exists(!0)))}return l.mutationQueue.addMutationBatch(v,u,S,a)}).next(D=>{g=D;const S=D.applyToLocalDocumentSet(p,x);return l.documentOverlayCache.saveOverlays(v,D.batchId,S)})}).then(()=>({batchId:g.batchId,changes:CA(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new st(Te)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,i.batchId,n),await Fu(r,i.changes),await Lu(r.remoteStore)}catch(i){const s=L_(i,"Failed to persist write");n.reject(s)}}async function Ax(t,e){const n=Ee(t);try{const r=await cO(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.Au.get(s);o&&(fe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?fe(o.hu,14607):i.removedDocuments.size>0&&(fe(o.hu,42227),o.hu=!1))}),await Fu(n,r,e)}catch(r){await Js(r)}}function kI(t,e,n){const r=Ee(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach((s,o)=>{const a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const l=Ee(o);l.onlineState=a;let u=!1;l.queries.forEach((f,p)=>{for(const g of p.Sa)g.va(a)&&(u=!0)}),u&&O_(l)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function XO(t,e,n){const r=Ee(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let o=new st(se.comparator);o=o.insert(s,ht.newNoDocument(s,me.min()));const a=Re().add(s),l=new ef(me.min(),new Map,new st(Te),o,a);await Ax(r,l),r.du=r.du.remove(s),r.Au.delete(e),G_(r)}else await Om(r.localStore,e,!1).then(()=>Gm(r,e,n)).catch(Js)}async function ZO(t,e){const n=Ee(t),r=e.batch.batchId;try{const i=await uO(n.localStore,e);Rx(n,r,null),xx(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Fu(n,i)}catch(i){await Js(i)}}async function e3(t,e,n){const r=Ee(t);try{const i=await function(o,a){const l=Ee(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let f;return l.mutationQueue.lookupMutationBatch(u,a).next(p=>(fe(p!==null,37113),f=p.keys(),l.mutationQueue.removeMutationBatch(u,p))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,f,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,f)).next(()=>l.localDocuments.getDocuments(u,f))})}(r.localStore,e);Rx(r,e,n),xx(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Fu(r,i)}catch(i){await Js(i)}}function xx(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function Rx(t,e,n){const r=Ee(t);let i=r.Vu[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Gm(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||Px(t,r)})}function Px(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(N_(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),G_(t))}function NI(t,e,n){for(const r of n)r instanceof wx?(t.Ru.addReference(r.key,e),t3(t,r)):r instanceof Sx?(Y(q_,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||Px(t,r.key)):ce(19791,{wu:r})}function t3(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Y(q_,"New document in limbo: "+n),t.Eu.add(r),G_(t))}function G_(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new se(Ge.fromString(e)),r=t.fu.next();t.Au.set(r,new $O(n)),t.du=t.du.insert(n,r),_x(t.remoteStore,new Dr(Mn(Du(n.path)),r,"TargetPurposeLimboResolution",Nn.ce))}}async function Fu(t,e,n){const r=Ee(t),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,n).then(u=>{var f;if((u||n)&&r.isPrimaryClient){const p=u?!u.fromCache:(f=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:f.current;r.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(u){i.push(u);const p=P_.As(l.targetId,u);s.push(p)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(l,u){const f=Ee(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>B.forEach(u,g=>B.forEach(g.Es,v=>f.persistence.referenceDelegate.addReference(p,g.targetId,v)).next(()=>B.forEach(g.ds,v=>f.persistence.referenceDelegate.removeReference(p,g.targetId,v)))))}catch(p){if(!qi(p))throw p;Y(k_,"Failed to update sequence numbers: "+p)}for(const p of u){const g=p.targetId;if(!p.fromCache){const v=f.Ms.get(g),T=v.snapshotVersion,x=v.withLastLimboFreeSnapshotVersion(T);f.Ms=f.Ms.insert(g,x)}}}(r.localStore,s))}async function n3(t,e){const n=Ee(t);if(!n.currentUser.isEqual(e)){Y(q_,"User change. New user:",e.toKey());const r=await hx(n.localStore,e);n.currentUser=e,function(s,o){s.mu.forEach(a=>{a.forEach(l=>{l.reject(new ne(H.CANCELLED,o))})}),s.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Fu(n,r.Ls)}}function r3(t,e){const n=Ee(t),r=n.Au.get(e);if(r&&r.hu)return Re().add(r.key);{let i=Re();const s=n.Iu.get(e);if(!s)return i;for(const o of s){const a=n.Tu.get(o);i=i.unionWith(a.view.nu)}return i}}function kx(t){const e=Ee(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ax.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=r3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=XO.bind(null,e),e.Pu.H_=BO.bind(null,e.eventManager),e.Pu.yu=qO.bind(null,e.eventManager),e}function Nx(t){const e=Ee(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ZO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=e3.bind(null,e),e}class gu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return dx(this.persistence,new cx,e.initialUser,this.serializer)}Cu(e){return new x_(rf.mi,this.serializer)}Du(e){return new px}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gu.provider={build:()=>new gu};class i3 extends gu{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){fe(this.persistence.referenceDelegate instanceof hh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sx(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Gt.withCacheSize(this.cacheSizeBytes):Gt.DEFAULT;return new x_(r=>hh.mi(r,n),this.serializer)}}class s3 extends gu{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Nx(this.xu.syncEngine),await Lu(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return dx(this.persistence,new cx,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new sx(r,e.asyncQueue,n)}Mu(e,n){const r=new dU(n,this.persistence);return new cU(e.asyncQueue,r)}Cu(e){const n=sO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Gt.withCacheSize(this.cacheSizeBytes):Gt.DEFAULT;return new R_(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,TO(),md(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new px}}class ph{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>kI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=n3.bind(null,this.syncEngine),await FO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new OO}()}createDatastore(e){const n=sf(e.databaseInfo.databaseId),r=function(s){return new vO(s)}(e.databaseInfo);return function(s,o,a,l){return new SO(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new AO(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>kI(this.syncEngine,n,0),function(){return SI.v()?new SI:new mO}())}createSyncEngine(e,n){return function(i,s,o,a,l,u,f){const p=new HO(i,s,o,a,l,u);return f&&(p.gu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=Ee(i);Y(Hs,"RemoteStore shutting down."),s.Ea.add(5),await Vu(s),s.Aa.shutdown(),s.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}ph.provider={build:()=>new ph};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Yt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Li="FirestoreClient";class o3{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Vt.UNAUTHENTICATED,this.clientId=qh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{Y(Li,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Y(Li,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=L_(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function ap(t,e){t.asyncQueue.verifyOperationInProgress(),Y(Li,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await hx(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function DI(t,e){t.asyncQueue.verifyOperationInProgress();const n=await a3(t);Y(Li,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>AI(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>AI(e.remoteStore,i)),t._onlineComponents=e}async function a3(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Y(Li,"Using user provided OfflineComponentProvider");try{await ap(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===H.FAILED_PRECONDITION||i.code===H.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Ni("Error using user provided cache. Falling back to memory cache: "+n),await ap(t,new gu)}}else Y(Li,"Using default OfflineComponentProvider"),await ap(t,new i3(void 0));return t._offlineComponents}async function Dx(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Y(Li,"Using user provided OnlineComponentProvider"),await DI(t,t._uninitializedComponentsProvider._online)):(Y(Li,"Using default OnlineComponentProvider"),await DI(t,new ph))),t._onlineComponents}function l3(t){return Dx(t).then(e=>e.syncEngine)}async function mh(t){const e=await Dx(t),n=e.eventManager;return n.onListen=WO.bind(null,e.syncEngine),n.onUnlisten=JO.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=KO.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=QO.bind(null,e.syncEngine),n}function u3(t,e,n={}){const r=new fr;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,u){const f=new z_({next:g=>{f.Nu(),o.enqueueAndForget(()=>U_(s,p));const v=g.docs.has(a);!v&&g.fromCache?u.reject(new ne(H.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&l&&l.source==="server"?u.reject(new ne(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new B_(Du(a.path),f,{includeMetadataChanges:!0,qa:!0});return F_(s,p)}(await mh(t),t.asyncQueue,e,n,r)),r.promise}function c3(t,e,n={}){const r=new fr;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,u){const f=new z_({next:g=>{f.Nu(),o.enqueueAndForget(()=>U_(s,p)),g.fromCache&&l.source==="server"?u.reject(new ne(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new B_(a,f,{includeMetadataChanges:!0,qa:!0});return F_(s,p)}(await mh(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx="firestore.googleapis.com",MI=!0;class VI{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ne(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Mx,this.ssl=MI}else this.host=e.host,this.ssl=e.ssl??MI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=tx;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<G4)throw new ne(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}G0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bx(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ne(H.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ne(H.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ne(H.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class af{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new VI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ne(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new VI(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new O0;switch(r.type){case"firstParty":return new tU(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ne(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=bI.get(n);r&&(Y("ComponentProvider","Removing Datastore"),bI.delete(n),r.terminate())}(this),Promise.resolve()}}function Vx(t,e,n,r={}){var u;t=en(t,af);const i=Ea(e),s=t._getSettings(),o={...s,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;i&&(qC(`https://${a}`),GC("Firestore",!0)),s.host!==Mx&&s.host!==a&&Ni("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:a,ssl:i,emulatorOptions:r};if(!Us(l,o)&&(t._setSettings(l),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Vt.MOCK_USER;else{f=A2(r.mockUserToken,(u=t._app)==null?void 0:u.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new ne(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Vt(g)}t._authCredentials=new XF(new U0(f,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new zi(this.firestore,e,this._query)}}class lt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lt(this.firestore,e,this._key)}toJSON(){return{type:lt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Ru(n,lt._jsonSchema))return new lt(e,r||null,new se(Ge.fromString(n.referencePath)))}}lt._jsonSchemaVersion="firestore/documentReference/1.0",lt._jsonSchema={type:Tt("string",lt._jsonSchemaVersion),referencePath:Tt("string")};class Mr extends zi{constructor(e,n,r){super(e,n,Du(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new lt(this.firestore,null,new se(e))}withConverter(e){return new Mr(this.firestore,e,this._path)}}function yt(t,e,...n){if(t=At(t),q0("collection","path",e),t instanceof af){const r=Ge.fromString(e,...n);return CE(r),new Mr(t,null,r)}{if(!(t instanceof lt||t instanceof Mr))throw new ne(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return CE(r),new Mr(t.firestore,null,r)}}function tt(t,e,...n){if(t=At(t),arguments.length===1&&(e=qh.newId()),q0("doc","path",e),t instanceof af){const r=Ge.fromString(e,...n);return SE(r),new lt(t,null,new se(r))}{if(!(t instanceof lt||t instanceof Mr))throw new ne(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return SE(r),new lt(t.firestore,t instanceof Mr?t.converter:null,new se(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI="AsyncQueue";class FI{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new mx(this,"async_queue_retry"),this._c=()=>{const r=md();r&&Y(LI,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=md();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=md();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new fr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!qi(e))throw e;Y(LI,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Yt("INTERNAL UNHANDLED ERROR: ",UI(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=V_.createAndSchedule(this,e,n,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&ce(47125,{Pc:UI(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function UI(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OI(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const i=n;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}class gr extends af{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new FI,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new FI(e),this._firestoreClient=void 0,await e}}}function Lx(t,e){const n=typeof t=="object"?t:QC(),r=typeof t=="string"?t:rh,i=Qg(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=S2("firestore");s&&Vx(i,...s)}return i}function Uu(t){if(t._terminated)throw new ne(H.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Fx(t),t._firestoreClient}function Fx(t){var r,i,s;const e=t._freezeSettings(),n=function(a,l,u,f){return new BU(a,l,u,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,bx(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((s=e.localCache)!=null&&s._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new o3(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}function Ux(t,e){Ni("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return d3(t,ph.provider,{build:r=>new s3(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function d3(t,e,n){if((t=en(t,gr))._firestoreClient||t._terminated)throw new ne(H.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ne(H.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},Fx(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yn(gt.fromBase64String(e))}catch(n){throw new ne(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new yn(gt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ru(e,yn._jsonSchema))return yn.fromBase64String(e.bytes)}}yn._jsonSchemaVersion="firestore/bytes/1.0",yn._jsonSchema={type:Tt("string",yn._jsonSchemaVersion),bytes:Tt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ne(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ne(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ne(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Te(this._lat,e._lat)||Te(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qn._jsonSchemaVersion}}static fromJSON(e){if(Ru(e,Qn._jsonSchema))return new Qn(e.latitude,e.longitude)}}Qn._jsonSchemaVersion="firestore/geoPoint/1.0",Qn._jsonSchema={type:Tt("string",Qn._jsonSchemaVersion),latitude:Tt("number"),longitude:Tt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Yn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ru(e,Yn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Yn(e.vectorValues);throw new ne(H.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Yn._jsonSchemaVersion="firestore/vectorValue/1.0",Yn._jsonSchema={type:Tt("string",Yn._jsonSchemaVersion),vectorValues:Tt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h3=/^__.*__$/;class f3{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Kr(e,this.data,this.fieldMask,n,this.fieldTransforms):new Ca(e,this.data,n,this.fieldTransforms)}}class Ox{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Kr(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Bx(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ce(40011,{Ac:t})}}class $_{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new $_({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return gh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Bx(this.Ac)&&h3.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class p3{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||sf(e)}Cc(e,n,r,i=!1){return new $_({Ac:e,methodName:n,Dc:r,path:it.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function H_(t){const e=t._freezeSettings(),n=sf(t._databaseId);return new p3(t._databaseId,!!e.ignoreUndefinedProperties,n)}function m3(t,e,n,r,i,s={}){const o=t.Cc(s.merge||s.mergeFields?2:0,e,n,i);K_("Data must be an object, but it was:",o,r);const a=qx(r,o);let l,u;if(s.merge)l=new un(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const f=[];for(const p of s.mergeFields){const g=zm(e,p,n);if(!o.contains(g))throw new ne(H.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);zx(f,g)||f.push(g)}l=new un(f),u=o.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,u=o.fieldTransforms;return new f3(new $t(a),l,u)}class lf extends Bu{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lf}}class W_ extends Bu{_toFieldTransform(e){return new DA(e.path,new ca)}isEqual(e){return e instanceof W_}}function g3(t,e,n,r){const i=t.Cc(1,e,n);K_("Data must be an object, but it was:",i,r);const s=[],o=$t.empty();Gi(r,(l,u)=>{const f=j_(e,l,n);u=At(u);const p=i.yc(f);if(u instanceof lf)s.push(f);else{const g=qu(u,p);g!=null&&(s.push(f),o.set(f,g))}});const a=new un(s);return new Ox(o,a,i.fieldTransforms)}function _3(t,e,n,r,i,s){const o=t.Cc(1,e,n),a=[zm(e,r,n)],l=[i];if(s.length%2!=0)throw new ne(H.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(zm(e,s[g])),l.push(s[g+1]);const u=[],f=$t.empty();for(let g=a.length-1;g>=0;--g)if(!zx(u,a[g])){const v=a[g];let T=l[g];T=At(T);const x=o.yc(v);if(T instanceof lf)u.push(v);else{const D=qu(T,x);D!=null&&(u.push(v),f.set(v,D))}}const p=new un(u);return new Ox(f,p,o.fieldTransforms)}function y3(t,e,n,r=!1){return qu(n,t.Cc(r?4:3,e))}function qu(t,e){if(Gx(t=At(t)))return K_("Unsupported field value:",e,t),qx(t,e);if(t instanceof Bu)return function(r,i){if(!Bx(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let l=qu(a,i.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=At(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return o4(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=ze.fromDate(r);return{timestampValue:fa(i.serializer,s)}}if(r instanceof ze){const s=new ze(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:fa(i.serializer,s)}}if(r instanceof Qn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof yn)return{bytesValue:OA(i.serializer,r._byteString)};if(r instanceof lt){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:w_(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Yn)return function(o,a){return{mapValue:{fields:{[m_]:{stringValue:g_},[oa]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return y_(a.serializer,u)})}}}}}}(r,i);throw i.Sc(`Unsupported field value: ${Gh(r)}`)}(t,e)}function qx(t,e){const n={};return iA(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gi(t,(r,i)=>{const s=qu(i,e.mc(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Gx(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ze||t instanceof Qn||t instanceof yn||t instanceof lt||t instanceof Bu||t instanceof Yn)}function K_(t,e,n){if(!Gx(n)||!z0(n)){const r=Gh(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function zm(t,e,n){if((e=At(e))instanceof Ou)return e._internalPath;if(typeof e=="string")return j_(t,e);throw gh("Field path arguments must be of type string or ",t,!1,void 0,n)}const v3=new RegExp("[~\\*/\\[\\]]");function j_(t,e,n){if(e.search(v3)>=0)throw gh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ou(...e.split("."))._internalPath}catch{throw gh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function gh(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new ne(H.INVALID_ARGUMENT,a+t+l)}function zx(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new lt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new T3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(J_("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class T3 extends $x{data(){return super.data()}}function J_(t,e){return typeof e=="string"?j_(t,e):e instanceof Ou?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ne(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Q_{}class Wx extends Q_{}function gd(t,e,...n){let r=[];e instanceof Q_&&r.push(e),r=r.concat(n),function(s){const o=s.filter(l=>l instanceof uf).length,a=s.filter(l=>l instanceof Gu).length;if(o>1||o>0&&a>0)throw new ne(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Gu extends Wx{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Gu(e,n,r)}_apply(e){const n=this._parse(e);return Kx(e._query,n),new zi(e.firestore,e.converter,km(e._query,n))}_parse(e){const n=H_(e.firestore);return function(s,o,a,l,u,f,p){let g;if(u.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new ne(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){qI(p,f);const T=[];for(const x of p)T.push(BI(l,s,x));g={arrayValue:{values:T}}}else g=BI(l,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||qI(p,f),g=y3(a,o,p,f==="in"||f==="not-in");return be.create(u,f,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function _d(t,e,n){const r=e,i=J_("where",t);return Gu._create(i,r,n)}class uf extends Q_{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new uf(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:$e.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const l of a)Kx(o,l),o=km(o,l)}(e._query,n),new zi(e.firestore,e.converter,km(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function BI(t,e,n){if(typeof(n=At(n))=="string"){if(n==="")throw new ne(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!EA(e)&&n.indexOf("/")!==-1)throw new ne(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ge.fromString(n));if(!se.isDocumentKey(r))throw new ne(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fu(t,new se(r))}if(n instanceof lt)return fu(t,n._key);throw new ne(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Gh(n)}.`)}function qI(t,e){if(!Array.isArray(t)||t.length===0)throw new ne(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Kx(t,e){const n=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ne(H.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ne(H.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class jx{convertValue(e,n="none"){switch(bi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Gr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ce(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Gi(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var r,i,s;const n=(s=(i=(r=e.fields)==null?void 0:r[oa].arrayValue)==null?void 0:i.values)==null?void 0:s.map(o=>nt(o.doubleValue));return new Yn(n)}convertGeoPoint(e){return new Qn(nt(e.latitude),nt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=jh(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(du(e));default:return null}}convertTimestamp(e){const n=qr(e);return new ze(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ge.fromString(e);fe(JA(r),9688,{name:e});const i=new Di(r.get(1),r.get(3)),s=new se(r.popFirst(5));return i.isEqual(n)||Yt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E3(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Do{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ai extends $x{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Ul(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(J_("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ne(H.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Ai._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Ai._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ai._jsonSchema={type:Tt("string",Ai._jsonSchemaVersion),bundleSource:Tt("string","DocumentSnapshot"),bundleName:Tt("string"),bundle:Tt("string")};class Ul extends Ai{data(e={}){return super.data(e)}}class xi{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Do(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Ul(this._firestore,this._userDataWriter,r.key,r,new Do(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ne(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const l=new Ul(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Do(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const l=new Ul(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Do(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,f=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),f=o.indexOf(a.doc.key)),{type:I3(a.type),doc:l,oldIndex:u,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ne(H.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=xi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=qh.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(n.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function I3(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $m(t){t=en(t,lt);const e=en(t.firestore,gr);return u3(Uu(e),t._key).then(n=>Jx(e,t,n))}xi._jsonSchemaVersion="firestore/querySnapshot/1.0",xi._jsonSchema={type:Tt("string",xi._jsonSchemaVersion),bundleSource:Tt("string","QuerySnapshot"),bundleName:Tt("string"),bundle:Tt("string")};class Y_ extends jx{constructor(e){super(),this.firestore=e}convertBytes(e){return new yn(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new lt(this.firestore,null,n)}}function _o(t){t=en(t,zi);const e=en(t.firestore,gr),n=Uu(e),r=new Y_(e);return Hx(t._query),c3(n,t._query).then(i=>new xi(e,r,t,i))}function pt(t,e,n){t=en(t,lt);const r=en(t.firestore,gr),i=E3(t.converter,e,n);return cf(r,[m3(H_(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Xt.none())])}function Hm(t,e,n,...r){t=en(t,lt);const i=en(t.firestore,gr),s=H_(i);let o;return o=typeof(e=At(e))=="string"||e instanceof Ou?_3(s,"updateDoc",t._key,e,n,r):g3(s,"updateDoc",t._key,e),cf(i,[o.toMutation(t._key,Xt.exists(!0))])}function gs(t){return cf(en(t.firestore,gr),[new Zh(t._key,Xt.none())])}function _l(t,...e){var l,u,f;t=At(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||OI(e[r])||(n=e[r++]);const i={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(OI(e[r])){const p=e[r];e[r]=(l=p.next)==null?void 0:l.bind(p),e[r+1]=(u=p.error)==null?void 0:u.bind(p),e[r+2]=(f=p.complete)==null?void 0:f.bind(p)}let s,o,a;if(t instanceof lt)o=en(t.firestore,gr),a=Du(t._key.path),s={next:p=>{e[r]&&e[r](Jx(o,t,p))},error:e[r+1],complete:e[r+2]};else{const p=en(t,zi);o=en(p.firestore,gr),a=p._query;const g=new Y_(o);s={next:v=>{e[r]&&e[r](new xi(o,g,p,v))},error:e[r+1],complete:e[r+2]},Hx(t._query)}return function(g,v,T,x){const D=new z_(x),S=new B_(v,D,T);return g.asyncQueue.enqueueAndForget(async()=>F_(await mh(g),S)),()=>{D.Nu(),g.asyncQueue.enqueueAndForget(async()=>U_(await mh(g),S))}}(Uu(o),a,i,s)}function cf(t,e){return function(r,i){const s=new fr;return r.asyncQueue.enqueueAndForget(async()=>YO(await l3(r),i,s)),s.promise}(Uu(t),e)}function Jx(t,e,n){const r=n.docs.get(e._key),i=new Y_(t);return new Ai(t,i,e._key,r,new Do(n.hasPendingWrites,n.fromCache),e.converter)}function w3(){return new W_("serverTimestamp")}(function(e,n=!0){(function(i){Sa=i})(Ia),Zo(new Os("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new gr(new ZF(r.getProvider("auth-internal")),new nU(o,r.getProvider("app-check-internal")),function(u,f){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new ne(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Di(u.options.projectId,f)}(o,i),o);return s={useFetchStreams:n,...s},a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),wi(TE,EE,e),wi(TE,EE,"esm2020")})();const ll=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:jx,Bytes:yn,CollectionReference:Mr,DocumentReference:lt,DocumentSnapshot:Ai,FieldPath:Ou,FieldValue:Bu,Firestore:gr,FirestoreError:ne,GeoPoint:Qn,Query:zi,QueryCompositeFilterConstraint:uf,QueryConstraint:Wx,QueryDocumentSnapshot:Ul,QueryFieldFilterConstraint:Gu,QuerySnapshot:xi,SnapshotMetadata:Do,Timestamp:ze,VectorValue:Yn,_AutoId:qh,_ByteString:gt,_DatabaseId:Di,_DocumentKey:se,_EmptyAuthCredentialsProvider:O0,_FieldPath:it,_cast:en,_logWarn:Ni,_validateIsNotUsedTogether:G0,collection:yt,connectFirestoreEmulator:Vx,deleteDoc:gs,doc:tt,enableIndexedDbPersistence:Ux,ensureFirestoreConfigured:Uu,executeWrite:cf,getDoc:$m,getDocs:_o,getFirestore:Lx,onSnapshot:_l,query:gd,serverTimestamp:w3,setDoc:pt,setLogLevel:L0,updateDoc:Hm,where:_d},Symbol.toStringTag,{value:"Module"}));L0("error");const S3={apiKey:"AIzaSyC1zhlBnbOxP_PCaHU6L-UsDOBRTjGgpfk",authDomain:"my-apss-da774.firebaseapp.com",projectId:"my-apss-da774",storageBucket:"my-apss-da774.firebasestorage.app",messagingSenderId:"528434940137",appId:"1:528434940137:web:56be66185a46f390b60878",measurementId:"G-WPGZGF4ZBG"},Qx=JC(S3),yo=QF(Qx);FL(yo,T0).catch(t=>console.error("Persistence error:",t));const X_=new xr;X_.addScope("profile");X_.addScope("email");const we=Lx(Qx);Ux(we).catch(t=>{t.code==="failed-precondition"?console.warn("Firestore: Multiple tabs open, persistence disabled"):t.code==="unimplemented"&&console.warn("Firestore: Browser does not support persistence")});const GI=()=>{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet/i.test(navigator.userAgent),n=navigator.maxTouchPoints&&navigator.maxTouchPoints>2,r=window.innerWidth<=768;return console.log("Mobile detection:",{isUserAgentMobile:e,isTouchDevice:n,isSmallScreen:r,userAgent:navigator.userAgent}),e||n&&r},zI=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,sr=t=>{if(t==null)return;if(typeof t!="object")return t;if(Array.isArray(t))return t.map(r=>sr(r)).filter(r=>r!==void 0);if(t===null)return;let e;try{e=Object.entries(t)}catch(r){console.error("❌ Object.entries 실패:",r,t);return}const n={};for(const[r,i]of e){if(i===void 0||typeof i=="string"&&i.trim()===""){console.warn(`⚠️ 필드 제거됨: ${r} = ${i}`);continue}if(typeof i=="object"&&i!==null){const s=sr(i);s!==void 0&&(n[r]=s)}else n[r]=i}return Object.keys(n).length>0?n:void 0},$I=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Yx=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("This browser does not support notifications"),!1),Xx=async()=>{try{if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.log("Push notifications not supported"),!1;const e=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:C3("BOEd9nQKXBj8LJXNM6LJt6Nua5MJMhF8cCQvMNJ-2NWoWsM0cGgNqDG3kNm-QMYbdMDYAXaJ55MFP_fPHqH7SFA")});return await A3(e),!0}catch(t){return console.error("Failed to subscribe to push notifications:",t),!1}},C3=t=>{const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(n),i=new Uint8Array(r.length);for(let s=0;s<r.length;++s)i[s]=r.charCodeAt(s);return i},A3=async t=>{try{(await fetch("/api/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:t.toJSON(),endpoint:t.endpoint})})).ok||console.error("Failed to send subscription to server")}catch(e){console.error("Error sending subscription to server:",e)}},x3=({onClose:t})=>{const[e,n]=$.useState(null),[r,i]=$.useState(!1);$.useEffect(()=>{const o=/iPad|iPhone|iPod/.test(navigator.userAgent);i(o);const a=l=>{l.preventDefault(),n(l)};return window.addEventListener("beforeinstallprompt",a),()=>{window.removeEventListener("beforeinstallprompt",a)}},[]);const s=async()=>{if(e){e.prompt();const{outcome:o}=await e.userChoice;o==="accepted"&&(n(null),t())}};return m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm w-full",children:[m.jsxs("div",{className:"text-center mb-4",children:[m.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-lg mx-auto mb-4 flex items-center justify-center",children:m.jsx("span",{className:"text-white text-2xl font-bold",children:"N"})}),m.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"앱으로 설치하기"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Nova Beta를 홈 화면에 추가하여 더 편리하게 사용하세요."})]}),r?m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:"bg-blue-50 dark:bg-blue-900 p-3 rounded-lg mb-3",children:m.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"iOS에서 설치하는 방법:"})}),m.jsxs("ol",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-2",children:[m.jsxs("li",{className:"flex items-center",children:[m.jsx("span",{className:"w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs mr-2",children:"1"}),"하단의 공유 버튼 (□↗) 탭"]}),m.jsxs("li",{className:"flex items-center",children:[m.jsx("span",{className:"w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs mr-2",children:"2"}),'"홈 화면에 추가" 선택']}),m.jsxs("li",{className:"flex items-center",children:[m.jsx("span",{className:"w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs mr-2",children:"3"}),'"추가" 버튼 탭']})]})]}):m.jsx("div",{className:"mb-4",children:e?m.jsx("button",{onClick:s,className:"w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors",children:"지금 설치하기"}):m.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:'브라우저 메뉴에서 "홈 화면에 추가" 또는 "앱 설치"를 선택하세요.'})})}),m.jsxs("div",{className:"flex space-x-2",children:[m.jsx("button",{onClick:t,className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"나중에"}),m.jsx("button",{onClick:()=>{localStorage.setItem("pwa-prompt-dismissed","true"),t()},className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"다시 보지 않기"})]})]})})},R3={ko:{language_selection_title:"언어",error_wish_required:"목표를 입력해주세요.",error_outcome_required:"결과를 입력해주세요.",error_obstacle_required:"장애물을 입력해주세요.",error_plan_required:"If-Then 계획을 입력해주세요.",error_deadline_required:"마감일을 선택해주세요.",error_day_required:"하나 이상의 요일을 선택해주세요.",my_goals_title:"나의 목표",all_goals_label:"모든 목표",sort_label_manual:"사용자화",sort_label_deadline:"마감일순",sort_label_newest:"최신순",sort_label_alphabetical:"이름순",sort_label_ai:"우선순위로 정렬",ai_sorting_button:"정렬 중...",add_new_goal_button_label:"새로운 목표 추가",filter_all:"모든 목표",filter_active:"진행중",filter_completed:"완료됨",filter_category:"카테고리",category_all:"모든 카테고리",category_school:"학교",category_work:"회사",category_personal:"개인",category_other:"기타",category_label:"카테고리 선택",empty_message_all:"+ 버튼으로 목표를 추가해보세요",empty_message_active:"진행중인 목표가 없습니다.",empty_message_completed:"아직 완료된 목표가 없습니다.",empty_encouragement_1:"새로운 여정의 첫 걸음을 내딛어보세요.",empty_encouragement_2:"작은 변화가 큰 성취로 이어집니다.",empty_encouragement_3:"오늘 하는 일이 내일을 만듭니다.",empty_encouragement_4:"당신의 목표가 현실이 되는 순간을 만나보세요.",delete_button:"삭제",edit_button_aria:"편집",info_button_aria:"정보",filter_title:"필터",sort_title:"정렬",filter_sort_button_aria:"필터 및 정렬",calendar_view_button_aria:"달력 보기",list_view_button_aria:"목록 보기",more_options_button_aria:"더보기",select_button_label:"선택",cancel_selection_button_label:"취소",delete_selected_button_label:"{count}개 삭제",delete_selected_confirm_title:"목표 삭제",delete_selected_confirm_message:"선택한 {count}개의 목표가 영구적으로 삭제됩니다. 이 작업은 되돌릴 수 없습니다.",days_left:"{count}일 남음",d_day:"오늘",days_overdue:"{count}일 지남",month_names:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],day_names_short:["일","월","화","수","목","금","토"],day_names_long:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],calendar_header_month_format:"{year}년 {month}",calendar_view_day3:"3일",calendar_view_week:"주",calendar_view_month:"월",settings_title:"설정",sort_alert_title:"정렬 실패",sort_alert_message:"우선순위 정렬을 사용하려면<br/>2개 이상의 목표가 필요합니다.",ai_sort_error_title:"정렬 오류",ai_sort_error_message:"서버에 연결할 수 없습니다. 나중에 다시 시도해주세요.",confirm_button:"확인",new_goal_modal_title:"새로운 목표",edit_goal_modal_title:"목표 편집",wish_label:"목표",outcome_label:"최상의 결과",obstacle_label:"장애물",plan_label:"If-Then 계획",deadline_label:"마감일",cancel_button:"취소",add_button:"추가",save_button:"저장",goal_details_modal_title:"목표 상세 정보",ai_coach_suggestion:"요약보기",ai_analyzing:"분석 중...",close_button:"닫기",ai_sort_reason_modal_title:"AI 정렬 재안",ai_sort_criteria:"AI 정렬 기준",delete_account_final_confirm_title:"모든 데이터 및 설정 지우기",delete_account_final_confirm_message:"모든 목표와 데이터가 영구적으로 삭제되며, 이 작업은 되돌릴 수 없습니다.",delete_all_data_button:"모든 데이터 및 설정 지우기",settings_done_button:"완료",settings_section_data:"데이터 관리",settings_section_account:"Nova Beta 계정",settings_sync_data:"지금 동기화",settings_load_data:"불러오기",settings_logout:"로그아웃",settings_export_data:"데이터 내보내기",settings_import_data:"데이터 가져오기",import_confirm_title:"데이터 가져오기",import_confirm_message:"현재 목표를 새로운 데이터로 교체합니다. 이 작업은 되돌릴 수 없습니다.",import_success_toast:"데이터를 성공적으로 가져왔습니다.",import_error_alert_title:"가져오기 실패",import_error_alert_message:"파일을 읽는 중 오류가 발생했거나 파일 형식이 올바르지 않습니다. 나중에 다시 시도히십시오.",settings_section_general:"일반",settings_section_info:"정보",settings_section_help:"사용방법",settings_theme_mode:"테마 모드",theme_mode_light:"라이트 모드",theme_mode_light_desc:"항상 밝은 테마 사용",theme_mode_dark:"다크 모드",theme_mode_dark_desc:"항상 어두운 테마 사용",theme_mode_system:"자동",theme_mode_system_desc:"기기의 설정에에 동기화 됩니다.",settings_dark_mode:"다크 모드",settings_language:"언어",settings_api_key:"Gemini AI 설정",settings_api_key_placeholder:"Gemini API 키 입력",settings_offline_mode:"오프라인 사용",settings_offline_mode_desc:"AI 기능 없이 기본 기능 사용",settings_notifications:"알림",settings_notifications_desc:"PWA 알림 설정",notification_settings_title:"어떤 알림을 받을까요?",reminder_add_title:"미리알림 추가",reminder_step_title:"{step}/5 단계",reminder_step1_title:"🔔 제목",reminder_step1_desc:"미리알림의 제목을 입력하세요",reminder_step2_title:"📅 기한 & ⏰ 시간",reminder_step2_desc:"기한 날짜와 시간을 설정하세요 (선택사항)",reminder_step2_date_toggle:"기한 설정",reminder_step2_time_toggle:"시간 설정",reminder_step3_title:"🔄 반복 설정",reminder_step3_desc:"반복 여부와 반복 주기를 선택하세요",reminder_step3_enable_recurring:"반복 설정",reminder_step4_title:"📝 설명",reminder_step4_desc:"추가 설명을 입력하세요 (선택사항)",reminder_step5_title:"✅ 활성화",reminder_step5_desc:"미리알림 활성화 여부를 선택하세요",reminder_next_button:"다음",reminder_back_button:"이전",reminder_submit_button:"추가",reminder_form_title:"제목",reminder_form_date:"기한",reminder_form_time:"시간",reminder_form_recurring:"반복",reminder_form_description:"설명",reminder_form_enabled:"활성화",recurring_type_none:"반복 없음",recurring_type_daily:"매일",recurring_type_weekly:"매주",recurring_type_monthly:"매월",notification_deadline:"마감일 임박 알림",notification_deadline_desc:"마감이 가까운 목표에 대해 알려줍니다.",notification_suggestion:"지금할일 제안",notification_suggestion_desc:"오늘 해야할 목표를 제안해줍니다.",notification_achievement:"목표 달성 축하",notification_achievement_desc:"목표를 달성했을 때 축하해줍니다.",notification_reminder:"일반 미리알림",notification_reminder_desc:"설정한 시간에 미리알림을 받습니다.",reminder_time_settings_title:"미리알림 시간 설정",reminder_start_time:"시작 시간",reminder_end_time:"종료 시간",language_name:"한국어 (대한민국)",language_modal_title:"언어",settings_section_background:"화면",settings_bg_default:"라이트",settings_bg_default_dark:"다크",settings_bg_pink:"핑크",settings_bg_cherry_noir:"다크 체리",settings_bg_blue:"블루",settings_bg_deep_ocean:"오션",settings_bg_green:"그린",settings_bg_forest_green:"포레스트 그린",settings_bg_purple:"퍼플",settings_bg_royal_purple:"딥 퍼플",settings_version:"버전",test_long_alert:"긴 알림 테스트",test_long_alert_desc:"긴 내용의 알림 팝업 테스트",folder_manage_title:"폴더 관리",folder_manage_info:"폴더 정보",folder_manage_collaborators:"협업자",folder_manage_settings:"설정",folder_name_edit:"폴더 이름 편집",folder_invite_new:"새 협업자 초대",folder_invite_email:"이메일 주소",folder_invite_role:"역할",folder_role_owner:"소유자",folder_role_editor:"편집자",folder_role_viewer:"뷰어",folder_invite_button:"초대하기",folder_leave:"폴더 나가기",folder_delete:"폴더 삭제",folder_share_link:"공유 링크",folder_share_link_desc:"이 링크로 다른 사용자를 초대할 수 있습니다",folder_copy_link:"링크 복사",folder_leave_confirm:"폴더에서 나가시겠습니까?",folder_delete_confirm:"폴더를 삭제하시겠습니까? 모든 목표가 루트로 이동됩니다.",settings_developer:"개발자",developer_name:"Kim Kyumin",settings_copyright:"저작권",copyright_notice:"© 2025 Kim Kyumin. All Rights Reserved.",build_number:"빌드 번호",settings_data_header:"데이터 관리",settings_data_header_desc:"목표 데이터를 파일로 내보내거나, 파일에서 가져옵니다.",settings_background_header:"배경화면",settings_background_header_desc:"앱의 배경화면 스타일을 변경하여 개성을 표현해 보세요.",data_importing:"가져오는 중...",data_exporting:"내보내는 중...",data_deleting:"삭제 중...",url_import_title:"URL에서 데이터 불러오기",url_import_message:"URL의 데이터로 현재 목표 목록을 병합하시겠습니까?",url_import_confirm:"불러오기",url_import_success:"URL에서 데이터를 성공적으로 가져왔습니다!",url_import_error:"URL의 데이터가 올바르지 않습니다.",settings_share_link_header:"링크로 공유",settings_generate_link:"공유 링크 생성",settings_copy_link:"복사",link_copied_toast:"링크가 클립보드에 복사되었습니다.",short_url_created:"📎 단축 URL이 생성되었습니다!",share_link_created:"🔗 공유 링크가 생성되었습니다!",short_url_failed:"⚠️ 단축 URL 생성에 실패하여 기본 링크를 사용합니다.",no_data_to_share:"공유할 목표가 없습니다.",usage_guide_tab:"사용방법",usage_guide_title:"사용 가이드",usage_basic_title:"목표 추가하기",usage_basic_desc:`1. 홈 화면에서 "목표 추가 및 편집" 버튼을 탭하세요.
2. 목표, 결과, 장애물, 계획을 차례로 입력하세요.
3. 마감일과 반복 요일을 선택하세요.
4. "저장" 버튼을 눌러 목표를 추가하세요.`,usage_ai_title:"Gemini AI 기능 사용하기",usage_ai_desc:`• 목표 작성 시 "요약보기" 버튼으로 Gemini AI의 개선된 목표를 받아보세요.
• 목표 목록에서 "우선순위 정렬" 버튼으로 중요도 순 정렬이 가능합니다.
• Gemini AI 분석을 통해 더 효과적인 목표 설정을 도와드립니다.

※ Gemini AI 기능 사용을 위해서는 API 키 설정이 필요합니다.`,usage_ai_setup_title:"Gemini AI 설정하기",usage_ai_setup_desc:`1. 설정 > 일반에서 "Gemini AI 설정" 항목을 찾으세요.
2. Google Gemini API 키를 입력하세요.
3. API 키 발급 방법은 다음 Google 지원 문서를 참조하세요:
   https://ai.google.dev/gemini-api/docs/api-key
4. 키 입력 후 Gemini AI 기능이 활성화됩니다.`,usage_share_title:"목표 공유하기",usage_share_desc:`1. 설정 > 공유에서 "목표 링크 생성" 버튼을 탭하세요.
2. 자동으로 생성된 단축 링크를 확인하세요.
3. "링크 복사" 버튼으로 클립보드에 복사하세요.
4. 메신저나 이메일로 링크를 공유하세요.`,usage_theme_title:"테마 변경하기",usage_theme_desc:`1. 설정 > 모양에서 다크 모드 토글을 사용하세요.
2. 배경 테마에서 원하는 색상을 선택하세요.
3. 기본, 핑크, 블루, 그린, 퍼플 테마 중 선택 가능합니다.
4. 변경 사항은 즉시 적용됩니다.`,usage_calendar_title:"캘린더 보기 사용하기",usage_calendar_desc:`1. 하단 탭에서 캘린더 아이콘을 탭하세요.
2. 3일/주간/월간 보기를 선택할 수 있습니다.
3. 날짜를 탭하여 해당 날의 목표를 확인하세요.
4. 좌우 화살표로 날짜를 이동할 수 있습니다.`,usage_offline_title:"오프라인 모드 사용하기",usage_offline_desc:`1. 설정 > 일반에서 "오프라인 모드" 토글을 켜세요.
2. API 키 없이도 목표 추가, 편집, 삭제가 가능합니다.
3. AI 기능은 사용할 수 없지만 모든 기본 기능은 정상 작동합니다.
4. 데이터는 브라우저에 안전하게 저장됩니다.`,goal_assistant_title:"새로운 목표",goal_assistant_mode_woop:"WOOP",goal_assistant_mode_automation:"장기 계획",automation_title:"장기 목표 만들기",automation_base_name_label:"목표 이름",automation_base_name_placeholder:"예: 영어 단어 학습",automation_total_units_label:"총 분량",automation_total_units_placeholder:"예: 30",automation_units_per_day_label:"일일 분량",automation_period_label:"기간",automation_start_date_label:"시작일",automation_end_date_label:"종료일",automation_generate_button:"{count}개 생성",automation_error_all_fields:"모든 필드를 올바르게 입력해주세요.",automation_error_start_after_end:"시작일은 종료일보다 빨라야 합니다.",automation_error_short_period:"기간이 너무 짧습니다. (1일 이상)",next_button:"다음",back_button:"이전",wish_tip:"측정 가능하고 구체적인, 도전적이면서도 현실적인 목표를 설정하세요.",wish_example:"예: 3개월 안에 5kg 감량하기, 이번 학기에 A+ 받기",outcome_tip:"목표 달성 시 얻게 될 가장 긍정적인 결과를 생생하게 상상해 보세요.",outcome_example:"예: 더 건강하고 자신감 있는 모습, 성적 장학금 수령",obstacle_tip:"목표 달성을 방해할 수 있는 내면의 장애물(습관, 감정 등)은 무엇인가요?",obstacle_example:"예: 퇴근 후 피곤해서 운동 가기 싫은 마음, 어려운 과제를 미루는 습관",plan_tip:"'만약 ~라면, ~하겠다' 형식으로 장애물에 대한 구체적인 대응 계획을 세워보세요.",plan_example:"예: 만약 퇴근 후 운동 가기 싫다면, 일단 운동복으로 갈아입고 10분만 스트레칭한다.",recurrence_label:"반복",recurrence_tip:"정해진 요일에 꾸준히 해야 하는 목표인가요? 반복으로 설정하여 연속 달성을 기록해 보세요.",recurrence_example:"예: 매주 월,수,금 헬스장 가기",recurrence_option_daily:"반복 목표",deadline_tip:"현실적인 마감일을 설정하여 동기를 부여하세요. 마감일이 없는 장기 목표도 좋습니다.",deadline_option_no_deadline:"마감일 없음",day_names_short_picker:["월","화","수","목","금","토","일"],settings_delete_account:"모든 데이터 삭제",delete_account_header:"데이터 삭제",delete_account_header_desc:"이 작업은 되돌릴 수 없으며, 모든 목표와 데이터가 영구적으로 삭제됩니다.",version_update_title:"새로운 기능",version_update_1_title:"Firebase 클라우드 동기화",version_update_1_desc:"Google 로그인으로 목표와 설정값을 클라우드에 저장하고 불러올 수 있습니다. 목표는 같은 Google 계정으로 로그인된 여러 기기에서 동기화됩니다.",version_update_2_title:"자동 설정 동기화",version_update_2_desc:"언어, 테마, 배경 색상 등 모든 설정값이 클라우드에 저장되어 다른 기기에서도 동일하게 적용됩니다.",version_update_3_title:"안전한 로그아웃",version_update_3_desc:"로그아웃 시 모든 데이터가 클라우드에 저장되고, 로컬 데이터는 완전히 삭제되며 홈으로 이동합니다.",version_update_4_title:"상태 표시 UI",version_update_4_desc:"로그인, 로그아웃, 동기화 등의 작업 중 버튼 상태가 변화하여 진행 상황을 명확히 보여줍니다."},en:{language_selection_title:"Language",error_wish_required:"Please enter your wish.",error_outcome_required:"Please enter the outcome.",error_obstacle_required:"Please enter the obstacle.",error_plan_required:"Please enter your If-Then plan.",error_deadline_required:"Please select a deadline.",error_day_required:"Please select at least one day.",my_goals_title:"My Goals",all_goals_label:"All Goals",sort_label_manual:"Manual",sort_label_deadline:"Deadline",sort_label_newest:"Newest",sort_label_alphabetical:"Alphabetical",sort_label_ai:"Priority Order",ai_sorting_button:"Sorting...",add_new_goal_button_label:"Add New Goal",filter_all:"All Goals",filter_active:"In Progress",filter_completed:"Completed",filter_category:"Category",category_all:"All Categories",category_school:"School",category_work:"Work",category_personal:"Personal",category_other:"Other",category_label:"Select Category",empty_message_all:"Add a goal with the + button",empty_message_active:"No goals in progress.",empty_message_completed:"No completed goals yet.",empty_encouragement_1:"Take the first step toward something amazing.",empty_encouragement_2:"Small changes lead to big achievements.",empty_encouragement_3:"What you do today shapes tomorrow.",empty_encouragement_4:"Your goals are waiting to become reality.",delete_button:"Delete",edit_button_aria:"Edit Goal",info_button_aria:"Details",filter_title:"Filter",sort_title:"Sort",filter_sort_button_aria:"Filter and Sort",calendar_view_button_aria:"Calendar View",list_view_button_aria:"List View",more_options_button_aria:"More",select_button_label:"Select",cancel_selection_button_label:"Cancel",delete_selected_button_label:"Delete {count}",delete_selected_confirm_title:"Delete Goals",delete_selected_confirm_message:"The {count} selected goals will be permanently deleted.",days_left:"{count} days left",d_day:"D-DAY",days_overdue:"{count} days overdue",month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],day_names_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],day_names_long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],calendar_header_month_format:"{month} {year}",calendar_view_day3:"3-Day",calendar_view_week:"Week",calendar_view_month:"Month",settings_title:"Settings",sort_alert_title:"Unable to Sort",sort_alert_message:"Add at least two goals to use priority order.",ai_sort_error_title:"Unable to Sort",ai_sort_error_message:"Cannot connect to server. Please try again later.",confirm_button:"OK",new_goal_modal_title:"New Goal",edit_goal_modal_title:"Edit Goal",wish_label:"Wish",outcome_label:"Outcome",obstacle_label:"Obstacle",plan_label:"If-Then Plan",deadline_label:"Deadline",cancel_button:"Cancel",add_button:"Add",save_button:"Save",goal_details_modal_title:"Goal Details",ai_coach_suggestion:"View Summary",ai_analyzing:"Analyzing...",close_button:"Close",ai_sort_reason_modal_title:"Sort Reason",ai_sort_criteria:"🤖 Sort Criteria",delete_account_final_confirm_title:"Delete All Data",delete_account_final_confirm_message:"All your goals and data will be permanently deleted. This action cannot be undone.",delete_all_data_button:"Delete All Data",settings_done_button:"Done",settings_section_data:"Data Management",settings_export_data:"Export",settings_import_data:"Import",import_confirm_title:"Import Data",import_confirm_message:"This will replace your current goals with new data. This action cannot be undone.",import_success_toast:"Data imported successfully.",import_error_alert_title:"Import Failed",import_error_alert_message:"There was an error reading the file, or the file format is incorrect.",settings_section_general:"General",settings_section_info:"Information",settings_section_help:"How to Use",settings_theme_mode:"Theme Mode",theme_mode_light:"Light Mode",theme_mode_light_desc:"Use bright theme",theme_mode_dark:"Dark Mode",theme_mode_dark_desc:"Use dark theme",theme_mode_system:"Follow System Settings",theme_mode_system_desc:"Automatically adjust to device settings",settings_dark_mode:"Dark Mode",settings_language:"Language",settings_api_key:"Gemini AI Setup",settings_api_key_placeholder:"Enter Gemini API key",settings_offline_mode:"Offline Mode",settings_offline_mode_desc:"Use basic features without AI",settings_notifications:"Notifications",settings_notifications_desc:"PWA notification settings",notification_settings_title:"What notifications would you like?",notification_deadline:"Deadline Alerts",notification_deadline_desc:"Get notified when deadlines are approaching.",notification_suggestion:"Today's Suggestions",notification_suggestion_desc:"Get suggestions on what to do today.",notification_achievement:"Achievement Celebration",notification_achievement_desc:"Celebrate when you achieve a goal.",notification_reminder:"General Reminder",notification_reminder_desc:"Get reminded at scheduled times.",reminder_time_settings_title:"Reminder Time Settings",reminder_start_time:"Start Time",reminder_end_time:"End Time",reminder_add_title:"Add Reminder",reminder_step_title:"Step {step}/5",reminder_step1_title:"🔔 Title",reminder_step1_desc:"Enter the reminder title",reminder_step2_title:"📅 Date & ⏰ Time",reminder_step2_desc:"Set the reminder date and time (optional)",reminder_step2_date_toggle:"Set Date",reminder_step2_time_toggle:"Set Time",reminder_step3_title:"🔄 Recurring",reminder_step3_desc:"Choose recurrence settings",reminder_step3_enable_recurring:"Enable Recurring",reminder_step4_title:"📝 Description",reminder_step4_desc:"Add optional description",reminder_step5_title:"✅ Enable",reminder_step5_desc:"Choose whether to enable reminder",reminder_next_button:"Next",reminder_back_button:"Back",reminder_submit_button:"Add",reminder_form_title:"Title",reminder_form_date:"Date",reminder_form_time:"Time",reminder_form_recurring:"Recurring",reminder_form_description:"Description",reminder_form_enabled:"Enabled",recurring_type_none:"No Recurrence",recurring_type_daily:"Daily",recurring_type_weekly:"Weekly",recurring_type_monthly:"Monthly",language_name:"English (US)",language_modal_title:"Language",settings_section_background:"Appearance",settings_share_link_header:"Share via Link",settings_generate_link:"Generate Share Link",settings_bg_default:"Light",settings_bg_default_dark:"Dark",settings_bg_pink:"Pink",settings_bg_cherry_noir:"Cherry Noir",settings_bg_blue:"Blue",settings_bg_deep_ocean:"Ocean",settings_bg_green:"Green",settings_bg_forest_green:"Forest",settings_bg_purple:"Purple",settings_bg_royal_purple:"Royal Purple",settings_section_account:"Nova Beta Account",settings_sync_data:"Sync Data",settings_load_data:"Load Data",settings_logout:"Sign Out",settings_delete_account:"Delete All Data",delete_account_header:"Delete Data",delete_account_header_desc:"This action is irreversible and will permanently delete all your goals and data.",data_deleting:"Deleting...",settings_version:"Version",test_long_alert:"Test Long Alert",test_long_alert_desc:"Test alert popup with long content",settings_developer:"Developer",developer_name:"GimGyuMin",settings_copyright:"Copyright",copyright_notice:"© 2025 GimGyuMin. All Rights Reserved.",build_number:"Build Number",settings_data_header:"Data Management",settings_data_header_desc:"Export or import your goal data.",settings_background_header:"Background",settings_background_header_desc:"Change the app's background style to express your personality.",data_importing:"Importing...",data_exporting:"Exporting..."}},_e={add:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),m.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),check:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:m.jsx("polyline",{points:"20 6 9 17 4 12"})}),info:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("circle",{cx:"12",cy:"12",r:"10"}),m.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),m.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),delete:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("polyline",{points:"3 6 5 6 21 6"}),m.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),m.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),m.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),edit:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),m.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),close:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),back:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:m.jsx("polyline",{points:"15 18 9 12 15 6"})}),forward:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:m.jsx("polyline",{points:"9 18 15 12 9 6"})}),calendar:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),list:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),m.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),m.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),m.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),m.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),m.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),settings:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("circle",{cx:"12",cy:"12",r:"3"}),m.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),filter:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:m.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),ai:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("path",{d:"M12 3L14.34 8.66L20 11L14.34 13.34L12 19L9.66 13.34L4 11L9.66 8.66L12 3Z"}),m.jsx("path",{d:"M5 21L7 16"}),m.jsx("path",{d:"M19 21L17 16"})]}),flame:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:m.jsx("path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"})}),data:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83"}),m.jsx("path",{d:"M22 12A10 10 0 0 0 12 2v10z"})]}),background:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),m.jsx("polyline",{points:"21 15 16 10 5 21"})]}),exclamation:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:m.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm1-4h-2V7h2v6z"})})},Ol=(t,e)=>{const n=new Date(t),r=new Date(e);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate()},P3=(t,e)=>{if(!t)return null;const n=new Date;n.setHours(0,0,0,0);const r=new Date(t);r.setHours(0,0,0,0);const i=r.getTime()-n.getTime(),s=Math.ceil(i/(1e3*60*60*24));return s===0?e("d_day"):s>0?e("days_left").replace("{count}",String(s)):e("days_overdue").replace("{count}",String(Math.abs(s)))},HI=(t,e=1)=>{const n=new Date(t),r=n.getDay(),i=(r<e?7:0)+r-e;return n.setDate(n.getDate()-i),n.setHours(0,0,0,0),n},Wm=t=>{try{const e=new TextEncoder().encode(t),n=Array.from(e).map(r=>String.fromCharCode(r)).join("");return btoa(n)}catch(e){return console.error("UTF-8 to Base64 encoding failed:",e),""}},WI=t=>{try{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new TextDecoder().decode(n)}catch(e){return console.error("Base64 to UTF-8 decoding failed:",e),""}},KI=t=>{try{const n=JSON.stringify(t).replace(/\s+/g," ").trim();return Wm(n)}catch(e){return console.error("Data compression failed:",e),Wm(JSON.stringify(t))}},Zx=async t=>{if(t.length<1500)return t;const e=[{name:"is.gd",createUrl:async n=>{const r=await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(n)}`);if(!r.ok)throw new Error("is.gd API failed");const i=await r.text();if(i.includes("Error")||!i.startsWith("http"))throw new Error("Invalid response from is.gd");return i.trim()}},{name:"tinyurl",createUrl:async n=>new Promise((r,i)=>{const s=`tinyurl_${Date.now()}`,o=document.createElement("script"),a=setTimeout(()=>{l(),i(new Error("TinyURL timeout"))},5e3),l=()=>{clearTimeout(a),o.parentNode&&document.head.removeChild(o),delete window[s]};window[s]=u=>{l(),u&&typeof u=="string"&&!u.includes("Error")&&u.startsWith("http")?r(u.trim()):i(new Error("Invalid TinyURL response"))},o.onerror=()=>{l(),i(new Error("TinyURL script load failed"))},o.src=`https://tinyurl.com/api-create.php?url=${encodeURIComponent(n)}&callback=${s}`,document.head.appendChild(o)})},{name:"v.gd",createUrl:async n=>{const r=await fetch(`https://v.gd/create.php?format=simple&url=${encodeURIComponent(n)}`);if(!r.ok)throw new Error("v.gd API failed");const i=await r.text();if(i.includes("Error")||!i.startsWith("http"))throw new Error("Invalid response from v.gd");return i.trim()}}];for(const n of e)try{console.log(`Trying ${n.name} for URL shortening...`);const r=await n.createUrl(t);return console.log(`✅ ${n.name} success:`,r),r}catch(r){console.warn(`❌ ${n.name} failed:`,r);continue}return console.warn("All URL shortening services failed, using original URL"),t},Km=[{id:"default",lightThemeClass:"bg-solid-default",darkThemeClass:"bg-solid-default",lightNameKey:"settings_bg_default",darkNameKey:"settings_bg_default_dark"},{id:"pink",lightThemeClass:"bg-solid-pink",darkThemeClass:"bg-solid-pink",lightNameKey:"settings_bg_pink",darkNameKey:"settings_bg_cherry_noir"},{id:"blue",lightThemeClass:"bg-solid-blue",darkThemeClass:"bg-solid-blue",lightNameKey:"settings_bg_blue",darkNameKey:"settings_bg_deep_ocean"},{id:"green",lightThemeClass:"bg-solid-green",darkThemeClass:"bg-solid-green",lightNameKey:"settings_bg_green",darkNameKey:"settings_bg_forest_green"},{id:"purple",lightThemeClass:"bg-solid-purple",darkThemeClass:"bg-solid-purple",lightNameKey:"settings_bg_purple",darkNameKey:"settings_bg_royal_purple"}],k3=()=>{const[t,e]=$.useState("ko"),[n,r]=$.useState([]),[i,s]=$.useState([]),[o,a]=$.useState(null),[l,u]=$.useState("all"),[f,p]=$.useState("all"),[g,v]=$.useState("manual"),[T,x]=$.useState(["school","work","personal","other"]),[D,S]=$.useState(()=>$I()==="dark"),[E,R]=$.useState("system"),[M,O]=$.useState("default"),[F,I]=$.useState([]),[w,C]=$.useState({}),[N,b]=$.useState([]),[V,k]=$.useState(!1),[xe,Fe]=$.useState(!1),[Me,he]=$.useState(null),[J,le]=$.useState(!1),[pe,Pe]=$.useState(null),[oe,et]=$.useState(""),[Je,jt]=$.useState(""),[Et,sn]=$.useState("editor"),[fn,Jt]=$.useState(!1),[Fn,_r]=$.useState(null),[er,on]=$.useState(!1),[yr,Ne]=$.useState(!1),[Ie,Un]=$.useState(!1),[ot,de]=$.useState(null),[Rt,$i]=$.useState(!1),[Hi,Ra]=$.useState(new Set),[Xs,Ce]=$.useState(""),[zu,vr]=$.useState("idle"),[Wi,Pa]=$.useState(!1),[$u,ka]=$.useState(!1),[Hu,Ki]=$.useState(""),[Na,ji]=$.useState(!1),[pn,Ji]=$.useState(void 0),[Zs,Da]=$.useState(!1),[On,Qi]=$.useState(""),[ft,Wu]=$.useState(!1),[Tr,Yi]=$.useState(!0),[Q,ba]=$.useState(null),[Xi,Z_]=$.useState(""),[ey,Ma]=$.useState(!1),[Ku,eo]=$.useState(!1),[Va,Er]=$.useState(!1),[ju,Pt]=$.useState(!1),[Ju,La]=$.useState(!1);$.useEffect(()=>{const P=BL(yo,async L=>{ba(L),L?(console.log("🔑 사용자 로그인 감지 - Firebase 데이터 로드 시작"),await to(L)):(console.log("🚪 사용자 로그아웃 감지 - 데이터 초기화"),r([]),s([]),e("ko"),R("system"),O("default"),Qi(""),x(["school","work","personal","other"]))});return()=>P()},[]);const Zi=$.useCallback(async()=>{eo(!0);try{const P=await sF(yo,X_);ba(P.user),Ce("✅ Google 로그인 성공!"),setTimeout(async()=>{try{const{doc:L,getDoc:U}=await Ka(async()=>{const{doc:Z,getDoc:ee}=await Promise.resolve().then(()=>ll);return{doc:Z,getDoc:ee}},void 0),G=L(we,"users",P.user.uid,"data","todos"),W=await U(G);if(W.exists()){const Z=W.data();r(Z.todos||[])}const j=L(we,"users",P.user.uid,"data","settings"),K=await U(j);if(K.exists()){const Z=K.data();Z.language&&e(Z.language),Z.themeMode&&R(Z.themeMode),Z.isDarkMode!==void 0&&S(Z.isDarkMode),Z.backgroundTheme&&O(Z.backgroundTheme),Z.apiKey&&Qi(Z.apiKey)}Ce("✅ 로그인 완료! 데이터 로드됨")}catch(L){console.error("데이터 로드 실패:",L),Ce("⚠️ 로그인은 성공했으나 데이터 로드 실패")}eo(!1),setTimeout(()=>Ce(""),3e3)},500),setTimeout(()=>Ce(""),3e3)}catch(P){console.error("Google 로그인 오류:",P),P.code!=="auth/popup-closed-by-user"&&de({title:"로그인 실패",message:P.message||"로그인 중 오류가 발생했습니다.",confirmText:"확인",onConfirm:()=>de(null)}),eo(!1)}},[]),Fa=(P,L)=>{if(P===null)return;const U=i.map(G=>G.id===P?{...G,collaborators:L}:G);s(U),pn&&pn.id===P&&Ji({...pn,collaborators:L}),Ce("✅ 폴더 협업자가 업데이트되었습니다"),setTimeout(()=>Ce(""),3e3)},Qu=$.useCallback(async()=>{Er(!0);try{if(Q){Ce("⏳ 데이터 저장 중...");const P=n.filter(K=>K!=null),{doc:L,setDoc:U,serverTimestamp:G}=await Ka(async()=>{const{doc:K,setDoc:Z,serverTimestamp:ee}=await Promise.resolve().then(()=>ll);return{doc:K,setDoc:Z,serverTimestamp:ee}},void 0),W=L(we,"users",Q.uid,"data","todos");await U(W,{todos:P,lastSyncTime:G(),totalGoals:P.length,syncedAt:new Date().toISOString()});const j=L(we,"users",Q.uid,"data","settings");await U(j,{language:t,themeMode:E,isDarkMode:D,backgroundTheme:M,updatedAt:G()})}await uE(yo),ba(null),r([]),e("ko"),O("default"),R("system"),S($I()==="dark"),he(null),on(!1),Fe(!1),Ce("✅ 로그아웃 완료"),setTimeout(()=>Ce(""),3e3),Er(!1)}catch(P){console.error("로그아웃 오류:",P),de({title:"로그아웃 실패",message:"로그아웃 중 오류가 발생했습니다.",confirmText:"확인",onConfirm:()=>de(null)}),Er(!1)}},[Q,n,t,E,D,M]),Yu=$.useCallback(async()=>{if(!Q){de({title:"로그인 필요",message:"먼저 로그인해주세요",confirmText:"확인",onConfirm:()=>de(null)});return}Pt(!0);try{const P=n.filter(Z=>Z!=null),{doc:L,setDoc:U,serverTimestamp:G}=await Ka(async()=>{const{doc:Z,setDoc:ee,serverTimestamp:ge}=await Promise.resolve().then(()=>ll);return{doc:Z,setDoc:ee,serverTimestamp:ge}},void 0),W=L(we,"users",Q.uid,"data","todos");await U(W,{todos:P,lastSyncTime:G(),totalGoals:P.length,syncedAt:new Date().toISOString()});const j=L(we,"users",Q.uid,"data","settings"),K={language:t,themeMode:E,isDarkMode:D,backgroundTheme:M,apiKey:On,userCategories:T,updatedAt:G()};await U(j,K);for(const Z of i)try{const ee=L(we,"users",Q.uid,"folders",Z.id),ge={...Z,ownerId:Z.ownerId||Q.uid,collaborators:Z.collaborators||[],updatedAt:G()};await U(ee,ge),console.log(`✅ 폴더 ${Z.id} 동기화 완료`)}catch(ee){console.error(`❌ 폴더 ${Z.id} 동기화 실패:`,ee)}Ce("✅ 전체 데이터 동기화 완료! (목표: "+P.length+"개, 폴더: "+i.length+"개)"),setTimeout(()=>Ce(""),3e3),Pt(!1)}catch(P){console.error("동기화 오류:",P),de({title:"동기화 실패",message:P.message||"데이터 동기화 중 오류가 발생했습니다.",confirmText:"확인",onConfirm:()=>de(null)}),Pt(!1)}},[Q,n,t,E,D,M,On]),to=$.useCallback(async P=>{var L;try{const{doc:U,getDoc:G,collection:W,getDocs:j}=await Ka(async()=>{const{doc:te,getDoc:Ue,collection:Ve,getDocs:qe}=await Promise.resolve().then(()=>ll);return{doc:te,getDoc:Ue,collection:Ve,getDocs:qe}},void 0),K=U(we,"users",P.uid,"data","todos"),Z=await G(K);if(Z.exists()){const te=Z.data();r(te.todos||[])}const ee=U(we,"users",P.uid,"data","settings"),ge=await G(ee);if(ge.exists()){const te=ge.data();te.language&&e(te.language),te.themeMode&&R(te.themeMode),te.isDarkMode!==void 0&&S(te.isDarkMode),te.backgroundTheme&&O(te.backgroundTheme),te.apiKey&&Qi(te.apiKey),te.userCategories&&x(te.userCategories)}try{const te=W(we,"users",P.uid,"folders"),Ue=await j(te),Ve=[];Ue.forEach(qe=>{const Se=qe.data(),ye={id:qe.id,...Se,collaborators:Se.collaborators||[],ownerId:Se.ownerId||P.uid};Ve.push(ye)}),s(Ve),console.log("✅ 폴더 로드 완료:",{count:Ve.length})}catch(te){console.warn("⚠️ 폴더 로드 실패, 빈 배열로 설정:",te),s([])}console.log("✅ 클라우드 데이터 로드 완료:",{todos:Z.exists()&&((L=Z.data().todos)==null?void 0:L.length)||0,folders:"로드됨",settings:ge.exists()?"로드됨":"없음"})}catch(U){console.error("❌ 클라우드 데이터 로드 실패:",U)}},[]),df=$.useCallback(async()=>{if(!Q){de({title:"로그인 필요",message:"먼저 로그인해주세요",confirmText:"확인",onConfirm:()=>de(null)});return}La(!0);try{await to(Q),Ce("✅ 클라우드 데이터 로드 완료!")}catch(P){console.error("로드 오류:",P),de({title:"로드 실패",message:P.message||"데이터 로드 중 오류가 발생했습니다.",confirmText:"확인",onConfirm:()=>de(null)})}finally{La(!1)}},[Q,to]),ie=$.useCallback(P=>R3[t][P]||P,[t]),es=$.useCallback(P=>{const L=P||On;if(ft||!L)return null;try{return new g2({apiKey:L})}catch(U){return console.error("Failed to create AI instance:",U),null}},[On,ft]),Ua=$.useCallback(P=>{R(P)},[]),Ir=$.useMemo(()=>[ie("empty_encouragement_1"),ie("empty_encouragement_2"),ie("empty_encouragement_3"),ie("empty_encouragement_4")],[ie]),wr=$.useMemo(()=>Ir[Math.floor(Math.random()*Ir.length)],[Ir]);$.useEffect(()=>{console.log("🚀 클라우드 기반 앱 시작 - localStorage 사용 안 함")},[]),$.useEffect(()=>{(()=>{s(L=>{const U=L.filter(G=>{if(!G.collaborators||G.collaborators.length===0)return!0;const W=G.collaborators.find(j=>j.role==="owner");return!W||!W.userId||W.userId.startsWith("owner_")?(console.warn("🗑️ 잘못된 공유 폴더 제거:",G.name,W==null?void 0:W.userId),!1):!0});return U.length!==L.length&&console.log("✅ 잘못된 공유 폴더 정리 완료:",{제거됨:L.length-U.length,남은폴더:U.length}),U})})()},[]),$.useEffect(()=>{(async()=>{const L=new URLSearchParams(window.location.search),U=L.get("data"),G=L.get("folder_share");if(G){try{const W=WI(G),j=JSON.parse(W);if(j.type==="folder_share"&&j.folderId){if(j.password){const Z=sessionStorage.getItem(`folder_${j.folderId}_password`);if(!Z||Z!==j.password){de({title:"암호 입력",message:"이 폴더는 암호로 보호되어 있습니다. 암호를 입력하세요.",confirmText:"확인",cancelText:"취소",onConfirm:()=>{const ee=prompt("폴더 암호를 입력하세요:");ee===j.password?(sessionStorage.setItem(`folder_${j.folderId}_password`,ee),window.location.reload()):ee!==null&&de({title:"암호 오류",message:"암호가 일치하지 않습니다.",confirmText:"확인",onConfirm:()=>{window.history.replaceState({},document.title,window.location.pathname)}})},onCancel:()=>{window.history.replaceState({},document.title,window.location.pathname)}});return}}if(i.some(Z=>Z.id===j.folderId))window.history.replaceState({},document.title,window.location.pathname);else{if(j.ownerId&&!Q){de({title:"로그인 필요",message:"이 공유 폴더는 소유자 기반 동기화를 위해 로그인이 필요합니다. 계속하려면 로그인하세요.",confirmText:"로그인",cancelText:"취소",onConfirm:async()=>{try{await Zi()}catch(te){console.error("로그인 중 오류:",te)}},onCancel:()=>{window.history.replaceState({},document.title,window.location.pathname)}});return}const Z=j.ownerId||null;if(!Z){console.error("❌ 공유 링크에 소유자 정보가 없습니다:",j),de({title:"❌ 공유 링크 오류",message:`공유 링크에 소유자 정보가 없습니다.
폴더 소유자에게 다시 공유 링크를 요청해주세요.`,confirmText:"확인",onConfirm:()=>{de(null),window.history.replaceState({},document.title,window.location.pathname)}});return}const ee={id:j.folderId,name:j.folderName,color:j.folderColor||"#007AFF",ownerId:Z,collaborators:[{userId:Z,email:j.sharedBy||"",role:"owner",addedAt:j.sharedAt}],createdAt:j.sharedAt,updatedAt:j.sharedAt,isShared:!0};let ge=ee;if(Z&&Q)try{console.log("🔍 협업자 추가 시작:",{ownerUserId:Z,googleUserUid:Q.uid});const te=yt(we,"users",Z,"folders"),Ue=tt(te,j.folderId),Ve=await $m(Ue);if(console.log("📄 폴더 조회 결과:",{exists:Ve.exists()}),Ve.exists()){let qe=Ve.data().collaborators||[];console.log("👥 현재 협업자 목록:",qe);const Se=qe.some(ye=>ye.userId===Q.uid);if(console.log("🔎 협업자 여부:",{isCollaborator:Se}),Se)console.log("ℹ️ 이미 협업자임");else{const ye={userId:Q.uid,email:Q.email||"",role:"editor",addedAt:new Date().toISOString()};qe=[...qe,ye],console.log("📝 새로운 협업자 목록:",qe);const as=sr(qe);as?(await pt(Ue,{collaborators:as,updatedAt:new Date().toISOString()},{merge:!0}),console.log("✅ 협업자 Firestore 저장 완료:",ye)):console.warn("⚠️ 협업자 정제 후 데이터가 없음")}ge={...ee,collaborators:qe}}else console.warn("⚠️ 폴더가 존재하지 않음:",j.folderId)}catch(te){console.error("❌ 협업자 목록 조회/추가 실패:",te)}else console.warn("⚠️ 협업자 추가 조건 미충족:",{ownerUserId:Z,hasGoogleUser:!!Q});s([...i,ge]),a(ge.id),de({title:"공유 폴더 추가됨",message:`"${j.folderName}" 폴더가 추가되었습니다. 잠시 후 목표들이 로드됩니다.`,confirmText:"확인",onConfirm:()=>{window.history.replaceState({},document.title,window.location.pathname)}})}}}catch(W){console.error("폴더 공유 데이터 파싱 실패:",W),window.history.replaceState({},document.title,window.location.pathname)}return}if(U)try{const W=WI(U),j=JSON.parse(W);if(Array.isArray(j)&&(j.length===0||"wish"in j[0]&&"id"in j[0]))de({title:ie("url_import_title"),message:ie("url_import_message"),confirmText:ie("url_import_confirm"),cancelText:ie("cancel_button"),onConfirm:()=>{r(j),Ce(ie("url_import_success")),window.history.replaceState({},document.title,window.location.pathname)},onCancel:()=>{window.history.replaceState({},document.title,window.location.pathname)}});else throw new Error("Invalid data format")}catch(W){console.error("Failed to parse data from URL",W),de({title:ie("import_error_alert_title"),message:ie("url_import_error")}),window.history.replaceState({},document.title,window.location.pathname)}})()},[ie,i,Q,Zi]),$.useEffect(()=>{if(!o||!Q)return;const P=i.find(ee=>ee.id===o);if(!P||!P.collaborators||P.collaborators.length===0)return;const L=P.collaborators.find(ee=>ee.role==="owner");if(!L)return;const U=L.userId;if(!U||U.startsWith("owner_")){console.warn("⚠️ Invalid owner UID:",L);return}const G=[],W=tt(we,"users",U,"folders",o),j=_l(W,ee=>{if(ee.exists()){const ge=ee.data();ge.collaborators&&s(te=>te.map(Ue=>Ue.id===o?{...Ue,collaborators:ge.collaborators}:Ue))}},ee=>{console.warn("⚠️ 공유 폴더 메타데이터 접근 오류 (협업자 목록 업데이트 안 됨):",ee.code)});G.push(j);const K=yt(we,"users",U,"todos");console.log("📊 Syncing todos from owner:",{ownerUid:U,currentFolderId:o});const Z=_l(K,ee=>{const ge=[];ee.forEach(te=>{const Ue=te.data();Ue.folderId===o&&ge.push({id:parseInt(te.id),...Ue})}),console.log("🎯 Owner todos received:",{count:ge.length,ownerTodos:ge}),r(te=>{const Ue=te.filter(ye=>ye.folderId!==o),Ve=te.filter(ye=>ye.folderId===o),qe=[],Se=new Set;return ge.forEach(ye=>{qe.push(ye),Se.add(ye.id)}),Ve.forEach(ye=>{Se.has(ye.id)||qe.push(ye)}),[...Ue,...qe]})},ee=>{console.error("❌ 실시간 동기화 실패:",ee),ee.code==="permission-denied"?(console.warn("⚠️ 권한 부족으로 실시간 동기화 실패 - 수동 동기화를 사용하세요"),Ce("⚠️ 실시간 동기화 실패 - 🔄 버튼으로 수동 동기화하세요")):ee.code==="not-found"?(console.warn("⚠️ 폴더를 찾을 수 없음 - 폴더가 삭제되었을 수 있습니다"),Ce("⚠️ 공유 폴더를 찾을 수 없습니다")):(console.warn("⚠️ 네트워크 오류로 실시간 동기화 실패"),Ce("⚠️ 네트워크 오류 - 🔄 버튼으로 재시도하세요"))});return G.push(Z),()=>{G.forEach(ee=>ee())}},[o,Q]),$.useEffect(()=>{var ee,ge;if(!o||!Q)return;const P=i.find(te=>te.id===o),L=((ee=P==null?void 0:P.collaborationSettings)==null?void 0:ee.enabled)||(P==null?void 0:P.isShared)||!1,U=((ge=P==null?void 0:P.collaborationSettings)==null?void 0:ge.showPresence)??!0;if(!L||!U){I([]);return}console.log("👥 실시간 접속 상태 추적 시작:",{folderId:o,showPresence:U});const G=yt(we,"folderPresence",o,"users"),W=tt(G,Q.uid);(async()=>{try{await pt(W,{userId:Q.uid,displayName:Q.displayName||"Anonymous",photoURL:Q.photoURL||null,isOnline:!0,lastSeen:new Date,currentFolder:o},{merge:!0}),console.log("✅ 내 접속 상태 등록:",Q.displayName)}catch(te){console.warn("presence set failed",te)}})();const K=setInterval(()=>{pt(W,{lastSeen:new Date,isOnline:!0},{merge:!0}).catch(()=>{})},3e4),Z=_l(G,te=>{const Ve=te.docs.map(qe=>{const Se=qe.data();return{userId:Se.userId||qe.id,displayName:Se.displayName||"Anonymous",photoURL:Se.photoURL||void 0,isOnline:!!Se.isOnline,lastSeen:Se.lastSeen?Se.lastSeen.toDate?Se.lastSeen.toDate():new Date(Se.lastSeen):new Date,currentFolder:Se.currentFolder}}).filter(qe=>!!qe.userId&&qe.isOnline);I(Ve),console.log("👥 활성 사용자 업데이트:",Ve.map(qe=>qe.displayName))},te=>console.warn("presence listen failed",te));return()=>{clearInterval(K),pt(W,{isOnline:!1,lastSeen:new Date},{merge:!0}).catch(()=>{}),Z()}},[o,Q,i]),$.useCallback(async P=>{var W,j;if(!o||!Q)return;const L=i.find(K=>K.id===o),U=((W=L==null?void 0:L.collaborationSettings)==null?void 0:W.showEditingState)??!0;if(!(!((j=L==null?void 0:L.collaborationSettings)!=null&&j.enabled||L!=null&&L.isShared)||!U))try{const K=tt(we,"folderEditing",`${o}_${P}`);await pt(K,{todoId:P,userId:Q.uid,userName:Q.displayName||"Anonymous",startTime:new Date,folderId:o}),console.log("✏️ 편집 시작:",{todoId:P,user:Q.displayName})}catch(K){console.warn("start editing failed",K)}},[o,Q,i]),$.useCallback(async P=>{var W,j;if(!o||!Q)return;const L=i.find(K=>K.id===o),U=((W=L==null?void 0:L.collaborationSettings)==null?void 0:W.showEditingState)??!0;if(!(!((j=L==null?void 0:L.collaborationSettings)!=null&&j.enabled||L!=null&&L.isShared)||!U))try{const K=tt(we,"folderEditing",`${o}_${P}`);await gs(K),console.log("✅ 편집 종료:",{todoId:P,user:Q.displayName})}catch(K){console.warn("stop editing failed",K)}},[o,Q,i]),$.useEffect(()=>{var j,K;if(!o)return;const P=i.find(Z=>Z.id===o),L=((j=P==null?void 0:P.collaborationSettings)==null?void 0:j.showEditingState)??!0;if(!(((K=P==null?void 0:P.collaborationSettings)==null?void 0:K.enabled)||(P==null?void 0:P.isShared)||!1)||!L){C({});return}console.log("✏️ 편집 상태 추적 시작:",{folderId:o});const G=gd(yt(we,"folderEditing"),_d("folderId","==",o)),W=_l(G,Z=>{const ee={};Z.docs.forEach(ge=>{const te=ge.data();te&&te.todoId&&(ee[te.todoId]={todoId:te.todoId,userId:te.userId,userName:te.userName,startTime:te.startTime?te.startTime.toDate?te.startTime.toDate():new Date(te.startTime):new Date,folderId:te.folderId})}),C(ee),console.log("✏️ 편집 상태 업데이트:",Object.keys(ee).length+"개 항목")},Z=>console.warn("editing states listen failed",Z));return()=>W()},[o,i]),$.useCallback(async P=>{var L,U;try{const G=P.ownerId||(Q==null?void 0:Q.uid);if(!G)throw new Error("No owner UID");const W=i.find(ge=>ge.id===o),j=((L=W==null?void 0:W.collaborationSettings)==null?void 0:L.enableConflictDetection)??!0,K=((U=W==null?void 0:W.collaborationSettings)==null?void 0:U.enabled)||(W==null?void 0:W.isShared)||!1,Z=tt(we,"users",G,"todos",P.id.toString());if(K&&j){const ge=await $m(Z),te=ge.exists()?ge.data():null,Ue=(te==null?void 0:te.version)||0,Ve=P.version||0;if(te&&Ue>Ve&&(b(Se=>[...Se,{todoId:P.id,conflictType:"version_mismatch",localVersion:P,serverVersion:te,lastModifiedBy:te.lastModifiedBy||"unknown",lastModifiedAt:te.lastModified?te.lastModified.toDate?te.lastModified.toDate():new Date(te.lastModified):new Date}]),console.warn("⚠️ 충돌 감지:",{todoId:P.id,localVersion:Ve,serverVersion:Ue,lastModifiedBy:te.lastModifiedBy}),!window.confirm("다른 사용자가 이 항목을 수정했습니다. 덮어쓰시겠습니까? (취소하면 변경이 중단됩니다)")))return!1}const ee=sr({...P,version:(P.version||0)+1,lastModified:new Date,lastModifiedBy:(Q==null?void 0:Q.uid)||"unknown"});return ee&&(await pt(Z,ee),console.log("✅ Todo 저장 완료:",{todoId:P.id,version:ee.version})),!0}catch(G){return console.error("attemptSaveTodo failed",G),!1}},[Q,o,i]),$.useEffect(()=>{const P=window.matchMedia("(prefers-color-scheme: dark)"),L=U=>{E==="system"&&S(U.matches)};return S(E==="system"?P.matches:E==="dark"),P.addEventListener("change",L),()=>P.removeEventListener("change",L)},[E]),$.useEffect(()=>{const P=()=>{console.log("🌐 인터넷 연결됨"),Ce("✅ 인터넷에 다시 연결되었습니다"),setTimeout(()=>Ce(""),3e3)},L=()=>{console.log("📡 인터넷 연결 끊김"),Ce("⚠️ 오프라인 모드 - 클라우드 동기화 불가"),setTimeout(()=>Ce(""),5e3)};return navigator.onLine||console.log("📡 현재 오프라인 상태"),window.addEventListener("online",P),window.addEventListener("offline",L),()=>{window.removeEventListener("online",P),window.removeEventListener("offline",L)}},[]),$.useEffect(()=>{const P=localStorage.getItem("pwa-prompt-dismissed"),L=GI(),U=zI();console.log("PWA Check:",{isMobileDevice:L,isInStandalone:U,isDismissed:P,userAgent:navigator.userAgent}),L&&!U&&!P&&(console.log("Showing PWA prompt immediately"),Da(!0))},[]),$.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/Nova-AI-Planer/sw.js").then(P=>{console.log("SW registered: ",P);const L=zI(),U=GI();L&&U&&setTimeout(()=>{Yx().then(G=>{G&&Xx()})},2e3)}).catch(P=>{console.log("SW registration failed: ",P)})},[]),$.useEffect(()=>{},[E,D]),$.useEffect(()=>{if(Tr&&Q&&n.length>0){const P=setTimeout(()=>{Yu()},2e3);return()=>clearTimeout(P)}},[n,Tr,Q]),$.useEffect(()=>{const P=Km.find(U=>U.id===M)||Km[0],L=D?P.darkThemeClass:P.lightThemeClass;document.body.className="",D&&document.body.classList.add("dark-mode"),L&&document.body.classList.add(L)},[M,D]),$.useEffect(()=>{if(Xs){const P=setTimeout(()=>Ce(""),3e3);return()=>clearTimeout(P)}},[Xs]);const Oa=$.useMemo(()=>{let P=[...n];return o===null?P=P:P=P.filter(L=>L.folderId===o),g==="deadline"?P.sort((L,U)=>!L.deadline&&!U.deadline?0:L.deadline?U.deadline?new Date(L.deadline).getTime()-new Date(U.deadline).getTime():-1:1):g==="newest"?P.sort((L,U)=>U.id-L.id):g==="alphabetical"&&P.sort((L,U)=>L.wish.localeCompare(U.wish)),l==="active"&&(P=P.filter(L=>!L.completed)),l==="completed"&&(P=P.filter(L=>L.completed)),f!=="all"&&(P=P.filter(L=>(L.category||"other")===f)),P},[n,l,g,f,o]),hf=async P=>{const L={...P,id:Date.now(),completed:!1,lastCompletedDate:null,streak:0,folderId:o||void 0};if(Q)try{const U=i.find(Z=>Z.id===o),G=(U==null?void 0:U.ownerId)||Q.uid,W=yt(we,"users",G,"todos"),j=tt(W,L.id.toString()),K=sr(L);K?(await pt(j,K),console.log("✅ 목표 Firestore 저장:",{targetOwnerUid:G,newTodo:K})):console.warn("⚠️ 정제 후 저장할 데이터가 없음")}catch(U){console.error("❌ 목표 Firestore 저장 실패:",U)}r(U=>[L,...U]),Fe(!1)},Xu=async P=>{const L=P.map((U,G)=>({...U,id:Date.now()+G,completed:!1,lastCompletedDate:null,streak:0,folderId:o||void 0})).reverse();if(Q)try{const U=i.find(W=>W.id===o),G=(U==null?void 0:U.ownerId)||Q.uid;for(const W of L){const j=yt(we,"users",G,"todos"),K=tt(j,W.id.toString()),Z=sr(W);Z?await pt(K,Z):console.warn("⚠️ 정제 후 저장할 데이터가 없음:",W.id)}console.log("✅ 여러 목표 Firestore 저장:",{targetOwnerUid:G,count:L.length})}catch(U){console.error("❌ 여러 목표 Firestore 저장 실패:",U)}r(U=>[...L,...U]),Fe(!1)},Ba=async P=>{if(Q)try{const L=i.find(K=>K.id===P.folderId),U=(L==null?void 0:L.ownerId)||Q.uid,G=yt(we,"users",U,"todos"),W=tt(G,P.id.toString()),j=sr(P);j?(await pt(W,j),console.log("✅ 목표 업데이트 Firestore 저장:",{targetOwnerUid:U,updatedTodo:j})):console.warn("⚠️ 정제 후 저장할 데이터가 없음")}catch(L){console.error("❌ 목표 업데이트 Firestore 저장 실패:",L)}r(n.map(L=>L.id===P.id?P:L)),he(null)},Zu=async P=>{const L=n.find(U=>U.id===P);if(Q&&L)try{const U=i.find(K=>K.id===L.folderId),G=(U==null?void 0:U.ownerId)||Q.uid,W=yt(we,"users",G,"todos"),j=tt(W,P.toString());await gs(j),console.log("✅ 목표 Firestore 삭제:",{targetOwnerUid:G,id:P})}catch(U){console.error("❌ 목표 Firestore 삭제 실패:",U)}r(n.filter(U=>U.id!==P))},qa=P=>{var U;if(!P.trim()){de({title:"Error",message:"Folder name cannot be empty."});return}const L={id:Date.now().toString(),name:P,ownerId:((U=yo.currentUser)==null?void 0:U.uid)||"unknown",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),color:"#3b82f6",collaborationSettings:{enabled:!1,showPresence:!0,showEditingState:!0,enableConflictDetection:!0,allowGuestView:!1,requireApproval:!0},isShared:!1};return s([...i,L]),console.log("📁 새 폴더 생성:",{name:P,collaborationEnabled:!1}),L},ts=$.useCallback(async(P,L)=>{try{if(s(U=>U.map(G=>{if(G.id===P){const W={...G.collaborationSettings,...L};return console.log("⚙️ 공동작업 설정 업데이트:",{folderId:P,settings:W}),{...G,collaborationSettings:W,updatedAt:new Date().toISOString()}}return G})),Q){const U=tt(we,"users",Q.uid,"folders",P);await Hm(U,{collaborationSettings:{...L},updatedAt:new Date().toISOString()})}}catch(U){console.error("공동작업 설정 업데이트 실패:",U)}},[Q]),ec=$.useCallback(async(P,L)=>{await ts(P,{enabled:L}),L?(s(U=>U.map(G=>G.id===P?{...G,isShared:!0}:G)),console.log("🤝 폴더 공동작업 활성화:",P)):(I([]),C({}),console.log("🔒 폴더 공동작업 비활성화:",P))},[ts]);$.useCallback(()=>{if(!o)return null;const P=i.find(L=>L.id===o);return(P==null?void 0:P.collaborationSettings)||null},[o,i]);const tc=(P,L)=>{if(!L.trim()){de({title:"Error",message:"Folder name cannot be empty."});return}s(i.map(U=>U.id===P?{...U,name:L,updatedAt:new Date().toISOString()}:U))},Ga=async P=>{const L=i.find(G=>G.id===P);if(!L)return;const U=n.filter(G=>G.folderId===P);if(Q&&U.length>0)try{for(const G of U){const W={...G};delete W.folderId;const j=L.ownerId||Q.uid,K=yt(we,"users",j,"todos"),Z=tt(K,G.id.toString()),ee=sr(W);ee?(await pt(Z,ee),console.log(`✅ 목표 ${G.id} Firebase 루트로 이동 완료`)):console.warn(`⚠️ 목표 ${G.id} 데이터 정제 실패`)}console.log("✅ 폴더 삭제 시 목표들 Firebase 이동 완료:",{count:U.length})}catch(G){console.error("❌ 폴더 삭제 시 목표 이동 실패:",G)}r(n.map(G=>{if(G.folderId===P){const W={...G};return delete W.folderId,W}return G})),s(i.filter(G=>G.id!==P)),o===P&&a(null)},nc=async P=>{if(!oe.trim()||!Q){et("");return}try{const L={...P,name:oe.trim(),updatedAt:new Date().toISOString()},U=tt(we,"users",Q.uid,"folders",P.id);await pt(U,L),s(i.map(G=>G.id===P.id?L:G)),et(""),console.log("✅ 폴더 이름 변경 완료:",oe.trim())}catch(L){console.error("❌ 폴더 이름 변경 실패:",L),et("")}},tr=async P=>{var L;if(!(!Je.trim()||!Q||fn)){Jt(!0);try{if(((L=P.sharedWith)==null?void 0:L.some(K=>K.email===Je.trim()))||P.ownerEmail===Je.trim()){alert("이미 초대된 사용자입니다."),Jt(!1);return}const G={email:Je.trim(),userId:"",role:Et,addedAt:new Date().toISOString()},W={...P,sharedWith:[...P.sharedWith||[],G],updatedAt:new Date().toISOString()},j=tt(we,"users",Q.uid,"folders",P.id);await pt(j,W),s(i.map(K=>K.id===P.id?W:K)),jt(""),console.log("✅ 협업자 초대 완료:",G)}catch(U){console.error("❌ 협업자 초대 실패:",U)}finally{Jt(!1)}}},An=async(P,L,U)=>{var G;if(Q)try{const W={...P,sharedWith:(G=P.sharedWith)==null?void 0:G.map(K=>K.userId===L?{...K,role:U}:K),updatedAt:new Date().toISOString()},j=tt(we,"users",Q.uid,"folders",P.id);await pt(j,W),s(i.map(K=>K.id===P.id?W:K)),console.log("✅ 협업자 역할 변경 완료:",{userId:L,newRole:U})}catch(W){console.error("❌ 협업자 역할 변경 실패:",W)}},ns=async(P,L)=>{var U;if(Q&&confirm("이 협업자를 제거하시겠습니까?"))try{const G={...P,sharedWith:(U=P.sharedWith)==null?void 0:U.filter(j=>j.userId!==L),updatedAt:new Date().toISOString()},W=tt(we,"users",Q.uid,"folders",P.id);await pt(W,G),s(i.map(j=>j.id===P.id?G:j)),console.log("✅ 협업자 제거 완료:",L)}catch(G){console.error("❌ 협업자 제거 실패:",G)}},rs=P=>{const L=`${window.location.origin}${window.location.pathname}?invite=${P.id}`;navigator.clipboard.writeText(L).then(()=>{alert("공유 링크가 복사되었습니다!")}).catch(()=>{alert("링크 복사에 실패했습니다.")})},za=P=>{confirm(ie.folder_leave_confirm)&&Ke(P)},Ke=async P=>{var L;if(Q)try{const U={...P,sharedWith:(L=P.sharedWith)==null?void 0:L.filter(W=>W.userId!==Q.uid),updatedAt:new Date().toISOString()},G=tt(we,"users",P.ownerId,"folders",P.id);await pt(G,U),s(i.filter(W=>W.id!==P.id)),o===P.id&&a(null),le(!1),console.log("✅ 폴더 나가기 완료")}catch(U){console.error("❌ 폴더 나가기 실패:",U)}},no=P=>{confirm(ie.folder_delete_confirm)&&(Ga(P.id),le(!1))},is=P=>{if(a(P),P&&Q){const L=i.find(U=>U.id===P);L!=null&&L.ownerId&&(async()=>{try{console.log("📥 Firestore에서 폴더 목표 로드:",{folderId:P,ownerUid:L.ownerId});const U=yt(we,"users",L.ownerId,"todos"),G=gd(U,_d("folderId","==",P)),W=await _o(G),j=[];W.forEach(K=>{j.push({id:parseInt(K.id),...K.data()})}),console.log("✅ 폴더 목표 로드 완료:",{count:j.length,todos:j}),r(K=>[...K.filter(ge=>ge.folderId!==P),...j])}catch(U){console.error("❌ 폴더 목표 로드 실패:",U)}})()}},ss=async()=>{if(!o||!Q){Ce("❌ 동기화할 폴더가 없습니다");return}Pt(!0);try{console.log("🔄 폴더 정보 재로딩 중...",o);const{doc:P,getDoc:L,collection:U,query:G,where:W,getDocs:j}=await Ka(async()=>{const{doc:Se,getDoc:ye,collection:as,query:$a,where:lc,getDocs:uc}=await Promise.resolve().then(()=>ll);return{doc:Se,getDoc:ye,collection:as,query:$a,where:lc,getDocs:uc}},void 0);let K=i.find(Se=>Se.id===o);if(!K||!K.collaborators||K.collaborators.length===0){console.log("⚠️ 로컬 폴더 정보가 불완전함, Firebase에서 재로딩...");const Se=P(we,"users",Q.uid,"folders",o),ye=await L(Se);if(ye.exists())K={id:o,...ye.data()},console.log("✅ 사용자 폴더에서 로드됨:",K);else{console.log("🔍 공유된 폴더 검색 중..."),de({title:"📡 폴더 정보 로딩 중",message:`폴더 정보를 불러오는 중입니다.
잠시 후 다시 시도하거나 새로고침해주세요.`,confirmText:"확인",onConfirm:()=>de(null)}),Pt(!1);return}}if(!K||!K.collaborators||K.collaborators.length===0){de({title:"❌ 협업 폴더 아님",message:`이것은 공유 폴더가 아닙니다.
개인 폴더는 개별적으로 동기화됩니다.`,confirmText:"확인",onConfirm:()=>de(null)}),Pt(!1);return}const Z=K.collaborators.find(Se=>Se.role==="owner");if(!Z||!Z.userId){de({title:"❌ 소유자 정보 오류",message:`폴더 소유자 정보가 없습니다.
폴더를 다시 공유받아주세요.`,confirmText:"확인",onConfirm:()=>de(null)}),Pt(!1);return}if(Z.userId.startsWith("owner_")){console.warn("⚠️ 임시 소유자 ID 발견:",Z.userId),de({title:"⚠️ 소유자 정보 오류",message:`폴더 소유자 정보에 문제가 있습니다.
폴더 소유자에게 새로운 공유 링크를 요청해주세요.`,confirmText:"확인",onConfirm:()=>de(null)}),Pt(!1);return}console.log("🔄 수동 동기화 시작:",{folderId:o,ownerUid:Z.userId});const ee=n.filter(Se=>Se.folderId===o);console.log("📊 현재 로컬 목표 수:",ee.length);const ge=U(we,"users",Z.userId,"todos"),te=G(ge,W("folderId","==",o)),Ue=await j(te),Ve=[];Ue.forEach(Se=>{Ve.push({id:parseInt(Se.id),...Se.data()})}),console.log("📊 서버 목표 수:",Ve.length),ee.length===Ve.length?(console.log("✅ 실시간 동기화가 정상 작동 중입니다"),Ce(`✅ 동기화 확인 완료 (${Ve.length}개 항목 - 이미 최신 상태)`)):(console.log("⚠️ 로컬과 서버 데이터 불일치 감지:",{local:ee.length,server:Ve.length}),r(Se=>[...Se.filter($a=>$a.folderId!==o),...Ve]),Ce(`🔄 동기화 완료 (${Ve.length}개 항목 - ${Math.abs(Ve.length-ee.length)}개 차이 수정)`)),console.log("📡 실시간 리스너 상태:",o&&Q?"활성":"비활성")}catch(P){console.error("❌ 동기화 실패:",P),P instanceof Error?P.message.includes("permission-denied")?Ce("❌ 동기화 실패: 폴더 접근 권한이 없습니다"):P.message.includes("not-found")?Ce("❌ 동기화 실패: 폴더를 찾을 수 없습니다"):Ce("❌ 동기화 실패: "+P.message):Ce("❌ 동기화 실패: 알 수 없는 오류")}finally{Pt(!1)}},ff=async(P,L)=>{const U=n.find(W=>W.id===P);if(!U)return;const G={...U,folderId:L||void 0};if(Q)try{const W=i.find(ge=>ge.id===(L||U.folderId)),j=(W==null?void 0:W.ownerId)||Q.uid,K=yt(we,"users",j,"todos"),Z=tt(K,P.toString()),ee=sr(G);ee?(await pt(Z,ee),console.log("✅ 목표 폴더 이동 Firestore 저장:",{targetOwnerUid:j,goalId:P,folderId:L})):console.warn("⚠️ 정제 후 저장할 데이터가 없음")}catch(W){console.error("❌ 목표 폴더 이동 Firestore 저장 실패:",W)}r(n.map(W=>W.id===P?G:W)),Ce("✅ 목표가 폴더로 이동되었습니다"),setTimeout(()=>Ce(""),3e3)},rc=async P=>{const L=new Date().toISOString(),U=(()=>{const G=n.find(K=>K.id===P);if(!G)return null;const W=!G.completed;let j=G.streak;return G.isRecurring&&(W?(!G.lastCompletedDate||!Ol(L,G.lastCompletedDate))&&(j=(G.streak||0)+1):G.lastCompletedDate&&Ol(L,G.lastCompletedDate)&&(j=Math.max(0,(G.streak||1)-1))),{...G,completed:W,lastCompletedDate:W?L:G.lastCompletedDate,streak:j}})();if(U){if(Q)try{const G=i.find(ee=>ee.id===U.folderId),W=(G==null?void 0:G.ownerId)||Q.uid,j=yt(we,"users",W,"todos"),K=tt(j,P.toString()),Z=sr(U);Z?(await pt(K,Z),console.log("✅ 목표 완료 상태 Firestore 저장:",{targetOwnerUid:W,id:P,completed:U.completed})):console.warn("⚠️ 정제 후 저장할 데이터가 없음")}catch(G){console.error("❌ 목표 완료 상태 Firestore 저장 실패:",G)}r(n.map(G=>G.id===P?U:G))}},pf=async P=>{if(P==="ai"){if(n.length<2){de({title:ie("sort_alert_title"),message:ie("sort_alert_message")});return}Ne(!0);try{const L=es();if(!L){Ce(ft?"오프라인 모드에서는 AI 정렬을 사용할 수 없습니다.":"AI 정렬을 사용하려면 설정에서 API 키를 입력해주세요."),Ne(!1),v("manual");return}const U=`Here is a list of goals with their details (wish, outcome, obstacle, plan, deadline). Prioritize them based on urgency (closer deadline), importance (based on outcome), and feasibility (based on plan). Return a JSON object with "sorted_ids" array and "reasoning" string explaining your prioritization logic. Goals: ${JSON.stringify(n.map(({id:te,wish:Ue,outcome:Ve,obstacle:qe,plan:Se,deadline:ye})=>({id:te,wish:Ue,outcome:Ve,obstacle:qe,plan:Se,deadline:ye})))}`,G=await L.models.generateContent({model:"gemini-2.5-flash",contents:U,config:{responseMimeType:"application/json",responseSchema:{type:kn.OBJECT,properties:{sorted_ids:{type:kn.ARRAY,items:{type:kn.NUMBER}},reasoning:{type:kn.STRING}}}}}),W=JSON.parse(G.text),j=W.sorted_ids.map(Number),K=new Map(n.map(te=>[Number(te.id),te])),Z=j.map(te=>K.get(te)).filter(Boolean),ee=n.filter(te=>!j.includes(Number(te.id))),ge=[...Z,...ee].map(te=>({...te,id:Number(te.id)}));r(ge),v("manual"),Ki(W.reasoning||""),ji(!0)}catch(L){console.error("AI sort failed:",L),de({title:ie("ai_sort_error_title"),message:ie("ai_sort_error_message")})}finally{Ne(!1)}}else v(P)},mf=P=>{const L=new Set(Hi);L.has(P)?L.delete(P):L.add(P),Ra(L)},ic=()=>{$i(!1),Ra(new Set)},gf=()=>{const P=Hi.size;de({title:ie("delete_selected_confirm_title"),message:ie("delete_selected_confirm_message").replace("{count}",String(P)),isDestructive:!0,confirmText:ie("delete_selected_button_label").replace("{count}",String(P)),cancelText:ie("cancel_button"),onConfirm:()=>{r(n.filter(L=>!Hi.has(L.id))),ic()}})},os=()=>{vr("exporting");const P=JSON.stringify(n,null,2),L="data:application/json;charset=utf-8,"+encodeURIComponent(P),U="nova_goals.json",G=document.createElement("a");G.setAttribute("href",L),G.setAttribute("download",U),G.click(),setTimeout(()=>{vr("idle"),on(!1)},1500)},Sr=P=>{var G;const L=(G=P.target.files)==null?void 0:G[0];if(!L)return;const U=new FileReader;U.onload=W=>{var j;try{const K=(j=W.target)==null?void 0:j.result;if(typeof K!="string")throw new Error("File content is not a string");const Z=JSON.parse(K);if(Array.isArray(Z)&&Z.every(ee=>"wish"in ee&&"id"in ee))de({title:ie("import_confirm_title"),message:ie("import_confirm_message"),confirmText:ie("settings_import_data"),cancelText:ie("cancel_button"),onConfirm:()=>{vr("importing"),setTimeout(()=>{r(Z),Ce(ie("import_success_toast")),vr("idle"),on(!1)},1500)}});else throw new Error("Invalid file format")}catch{de({title:ie("import_error_alert_title"),message:ie("import_error_alert_message")})}},U.onerror=()=>de({title:ie("import_error_alert_title"),message:ie("import_error_alert_message")}),U.readAsText(L),P.target.value=""},sc=()=>{de({title:"⚠️ 모든 데이터 삭제",message:`정말로 모든 데이터를 삭제하시겠습니까?

이 작업은 되돌릴 수 없습니다:

• 모든 목표와 폴더
• Firebase 클라우드 데이터
• 로컬 설정
• 공유 폴더 데이터
• 실시간 협업 정보`,confirmText:"삭제",cancelText:"취소",isDestructive:!0,onConfirm:()=>{de(null),oc()},onCancel:()=>{de(null)}})},oc=async()=>{vr("deleting");try{if(Q){console.log("🗑️ Firebase 데이터 삭제 시작...");const P=yt(we,"users",Q.uid,"todos"),L=await _o(P),U=L.docs.map(ee=>gs(ee.ref));await Promise.all(U),console.log("✅ todos 삭제 완료:",L.size,"개");const G=yt(we,"users",Q.uid,"folders"),W=await _o(G),j=W.docs.map(ee=>gs(ee.ref));await Promise.all(j),console.log("✅ folders 삭제 완료:",W.size,"개");const K=yt(we,"sharedFolders"),Z=await _o(K);for(const ee of Z.docs){const ge=ee.data();if(ge.collaborators&&Array.isArray(ge.collaborators)){const te=ge.collaborators.filter(Ue=>Ue.userId!==Q.uid);te.length!==ge.collaborators.length&&(await Hm(ee.ref,{collaborators:te}),console.log("✅ 공유 폴더에서 내 계정 제거:",ee.id))}}try{for(const ee of i)if(ee.id){const ge=tt(we,"folderPresence",ee.id,"users",Q.uid);await gs(ge)}console.log("✅ presence 데이터 삭제 완료")}catch(ee){console.warn("⚠️ presence 데이터 삭제 중 일부 오류:",ee)}try{const ee=gd(yt(we,"folderEditing"),_d("userId","==",Q.uid)),te=(await _o(ee)).docs.map(Ue=>gs(Ue.ref));await Promise.all(te),console.log("✅ editing states 삭제 완료")}catch(ee){console.warn("⚠️ editing states 삭제 중 일부 오류:",ee)}}r([]),s([]),I([]),C({}),b([]),a(null),e("ko"),S(!0),O("default"),v("manual"),x(["school","work","personal","other"]),localStorage.clear(),Q&&(console.log("🚪 Firebase 로그아웃 처리..."),await uE(yo),console.log("✅ 로그아웃 완료")),console.log("✅ 모든 데이터 삭제 완료"),Ce("✅ 모든 데이터가 완전히 삭제되었습니다. 로그아웃됩니다."),setTimeout(()=>{window.location.reload()},2e3)}catch(P){console.error("❌ 데이터 삭제 중 오류:",P);let L="❌ 삭제 실패",U="데이터 삭제 중 오류가 발생했습니다.";P instanceof Error&&(P.message.includes("permission-denied")||P.message.includes("insufficient permissions")?(L="❌ 권한 부족",U=`삭제 권한이 부족합니다.

잠시 후 다시 시도해주세요.
(Firebase 보안 규칙이 업데이트 중일 수 있습니다)`):P.message.includes("network-request-failed")?(L="❌ 네트워크 오류",U="인터넷 연결을 확인하고 다시 시도해주세요."):P.message.includes("unauthenticated")?(L="❌ 로그인 필요",U=`로그인이 만료되었습니다.
다시 로그인해주세요.`):U=`데이터 삭제 중 오류가 발생했습니다.

오류 내용: `+P.message),de({title:L,message:U,confirmText:"확인",onConfirm:()=>de(null)})}finally{vr("idle"),on(!1)}},ac=xe||!!Me||!!Fn||er||!!ot||Wi||$u;return m.jsxs("div",{className:`main-page-layout ${Ie?"calendar-view-active":""}`,children:[m.jsxs("div",{className:`page-content ${ac?"modal-open":""}`,children:[m.jsx(N3,{folders:i,currentFolderId:o,onSetCurrentFolder:is,onCreateFolder:qa,onRenameFolder:tc,onDeleteFolder:Ga,onSetCollaboratingFolder:Ji,todos:n,t:ie,onManageFolder:P=>{Pe(P),le(!0)}}),m.jsxs("div",{className:"container",children:[m.jsx(D3,{t:ie,isSelectionMode:Rt,selectedCount:Hi.size,onCancelSelection:ic,onDeleteSelected:gf,isViewModeCalendar:Ie,onToggleViewMode:()=>Un(!Ie),isAiSorting:yr,sortType:g,onSort:pf,filter:l,onFilter:u,categoryFilter:f,onCategoryFilter:p,userCategories:T,onAddCategory:P=>x([...T,P]),onRemoveCategory:P=>x(T.filter(L=>L!==P)),onSetSelectionMode:()=>$i(!0),onOpenSettings:()=>on(!0),onAddGoal:()=>Fe(!0),currentFolderId:o,folders:i,onSyncSharedFolder:ss,isSyncing:ju,activeUsers:F,editingStates:w,onToggleCollaboration:ec,onUpdateCollaborationSettings:ts}),Ie?m.jsx(q3,{todos:n,t:ie,onGoalClick:_r,language:t}):m.jsx(m.Fragment,{children:m.jsx(b3,{todos:Oa,onToggleComplete:rc,onDelete:Zu,onEdit:he,onInfo:_r,t:ie,filter:l,randomEncouragement:wr,isSelectionMode:Rt,selectedTodoIds:Hi,onSelectTodo:mf,folders:i,onMoveToFolder:ff})})]})]}),xe&&m.jsx(jI,{onClose:()=>Fe(!1),onAddTodo:hf,onAddMultipleTodos:Xu,t:ie,language:t,createAI:es,userCategories:T}),Me&&m.jsx(jI,{onClose:()=>he(null),onEditTodo:Ba,existingTodo:Me,t:ie,language:t,createAI:es}),Fn&&m.jsx(F3,{todo:Fn,onClose:()=>_r(null),t:ie,createAI:es,onOpenCollaboration:P=>{const L=i.find(U=>U.id===P.folderId)||(P.folderId===null||P.folderId===void 0?null:void 0);L!==void 0&&Ji(L||null)},userCategories:T,onUpdateGoal:Ba}),pn!==void 0&&m.jsx(U3,{folder:pn,onClose:()=>Ji(void 0),t:ie,googleUser:Q,onUpdateCollaborators:Fa,setAlertConfig:de}),er&&m.jsx(O3,{onClose:()=>on(!1),isDarkMode:D,onToggleDarkMode:()=>S(!D),themeMode:E,onThemeChange:Ua,backgroundTheme:M,onSetBackgroundTheme:O,onExportData:os,onImportData:Sr,setAlertConfig:de,onDeleteAllData:sc,dataActionStatus:zu,language:t,onSetLanguage:e,t:ie,todos:n,setToastMessage:Ce,onOpenVersionInfo:()=>Pa(!0),onOpenUsageGuide:()=>ka(!0),apiKey:On,onSetApiKey:Qi,isOfflineMode:ft,onToggleOfflineMode:()=>Wu(!ft),googleUser:Q,onGoogleLogin:Zi,onGoogleLogout:Qu,onSyncDataToFirebase:Yu,onLoadDataFromFirebase:df,isGoogleLoggingIn:Ku,isGoogleLoggingOut:Va,isSyncingData:ju,isLoadingData:Ju,isAutoSyncEnabled:Tr,setIsAutoSyncEnabled:Yi}),Wi&&m.jsx(JI,{onClose:()=>Pa(!1),t:ie}),$u&&m.jsx(B3,{onClose:()=>ka(!1),t:ie}),Na&&m.jsx(Ys,{onClose:()=>ji(!1),isClosing:!1,className:"ai-sort-reason-modal",children:m.jsxs("div",{style:{padding:"24px"},children:[m.jsx("h2",{style:{marginBottom:"16px",fontSize:"1.3rem",fontWeight:600},children:ie("ai_sort_reason_modal_title")}),m.jsx("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"var(--card-bg-color)",borderRadius:"8px",border:"1px solid var(--border-color)",lineHeight:"1.6",color:"var(--text-secondary-color)"},children:Hu}),m.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:m.jsx("button",{onClick:()=>ji(!1),className:"primary",children:ie("close_button")})})]})}),Wi&&m.jsx(JI,{onClose:()=>Pa(!1),t:ie}),ot&&m.jsx(G3,{title:ot.title,message:ot.message,onConfirm:()=>{var P;(P=ot.onConfirm)==null||P.call(ot),de(null)},onCancel:ot.onCancel?()=>{var P;(P=ot.onCancel)==null||P.call(ot),de(null)}:void 0,confirmText:ot.confirmText,cancelText:ot.cancelText,isDestructive:ot.isDestructive,t:ie}),Xs&&m.jsx("div",{className:"toast-notification",children:Xs}),Zs&&m.jsx(x3,{onClose:()=>Da(!1)}),J&&pe&&m.jsx("div",{className:"modal-backdrop",onClick:()=>le(!1),children:m.jsxs("div",{className:"modal-content large-modal",onClick:P=>P.stopPropagation(),children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h3",{children:ie.folder_manage_title}),m.jsx("button",{onClick:()=>le(!1),children:"✕"})]}),m.jsx("div",{className:"modal-body",children:(()=>{var G,W,j;const P=i.find(K=>K.id===pe);if(!P)return null;const L=P.ownerId===(Q==null?void 0:Q.uid),U=L?"owner":((W=(G=P.sharedWith)==null?void 0:G.find(K=>K.userId===(Q==null?void 0:Q.uid)))==null?void 0:W.role)||"viewer";return m.jsxs("div",{className:"folder-manage-content",children:[m.jsxs("div",{className:"folder-info-section",children:[m.jsx("h4",{children:ie.folder_manage_info}),m.jsxs("div",{className:"folder-info-item",children:[m.jsxs("label",{children:[ie.folder_name,":"]}),oe?m.jsxs("div",{className:"inline-edit",children:[m.jsx("input",{type:"text",value:oe,onChange:K=>et(K.target.value),onKeyPress:K=>{K.key==="Enter"&&nc(P)}}),m.jsx("button",{onClick:()=>nc(P),children:"✓"}),m.jsx("button",{onClick:()=>et(""),children:"✕"})]}):m.jsxs("div",{className:"folder-name-display",children:[m.jsx("span",{children:P.name}),L&&m.jsx("button",{className:"edit-btn",onClick:()=>et(P.name),children:"✏️"})]})]}),m.jsxs("div",{className:"folder-info-item",children:[m.jsxs("label",{children:[ie.folder_owner,":"]}),m.jsx("span",{children:P.ownerEmail||P.ownerId})]}),m.jsxs("div",{className:"folder-info-item",children:[m.jsxs("label",{children:[ie.role,":"]}),m.jsx("span",{children:U==="owner"?ie.folder_role_owner:U==="editor"?ie.folder_role_editor:ie.folder_role_viewer})]}),m.jsxs("div",{className:"folder-info-item",children:[m.jsxs("label",{children:[ie.created_date,":"]}),m.jsx("span",{children:new Date(P.createdAt).toLocaleDateString()})]})]}),m.jsxs("div",{className:"collaborators-section",children:[m.jsx("h4",{children:ie.folder_manage_collaborators}),m.jsxs("div",{className:"collaborator-list",children:[m.jsx("div",{className:"collaborator-item owner",children:m.jsxs("div",{className:"collaborator-info",children:[m.jsx("span",{className:"email",children:P.ownerEmail||P.ownerId}),m.jsx("span",{className:"role owner-role",children:ie.folder_role_owner})]})}),((j=P.sharedWith)==null?void 0:j.map((K,Z)=>m.jsxs("div",{className:"collaborator-item",children:[m.jsxs("div",{className:"collaborator-info",children:[m.jsx("span",{className:"email",children:K.email||K.userId}),m.jsx("span",{className:`role ${K.role}`,children:K.role==="editor"?ie.folder_role_editor:ie.folder_role_viewer})]}),L&&m.jsxs("div",{className:"collaborator-actions",children:[m.jsxs("select",{value:K.role,onChange:ee=>An(P,K.userId,ee.target.value),children:[m.jsx("option",{value:"editor",children:ie.folder_role_editor}),m.jsx("option",{value:"viewer",children:ie.folder_role_viewer})]}),m.jsx("button",{className:"remove-btn",onClick:()=>ns(P,K.userId),children:"🗑️"})]})]},Z)))||[]]}),(L||U==="editor")&&m.jsxs("div",{className:"invite-section",children:[m.jsx("h5",{children:ie.folder_invite_new}),m.jsxs("div",{className:"invite-form",children:[m.jsx("input",{type:"email",placeholder:ie.folder_invite_email,value:Je,onChange:K=>jt(K.target.value)}),m.jsxs("select",{value:Et,onChange:K=>sn(K.target.value),children:[m.jsx("option",{value:"editor",children:ie.folder_role_editor}),m.jsx("option",{value:"viewer",children:ie.folder_role_viewer})]}),m.jsx("button",{onClick:()=>tr(P),disabled:!Je||fn,children:fn?"초대 중...":ie.folder_invite_button})]})]})]}),m.jsxs("div",{className:"folder-settings-section",children:[m.jsx("h4",{children:ie.folder_manage_settings}),m.jsxs("div",{className:"share-link-section",children:[m.jsx("label",{children:ie.folder_share_link}),m.jsx("p",{className:"share-link-desc",children:ie.folder_share_link_desc}),m.jsxs("div",{className:"share-link-input",children:[m.jsx("input",{type:"text",readOnly:!0,value:`${window.location.origin}${window.location.pathname}?invite=${P.id}`}),m.jsx("button",{onClick:()=>rs(P),children:ie.folder_copy_link})]})]}),m.jsxs("div",{className:"folder-actions",children:[!L&&m.jsx("button",{className:"leave-folder-btn",onClick:()=>za(P),children:ie.folder_leave}),L&&m.jsx("button",{className:"delete-folder-btn",onClick:()=>no(P),children:ie.folder_delete})]})]})]})})()})]})})]})},N3=({folders:t,currentFolderId:e,onSetCurrentFolder:n,onCreateFolder:r,onRenameFolder:i,onDeleteFolder:s,onSetCollaboratingFolder:o,todos:a,t:l,onManageFolder:u})=>{var O;const[f,p]=$.useState(!1),[g,v]=$.useState(""),[T,x]=$.useState(null),[D,S]=$.useState(""),[E,R]=$.useState(null),M=()=>{g.trim()&&(r(g),v(""),p(!1))};return m.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-color)",overflowX:"auto",display:"flex",gap:"8px",alignItems:"center",backgroundColor:"var(--card-bg-color)"},children:[m.jsxs("button",{onClick:()=>n(null),style:{padding:"6px 12px",borderRadius:"8px",border:"none",backgroundColor:e===null?"var(--primary-color)":"transparent",color:e===null?"white":"var(--text-color)",cursor:"pointer",fontSize:"0.9rem",fontWeight:500,whiteSpace:"nowrap",transition:"all 0.2s",minWidth:"80px",textAlign:"center"},children:["📁 ",l("all_goals_label")||"All"]}),t.length>0&&t.map(F=>{const I=a.filter(w=>w.folderId===F.id).length;return m.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",gap:"2px"},children:[m.jsxs("button",{onClick:()=>n(F.id),style:{padding:"6px 12px",borderRadius:"8px",border:"none",backgroundColor:e===F.id?F.color||"var(--primary-color)":`${F.color}20`||"transparent",color:e===F.id?"white":"var(--text-color)",cursor:"pointer",fontSize:"0.9rem",fontWeight:500,whiteSpace:"nowrap",transition:"all 0.2s",position:"relative"},title:"폴더 선택",children:[F.name," (",I,")"]}),e===F.id&&m.jsxs("div",{style:{display:"flex",gap:"2px"},children:[m.jsx("button",{onClick:()=>o(F),style:{width:"24px",height:"24px",padding:"0",borderRadius:"4px",border:"none",backgroundColor:"var(--primary-color)",color:"white",cursor:"pointer",fontSize:"0.8rem",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},title:"폴더 협업",children:"👥"}),m.jsx("button",{onClick:()=>u(F.id),style:{width:"24px",height:"24px",padding:"0",borderRadius:"4px",border:"none",backgroundColor:"var(--button-bg-color)",color:"var(--text-color)",cursor:"pointer",fontSize:"0.8rem",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},title:"폴더 관리",children:"⚙️"}),m.jsx("button",{onClick:()=>{x(F.id),S(F.name)},style:{width:"24px",height:"24px",padding:"0",borderRadius:"4px",border:"none",backgroundColor:"var(--button-bg-color)",color:"var(--text-color)",cursor:"pointer",fontSize:"0.8rem",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},title:"폴더 이름 변경",children:"✏"}),m.jsx("button",{onClick:()=>{R(F.id)},style:{width:"24px",height:"24px",padding:"0",borderRadius:"4px",border:"none",backgroundColor:"var(--danger-color)",color:"white",cursor:"pointer",fontSize:"0.8rem",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},title:"폴더 삭제",children:"×"})]})]},F.id)}),f?m.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[m.jsx("input",{type:"text",value:g,onChange:F=>v(F.target.value),onKeyPress:F=>{F.key==="Enter"&&M(),F.key==="Escape"&&(p(!1),v(""))},placeholder:"폴더 이름...",autoFocus:!0,style:{padding:"6px 12px",borderRadius:"8px",border:"2px solid var(--primary-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"0.9rem",outline:"none",width:"120px"}}),m.jsx("button",{onClick:M,style:{padding:"4px 12px",borderRadius:"8px",border:"none",backgroundColor:"var(--primary-color)",color:"white",cursor:"pointer",fontSize:"0.85rem",fontWeight:600,transition:"all 0.2s"},children:"완료"}),m.jsx("button",{onClick:()=>{p(!1),v("")},style:{padding:"4px 12px",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"transparent",color:"var(--text-color)",cursor:"pointer",fontSize:"0.85rem",transition:"all 0.2s"},children:"취소"})]}):m.jsx("button",{onClick:()=>p(!0),style:{padding:"6px 12px",borderRadius:"8px",border:"2px solid var(--primary-color)",backgroundColor:"transparent",color:"var(--primary-color)",cursor:"pointer",fontSize:"0.9rem",fontWeight:500,whiteSpace:"nowrap",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"4px"},children:"➕ 폴더"}),E&&m.jsx("div",{className:"modal-backdrop alert-backdrop",children:m.jsxs("div",{className:"modal-content alert-modal",children:[m.jsxs("div",{className:"alert-content",children:[m.jsx("h2",{children:"폴더 삭제"}),m.jsxs("p",{style:{fontSize:"0.9rem"},children:['"',(O=t.find(F=>F.id===E))==null?void 0:O.name,'" 폴더를 삭제하시겠습니까?',m.jsx("br",{}),'폴더 내 목표는 "모든 목표"로 이동됩니다.']})]}),m.jsxs("div",{className:"modal-buttons",children:[m.jsx("button",{onClick:()=>R(null),className:"secondary",children:"취소"}),m.jsx("button",{onClick:()=>{s(E),R(null)},className:"destructive",children:"삭제"})]})]})}),T&&m.jsx("div",{className:"modal-backdrop alert-backdrop",children:m.jsxs("div",{className:"modal-content alert-modal",children:[m.jsxs("div",{className:"alert-content",children:[m.jsx("h2",{children:"폴더 이름 변경"}),m.jsx("p",{style:{fontSize:"0.9rem",marginBottom:"16px"},children:"새로운 폴더 이름을 입력하세요"}),m.jsx("input",{type:"text",value:D,onChange:F=>S(F.target.value),onKeyPress:F=>{F.key==="Enter"&&D.trim()&&(i(T,D),x(null),S(""))},placeholder:"폴더 이름...",autoFocus:!0,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"0.95rem",outline:"none",boxSizing:"border-box"}})]}),m.jsxs("div",{className:"modal-buttons",children:[m.jsx("button",{onClick:()=>{x(null),S("")},className:"secondary",children:"취소"}),m.jsx("button",{onClick:()=>{D.trim()&&(i(T,D),x(null),S(""))},className:"primary",children:"변경"})]})]})})]})},D3=({t,isSelectionMode:e,selectedCount:n,onCancelSelection:r,onDeleteSelected:i,isViewModeCalendar:s,onToggleViewMode:o,isAiSorting:a,sortType:l,onSort:u,filter:f,onFilter:p,categoryFilter:g,onCategoryFilter:v,userCategories:T,onAddCategory:x,onRemoveCategory:D,onSetSelectionMode:S,onOpenSettings:E,onAddGoal:R,currentFolderId:M,folders:O,onSyncSharedFolder:F,isSyncing:I,activeUsers:w,editingStates:C,onToggleCollaboration:N,onUpdateCollaborationSettings:b})=>{var Pe;const[V,k]=$.useState(!1),[xe,Fe]=$.useState(!1),Me=M?O.find(oe=>oe.id===M):null,he=Me==null?void 0:Me.collaborationSettings,J=(he==null?void 0:he.enabled)||(Me==null?void 0:Me.isShared)||!1;$.useEffect(()=>{const oe=()=>{k(!1),Fe(!1)};return document.addEventListener("click",oe),document.addEventListener("touchstart",oe),()=>{document.removeEventListener("click",oe),document.removeEventListener("touchstart",oe)}},[]);const le=oe=>{oe.stopPropagation(),k(et=>!et)},pe=oe=>{oe.stopPropagation()};return m.jsxs("header",{children:[m.jsx("div",{className:"header-left",children:e&&m.jsx("button",{onClick:r,className:"header-action-button",children:t("cancel_selection_button_label")})}),m.jsxs("div",{className:"header-title-group",children:[m.jsx("h1",{children:t("my_goals_title")}),!e&&m.jsxs("div",{className:"header-inline-actions",children:[m.jsx("button",{onClick:o,className:"header-icon-button","aria-label":t(s?"list_view_button_aria":"calendar_view_button_aria"),children:s?_e.list:_e.calendar}),m.jsxs("div",{className:"filter-sort-container",children:[m.jsx("button",{onClick:le,onTouchStart:le,className:"header-icon-button","aria-label":t("filter_sort_button_aria"),children:a?m.jsx("div",{className:"spinner"}):_e.filter}),V&&m.jsxs("div",{className:"profile-popover filter-sort-popover",onClick:pe,onTouchStart:pe,children:[m.jsx("div",{className:"popover-section",children:m.jsx("button",{onClick:()=>{S(),k(!1)},className:"popover-action-button",children:m.jsx("span",{children:t("select_button_label")})})}),m.jsxs("div",{className:"popover-section",children:[m.jsx("h4",{children:t("filter_title")}),m.jsxs("button",{onClick:()=>{p("all")},className:`popover-action-button ${f==="all"?"active":""}`,children:[m.jsx("span",{children:t("filter_all")}),f==="all"&&_e.check]}),m.jsxs("button",{onClick:()=>{p("active")},className:`popover-action-button ${f==="active"?"active":""}`,children:[m.jsx("span",{children:t("filter_active")}),f==="active"&&_e.check]}),m.jsxs("button",{onClick:()=>{p("completed")},className:`popover-action-button ${f==="completed"?"active":""}`,children:[m.jsx("span",{children:t("filter_completed")}),f==="completed"&&_e.check]})]}),m.jsxs("div",{className:"popover-section",children:[m.jsxs("h4",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[m.jsx("span",{children:t("filter_category")}),m.jsx("button",{onClick:()=>{const oe=prompt("새 카테고리 이름: (New category name:)");oe&&oe.trim()&&!T.includes(oe.trim())&&x(oe.trim())},style:{background:"none",border:"none",color:"var(--primary-color)",cursor:"pointer",fontSize:"1.2rem",padding:"0"},children:"+"})]}),m.jsxs("button",{onClick:()=>{v("all")},className:`popover-action-button ${g==="all"?"active":""}`,children:[m.jsx("span",{children:t("category_all")}),g==="all"&&_e.check]}),T.map(oe=>m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[m.jsxs("button",{onClick:()=>{v(oe)},className:`popover-action-button ${g===oe?"active":""}`,style:{flex:1,justifyContent:"space-between"},children:[m.jsx("span",{children:oe}),g===oe&&_e.check]}),!["school","work","personal","other"].includes(oe)&&m.jsx("button",{onClick:()=>D(oe),style:{background:"rgba(255, 59, 48, 0.1)",border:"none",color:"var(--danger-color)",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"0.8rem"},children:"✕"})]},oe))]}),m.jsxs("div",{className:"popover-section",children:[m.jsx("h4",{children:t("sort_title")}),m.jsxs("button",{onClick:()=>{u("manual")},className:`popover-action-button ${l==="manual"?"active":""}`,children:[m.jsx("span",{children:t("sort_label_manual")}),l==="manual"&&_e.check]}),m.jsxs("button",{onClick:()=>{u("deadline")},className:`popover-action-button ${l==="deadline"?"active":""}`,children:[m.jsx("span",{children:t("sort_label_deadline")}),l==="deadline"&&_e.check]}),m.jsxs("button",{onClick:()=>{u("newest")},className:`popover-action-button ${l==="newest"?"active":""}`,children:[m.jsx("span",{children:t("sort_label_newest")}),l==="newest"&&_e.check]}),m.jsxs("button",{onClick:()=>{u("alphabetical")},className:`popover-action-button ${l==="alphabetical"?"active":""}`,children:[m.jsx("span",{children:t("sort_label_alphabetical")}),l==="alphabetical"&&_e.check]}),m.jsxs("button",{onClick:()=>{u("ai")},className:"popover-action-button with-icon",children:[m.jsx("span",{className:"popover-button-icon",children:_e.ai}),m.jsx("span",{children:t(a?"ai_sorting_button":"sort_label_ai")})]}),m.jsx("button",{onClick:()=>{u("ai"),k(!1)},className:"popover-action-button",style:{backgroundColor:"rgba(88, 86, 214, 0.1)",marginTop:"8px",color:"var(--icon-color-indigo)"},children:m.jsx("span",{children:"💡 정렬 제안 보기"})})]})]})]}),M&&m.jsxs("div",{className:"collaboration-settings",children:[m.jsx("button",{onClick:()=>Fe(!xe),className:`header-icon-button ${J?"collaboration-active":""}`,"aria-label":"공동작업 설정",title:"공동작업 설정",children:J?"👥":"👤"}),xe&&m.jsx("div",{className:"profile-popover collaboration-popover",style:{right:"60px",top:"50px"},children:m.jsxs("div",{className:"popover-section",children:[m.jsx("h4",{style:{marginBottom:"12px"},children:"공동작업 설정"}),m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[m.jsx("span",{children:"공동작업 활성화"}),m.jsx("button",{onClick:()=>N(M,!J),style:{background:J?"var(--primary-color)":"#ccc",border:"none",borderRadius:"12px",width:"44px",height:"24px",position:"relative",cursor:"pointer",transition:"background 0.2s"},children:m.jsx("div",{style:{background:"white",borderRadius:"50%",width:"20px",height:"20px",position:"absolute",top:"2px",left:J?"22px":"2px",transition:"left 0.2s"}})})]}),J&&w.length>0&&m.jsxs("div",{style:{marginBottom:"16px"},children:[m.jsxs("h5",{style:{marginBottom:"8px",fontSize:"0.9rem"},children:["현재 접속자 (",w.length,"명)"]}),m.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:w.map(oe=>m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(var(--primary-color-rgb), 0.1)",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8rem"},children:[oe.photoURL&&m.jsx("img",{src:oe.photoURL,alt:"",style:{width:"16px",height:"16px",borderRadius:"50%"}}),m.jsx("span",{children:oe.displayName}),m.jsx("div",{style:{width:"6px",height:"6px",background:oe.isOnline?"#34C759":"#ccc",borderRadius:"50%"}})]},oe.userId))})]}),J&&m.jsx(m.Fragment,{children:m.jsxs("div",{style:{borderTop:"1px solid #eee",paddingTop:"16px"},children:[m.jsx("h5",{style:{marginBottom:"8px",fontSize:"0.9rem"},children:"세부 설정"}),m.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",cursor:"pointer"},children:[m.jsx("span",{style:{fontSize:"0.8rem"},children:"접속자 표시"}),m.jsx("input",{type:"checkbox",checked:(he==null?void 0:he.showPresence)??!0,onChange:oe=>b(M,{showPresence:oe.target.checked})})]}),m.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",cursor:"pointer"},children:[m.jsx("span",{style:{fontSize:"0.8rem"},children:"편집 상태 표시"}),m.jsx("input",{type:"checkbox",checked:(he==null?void 0:he.showEditingState)??!0,onChange:oe=>b(M,{showEditingState:oe.target.checked})})]}),m.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",cursor:"pointer"},children:[m.jsx("span",{style:{fontSize:"0.8rem"},children:"충돌 감지"}),m.jsx("input",{type:"checkbox",checked:(he==null?void 0:he.enableConflictDetection)??!0,onChange:oe=>b(M,{enableConflictDetection:oe.target.checked})})]})]})})]})})]}),M&&((Pe=O.find(oe=>oe.id===M))==null?void 0:Pe.collaborators)&&m.jsx("button",{onClick:F,disabled:I,className:"header-icon-button","aria-label":"동기화",title:I?"동기화 중...":`공유 폴더 수동 동기화
실시간 동기화가 실패했을 때 사용하세요`,children:I?m.jsx("div",{className:"spinner",style:{width:"20px",height:"20px"}}):"🔄"}),m.jsx("button",{onClick:E,className:"header-icon-button","aria-label":t("settings_title"),children:_e.settings})]})]}),m.jsx("div",{className:"header-right",children:e?m.jsx("button",{onClick:i,className:"header-action-button destructive",children:t("delete_selected_button_label").replace("{count}",String(n))}):m.jsx(m.Fragment,{children:m.jsx("button",{onClick:R,className:"header-icon-button","aria-label":t("add_new_goal_button_label"),children:_e.add})})})]})},b3=({todos:t,onToggleComplete:e,onDelete:n,onEdit:r,onInfo:i,t:s,filter:o,randomEncouragement:a,isSelectionMode:l,selectedTodoIds:u,onSelectTodo:f,folders:p,onMoveToFolder:g})=>{if(t.length===0){const v=`empty_message_${o}`;return m.jsx("div",{className:"empty-message",children:m.jsx("p",{children:s(v)})})}return m.jsx("ul",{children:t.map(v=>m.jsx(M3,{todo:v,onToggleComplete:e,onDelete:n,onEdit:r,onInfo:i,t:s,isSelectionMode:l,isSelected:u.has(v.id),onSelect:f,folders:p,onMoveToFolder:g},v.id))})},M3=ow.memo(({todo:t,onToggleComplete:e,onDelete:n,onEdit:r,onInfo:i,t:s,isSelectionMode:o,isSelected:a,onSelect:l,folders:u,onMoveToFolder:f})=>{var T;const p=()=>{o&&l(t.id)},g={school:"🎓",work:"💼",personal:"👤",other:"📌"},v=x=>x?{school:s("category_school"),work:s("category_work"),personal:s("category_personal"),other:s("category_other")}[x]||x:"";return m.jsx("li",{className:`${t.completed?"completed":""} ${o?"selection-mode":""} ${a?"selected":""}`,onClick:p,children:m.jsxs("div",{className:"swipeable-content",children:[m.jsxs("label",{className:"checkbox-container",onClick:x=>x.stopPropagation(),children:[m.jsx("input",{type:"checkbox",checked:t.completed,onChange:()=>e(t.id)}),m.jsx("span",{className:"checkmark"})]}),m.jsxs("div",{className:"todo-text-with-streak",children:[m.jsx("span",{className:"todo-text",children:t.wish}),t.isRecurring&&t.streak>0&&m.jsxs("div",{className:"streak-indicator",children:[_e.flame,m.jsx("span",{children:t.streak})]})]}),m.jsxs("div",{className:"todo-actions-and-meta",children:[m.jsxs("div",{className:"todo-meta-badges",children:[t.category&&m.jsxs("span",{style:{backgroundColor:"rgba(88, 86, 214, 0.1)",color:"var(--icon-color-indigo)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",marginRight:"4px",display:"inline-flex",alignItems:"center",gap:"4px",whiteSpace:"nowrap"},children:[g[t.category]||"📌"," ",v(t.category)]}),t.deadline&&m.jsx("span",{className:"todo-deadline",children:P3(t.deadline,s)}),t.collaborators&&t.collaborators.length>0&&m.jsxs("span",{style:{backgroundColor:"rgba(52, 199, 89, 0.1)",color:"var(--success-color)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.85rem",marginLeft:"4px",display:"inline-flex",alignItems:"center",gap:"4px"},children:["🤝 ",t.collaborators.length]}),t.folderId&&m.jsxs("span",{style:{backgroundColor:"rgba(100, 150, 200, 0.15)",color:"var(--primary-color)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",marginLeft:"4px",display:"inline-flex",alignItems:"center",gap:"4px",whiteSpace:"nowrap"},children:["📁 ",((T=u.find(x=>x.id===t.folderId))==null?void 0:T.name)||"Unknown"]})]}),m.jsxs("div",{className:"todo-buttons",children:[m.jsxs("select",{onClick:x=>x.stopPropagation(),onChange:x=>{f(t.id,x.target.value==="root"?null:x.target.value)},defaultValue:t.folderId||"root",style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--card-bg-color)",color:"var(--text-color)",cursor:"pointer",fontSize:"0.85rem",fontFamily:"inherit"},title:"폴더 선택",children:[m.jsx("option",{value:"root",children:"📁 All Goals"}),u.map(x=>m.jsx("option",{value:x.id,children:x.name},x.id))]}),m.jsx("button",{onClick:x=>{x.stopPropagation(),r(t)},className:"info-button edit-button","aria-label":s("edit_button_aria"),children:_e.edit}),m.jsx("button",{onClick:x=>{x.stopPropagation(),n(t.id)},className:"delete-button","aria-label":s("delete_button"),children:_e.delete}),m.jsx("button",{onClick:x=>{x.stopPropagation(),i(t)},className:"info-button","aria-label":s("info_button_aria"),children:_e.info})]})]})]})})}),Ys=({onClose:t,children:e,className:n="",isClosing:r,size:i="large"})=>{const s={small:"modal-content-small",medium:"modal-content-medium",large:"modal-content-large"}[i];return m.jsx("div",{className:`modal-backdrop ${r?"is-closing":""}`,onClick:t,children:m.jsx("div",{className:`modal-content ${s} ${n} ${r?"is-closing":""}`,onClick:o=>o.stopPropagation(),children:e})})},xa=t=>{const[e,n]=$.useState(!1);return[e,()=>{n(!0),setTimeout(t,500)}]},V3=({step:t,t:e,createAI:n,...r})=>{const{wish:i,setWish:s,outcome:o,setOutcome:a,obstacle:l,setObstacle:u,plan:f,setPlan:p,isRecurring:g,setIsRecurring:v,recurringDays:T,setRecurringDays:x,deadline:D,setDeadline:S,noDeadline:E,setNoDeadline:R,category:M,setCategory:O,userCategories:F,errors:I,language:w}=r,[C,N]=$.useState(!1),[b,V]=$.useState(""),[k,xe]=$.useState(""),Fe=async(Me,he)=>{if(he){N(!0),V(""),xe("");try{const J=n();if(!J){xe("AI 기능을 사용하려면 설정에서 API 키를 입력해주세요."),N(!1);return}const le=`Provide concise, actionable feedback on this part of a WOOP goal: ${Me} - "${he}". The feedback should be helpful and encouraging, in ${w==="ko"?"Korean":"English"}. Keep it to 1-2 sentences.`,pe=await J.models.generateContent({model:"gemini-2.5-flash",contents:le});V(pe.text)}catch(J){console.error("AI Feedback Error:",J),xe("Failed to get AI feedback.")}finally{N(!1)}}};switch(t){case 1:return m.jsxs("div",{children:[m.jsx("h3",{children:e("wish_label")}),m.jsxs("div",{className:"step-guidance",children:[m.jsx("p",{className:"tip",children:e("wish_tip")}),m.jsx("p",{className:"example",children:e("wish_example")})]}),m.jsx("textarea",{value:i,onChange:he=>{s(he.target.value),V(""),xe("")},placeholder:e("wish_label"),className:I.wish?"input-error":"",rows:3}),I.wish&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_wish_required")]}),m.jsxs("div",{className:"ai-feedback-section",children:[m.jsxs("button",{onClick:()=>Fe("Wish",i),disabled:!i.trim()||C,className:"ai-feedback-button",children:[C?m.jsx("div",{className:"spinner-small"}):"🤖",m.jsx("span",{children:e(C?"ai_analyzing":"ai_coach_suggestion")})]}),b&&m.jsx("div",{className:"ai-feedback-bubble",children:b}),k&&m.jsx("div",{className:"ai-feedback-bubble error",children:k})]})]});case 2:return m.jsxs("div",{children:[m.jsx("h3",{children:e("outcome_label")}),m.jsxs("div",{className:"step-guidance",children:[m.jsx("p",{className:"tip",children:e("outcome_tip")}),m.jsx("p",{className:"example",children:e("outcome_example")})]}),m.jsx("textarea",{value:o,onChange:he=>{a(he.target.value),V(""),xe("")},placeholder:e("outcome_label"),className:I.outcome?"input-error":"",rows:3}),I.outcome&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_outcome_required")]}),m.jsxs("div",{className:"ai-feedback-section",children:[m.jsxs("button",{onClick:()=>Fe("Outcome",o),disabled:!o.trim()||C,className:"ai-feedback-button",children:[C?m.jsx("div",{className:"spinner-small"}):"🤖",m.jsx("span",{children:e(C?"ai_analyzing":"ai_coach_suggestion")})]}),b&&m.jsx("div",{className:"ai-feedback-bubble",children:b}),k&&m.jsx("div",{className:"ai-feedback-bubble error",children:k})]})]});case 3:return m.jsxs("div",{children:[m.jsx("h3",{children:e("obstacle_label")}),m.jsxs("div",{className:"step-guidance",children:[m.jsx("p",{className:"tip",children:e("obstacle_tip")}),m.jsx("p",{className:"example",children:e("obstacle_example")})]}),m.jsx("textarea",{value:l,onChange:he=>{u(he.target.value),V(""),xe("")},placeholder:e("obstacle_label"),className:I.obstacle?"input-error":"",rows:3}),I.obstacle&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_obstacle_required")]}),m.jsxs("div",{className:"ai-feedback-section",children:[m.jsxs("button",{onClick:()=>Fe("Obstacle",l),disabled:!l.trim()||C,className:"ai-feedback-button",children:[C?m.jsx("div",{className:"spinner-small"}):"🤖",m.jsx("span",{children:e(C?"ai_analyzing":"ai_coach_suggestion")})]}),b&&m.jsx("div",{className:"ai-feedback-bubble",children:b}),k&&m.jsx("div",{className:"ai-feedback-bubble error",children:k})]})]});case 4:return m.jsxs("div",{children:[m.jsx("h3",{children:e("plan_label")}),m.jsxs("div",{className:"step-guidance",children:[m.jsx("p",{className:"tip",children:e("plan_tip")}),m.jsx("p",{className:"example",children:e("plan_example")})]}),m.jsx("textarea",{value:f,onChange:he=>{p(he.target.value),V(""),xe("")},placeholder:e("plan_label"),className:I.plan?"input-error":"",rows:3}),I.plan&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_plan_required")]}),m.jsxs("div",{className:"ai-feedback-section",children:[m.jsxs("button",{onClick:()=>Fe("Plan",f),disabled:!f.trim()||C,className:"ai-feedback-button",children:[C?m.jsx("div",{className:"spinner-small"}):"🤖",m.jsx("span",{children:e(C?"ai_analyzing":"ai_coach_suggestion")})]}),b&&m.jsx("div",{className:"ai-feedback-bubble",children:b}),k&&m.jsx("div",{className:"ai-feedback-bubble error",children:k})]})]});case 5:const Me=he=>{const J=[...T],le=J.indexOf(he);le>-1?J.splice(le,1):J.push(he),x(J)};return m.jsxs("div",{children:[m.jsxs("h3",{children:[e("recurrence_label")," & ",e("deadline_label")," & ",e("category_label")]}),m.jsxs("div",{className:"step-guidance",children:[m.jsx("p",{className:"tip",children:e("recurrence_tip")}),m.jsx("p",{className:"example",children:e("recurrence_example")})]}),m.jsxs("label",{className:"settings-item standalone-toggle",children:[m.jsx("span",{style:{fontWeight:500},children:e("recurrence_option_daily")}),m.jsxs("label",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:g,onChange:he=>v(he.target.checked)}),m.jsx("span",{className:"slider round"})]})]}),g&&m.jsx("div",{className:"day-picker",children:e("day_names_short_picker").map((he,J)=>m.jsx("button",{onClick:()=>Me(J),className:`day-button ${T.includes(J)?"selected":""}`,children:he},J))}),I.recurringDays&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_day_required")]}),m.jsx("hr",{}),m.jsx("div",{className:"step-guidance",style:{marginTop:"16px"},children:m.jsx("p",{className:"tip",children:e("deadline_tip")})}),m.jsxs("label",{className:"settings-item standalone-toggle",children:[m.jsx("span",{style:{fontWeight:500},children:e("deadline_option_no_deadline")}),m.jsxs("label",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:E,onChange:he=>R(he.target.checked)}),m.jsx("span",{className:"slider round"})]})]}),!E&&m.jsx("input",{type:"date",value:D,onChange:he=>S(he.target.value),className:I.deadline?"input-error":"",style:{marginTop:"12px"}}),I.deadline&&m.jsxs("p",{className:"field-error-message",children:[_e.exclamation," ",e("error_deadline_required")]}),m.jsx("hr",{}),m.jsx("div",{className:"step-guidance",style:{marginTop:"16px"},children:m.jsx("p",{className:"tip",children:e("category_label")})}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:F&&F.length>2?"repeat(2, 1fr)":"repeat(1, 1fr)",gap:"8px",marginTop:"12px"},children:F&&F.map(he=>m.jsx("button",{onClick:()=>O(he),className:`category-button ${M===he?"active":""}`,children:he},he))})]});default:return null}},L3=({onGenerate:t,t:e})=>{const[n,r]=$.useState(""),[i,s]=$.useState(""),[o,a]=$.useState(""),[l,u]=$.useState(""),[f,p]=$.useState(""),{endDate:g,generatedCount:v}=$.useMemo(()=>{const x=parseInt(i,10),D=parseInt(o,10);if(!l||!x||x<=0||!D||D<=0)return{endDate:"",generatedCount:0};const S=Math.ceil(x/D),E=new Date(l),R=new Date(E);return R.setDate(E.getDate()+S-1),{endDate:R.toISOString().split("T")[0],generatedCount:S}},[i,o,l]),T=()=>{const x=parseInt(i,10),D=parseInt(o,10);if(!n.trim()||!l||!x||x<=0||!D||D<=0){p(e("automation_error_all_fields"));return}const S=[],E=Math.ceil(x/D),R=new Date(l);for(let M=0;M<E;M++){const O=new Date(R);O.setDate(R.getDate()+M);const F=M*D+1,I=Math.min((M+1)*D,x),w=`${n.trim()} ${F}`+(I>F?` - ${I}`:"");S.push({wish:w,outcome:"",obstacle:"",plan:"",isRecurring:!1,recurringDays:[],deadline:O.toISOString().split("T")[0],category:"personal"})}p(""),t(S)};return m.jsxs("div",{className:"automation-form-container",children:[m.jsx("h3",{children:e("automation_title")}),m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:e("automation_base_name_label")}),m.jsx("input",{type:"text",value:n,onChange:x=>r(x.target.value),placeholder:e("automation_base_name_placeholder")})]}),m.jsxs("div",{className:"automation-form-grid",children:[m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:e("automation_total_units_label")}),m.jsx("input",{type:"number",value:i,onChange:x=>s(x.target.value),placeholder:e("automation_total_units_placeholder")})]}),m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:e("automation_units_per_day_label")}),m.jsx("input",{type:"number",value:o,onChange:x=>a(x.target.value),placeholder:"예: 5"})]})]}),m.jsxs("div",{className:"automation-form-grid",children:[m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:e("automation_start_date_label")}),m.jsx("input",{type:"date",value:l,onChange:x=>u(x.target.value)})]}),m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:e("automation_end_date_label")}),m.jsx("input",{type:"date",value:g,readOnly:!0})]})]}),f&&m.jsxs("p",{className:"field-error-message",style:{justifyContent:"center"},children:[_e.exclamation," ",f]}),m.jsx("div",{className:"goal-assistant-nav",children:m.jsx("button",{onClick:T,className:"primary",disabled:v===0,children:e("automation_generate_button").replace("{count}",String(v))})})]})},jI=({onClose:t,onAddTodo:e,onAddMultipleTodos:n,onEditTodo:r,existingTodo:i,t:s,language:o,createAI:a,userCategories:l=["personal"]})=>{const[u,f]=xa(t),[p,g]=$.useState("woop"),[v,T]=$.useState(1),[x,D]=$.useState("forward"),[S,E]=$.useState((i==null?void 0:i.wish)||""),[R,M]=$.useState((i==null?void 0:i.outcome)||""),[O,F]=$.useState((i==null?void 0:i.obstacle)||""),[I,w]=$.useState((i==null?void 0:i.plan)||""),[C,N]=$.useState((i==null?void 0:i.isRecurring)||!1),[b,V]=$.useState((i==null?void 0:i.recurringDays)||[]),[k,xe]=$.useState((i==null?void 0:i.deadline)||""),[Fe,Me]=$.useState(!(i!=null&&i.deadline)),[he,J]=$.useState((i==null?void 0:i.category)||"personal"),[le,pe]=$.useState({}),[Pe,oe]=$.useState(""),[et,Je]=$.useState(""),[jt,Et]=$.useState(""),[sn,fn]=$.useState("personal"),Jt=5,Fn=Ne=>{const Ie={};return Ne===1&&!S.trim()&&(Ie.wish=!0),Ne===2&&!R.trim()&&(Ie.outcome=!0),Ne===3&&!O.trim()&&(Ie.obstacle=!0),Ne===4&&!I.trim()&&(Ie.plan=!0),Ne===5&&(!Fe&&!k&&(Ie.deadline=!0),C&&b.length===0&&(Ie.recurringDays=!0)),pe(Ie),Object.keys(Ie).length===0},_r=()=>{Fn(v)&&(v<Jt?(D("forward"),T(Ne=>Ne+1)):on())},er=()=>{v>1&&(D("backward"),T(Ne=>Ne-1))},on=()=>{if(!Fn(5))return;const Ne={wish:S,outcome:R,obstacle:O,plan:I,isRecurring:C,recurringDays:b,deadline:Fe?"":k,category:he};i&&r?r({...i,...Ne}):e&&e(Ne)},yr=()=>{Pe.trim()&&(e&&e({wish:Pe.trim(),outcome:Pe.trim(),obstacle:"",plan:"",isRecurring:!1,recurringDays:[],deadline:et,category:sn}),oe(""),Je(""),Et(""),fn("personal"),f())};return m.jsxs(Ys,{onClose:f,isClosing:u,className:"goal-assistant-modal",children:[m.jsxs("div",{className:"goal-assistant-header",children:[m.jsx("div",{className:"goal-assistant-header-left",children:v>1&&p==="woop"&&m.jsx("button",{onClick:er,className:"settings-back-button",children:_e.back})}),m.jsx("h2",{children:p==="woop"?"새로운 목표":p==="quick"?"새로운 할일":p==="automation"?"새로운 계획":s("goal_assistant_title")}),m.jsx("div",{className:"goal-assistant-header-right",children:m.jsx("button",{onClick:f,className:"close-button",children:_e.close})})]}),!i&&m.jsx("div",{className:"modal-mode-switcher-container",children:m.jsxs("div",{className:"modal-mode-switcher",children:[m.jsx("button",{onClick:()=>g("woop"),className:p==="woop"?"active":"",children:s("goal_assistant_mode_woop")}),m.jsx("button",{onClick:()=>g("quick"),className:p==="quick"?"active":"",children:"새로운 할일"}),m.jsx("button",{onClick:()=>g("automation"),className:p==="automation"?"active":"",children:s("goal_assistant_mode_automation")})]})}),m.jsx("div",{className:"goal-assistant-body",children:p==="woop"?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"progress-bar-container",children:m.jsx("div",{className:"progress-bar",style:{width:`${v/Jt*100}%`}})}),m.jsx("div",{className:`goal-assistant-step-content-animator ${x}`,children:m.jsx(V3,{step:v,t:s,createAI:a,wish:S,setWish:E,outcome:R,setOutcome:M,obstacle:O,setObstacle:F,plan:I,setPlan:w,isRecurring:C,setIsRecurring:N,recurringDays:b,setRecurringDays:V,deadline:k,setDeadline:xe,noDeadline:Fe,setNoDeadline:Me,category:he,setCategory:J,userCategories:l,errors:le,language:o})},v),m.jsxs("div",{className:"goal-assistant-nav",children:[v>1?m.jsx("button",{onClick:er,className:"secondary",children:s("back_button")}):m.jsx("div",{}),m.jsx("button",{onClick:_r,className:"primary",children:s(v===Jt?i?"save_button":"add_button":"next_button")})]})]}):p==="quick"?m.jsxs("div",{style:{padding:"24px 16px"},children:[m.jsxs("div",{style:{marginBottom:"20px"},children:[m.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"12px"},children:"새로운 할일"}),m.jsx("div",{className:"step-guidance",children:m.jsx("p",{className:"tip",children:"빠르게 할일을 추가하세요"})}),m.jsx("textarea",{value:Pe,onChange:Ne=>oe(Ne.target.value),placeholder:"예: 선물 사기",rows:2,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"14px",fontFamily:"inherit",resize:"none",marginTop:"12px"},onKeyPress:Ne=>{Ne.key==="Enter"&&Ne.ctrlKey&&yr()}})]}),m.jsx("hr",{}),m.jsxs("div",{style:{marginBottom:"20px"},children:[m.jsx("div",{className:"step-guidance",style:{marginTop:"16px"},children:m.jsx("p",{className:"tip",children:"마감일 설정 (선택)"})}),m.jsxs("label",{className:"settings-item standalone-toggle",style:{marginTop:"12px"},children:[m.jsx("span",{style:{fontWeight:"500"},children:"마감일 설정"}),m.jsxs("label",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:!!et,onChange:Ne=>Je(Ne.target.checked?new Date().toISOString().split("T")[0]:"")}),m.jsx("span",{className:"slider round"})]})]}),et&&m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px"},children:[m.jsxs("div",{children:[m.jsx("label",{style:{fontSize:"12px",opacity:.7,display:"block",marginBottom:"4px"},children:"날짜"}),m.jsx("input",{type:"date",value:et,onChange:Ne=>Je(Ne.target.value),style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"13px"}})]}),m.jsxs("div",{children:[m.jsx("label",{style:{fontSize:"12px",opacity:.7,display:"block",marginBottom:"4px"},children:"시간 (선택)"}),m.jsx("input",{type:"time",value:jt,onChange:Ne=>Et(Ne.target.value),style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"13px"}})]})]})]}),m.jsx("hr",{}),m.jsxs("div",{style:{marginBottom:"24px"},children:[m.jsx("div",{className:"step-guidance",style:{marginTop:"16px"},children:m.jsx("p",{className:"tip",children:s("category_label")})}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:l&&l.length>2?"repeat(2, 1fr)":"repeat(1, 1fr)",gap:"8px",marginTop:"12px"},children:l&&l.map(Ne=>m.jsx("button",{onClick:()=>fn(Ne),className:`category-button ${sn===Ne?"active":""}`,children:Ne},Ne))})]}),m.jsxs("div",{className:"goal-assistant-nav",children:[m.jsx("button",{onClick:f,className:"secondary",children:s("cancel_button")}),m.jsx("button",{onClick:yr,className:"primary",disabled:!Pe.trim(),children:s("add_button")})]})]}):n&&m.jsx(L3,{onGenerate:n,t:s})})]})},F3=({todo:t,onClose:e,t:n,createAI:r,onOpenCollaboration:i,userCategories:s,onUpdateGoal:o})=>{const[a,l]=xa(e),[u,f]=$.useState(""),[p,g]=$.useState(!1),[v,T]=$.useState(!1),x=async()=>{g(!0),f(""),T(!1);try{const D=r();if(!D){f("AI 기능을 사용하려면 설정에서 API 키를 입력해주세요."),g(!1);return}const S=`Based on the WOOP method, provide a concise and encouraging suggestion for the following goal: Wish: "${t.wish}", Best Outcome: "${t.outcome}", Obstacle: "${t.obstacle}", Plan: "${t.plan}". Focus on strengthening the plan or reframing the obstacle.`,E=await D.models.generateContent({model:"gemini-2.5-flash",contents:S});f(E.text)}catch(D){console.error(D),T(!0)}finally{g(!1)}};return m.jsxs(Ys,{onClose:l,isClosing:a,className:"info-modal",children:[m.jsxs("div",{className:"info-modal-content",children:[m.jsx("h2",{children:n("goal_details_modal_title")}),m.jsxs("div",{className:"info-section",children:[m.jsx("h4",{children:n("wish_label")}),m.jsx("p",{children:t.wish})]}),m.jsxs("div",{className:"info-section",children:[m.jsx("h4",{children:n("outcome_label")}),m.jsx("p",{children:t.outcome})]}),m.jsxs("div",{className:"info-section",children:[m.jsx("h4",{children:n("obstacle_label")}),m.jsx("p",{children:t.obstacle})]}),m.jsxs("div",{className:"info-section",children:[m.jsx("h4",{children:n("plan_label")}),m.jsx("p",{children:t.plan})]}),s&&s.length>0&&o&&m.jsxs("div",{className:"info-section",style:{borderTop:"1px solid var(--border-color)",paddingTop:"16px",marginTop:"16px"},children:[m.jsx("h4",{style:{marginBottom:"12px"},children:n("category_label")}),m.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:s.map(D=>m.jsx("button",{onClick:()=>{o({...t,category:D}),l()},className:`category-button ${t.category===D?"active":""}`,style:{padding:"8px 16px",borderRadius:"20px",border:t.category===D?"2px solid var(--primary-color)":"2px solid var(--border-color)",backgroundColor:t.category===D?"var(--primary-color)":"transparent",color:t.category===D?"white":"var(--text-color)",cursor:"pointer",fontSize:"14px",fontWeight:t.category===D?"600":"500",transition:"all 0.25s ease",whiteSpace:"nowrap",display:"inline-block",boxShadow:t.category===D?"0 2px 8px rgba(88, 86, 214, 0.2)":"none"},children:D},D))})]}),m.jsxs("div",{className:"ai-analysis-section",children:[m.jsx("h4",{children:n("ai_coach_suggestion")}),p?m.jsx("p",{children:n("ai_analyzing")}):u?m.jsx("p",{children:u}):v?m.jsx("p",{className:"ai-error",children:n("ai_sort_error_message")}):m.jsx("button",{onClick:x,className:"feedback-button",children:n("ai_coach_suggestion")})]})]}),m.jsxs("div",{className:"modal-buttons",children:[i&&m.jsx("button",{onClick:()=>{i(t),l()},className:"secondary",children:"🤝 협업"}),m.jsx("button",{onClick:l,className:"primary",children:n("close_button")})]})]})},U3=({folder:t,onClose:e,t:n,googleUser:r,onUpdateCollaborators:i,setAlertConfig:s})=>{const[o,a]=xa(e),[l,u]=$.useState(""),[f,p]=$.useState(!1),[g,v]=$.useState(""),[T,x]=$.useState(!1),D=async()=>{if(!(!t||!r)){p(!0);try{if(!g||g.trim().length===0){s({title:"암호 설정 필수",message:"보안을 위해 공유 링크에 반드시 암호를 설정해주세요.",confirmText:"확인",onConfirm:()=>{}}),p(!1);return}const M={type:"folder_share",folderId:t.id,folderName:t.name,folderColor:t.color,goals:[],sharedBy:r==null?void 0:r.email,ownerId:r==null?void 0:r.uid,sharedAt:new Date().toISOString(),password:g},O=yt(we,"users",r.uid,"folders"),F=tt(O,t.id),I=t.collaborators||[];await pt(F,{collaborators:I,shareInfo:{password:g,createdAt:new Date().toISOString()},updatedAt:new Date().toISOString()},{merge:!0});const w=Wm(JSON.stringify(M)),C=`${window.location.origin}${window.location.pathname}?folder_share=${encodeURIComponent(w)}`,N=await Zx(C);u(N),s({title:"공유 링크 생성 완료",message:"클립보드에 복사되었습니다. 협업자에게 공유해주세요!",confirmText:"확인",onConfirm:()=>{navigator.clipboard.writeText(N)}})}catch(M){console.error("공유 링크 생성 실패:",M),s({title:"생성 실패",message:"공유 링크 생성에 실패했습니다. 다시 시도해주세요.",confirmText:"확인",onConfirm:()=>{}})}finally{p(!1)}}},S=()=>{l&&navigator.clipboard.writeText(l).then(()=>{s({title:"복사 완료",message:"링크가 클립보드에 복사되었습니다.",confirmText:"확인",onConfirm:()=>{}})})},E=async M=>{if(!(!t||!r))try{const O=yt(we,"users",r.uid,"folders"),F=tt(O,t.id),I=(t.collaborators||[]).filter(w=>w.userId!==M);await pt(F,{collaborators:I,updatedAt:new Date().toISOString()},{merge:!0}),i(t.id,I),s({title:"제거 완료",message:"협업자가 제거되었습니다.",confirmText:"확인",onConfirm:()=>{}})}catch(O){console.error("협업자 제거 실패:",O),s({title:"제거 실패",message:"협업자 제거에 실패했습니다.",confirmText:"확인",onConfirm:()=>{}})}},R=async(M,O)=>{if(!(!t||!r))try{const F=yt(we,"users",r.uid,"folders"),I=tt(F,t.id),w=(t.collaborators||[]).map(C=>C.userId===M?{...C,role:O}:C);await pt(I,{collaborators:w,updatedAt:new Date().toISOString()},{merge:!0}),i(t.id,w),s({title:"권한 변경 완료",message:`협업자의 권한이 ${O==="editor"?"편집자":"뷰어"}로 변경되었습니다.`,confirmText:"확인",onConfirm:()=>{}})}catch(F){console.error("권한 변경 실패:",F)}};return t?m.jsxs(Ys,{onClose:a,isClosing:o,className:"goal-assistant-modal",children:[m.jsxs("div",{className:"goal-assistant-header",children:[m.jsx("div",{className:"goal-assistant-header-left"}),m.jsxs("h2",{children:[t.name," 폴더 공유"]}),m.jsx("div",{className:"goal-assistant-header-right",children:m.jsx("button",{onClick:a,className:"close-button",children:_e.close})})]}),m.jsx("div",{className:"goal-assistant-body",children:m.jsxs("div",{style:{padding:"24px 16px"},children:[m.jsxs("div",{style:{marginBottom:"20px"},children:[m.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"12px"},children:"현재 협업자"}),t.collaborators&&t.collaborators.length>0?m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:t.collaborators.map(M=>m.jsxs("div",{className:"settings-item",style:{padding:"12px",backgroundColor:"var(--card-bg-color)",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{flex:1},children:[m.jsx("div",{style:{fontWeight:"500",fontSize:"0.95rem"},children:M.email}),M.role==="owner"?m.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary-color)",marginTop:"2px"},children:"소유자"}):m.jsxs("select",{value:M.role,onChange:O=>R(M.userId,O.target.value),style:{fontSize:"0.85rem",padding:"4px 8px",marginTop:"4px",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",cursor:"pointer"},children:[m.jsx("option",{value:"editor",children:"편집자"}),m.jsx("option",{value:"viewer",children:"뷰어"})]})]}),M.role!=="owner"&&m.jsx("button",{onClick:()=>E(M.userId),style:{padding:"4px 12px",backgroundColor:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.8rem",marginLeft:"12px",whiteSpace:"nowrap"},children:"제거"})]},M.userId))}):m.jsx("div",{className:"step-guidance",children:m.jsx("p",{className:"tip",children:"협업자가 없습니다. 공유 링크로 협업자를 추가하세요."})})]}),m.jsx("hr",{style:{margin:"20px 0",border:"none",borderTop:"1px solid var(--border-color)"}}),m.jsxs("div",{style:{marginBottom:"20px"},children:[m.jsx("h3",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"12px"},children:"공유 링크로 협업자 추가"}),m.jsx("div",{className:"step-guidance",children:m.jsx("p",{className:"tip",children:"공유 링크를 생성하고 협업자에게 전달하면, 그들이 해당 폴더에 접근할 수 있습니다."})}),l?m.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[m.jsx("div",{style:{padding:"12px",backgroundColor:"var(--card-bg-color)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:m.jsx("input",{type:"text",readOnly:!0,value:l,onClick:M=>M.target.select(),style:{width:"100%",padding:"10px",border:"1px solid var(--border-color)",borderRadius:"6px",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontSize:"0.85rem",boxSizing:"border-box",fontFamily:"monospace"}})}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[m.jsx("button",{onClick:S,className:"primary",children:"클립보드 복사"}),m.jsx("button",{onClick:()=>{u(""),v(""),x(!1)},className:"secondary",children:"새로 생성"})]})]}):m.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[m.jsxs("label",{className:"settings-item standalone-toggle",children:[m.jsx("span",{style:{fontWeight:"500"},children:"링크에 암호 설정"}),m.jsxs("label",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:T,onChange:M=>{x(M.target.checked),M.target.checked||v("")}}),m.jsx("span",{className:"slider round"})]})]}),T&&m.jsx("input",{type:"password",placeholder:"암호 입력",value:g,onChange:M=>v(M.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"var(--input-bg-color)",color:"var(--text-color)",fontFamily:"inherit",fontSize:"14px",boxSizing:"border-box"}}),m.jsx("button",{onClick:D,disabled:f||!g.trim(),style:{width:"100%",padding:"12px",backgroundColor:(f||!g.trim(),"var(--primary-color)"),color:"white",border:"none",borderRadius:"8px",cursor:f||!g.trim()?"not-allowed":"pointer",fontWeight:"600",opacity:f||!g.trim()?.6:1,fontSize:"15px",transition:"all 0.2s"},children:f?"링크 생성 중...":"공유 링크 생성"})]})]})]})}),m.jsxs("div",{className:"goal-assistant-nav",children:[m.jsx("div",{}),m.jsx("button",{onClick:a,className:"primary",children:"닫기"})]})]}):null},O3=({onClose:t,isDarkMode:e,onToggleDarkMode:n,themeMode:r,onThemeChange:i,backgroundTheme:s,onSetBackgroundTheme:o,onExportData:a,onImportData:l,setAlertConfig:u,onDeleteAllData:f,dataActionStatus:p,language:g,onSetLanguage:v,t:T,todos:x,setToastMessage:D,onOpenVersionInfo:S,onOpenUsageGuide:E,apiKey:R,onSetApiKey:M,isOfflineMode:O,onToggleOfflineMode:F,googleUser:I,onGoogleLogin:w,onGoogleLogout:C,onSyncDataToFirebase:N,onLoadDataFromFirebase:b,isGoogleLoggingIn:V=!1,isGoogleLoggingOut:k=!1,isSyncingData:xe=!1,isLoadingData:Fe=!1,isAutoSyncEnabled:Me,setIsAutoSyncEnabled:he})=>{const[J,le]=xa(t),[pe,Pe]=$.useState("appearance"),[oe,et]=$.useState(""),[Je,jt]=$.useState(!1),[Et,sn]=$.useState("medium"),[fn,Jt]=$.useState(null),Fn=$.useRef(null),_r=[{id:"appearance",label:T("settings_section_background"),icon:_e.background},{id:"notifications",label:T("settings_notifications"),icon:_e.settings},{id:"general",label:T("settings_section_general"),icon:_e.settings},{id:"data",label:T("settings_section_data"),icon:_e.data}],er=()=>u({title:T("delete_account_header"),message:T("delete_account_header_desc"),isDestructive:!0,confirmText:T("delete_all_data_button"),cancelText:T("cancel_button"),onConfirm:f,onCancel:()=>{}}),on=async()=>{if(!x||x.length===0){Jt(T("no_data_to_share"));return}jt(!0);try{const Ie=KI(x),Un=`${window.location.origin}${window.location.pathname}?data=${encodeURIComponent(Ie)}`,ot=await Zx(Un);et(ot),ot!==Un&&ot.length<Un.length?D(T("short_url_created")):D(T("share_link_created"))}catch(Ie){console.error("Failed to create share link",Ie);const Un=KI(x),ot=`${window.location.origin}${window.location.pathname}?data=${encodeURIComponent(Un)}`;et(ot),D(T("short_url_failed"))}finally{jt(!1)}},yr=()=>{oe&&navigator.clipboard.writeText(oe).then(()=>{D(T("link_copied_toast"))})},Ne=()=>{switch(pe){case"appearance":return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"settings-section-header",children:T("settings_theme_mode")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>i("light"),children:[m.jsxs("div",{children:[m.jsx("span",{children:T("theme_mode_light")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:T("theme_mode_light_desc")})]}),r==="light"&&_e.check]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>i("dark"),children:[m.jsxs("div",{children:[m.jsx("span",{children:T("theme_mode_dark")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:T("theme_mode_dark_desc")})]}),r==="dark"&&_e.check]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>i("system"),children:[m.jsxs("div",{children:[m.jsx("span",{children:T("theme_mode_system")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:T("theme_mode_system_desc")})]}),r==="system"&&_e.check]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_background_header")}),m.jsx("div",{className:"settings-section-body",children:Km.map(Ie=>m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>o(Ie.id),children:[m.jsx("span",{children:T(e?Ie.darkNameKey:Ie.lightNameKey)}),s===Ie.id&&_e.check]},Ie.id))})]});case"notifications":return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"settings-section-header",children:T("notification_settings_title")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsxs("label",{className:"settings-item",children:[m.jsxs("div",{children:[m.jsx("span",{children:T("notification_deadline")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:T("notification_deadline_desc")})]}),m.jsxs("div",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",defaultChecked:!0,onChange:()=>{}}),m.jsx("span",{className:"slider round"})]})]}),m.jsxs("label",{className:"settings-item",children:[m.jsxs("div",{children:[m.jsx("span",{children:T("notification_suggestion")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:"지정된 시간에 할일을 제안합니다."})]}),m.jsxs("div",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",defaultChecked:!0,onChange:()=>{}}),m.jsx("span",{className:"slider round"})]})]})]}),m.jsx("div",{className:"settings-section-header",children:"알림 권한"}),m.jsxs("div",{className:"settings-section-body",children:[m.jsx("button",{className:"settings-item action-item",onClick:async()=>{await Yx()?(D("알림 권한이 허용되었습니다."),await Xx()):D("알림 권한을 거부했습니다.")},children:m.jsx("span",{className:"action-text",children:"알림 권한 요청"})}),m.jsxs("div",{style:{fontSize:"12px",opacity:.7,padding:"12px",marginTop:"8px"},children:["현재 권한: ",Notification.permission==="granted"?"✓ 허용됨":Notification.permission==="denied"?"✗ 거부됨":"? 미정"]})]})]});case"general":return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"settings-section-header",children:T("settings_language")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>v("ko"),children:[m.jsx("span",{children:"한국어"}),g==="ko"&&_e.check]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>v("en"),children:[m.jsx("span",{children:"English"}),g==="en"&&_e.check]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_api_key")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsx("div",{className:"settings-item",children:m.jsx("input",{type:"password",placeholder:T("settings_api_key_placeholder"),value:R,onChange:Ie=>M(Ie.target.value),style:{width:"100%",padding:"8px",border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--input-bg)"}})}),m.jsxs("label",{className:"settings-item",children:[m.jsxs("div",{children:[m.jsx("span",{children:T("settings_offline_mode")}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:T("settings_offline_mode_desc")})]}),m.jsxs("div",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:O,onChange:F}),m.jsx("span",{className:"slider round"})]})]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_section_info")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsxs("div",{className:"settings-item nav-indicator",onClick:S,children:[m.jsx("span",{children:T("settings_version")}),m.jsxs("div",{className:"settings-item-value-with-icon",children:[m.jsx("span",{children:"1.5"}),_e.forward]})]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:E,children:[m.jsx("span",{children:T("usage_guide_title")}),m.jsx("div",{className:"settings-item-value-with-icon",children:_e.forward})]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>{Jt(`이것은 매우 긴 알림 메시지입니다.

이 메시지는 여러 줄에 걸쳐 작성되었으며, 알림 팝업이 내용에 맞게 세로로 확장되는지 테스트하기 위한 목적으로 만들어졌습니다.

줄바꿈 문자도 포함되어 있고,
여러 문단으로 구성되어 있습니다.

이런 식으로 긴 에러 메시지나 안내 메시지가 표시될 때도 팝업이 적절하게 크기 조정이 되어야 합니다.

스크롤이 필요할 정도로 매우 긴 내용일 때는 스크롤바가 나타나야 하고, 버튼 영역은 항상 하단에 고정되어 있어야 합니다.`)},children:[m.jsx("span",{children:T("test_long_alert")}),m.jsxs("div",{className:"settings-item-value-with-icon",children:[m.jsx("span",{children:T("test_long_alert_desc")}),_e.forward]})]}),m.jsxs("div",{className:"settings-item",children:[m.jsx("span",{children:T("settings_developer")}),m.jsx("span",{className:"settings-item-value",children:T("developer_name")})]}),m.jsxs("div",{className:"settings-item",children:[m.jsx("span",{children:T("settings_copyright")}),m.jsx("span",{className:"settings-item-value",children:T("copyright_notice")})]})]})]});case"data":return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"settings-section-header",children:"계정"}),m.jsxs("div",{className:"settings-section-body",children:[I?m.jsxs("div",{children:[m.jsxs("div",{className:"settings-item",children:[m.jsxs("div",{children:[m.jsx("span",{children:"Google 계정"}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:I.email}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:I.displayName})]}),m.jsx("span",{style:{color:"var(--success-color, #4CAF50)"},children:"✓"})]}),m.jsx("button",{className:"settings-item action-item",onClick:C,disabled:k,style:{opacity:k?.6:1},children:m.jsx("span",{className:"action-text",children:k?"⏳ 로그아웃 중...":"로그아웃"})})]}):m.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"12px 0"},children:m.jsxs("button",{onClick:w,disabled:V,style:{backgroundColor:V?"#E0E0E0":"white",border:"1px solid #D3D3D3",borderRadius:"24px",padding:"8px 20px",fontSize:"14px",fontWeight:"500",cursor:V?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",color:V?"#999999":"#1F2937",transition:"all 0.2s",opacity:V?.6:1},children:[m.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[m.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),m.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),m.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),m.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),V?"로그인 중...":"Google로 로그인"]})}),m.jsx("div",{className:"settings-section-header",children:"클라우드 동기화"}),m.jsx("div",{className:"settings-section-body",children:I&&m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"settings-item action-item",onClick:N,disabled:xe,children:m.jsx("span",{className:"action-text",children:xe?"저장중...":"클라우드에 저장"})}),m.jsx("button",{className:"settings-item action-item",onClick:b,disabled:Fe,children:m.jsx("span",{className:"action-text",children:Fe?"로드중...":"클라우드에서 불러오기"})}),m.jsxs("label",{className:"settings-item",children:[m.jsxs("div",{children:[m.jsx("span",{children:"자동 동기화"}),m.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:"목표 변경 시 자동으로 저장"})]}),m.jsxs("div",{className:"theme-toggle-switch",children:[m.jsx("input",{type:"checkbox",checked:Me,onChange:Ie=>he(Ie.target.checked)}),m.jsx("span",{className:"slider round"})]})]})]})}),m.jsx("div",{className:"settings-section-header",children:T("settings_data_header")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsx("button",{className:"settings-item action-item",onClick:a,disabled:p!=="idle",children:m.jsx("span",{className:"action-text",children:T(p==="exporting"?"data_exporting":"settings_export_data")})}),m.jsxs("button",{className:"settings-item action-item",onClick:()=>{var Ie;return(Ie=Fn.current)==null?void 0:Ie.click()},disabled:p!=="idle",children:[m.jsx("span",{className:"action-text",children:T(p==="importing"?"data_importing":"settings_import_data")}),m.jsx("input",{type:"file",ref:Fn,onChange:l,accept:".json",style:{display:"none"}})]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_share_link_header")}),m.jsxs("div",{className:"settings-section-body",children:[!oe&&m.jsx("button",{className:"settings-item action-item",onClick:on,disabled:Je,children:m.jsx("span",{className:"action-text",children:Je?"단축 URL 생성 중...":T("settings_generate_link")})}),oe&&m.jsxs("div",{className:"share-link-container",children:[m.jsxs("div",{style:{marginBottom:"8px",fontSize:"12px",opacity:.7},children:[oe.length<100?"단축 URL":"일반 링크"," (",oe.length,"자)"]}),m.jsx("input",{type:"text",readOnly:!0,value:oe,onClick:Ie=>Ie.target.select()}),m.jsx("button",{onClick:yr,children:T("settings_copy_link")})]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_section_info")}),m.jsxs("div",{className:"settings-section-body",children:[m.jsxs("div",{className:"settings-item nav-indicator",onClick:S,children:[m.jsx("span",{children:T("settings_version")}),m.jsxs("div",{className:"settings-item-value-with-icon",children:[m.jsx("span",{children:"1.5"}),_e.forward]})]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:E,children:[m.jsx("span",{children:T("usage_guide_title")}),m.jsx("div",{className:"settings-item-value-with-icon",children:_e.forward})]}),m.jsxs("div",{className:"settings-item nav-indicator",onClick:()=>{Jt(`This is a very long alert message.

This message spans multiple lines and is designed to test whether the alert popup properly expands vertically to accommodate longer content.

It includes line breaks,
and multiple paragraphs.

When long error messages or guidance messages like this are displayed, the popup should adjust its size appropriately.

For extremely long content that requires scrolling, a scrollbar should appear, and the button area should always remain fixed at the bottom.`)},children:[m.jsx("span",{children:T("test_long_alert")}),m.jsxs("div",{className:"settings-item-value-with-icon",children:[m.jsx("span",{children:T("test_long_alert_desc")}),_e.forward]})]}),m.jsxs("div",{className:"settings-item",children:[m.jsx("span",{children:T("settings_developer")}),m.jsx("span",{className:"settings-item-value",children:T("developer_name")})]}),m.jsxs("div",{className:"settings-item",children:[m.jsx("span",{children:T("settings_copyright")}),m.jsx("span",{className:"settings-item-value",children:T("copyright_notice")})]})]}),m.jsx("div",{className:"settings-section-header",children:T("settings_delete_account")}),m.jsx("div",{className:"settings-section-body",children:m.jsx("button",{className:"settings-item action-item",onClick:er,disabled:p!=="idle",children:m.jsx("span",{className:"action-text destructive",children:T(p==="deleting"?"data_deleting":"settings_delete_account")})})})]})]});default:return null}};return m.jsxs(Ys,{onClose:le,isClosing:J,className:"settings-modal",size:Et,children:[m.jsxs("div",{className:"settings-modal-header",children:[m.jsx("h2",{children:T("settings_title")}),m.jsx("div",{className:"settings-modal-header-right",children:m.jsx("button",{onClick:le,className:"close-button",children:_e.close})})]}),m.jsxs("div",{className:"settings-modal-body",children:[m.jsx("div",{className:"settings-tabs",children:_r.map(Ie=>m.jsxs("button",{className:`settings-tab-button ${pe===Ie.id?"active":""}`,onClick:()=>Pe(Ie.id),"aria-label":Ie.label,children:[m.jsx("div",{className:"settings-tab-icon",children:Ie.icon}),m.jsx("span",{children:Ie.label})]},Ie.id))}),m.jsx("div",{className:"settings-tab-content-container",children:m.jsx("div",{className:"settings-tab-content",children:Ne()},pe)})]}),fn&&m.jsx("div",{className:"modal-backdrop alert-backdrop",children:m.jsxs("div",{className:"modal-content alert-modal",children:[m.jsxs("div",{className:"alert-content",children:[m.jsx("h2",{children:"알림"}),m.jsx("p",{children:fn})]}),m.jsx("div",{className:"modal-buttons",children:m.jsx("button",{onClick:()=>Jt(null),className:"primary",children:"확인"})})]})})]})},JI=({onClose:t,t:e})=>{const[n,r]=xa(t),i="2.0.0 (25.10.24)",s=[{icon:"🔔",title:"미리알림 관리",desc:"Step-by-step 미리알림 추가. 제목, 기한(선택), 시간(선택), 반복 설정, 설명, 활성화 여부"},{icon:"📅",title:"유연한 날짜/시간 설정",desc:"기한 없음, 시간 없음 옵션으로 필요한 정보만 선택적 입력 가능"},{icon:"🎯",title:"WOOP 목표 설정",desc:"5단계 마법사 (Wish → Outcome → Obstacle → Plan → 기한/반복)로 구조화된 목표 계획"},{icon:"🤖",title:"AI 코치 피드백",desc:"Gemini API 기반 각 단계별 실시간 AI 피드백으로 목표 개선"},{icon:"🔐",title:"Google 로그인",desc:"Google OAuth 인증으로 보안 강화 및 계정 관리"},{icon:"☁️",title:"Firebase 클라우드 동기화",desc:"목표, 설정, 미리알림 등 모든 데이터 Firebase Firestore에 자동 저장"},{icon:"🔄",title:"자동 동기화 제어",desc:"켜고 끄기 옵션으로 클라우드 자동 동기화 제어 가능"},{icon:"🌙",title:"다크 모드 & 테마",desc:"시스템/라이트/다크 모드 자동 감지 및 8가지 배경 테마 지원"},{icon:"📱",title:"PWA & 오프라인",desc:"모바일 PWA 자동 설치 배너, 오프라인 모드, 푸시 알림 지원"},{icon:"🗓️",title:"달력 보기",desc:"3일/주간/월간 달력 뷰로 목표 스케줄링 및 시각화"},{icon:"📤",title:"데이터 내보내기/가져오기",desc:"JSON 형식으로 모든 데이터 로컬 저장 및 복원"},{icon:"🌍",title:"다국어 지원",desc:"한국어, 영어 등 다국어 인터페이스 지원"}];return m.jsxs(Ys,{onClose:r,isClosing:n,className:"version-info-modal",children:[m.jsxs("div",{className:"version-info-header",children:[m.jsx("h2",{children:"🧪 Nova AI Planner v2.0 Beta"}),m.jsxs("p",{children:[e("build_number"),": ",i]})]}),m.jsx("div",{className:"version-info-body",children:s.map((o,a)=>m.jsxs("div",{className:"changelog-item",children:[m.jsx("div",{className:"changelog-icon",style:{"--icon-bg":"var(--primary-color)"},children:o.icon}),m.jsxs("div",{className:"changelog-text",children:[m.jsx("h3",{children:o.title}),m.jsx("p",{children:o.desc})]})]},a))}),m.jsx("div",{className:"modal-buttons",children:m.jsx("button",{onClick:r,className:"primary",children:e("settings_done_button")})})]})},B3=({onClose:t,t:e})=>{const[n,r]=xa(t),i=o=>{const a=/(https?:\/\/[^\s]+)/g;return o.split(a).map((u,f)=>a.test(u)?m.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"guide-link",children:u},f):u)},s=[{titleKey:"usage_basic_title",descKey:"usage_basic_desc"},{titleKey:"usage_ai_setup_title",descKey:"usage_ai_setup_desc"},{titleKey:"usage_ai_use_title",descKey:"usage_ai_use_desc"},{titleKey:"usage_share_title",descKey:"usage_share_desc"},{titleKey:"usage_theme_title",descKey:"usage_theme_desc"},{titleKey:"usage_calendar_title",descKey:"usage_calendar_desc"},{titleKey:"usage_offline_title",descKey:"usage_offline_desc"}];return m.jsxs(Ys,{onClose:r,isClosing:n,className:"usage-guide-modal",children:[m.jsx("div",{className:"version-info-header",children:m.jsx("h2",{children:e("usage_guide_title")})}),m.jsx("div",{className:"version-info-body",children:s.map((o,a)=>m.jsxs("div",{className:"usage-guide-item",children:[m.jsx("h3",{children:e(o.titleKey)}),m.jsx("p",{children:o.titleKey==="usage_ai_setup_title"?i(e(o.descKey)):e(o.descKey)})]},a))}),m.jsx("div",{className:"modal-buttons",children:m.jsx("button",{onClick:r,className:"primary",children:e("settings_done_button")})})]})},q3=({todos:t,t:e,onGoalClick:n,language:r})=>{const[i,s]=$.useState(new Date),[o,a]=$.useState("week"),l=g=>{const v=new Date(i);o==="month"?v.setMonth(v.getMonth()+g):o==="week"?v.setDate(v.getDate()+g*7):v.setDate(v.getDate()+g*3),s(v)},u=$.useMemo(()=>{const g=[];let v,T;if(o==="month"){const x=new Date(i.getFullYear(),i.getMonth(),1);v=HI(x,r==="ko"?1:0),T=42}else o==="week"?(v=HI(i,r==="ko"?1:0),T=7):(v=new Date(i),v.setDate(v.getDate()-1),T=3);for(let x=0;x<T;x++){const D=new Date(v);D.setDate(D.getDate()+x),g.push(D)}return g},[i,o,r]),f=$.useMemo(()=>{if(o==="month"){const g=i.getFullYear(),v=e("month_names")[i.getMonth()],T=e("calendar_header_month_format");return T&&typeof T=="string"&&T!=="calendar_header_month_format"?T.replace("{year}",String(g)).replace("{month}",v):`${v} ${g}`}return`${i.getFullYear()}.${i.getMonth()+1}`},[i,o,e]),p=$.useMemo(()=>{const g=e("day_names_short");if(r==="ko"&&Array.isArray(g)){const[v,...T]=g;return[...T,v]}return g},[r,e]);return m.jsxs("div",{className:"calendar-view-container",children:[m.jsxs("div",{className:"calendar-header",children:[m.jsx("button",{onClick:()=>l(-1),children:_e.back}),m.jsx("h2",{children:f}),m.jsx("button",{onClick:()=>l(1),children:_e.forward})]}),m.jsxs("div",{className:"calendar-view-mode-selector",children:[m.jsx("button",{onClick:()=>a("day3"),className:o==="day3"?"active":"",children:e("calendar_view_day3")}),m.jsx("button",{onClick:()=>a("week"),className:o==="week"?"active":"",children:e("calendar_view_week")}),m.jsx("button",{onClick:()=>a("month"),className:`calendar-view-button-month ${o==="month"?"active":""}`,children:e("calendar_view_month")})]}),(o==="week"||o==="month")&&m.jsx("div",{className:"calendar-days-of-week",children:Array.isArray(p)&&p.map(g=>m.jsx("div",{children:g},g))}),m.jsx("div",{className:`calendar-grid view-mode-${o}`,children:u.map(g=>{const T=Ol(g,new Date),x=g.getMonth()===i.getMonth(),D=t.filter(S=>{if(S.isRecurring){const E=(g.getDay()+6)%7;return S.recurringDays.includes(E)}return S.deadline&&Ol(g,S.deadline)});return m.jsxs("div",{className:`calendar-day ${!x&&o==="month"?"not-current-month":""} ${T?"is-today":""}`,"data-day-name":e("day_names_long")[g.getDay()],children:[m.jsx("div",{className:"day-header",children:m.jsx("span",{className:"day-number",children:g.getDate()})}),m.jsx("div",{className:"calendar-goals",children:D.map(S=>m.jsx("div",{className:`calendar-goal-item ${S.completed&&S.lastCompletedDate&&Ol(g,S.lastCompletedDate)?"completed":""}`,onClick:()=>n(S),children:S.wish},S.id))})]},g.toISOString())})})]})},G3=({title:t,message:e,onConfirm:n,onCancel:r,confirmText:i,cancelText:s,isDestructive:o,t:a})=>{const l=typeof r=="function";return m.jsx("div",{className:"modal-backdrop alert-backdrop",children:m.jsxs("div",{className:"modal-content alert-modal",children:[m.jsxs("div",{className:"alert-content",children:[m.jsx("h2",{children:t}),m.jsx("p",{dangerouslySetInnerHTML:{__html:e}})]}),m.jsxs("div",{className:"modal-buttons",children:[l&&m.jsx("button",{onClick:r,className:"secondary",children:s||a("cancel_button")}),m.jsx("button",{onClick:n,className:o?"destructive":"primary",children:i||a("confirm_button")})]})]})})},z3=lp.createRoot(document.getElementById("root"));z3.render(m.jsx(ow.StrictMode,{children:m.jsx(k3,{})}));
